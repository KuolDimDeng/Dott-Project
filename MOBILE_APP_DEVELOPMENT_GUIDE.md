# Mobile App Development Guide

**Last Updated: 2025-08-30**

## Critical Understanding: How Mobile HTML Files Work

### ðŸš¨ IMPORTANT: Never Edit `/out/` Directory Directly

The `/frontend/pyfactor_next/out/` directory contains **generated files** that are:
- Created by Next.js build process
- **Overwritten** on every build
- **Git ignored** (changes won't persist)
- **Copied to mobile apps** during Capacitor sync

### Mobile App File Flow

```
Source Files (src/) 
    â†“ (next build)
Generated Files (out/) 
    â†“ (cap sync)
Mobile App Bundle (android/ios)
```

## How to Fix Mobile App Navigation Issues

### Problem: Mobile app shows "file not found" errors
**Root Cause**: Mobile app bundle contains cached/old navigation references

### Solution Steps:

1. **Update source files** (not out/ files)
2. **Rebuild mobile bundle**
3. **Sync with Capacitor**
4. **Deploy updated mobile app**

### Commands for Mobile Updates:

```bash
# Build mobile-specific version
pnpm run build:mobile

# Sync with Capacitor (copies out/ to mobile apps)
pnpm run cap:sync

# Build and sync in one command
pnpm run mobile:build
```

## Mobile App Architecture

### Static HTML Files
- Location: `/frontend/pyfactor_next/out/*.html`
- Purpose: Pre-built pages for mobile app
- Generated by: Next.js static export (`output: 'export'`)
- Config: `next.config.mobile.js`

### Key Mobile Files:
- `mobile-menu.html` - Main navigation
- `mobile-payroll.html` - Payroll landing page
- `mobile-payroll-run.html` - Payroll execution
- `mobile-payroll-review.html` - Payroll review
- `mobile-payroll-history.html` - Payroll history
- `mobile-payroll-tax.html` - Tax filing

### Navigation Pattern:
```javascript
// Mobile pages use direct HTML navigation
window.location.href = 'mobile-payroll-run.html';
```

## Common Issues & Solutions

### Issue: "File doesn't exist" after adding new features
**Solution**: 
1. Check if file exists in `/out/` directory
2. If missing, create source file in `/src/` 
3. Run `pnpm run build:mobile`
4. Run `pnpm run cap:sync`

### Issue: Changes not reflecting in mobile app
**Cause**: Edited `/out/` files directly (gets overwritten)
**Solution**: 
1. Find/create corresponding source file
2. Make changes to source
3. Rebuild mobile bundle

### Issue: Mobile app cached old navigation
**Solution**:
```bash
# Clear build cache
rm -rf .next
rm -rf out

# Rebuild everything
pnpm run build:mobile
pnpm run cap:sync
```

## Development Workflow

### For Mobile Features:
1. **Create/edit source files** in `/src/`
2. **Test locally** with `pnpm run dev`
3. **Build mobile version** with `pnpm run build:mobile`
4. **Sync to mobile** with `pnpm run cap:sync`
5. **Test mobile app** in iOS/Android simulator
6. **Commit source changes** to git
7. **Deploy** to staging/production

### Never Do:
- âŒ Edit files in `/out/` directory directly
- âŒ Commit `/out/` directory to git
- âŒ Expect manual `/out/` changes to persist

### Always Do:
- âœ… Edit source files in `/src/` directory
- âœ… Use `build:mobile` for mobile changes
- âœ… Use `cap:sync` after mobile builds
- âœ… Test mobile changes before deploying

## Mobile-Specific Configuration

### Next.js Config (`next.config.mobile.js`):
```javascript
{
  output: 'export',           // Static HTML generation
  images: { unoptimized: true }, // No image optimization
  trailingSlash: true,        // Better mobile compatibility
}
```

### Capacitor Config (`capacitor.config.ts`):
```javascript
{
  webDir: 'out',  // Points to generated HTML files
  server: {
    androidScheme: 'https'
  }
}
```

## Troubleshooting Commands

```bash
# Check what's in the mobile bundle
ls -la out/mobile-*.html

# Rebuild from scratch
rm -rf .next out
pnpm run build:mobile

# Check Capacitor sync status
npx cap doctor

# View mobile build logs
pnpm run build:mobile 2>&1 | tee build.log
```

## Key Learnings

1. **Mobile apps use static HTML files**, not React components
2. **Build process generates these files** from source
3. **Direct edits to `/out/` are temporary** and will be lost
4. **Capacitor sync copies `/out/` to mobile apps**
5. **Source changes require rebuild + sync** to reach mobile
6. **Mobile navigation uses direct file references**, not routing

## Recent Issue Resolution (Aug 30, 2025)

**Problem**: Mobile app couldn't find `mobile-payroll.html` after payroll implementation
**Root Cause**: Navigation was looking for old file name
**Solution**: Updated existing `mobile-payroll.html` to redirect to correct payroll pages
**Prevention**: This documentation to avoid future confusion

---

**Remember**: Mobile development requires understanding the build â†’ sync â†’ deploy pipeline. Always work with source files, never output files.