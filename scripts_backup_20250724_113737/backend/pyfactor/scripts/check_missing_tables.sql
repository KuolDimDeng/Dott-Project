-- Check which tables are missing in staging compared to production
-- Run this in staging database

WITH production_tables (table_name) AS (
    VALUES 
    ('admin_audit_logs'),
    ('admin_sessions'),
    ('admin_users'),
    ('analysis_chartconfiguration'),
    ('analysis_financialdata'),
    ('audit_log'),
    ('audit_log_retention'),
    ('auth_group'),
    ('auth_group_permissions'),
    ('auth_permission'),
    ('banking_audit_log'),
    ('banking_bankaccount'),
    ('banking_banktransaction'),
    ('banking_country'),
    ('banking_countrypaymentgateway'),
    ('banking_paymentgateway'),
    ('banking_plaiditem'),
    ('banking_rules'),
    ('banking_tinkitem'),
    ('crm_activity'),
    ('crm_campaign'),
    ('crm_campaignmember'),
    ('crm_contact'),
    ('crm_customer'),
    ('crm_deal'),
    ('crm_lead'),
    ('crm_opportunity'),
    ('custom_auth_account_deletion_log'),
    ('custom_auth_accountdeletionlog'),
    ('custom_auth_passwordresettoken'),
    ('custom_auth_tenant'),
    ('custom_auth_user'),
    ('developing_countries'),
    ('device_fingerprints'),
    ('device_trust'),
    ('discount_verifications'),
    ('django_content_type'),
    ('django_migrations'),
    ('django_site'),
    ('events_event'),
    ('finance_account'),
    ('finance_accountcategory'),
    ('finance_accountreconciliation'),
    ('finance_accounttype'),
    ('finance_audittrail'),
    ('finance_budget'),
    ('finance_budgetitem'),
    ('finance_cashaccount'),
    ('finance_chartofaccount'),
    ('finance_costallocation'),
    ('finance_costcategory'),
    ('finance_costentry'),
    ('finance_financetransaction'),
    ('finance_financialstatement'),
    ('finance_fixedasset'),
    ('finance_generalledgerentry'),
    ('finance_income'),
    ('finance_intercompanyaccount'),
    ('finance_intercompanytransaction'),
    ('finance_journalentry'),
    ('finance_journalentryline'),
    ('finance_monthendclosing'),
    ('finance_monthendtask'),
    ('finance_reconciliationitem'),
    ('finance_revenueaccount'),
    ('finance_salestaxaccount'),
    ('hr_accesspermission'),
    ('hr_benefits'),
    ('hr_companyholiday'),
    ('hr_employee'),
    ('hr_employee_groups'),
    ('hr_employee_supervising'),
    ('hr_employee_user_permissions'),
    ('hr_employeegeofence'),
    ('hr_employeerole'),
    ('hr_feedbackrecord'),
    ('hr_geofence'),
    ('hr_geofenceevent'),
    ('hr_locationlog'),
    ('hr_performancegoal'),
    ('hr_performancemetric'),
    ('hr_performancerating'),
    ('hr_performancereview'),
    ('hr_performancesetting'),
    ('hr_preboardingform'),
    ('hr_role'),
    ('hr_timeoffbalance'),
    ('hr_timeoffrequest'),
    ('hr_timesheet'),
    ('hr_timesheetentry'),
    ('hr_timesheetsetting'),
    ('integrations_integration'),
    ('integrations_shopifyintegration'),
    ('integrations_woocommerceintegration'),
    ('integrations_woocommerceorder'),
    ('inventory_category'),
    ('inventory_customchargeplan'),
    ('inventory_department'),
    ('inventory_inventoryitem'),
    ('inventory_inventorytransaction'),
    ('inventory_location'),
    ('inventory_product'),
    ('inventory_producttypefields'),
    ('inventory_service'),
    ('inventory_service_custom_charge_plans'),
    ('inventory_servicetypefields'),
    ('inventory_supplier'),
    ('lead_activities'),
    ('leads'),
    ('leads_lead'),
    ('leads_leadactivity'),
    ('migration_log'),
    ('mobile_money_countries'),
    ('mobile_money_providers'),
    ('mobile_money_providers_countries'),
    ('notification_recipients'),
    ('notification_templates'),
    ('notifications'),
    ('onboarding_onboardingprogress'),
    ('onboarding_userprofile'),
    ('page_permissions'),
    ('payments_countrypaymentmethod'),
    ('payments_exchangerate'),
    ('payments_invoice_payment'),
    ('payments_paymentmethod'),
    ('payments_paymentprovider'),
    ('payments_paymenttransaction'),
    ('payments_platform_fee_collection'),
    ('payments_vendor_payment'),
    ('payments_webhookevent'),
    ('payroll_bonuspayment'),
    ('payroll_employeepaymentsetup'),
    ('payroll_employeepayoutrecord'),
    ('payroll_employeestripeaccount'),
    ('payroll_incomewithholding'),
    ('payroll_paymentdepositmethod'),
    ('payroll_payrollrun'),
    ('payroll_payrollstripepayment'),
    ('payroll_payrolltransaction'),
    ('payroll_paysetting'),
    ('payroll_paystatement'),
    ('payroll_taxform'),
    ('purchases_bill'),
    ('purchases_billitem'),
    ('purchases_expense'),
    ('purchases_procurement'),
    ('purchases_procurementitem'),
    ('purchases_purchase'),
    ('purchases_purchaseorder'),
    ('purchases_purchaseorderitem'),
    ('purchases_purchasereturn'),
    ('purchases_purchasereturnitem'),
    ('purchases_vendor'),
    ('reports_report'),
    ('role_template_pages'),
    ('role_templates'),
    ('sales_estimate'),
    ('sales_estimateattachment'),
    ('sales_estimateitem'),
    ('sales_invoice'),
    ('sales_invoiceitem'),
    ('sales_pos_refund'),
    ('sales_pos_refund_item'),
    ('sales_pos_transaction'),
    ('sales_pos_transaction_item'),
    ('sales_product'),
    ('sales_refund'),
    ('sales_refunditem'),
    ('sales_sale'),
    ('sales_saleitem'),
    ('sales_salesorder'),
    ('sales_salesorderitem'),
    ('sales_tax'),
    ('session_events'),
    ('session_security'),
    ('shopify_customers'),
    ('shopify_order_items'),
    ('shopify_orders'),
    ('shopify_products'),
    ('smart_insights_creditpackage'),
    ('smart_insights_credittransaction'),
    ('smart_insights_monthlyusage'),
    ('smart_insights_querylog'),
    ('smart_insights_usercredit'),
    ('tax_api_usage'),
    ('tax_filing_locations'),
    ('tax_rate_cache'),
    ('tax_reminders'),
    ('tax_settings'),
    ('taxes_taxdataabusereport'),
    ('taxes_taxdatablacklist'),
    ('taxes_taxdataentrycontrol'),
    ('taxes_taxdataentrylog'),
    ('taxes_taxsuggestionfeedback'),
    ('timesheets_clock_entry'),
    ('timesheets_geofence_zone'),
    ('timesheets_time_entry'),
    ('timesheets_time_off_request'),
    ('timesheets_timesheet'),
    ('user_deletion_tracking'),
    ('user_invitations'),
    ('user_notification_settings'),
    ('user_page_access'),
    ('user_sessions'),
    ('users_business'),
    ('users_business_details'),
    ('users_businessmember'),
    ('users_menu_privilege'),
    ('users_subscription'),
    ('users_usermenuprivilege'),
    ('users_userprofile'),
    ('whatsapp_analytics'),
    ('whatsapp_business_settings'),
    ('whatsapp_catalogs'),
    ('whatsapp_messages'),
    ('whatsapp_order_items'),
    ('whatsapp_orders'),
    ('whatsapp_products')
)
SELECT 
    pt.table_name as missing_table,
    CASE 
        WHEN st.table_name IS NULL THEN 'MISSING'
        ELSE 'EXISTS'
    END as status
FROM production_tables pt
LEFT JOIN information_schema.tables st 
    ON st.table_name = pt.table_name 
    AND st.table_schema = 'public'
WHERE st.table_name IS NULL
ORDER BY pt.table_name;