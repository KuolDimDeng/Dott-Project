packages:
  yum:
    gcc-c++: []
    python3-devel: []
    libpq-devel: []
    # postgresql package removed for AL2023 compatibility
    # The following are added for better PostgreSQL support on AL2023
    wget: []
    unzip: []
    make: []

commands:
  01_install_postgresql_client:
    command: |
      echo "Installing PostgreSQL client utilities..."
      # Try different methods to install PostgreSQL client
      if command -v dnf &> /dev/null; then
        # AL2023 specific methods
        dnf -y module list postgresql || echo "No PostgreSQL module available"
        dnf -y module enable postgresql:14 || echo "Failed to enable PostgreSQL module"
        dnf -y install libpq || echo "Failed to install libpq"
        
        # Try PostgreSQL AppStream
        dnf -y install dnf-plugins-core || echo "Failed to install dnf plugins"
        dnf -y config-manager --add-repo https://download.postgresql.org/pub/repos/yum/14/redhat/rhel-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm || echo "Failed to add PostgreSQL repo"
        dnf -y install postgresql14-server postgresql14-contrib || echo "Failed to install PostgreSQL 14"
      fi
      
      # Check if we have PostgreSQL client now
      if ! command -v psql &> /dev/null; then
        echo "PostgreSQL client not installed via system packages, will be handled by prebuild hook."
      else
        echo "PostgreSQL client successfully installed: $(psql --version)"
      fi
