try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="2461529b-0033-443f-82bd-986687e99018",e._sentryDebugIdIdentifier="sentry-dbid-2461529b-0033-443f-82bd-986687e99018")}catch(e){}(()=>{var e={};e.id=69566,e.ids=[69566],e.modules={110070:(e,t,s)=>{"use strict";let n;s.r(t),s.d(t,{default:()=>m,generateImageMetadata:()=>u,generateMetadata:()=>d,generateViewport:()=>p});var r=s(663033),i=s(778367),a=s(568575),o=(0,i.registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/kuoldeng/projectx/frontend/pyfactor_next/src/app/onboarding/page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/kuoldeng/projectx/frontend/pyfactor_next/src/app/onboarding/page.js","default");let l={...r},c="workUnitAsyncStorage"in l?l.workUnitAsyncStorage:"requestAsyncStorage"in l?l.requestAsyncStorage:void 0;n="function"==typeof o?new Proxy(o,{apply:(e,t,s)=>{let n,r,i;try{let e=c?.getStore();n=e?.headers.get("sentry-trace")??void 0,r=e?.headers.get("baggage")??void 0,i=e?.headers}catch(e){}return a.wrapServerComponentWithSentry(e,{componentRoute:"/onboarding",componentType:"Page",sentryTraceHeader:n,baggageHeader:r,headers:i}).apply(t,s)}}):o;let d=void 0,u=void 0,p=void 0,m=n},157075:e=>{"use strict";e.exports=require("node:stream")},173566:e=>{"use strict";e.exports=require("worker_threads")},176760:e=>{"use strict";e.exports=require("node:path")},257975:e=>{"use strict";e.exports=require("node:util")},286592:e=>{"use strict";e.exports=require("node:inspector")},312053:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.default,__next_app__:()=>d,pages:()=>c,routeModule:()=>u,tree:()=>l});var n=s(972787),r=s(235964),i=s(322685),a=s(538441),o={};for(let e in a)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>a[e]);s.d(t,o);let l={children:["",{children:["onboarding",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,110070)),"/Users/kuoldeng/projectx/frontend/pyfactor_next/src/app/onboarding/page.js"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,666111)),"/Users/kuoldeng/projectx/frontend/pyfactor_next/src/app/onboarding/layout.js"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,527605)),"/Users/kuoldeng/projectx/frontend/pyfactor_next/src/app/layout.js"],error:[()=>Promise.resolve().then(s.bind(s,584635)),"/Users/kuoldeng/projectx/frontend/pyfactor_next/src/app/error.js"],loading:[()=>Promise.resolve().then(s.bind(s,406151)),"/Users/kuoldeng/projectx/frontend/pyfactor_next/src/app/loading.js"],"global-error":[()=>Promise.resolve().then(s.bind(s,322685)),"/Users/kuoldeng/projectx/frontend/pyfactor_next/src/app/global-error.js"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,933674,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,239755,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,237648,23)),"next/dist/client/components/unauthorized-error"]}]}.children,c=["/Users/kuoldeng/projectx/frontend/pyfactor_next/src/app/onboarding/page.js"],d={require:s,loadChunk:()=>Promise.resolve()},u=new n.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/onboarding/page",pathname:"/onboarding",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},321820:e=>{"use strict";e.exports=require("os")},328354:e=>{"use strict";e.exports=require("util")},333873:e=>{"use strict";e.exports=require("path")},341667:(e,t,s)=>{Promise.resolve().then(s.bind(s,110070))},344708:e=>{"use strict";e.exports=require("node:https")},353053:e=>{"use strict";e.exports=require("node:diagnostics_channel")},370921:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>q});var n=s(649431),r=s(427490),i=s(422293),a=s(199529);async function o(){console.log("[ClientSessionHelper] Getting session...");try{let e=await fetch("/api/auth/session-v2",{method:"GET",credentials:"include",cache:"no-store"});if(console.log("[ClientSessionHelper] Response status:",e.status),!e.ok){if(401===e.status)return console.log("[ClientSessionHelper] No valid session"),{authenticated:!1,user:null};throw Error(`Session fetch failed: ${e.status}`)}let t=await e.json();return console.log("[ClientSessionHelper] Session data:",t),{authenticated:t.authenticated||!1,user:t.user||null}}catch(e){return console.error("[ClientSessionHelper] Error fetching session:",e),{authenticated:!1,user:null}}}async function l(e){return console.warn("[ClientSessionHelper] updateClientSession is deprecated in session-v2 system"),console.warn("[ClientSessionHelper] Session updates are handled server-side automatically"),console.log("[ClientSessionHelper] Requested updates were:",e),await o()}let c={NOT_STARTED:"not_started",BUSINESS_INFO:"business_info",SUBSCRIPTION_SELECTION:"subscription_selection",PAYMENT_PENDING:"payment_pending",PAYMENT_PROCESSING:"payment_processing",COMPLETED:"completed",ERROR:"error"},d={[c.NOT_STARTED]:[c.BUSINESS_INFO],[c.BUSINESS_INFO]:[c.SUBSCRIPTION_SELECTION],[c.SUBSCRIPTION_SELECTION]:[c.PAYMENT_PENDING,c.COMPLETED],[c.PAYMENT_PENDING]:[c.PAYMENT_PROCESSING,c.SUBSCRIPTION_SELECTION],[c.PAYMENT_PROCESSING]:[c.COMPLETED,c.PAYMENT_PENDING],[c.COMPLETED]:[c.SUBSCRIPTION_SELECTION],[c.ERROR]:[c.BUSINESS_INFO]};class u{constructor(){this.currentState=null,this.stateData={}}async initialize(){try{let e=await o();if(!e?.authenticated){this.currentState=null;return}let t=e.user;t?.onboardingCompleted||t?.tenantId?this.currentState=c.COMPLETED:this.currentState=c.NOT_STARTED,this.stateData={businessName:t?.businessName||null,selectedPlan:t?.subscriptionPlan||null,onboardingCompleted:t?.onboardingCompleted||!1},a.vF.info("[OnboardingStateMachine] Initialized",{currentState:this.currentState,stateData:this.stateData})}catch(e){a.vF.error("[OnboardingStateMachine] Initialization error",e),this.currentState=c.ERROR}}getCurrentState(){return this.currentState}canTransitionTo(e){return(d[this.currentState]||[]).includes(e)}async transitionTo(e,t={}){if(!this.canTransitionTo(e))throw Error(`Invalid transition from ${this.currentState} to ${e}`);a.vF.info("[OnboardingStateMachine] Transitioning",{from:this.currentState,to:e,data:t});let s=this.currentState;this.currentState=e,this.stateData={...this.stateData,...t};try{await this.saveProgress()}catch(e){throw a.vF.error("[OnboardingStateMachine] Failed to save progress",e),this.currentState=s,e}return this.currentState}async saveProgress(){let e={currentStep:this.currentState,...this.stateData,lastUpdated:new Date().toISOString()};await l({onboardingProgress:e,currentStep:this.currentState}),a.vF.info("[OnboardingStateMachine] Progress saved",e)}async submitBusinessInfo(e){if(a.vF.debug("[OnboardingStateMachine] submitBusinessInfo called",{currentState:this.currentState,businessData:e}),this.currentState!==c.NOT_STARTED&&this.currentState!==c.BUSINESS_INFO)throw Error("Invalid state for business info submission");if(!e.businessName||!e.businessType)throw Error("Business name and type are required");this.currentState===c.NOT_STARTED&&await this.transitionTo(c.BUSINESS_INFO,{startedAt:new Date().toISOString()}),await this.transitionTo(c.SUBSCRIPTION_SELECTION,{businessName:e.businessName,businessType:e.businessType,country:e.country,legalStructure:e.legalStructure,dateFounded:e.dateFounded,completedSteps:["business_info"]})}async selectSubscription(e,t="monthly"){if(this.currentState!==c.SUBSCRIPTION_SELECTION&&this.currentState!==c.COMPLETED)throw Error("Invalid state for subscription selection");this.currentState===c.COMPLETED&&(a.vF.info("[OnboardingStateMachine] Re-selecting subscription from completed state"),await this.transitionTo(c.SUBSCRIPTION_SELECTION,{reselecting:!0,previousPlan:this.stateData.selectedPlan}));let s="free"===e?c.COMPLETED:c.PAYMENT_PENDING;await this.transitionTo(s,{selectedPlan:e,billingCycle:t,paymentPending:"free"!==e,completedSteps:[...this.stateData.completedSteps||[],"subscription"]})}async initiatePayment(){if(this.currentState!==c.PAYMENT_PENDING)throw Error("Invalid state for payment initiation");await this.transitionTo(c.PAYMENT_PROCESSING,{paymentStartedAt:new Date().toISOString()})}async completePayment(e){if(this.currentState!==c.PAYMENT_PROCESSING)throw Error("Invalid state for payment completion");await this.transitionTo(c.COMPLETED,{paymentCompleted:!0,paymentId:e.paymentId,subscriptionId:e.subscriptionId,completedSteps:[...this.stateData.completedSteps||[],"payment"],onboardingCompletedAt:new Date().toISOString()})}async handlePaymentFailure(e){this.currentState===c.PAYMENT_PROCESSING&&await this.transitionTo(c.PAYMENT_PENDING,{lastPaymentError:e.message,paymentFailedAt:new Date().toISOString()})}getNextAction(){switch(this.currentState){case c.NOT_STARTED:return{action:"start",url:"/onboarding"};case c.BUSINESS_INFO:return{action:"complete_business_info",url:"/onboarding"};case c.SUBSCRIPTION_SELECTION:return{action:"select_plan",url:"/onboarding"};case c.PAYMENT_PENDING:return{action:"complete_payment",url:"/onboarding/payment"};case c.PAYMENT_PROCESSING:return{action:"wait",message:"Processing payment..."};case c.COMPLETED:return{action:"access_dashboard",url:`/${this.stateData.tenantId}/dashboard`};case c.ERROR:return{action:"retry",url:"/onboarding"};default:return{action:"unknown",url:"/onboarding"}}}isComplete(){return this.currentState===c.COMPLETED}reset(){this.currentState=c.NOT_STARTED,this.stateData={}}}let p=new u;var m=s(170002);let g={AUTH:"authentication",NETWORK:"network",VALIDATION:"validation",PAYMENT:"payment",SESSION:"session",ONBOARDING:"onboarding",SYSTEM:"system"},b={invalid_credentials:{message:"Invalid email or password",action:"Please check your credentials and try again",category:g.AUTH},email_not_verified:{message:"Email not verified",action:"Please check your email for a verification link",category:g.AUTH},account_locked:{message:"Account temporarily locked",action:"Too many failed attempts. Please try again in 15 minutes",category:g.AUTH},session_expired:{message:"Your session has expired",action:"Please sign in again to continue",category:g.SESSION},network_error:{message:"Connection error",action:"Please check your internet connection and try again",category:g.NETWORK},timeout:{message:"Request timed out",action:"The server is taking too long to respond. Please try again",category:g.NETWORK},ssl_error:{message:"Secure connection failed",action:"There was a problem establishing a secure connection. Please refresh and try again",category:g.NETWORK},missing_required_fields:{message:"Required information missing",action:"Please fill in all required fields",category:g.VALIDATION},invalid_email:{message:"Invalid email address",action:"Please enter a valid email address",category:g.VALIDATION},password_too_weak:{message:"Password too weak",action:"Password must be at least 8 characters with a mix of letters and numbers",category:g.VALIDATION},payment_failed:{message:"Payment failed",action:"Please check your payment details and try again",category:g.PAYMENT},card_declined:{message:"Card declined",action:"Your card was declined. Please try a different payment method",category:g.PAYMENT},insufficient_funds:{message:"Insufficient funds",action:"Please ensure sufficient funds and try again",category:g.PAYMENT},onboarding_incomplete:{message:"Onboarding not complete",action:"Please complete all onboarding steps to access the dashboard",category:g.ONBOARDING},invalid_state_transition:{message:"Invalid action",action:"This action cannot be performed at this time",category:g.ONBOARDING},rate_limit:{message:"Too many requests",action:"Please wait a moment before trying again",category:g.SYSTEM},server_error:{message:"Something went wrong",action:"An unexpected error occurred. Please try again later",category:g.SYSTEM},maintenance:{message:"System maintenance",action:"We're performing maintenance. Please try again in a few minutes",category:g.SYSTEM}};class h{handle(e,t={}){a.vF.error("[ErrorHandler] Error occurred",{error:e.message||e,context:t,stack:e.stack});let s=this.identifyError(e),n=this.getRecoverySuggestions(s,t);return{...s,recovery:n,timestamp:new Date().toISOString(),reference:this.generateErrorReference()}}identifyError(e){if(e.code&&b[e.code])return b[e.code];let t=e.message?.toLowerCase()||"";return t.includes("unauthorized")||t.includes("401")?b.session_expired:t.includes("invalid")&&t.includes("password")?b.invalid_credentials:t.includes("network")||t.includes("fetch")?b.network_error:t.includes("timeout")?b.timeout:t.includes("ssl")||t.includes("certificate")?b.ssl_error:t.includes("payment")||t.includes("stripe")?b.payment_failed:t.includes("declined")?b.card_declined:t.includes("rate limit")||t.includes("429")?b.rate_limit:b.server_error}getRecoverySuggestions(e,t){let s=[];switch(e.category){case g.AUTH:s.push({action:"retry_login",label:"Try signing in again"}),s.push({action:"reset_password",label:"Reset your password"});break;case g.SESSION:s.push({action:"refresh",label:"Refresh the page"}),s.push({action:"login",label:"Sign in again"});break;case g.NETWORK:s.push({action:"retry",label:"Try again"}),s.push({action:"check_connection",label:"Check your connection"});break;case g.PAYMENT:s.push({action:"update_payment",label:"Update payment method"}),s.push({action:"contact_support",label:"Contact support"});break;case g.ONBOARDING:s.push({action:"continue_onboarding",label:"Continue setup"}),s.push({action:"restart_onboarding",label:"Start over"});break;default:s.push({action:"retry",label:"Try again"}),s.push({action:"contact_support",label:"Get help"})}return s}generateErrorReference(){return`ERR-${Date.now().toString(36).toUpperCase()}`}toComponentProps(e,t){let s=this.handle(e,t);return{title:s.message,description:s.action,suggestions:s.recovery,reference:s.reference,severity:this.getSeverity(s.category),showContactSupport:s.category===g.SYSTEM}}getSeverity(e){switch(e){case g.AUTH:case g.SESSION:return"warning";case g.PAYMENT:case g.SYSTEM:return"error";default:return"info"}}isRetryable(e){let t=this.identifyError(e);return[g.NETWORK,g.SYSTEM].includes(t.category)&&t.message!==b.rate_limit.message}getRetryDelay(e,t=1){return this.identifyError(e).message===b.rate_limit.message?6e4:Math.min(1e3*Math.pow(2,t-1),3e4)}}let y=new h;class x{constructor(){this.baseURL="https://dott-api-y26w.onrender.com",this.maxRetries=3,this.retryDelay=1e3,this.timeout=3e4}async request(e,t={}){let s;a.vF.debug("[ApiClient] Request started",{url:e,method:t.method||"GET",hasBody:!!t.body});let n=new AbortController,r=setTimeout(()=>n.abort(),this.timeout),i={...t,credentials:"include",signal:n.signal,headers:{"Content-Type":"application/json",...t.headers}},o=await m.sessionManagerEnhanced.getSession();a.vF.debug("[ApiClient] Session check:",{hasSession:!!o,authenticated:o?.authenticated,hasSessionToken:!!o?.sessionToken,hasAccessToken:!!o?.accessToken,sessionTokenType:o?.sessionToken?typeof o.sessionToken:"none",sessionTokenPreview:o?.sessionToken?o.sessionToken.substring(0,20)+"...":"none"}),o?.authenticated&&(o.sessionToken?(i.headers.Authorization=`Session ${o.sessionToken}`,a.vF.debug("[ApiClient] Added session token to Authorization header")):o.accessToken?(i.headers.Authorization=`Bearer ${o.accessToken}`,a.vF.debug("[ApiClient] Added access token to Authorization header (fallback)")):a.vF.debug("[ApiClient] Session is authenticated, relying on cookies (no session/access token available)")),a.vF.debug("[ApiClient] Final request headers:",{...i.headers,credentials:i.credentials});let l=0;for(;l<this.maxRetries;)try{l++,a.vF.debug(`[ApiClient] Request attempt ${l}`,{url:e,method:t.method});let n=await fetch(e,i);if(clearTimeout(r),!n.ok){let e=n.clone(),t=await this.parseErrorResponse(e);if(n.status>=400&&n.status<500)throw t;if(s=t,l<this.maxRetries){let e=y.getRetryDelay(t,l);a.vF.warn(`[ApiClient] Retrying after ${e}ms due to:`,t.message),await this.delay(e);continue}}let o=n.clone();return await this.parseResponse(o)}catch(e){if(clearTimeout(r),"AbortError"===e.name?(s=Error("Request timeout")).code="timeout":s=e,l<this.maxRetries&&y.isRetryable(s)){let e=y.getRetryDelay(s,l);a.vF.warn(`[ApiClient] Retrying after ${e}ms due to:`,s.message),await this.delay(e);continue}break}throw s}async parseErrorResponse(e){let t;try{t=await e.json()}catch{t={message:`HTTP ${e.status}: ${e.statusText}`}}let s=Error(t.message||t.error||"Request failed");return s.status=e.status,s.code=t.code||this.getErrorCode(e.status),s.details=t,s}async parseResponse(e){let t=e.headers.get("content-type");return t?.includes("application/json")?await e.json():await e.text()}getErrorCode(e){switch(e){case 401:return"unauthorized";case 403:return"forbidden";case 404:return"not_found";case 429:return"rate_limit";case 500:return"server_error";case 503:return"maintenance";default:return"unknown_error"}}delay(e){return new Promise(t=>setTimeout(t,e))}async get(e,t={}){return this.request(e,{...t,method:"GET"})}async post(e,t,s={}){return a.vF.info("[ApiClient] POST request:",{url:e,data:t}),console.log("\uD83D\uDEA8 [ApiClient] POST data being sent:",JSON.stringify(t,null,2)),this.request(e,{...s,method:"POST",body:JSON.stringify(t)})}async put(e,t,s={}){return this.request(e,{...s,method:"PUT",body:JSON.stringify(t)})}async delete(e,t={}){return this.request(e,{...t,method:"DELETE"})}async updateSession(e){throw console.warn("[ApiClient] updateSession is deprecated in session-v2 system"),console.warn("[ApiClient] Session updates are handled server-side automatically"),console.log("[ApiClient] Requested updates were:",e),Error("updateSession is deprecated - session updates are handled server-side in session-v2 system")}async completeOnboarding(e){return this.post("/api/onboarding/complete-all",e)}async createPaymentSession(e,t){return this.post("/api/payments/create-session",{plan:e,billingCycle:t})}async verifyPayment(e){return this.post("/api/payments/verify",{sessionId:e})}}let f=new x;var S=s(966407),N=s(711377),v=s(178337),w=s(630919);function T({initialData:e={},onSubmit:t,submitting:s,error:i}){let{t:o}=(0,N.Bd)("onboarding"),[l,c]=(0,r.useState)({businessName:e.businessName||"",businessType:e.businessType||"",legalStructure:e.legalStructure||"",country:e.country||"US",dateFounded:e.dateFounded||new Date().toISOString().split("T")[0]}),[d,u]=(0,r.useState)({}),[p,m]=(0,r.useState)({}),g=(0,r.useMemo)(()=>Object.entries(v.Xr).map(([e,t])=>({value:e,label:t.name,code:e})).sort((e,t)=>e.label.localeCompare(t.label)),[]),b=(0,r.useMemo)(()=>w.AH.map(e=>({value:e,label:e})),[]),h=(0,r.useMemo)(()=>w.AP.map(e=>({value:e,label:e})),[]),y=(e,t)=>{console.log(`🚨 [BusinessInfoForm] Field change: ${e} = "${t}"`),c(s=>{let n={...s,[e]:t};return console.log("\uD83D\uDEA8 [BusinessInfoForm] Updated form data:",n),n}),d[e]&&u(t=>({...t,[e]:null}))},x=e=>{m(t=>({...t,[e]:!0})),f(e)},f=e=>{let t={};switch(e){case"businessName":l.businessName.trim()?l.businessName.length<2&&(t.businessName=o("businessInfo.errors.businessNameTooShort",{defaultValue:"Business name must be at least 2 characters"})):t.businessName=o("businessInfo.errors.businessNameRequired");break;case"businessType":l.businessType||(t.businessType=o("businessInfo.errors.businessTypeRequired"));break;case"legalStructure":l.legalStructure||(t.legalStructure=o("businessInfo.errors.legalStructureRequired"));break;case"country":l.country||(t.country=o("businessInfo.errors.countryRequired"))}return u(e=>({...e,...t})),0===Object.keys(t).length},S=()=>{let e={};return l.businessName.trim()||(e.businessName=o("businessInfo.errors.businessNameRequired")),l.businessType||(e.businessType=o("businessInfo.errors.businessTypeRequired")),l.legalStructure||(e.legalStructure=o("businessInfo.errors.legalStructureRequired")),l.country||(e.country=o("businessInfo.errors.countryRequired")),u(e),m({businessName:!0,businessType:!0,legalStructure:!0,country:!0}),0===Object.keys(e).length},T=async e=>{if(e.preventDefault(),!S()){a.vF.warn("[BusinessInfoForm] Validation failed",d),console.log("\uD83D\uDEA8 [BusinessInfoForm] Validation errors:",d);return}a.vF.info("[BusinessInfoForm] Submitting business info",l),console.log("\uD83D\uDEA8 [BusinessInfoForm] Form data being submitted:",JSON.stringify(l,null,2)),console.log("\uD83D\uDEA8 [BusinessInfoForm] Individual fields:",{businessName:l.businessName,businessType:l.businessType,country:l.country,legalStructure:l.legalStructure,dateFounded:l.dateFounded}),await t(l)};return(0,n.jsxs)("form",{onSubmit:T,className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-6",children:o("businessInfo.subtitle")}),i&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded text-red-700",children:i}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[o("businessInfo.businessNameLabel")," *"]}),(0,n.jsx)("input",{type:"text",value:l.businessName,onChange:e=>y("businessName",e.target.value),onBlur:()=>x("businessName"),placeholder:o("businessInfo.businessNamePlaceholder"),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${d.businessName&&p.businessName?"border-red-500":"border-gray-300"}`,disabled:s}),d.businessName&&p.businessName&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.businessName})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[o("businessInfo.businessTypeLabel")," *"]}),(0,n.jsxs)("select",{value:l.businessType,onChange:e=>y("businessType",e.target.value),onBlur:()=>x("businessType"),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${d.businessType&&p.businessType?"border-red-500":"border-gray-300"}`,disabled:s,children:[(0,n.jsx)("option",{value:"",children:o("businessInfo.businessTypePlaceholder")}),b.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))]}),d.businessType&&p.businessType&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.businessType})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[o("businessInfo.legalStructureLabel")," *"]}),(0,n.jsxs)("select",{value:l.legalStructure,onChange:e=>y("legalStructure",e.target.value),onBlur:()=>x("legalStructure"),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${d.legalStructure&&p.legalStructure?"border-red-500":"border-gray-300"}`,disabled:s,children:[(0,n.jsx)("option",{value:"",children:o("businessInfo.legalStructurePlaceholder")}),h.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))]}),d.legalStructure&&p.legalStructure&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.legalStructure})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[o("businessInfo.countryLabel")," *"]}),(0,n.jsxs)("select",{value:l.country,onChange:e=>y("country",e.target.value),onBlur:()=>x("country"),className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${d.country&&p.country?"border-red-500":"border-gray-300"}`,disabled:s,children:[(0,n.jsx)("option",{value:"",children:o("businessInfo.countryPlaceholder")}),g.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.code))]}),d.country&&p.country&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d.country})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:o("businessInfo.dateFoundedLabel")}),(0,n.jsx)("input",{type:"date",value:l.dateFounded,onChange:e=>y("dateFounded",e.target.value),max:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:s})]})]}),(0,n.jsx)("div",{className:"mt-6",children:(0,n.jsx)("button",{type:"submit",disabled:s,className:`w-full py-3 px-4 font-medium rounded-md transition-colors ${s?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:s?o("businessInfo.saving",{defaultValue:"Saving..."}):o("businessInfo.nextButton")})})]})}var E=s(142049),P=s(608654);let _={USD:1,EUR:.85,GBP:.73,CAD:1.25,AUD:1.35,JPY:110,CNY:6.45,INR:74.5,BRL:5.2,MXN:20.1,ZAR:14.8,NGN:411,KES:108,GHS:6.1,EGP:15.7,MAD:9,TND:2.8,DZD:134,XOF:558,XAF:558};async function I(e){try{let t=await fetch("https://api.exchangerate-api.com/v4/latest/USD");if(t.ok){let s=(await t.json()).rates[e];if(s)return console.log(`✅ Fetched exchange rate USD to ${e}: ${s}`),s}let s=await fetch(`https://api.fxratesapi.com/latest?base=USD&symbols=${e}`);if(s.ok){let t=(await s.json()).rates[e];if(t)return console.log(`✅ Fetched exchange rate USD to ${e}: ${t}`),t}}catch(t){console.warn(`⚠️ Failed to fetch exchange rate from API for ${e}:`,t.message)}return null}let j=[{id:"free",name:"Basic",description:"Perfect for small businesses just getting started",price:"Free",monthlyPrice:0,sixMonthPrice:0,yearlyPrice:0,features:["Income and expense tracking","Invoice creation & reminders","Stripe & PayPal payments","Mobile money (M-Pesa, etc.)","Basic inventory tracking","Barcode scanning","3GB storage limit","1 user only"],buttonText:"Start for Free"},{id:"professional",name:"Professional",description:"Everything growing businesses need to thrive",price:"$15/mo",monthlyPrice:15,sixMonthPrice:75,yearlyPrice:144,features:["Everything in Basic","Up to 3 users","Unlimited storage","Priority support","All features included","17% discount on 6-month","20% discount on annual"],popular:!0,buttonText:"Choose Professional"},{id:"enterprise",name:"Enterprise",description:"Unlimited scale for ambitious organizations",price:"$45/mo",monthlyPrice:45,sixMonthPrice:225,yearlyPrice:432,features:["Everything in Professional","Unlimited users","Custom onboarding","Dedicated support","All features included","17% discount on 6-month","20% discount on annual"],premium:!0,buttonText:"Choose Enterprise"}];function O({initialData:e={},onSelect:t,submitting:s,error:i,onBack:o}){let{t:l}=(0,N.Bd)("onboarding"),[c,d]=(0,r.useState)(e.selectedPlan||""),[u,p]=(0,r.useState)(e.billingCycle||"monthly"),[m,g]=(0,r.useState)(null),[b,h]=(0,r.useState)(!0),[y,x]=(0,r.useState)([]),[f,S]=(0,r.useState)(null),[v,w]=(0,r.useState)(null),T=async e=>{d(e),a.vF.info("[SubscriptionSelection] Plan selected",{planId:e,billingCycle:u}),await t(e,u)},P=e=>{p(e),a.vF.info("[SubscriptionSelection] Billing cycle changed",{cycle:e})},_=(e,t=!0)=>{if(!e||0===e)return l("subscription.plans.basic.price");let s=`$${e}`;if(f&&"USD"!==f&&v){let t=function(e,t){try{return new Intl.NumberFormat("en-US",{style:"currency",currency:t,minimumFractionDigits:2*("JPY"!==t),maximumFractionDigits:2*("JPY"!==t)}).format(e)}catch(s){return console.warn(`⚠️ Failed to format currency ${t}:`,s),`${t} ${e.toFixed(2)}`}}(Math.round(e*v),f);s+=` (${t})`}return s};return(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-2",children:l("subscription.title")}),(0,n.jsx)("p",{className:"text-gray-600",children:l("subscription.subtitle")})]}),i&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded text-red-700",children:i}),m&&m.discount_percentage>0&&(0,n.jsx)("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"text-2xl mr-2",children:"\uD83C\uDF89"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-green-800 font-semibold",children:l("subscription.regionalDiscount.badge",{percentage:m.discount_percentage})}),(0,n.jsx)("p",{className:"text-green-700 text-sm",children:l("subscription.regionalDiscount.description",{country:(0,E.qQ)(e.country)||e.country||l("subscription.regionalDiscount.yourRegion")})})]})]})}),y.length>0&&y.includes("mpesa")&&(0,n.jsx)("div",{className:"mb-4 p-4 bg-blue-50 border border-blue-200 rounded",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("svg",{className:"w-6 h-6 text-green-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-green-800 font-semibold",children:l("subscription.paymentMethods.mpesa.title")}),(0,n.jsx)("p",{className:"text-green-700 text-sm",children:l("subscription.paymentMethods.mpesa.description")}),f&&"USD"!==f&&(0,n.jsx)("p",{className:"text-green-600 text-xs mt-1",children:l("subscription.paymentMethods.mpesa.payInCurrency",{currency:f})})]})]})}),(0,n.jsx)("div",{className:"flex justify-center mb-8",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2 bg-gray-100 rounded-lg p-1",children:[(0,n.jsx)("button",{onClick:()=>P("monthly"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${"monthly"===u?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"}`,disabled:s,children:l("subscription.billingCycle.monthly")}),(0,n.jsxs)("button",{onClick:()=>P("6month"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center ${"6month"===u?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"}`,disabled:s,children:[l("subscription.billingCycle.sixMonth"),(0,n.jsx)("span",{className:"ml-1 bg-orange-500 text-white text-xs font-bold px-2 py-1 rounded-full",children:l("subscription.billingCycle.popular")})]}),(0,n.jsxs)("button",{onClick:()=>P("yearly"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center ${"yearly"===u?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"}`,disabled:s,children:[l("subscription.billingCycle.yearly"),(0,n.jsx)("span",{className:"ml-1 text-xs text-green-600 font-normal",children:l("subscription.billingCycle.save",{percentage:20})})]})]})}),b?(0,n.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,n.jsx)("div",{className:"grid gap-6 md:grid-cols-3",children:j.map(e=>(0,n.jsxs)("div",{className:`relative rounded-lg border-2 p-6 overflow-hidden ${e.popular?"border-blue-500 shadow-lg":e.premium?"border-purple-500":"border-gray-200"} ${c===e.id?"ring-2 ring-blue-500":""}`,children:[e.popular&&"6month"===u&&(0,n.jsx)("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:(0,n.jsx)("span",{className:"bg-orange-500 text-white text-xs font-bold px-3 py-1 rounded-full",children:l("subscription.plans.professional.popularBadge")})}),e.premium&&(0,n.jsx)("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:(0,n.jsx)("span",{className:"bg-purple-500 text-white text-xs font-bold px-3 py-1 rounded-full",children:l("subscription.plans.enterprise.premiumBadge")})}),(0,n.jsxs)("div",{className:"text-center mb-4",children:[(0,n.jsx)("h3",{className:"text-xl font-bold mb-2 break-words",children:l(`subscription.plans.${e.id}.name`)}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-4 break-words",children:l(`subscription.plans.${e.id}.description`)}),(0,n.jsx)("div",{className:"mb-4",children:"free"===e.id?(0,n.jsx)("div",{className:"text-3xl font-bold",children:l("subscription.plans.basic.price")}):(0,n.jsxs)("div",{children:[m&&m.discount_percentage>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-3xl font-bold",children:_("monthly"===u?m.pricing[e.id]?.monthly:"6month"===u?m.pricing[e.id]?.six_month:m.pricing[e.id]?.yearly,!1)}),(0,n.jsxs)("div",{className:"text-sm text-gray-500 line-through",children:["$","monthly"===u?e.monthlyPrice:"6month"===u?e.sixMonthPrice:e.yearlyPrice]}),(0,n.jsx)("div",{className:"text-sm text-green-600 font-semibold",children:l("subscription.regionalDiscount.percentOff",{percentage:m.discount_percentage})})]}):(0,n.jsx)("div",{className:"text-3xl font-bold",children:_("monthly"===u?e.monthlyPrice:"6month"===u?e.sixMonthPrice:e.yearlyPrice,!1)}),"6month"===u&&"free"!==e.id&&(0,n.jsx)("div",{className:"text-sm text-orange-600 mt-1",children:l("subscription.savings.sixMonth",{amount:6*e.monthlyPrice-e.sixMonthPrice,monthly:(e.sixMonthPrice/6).toFixed(2)})}),"yearly"===u&&"free"!==e.id&&(0,n.jsx)("div",{className:"text-sm text-green-600 mt-1",children:l("subscription.savings.yearly",{amount:12*e.monthlyPrice-e.yearlyPrice})})]})})]}),(0,n.jsx)("ul",{className:"space-y-2 mb-6",children:e.features.map((t,s)=>{let r=t;try{if(t.includes("{{"))r=l(`subscription.plans.${e.id}.features.${s}`,{discount:17,yearlyDiscount:20});else{let n=`subscription.plans.${e.id}.features.${s}`;r=l(n,{defaultValue:t})}}catch(e){r=t}return(0,n.jsxs)("li",{className:"flex items-start",children:[(0,n.jsx)("svg",{className:"w-5 h-5 text-green-500 mr-2 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,n.jsx)("span",{className:"text-sm text-gray-700",children:r})]},s)})}),(0,n.jsx)("button",{onClick:()=>T(e.id),disabled:s,className:`w-full py-2 px-4 rounded-md font-medium transition-colors ${s?"bg-gray-400 text-gray-200 cursor-not-allowed":e.popular&&"6month"===u?"bg-orange-600 text-white hover:bg-orange-700":e.popular?"bg-blue-600 text-white hover:bg-blue-700":e.premium?"bg-purple-600 text-white hover:bg-purple-700":"bg-gray-800 text-white hover:bg-gray-900"}`,children:s&&c===e.id?l("subscription.processing"):l(`subscription.plans.${e.id}.buttonText`)})]},e.id))}),o&&(0,n.jsx)("div",{className:"mt-8 text-center",children:(0,n.jsx)("button",{onClick:o,disabled:s,className:"text-gray-600 hover:text-gray-800 underline",children:l("subscription.backButton")})}),(0,n.jsx)("div",{className:"mt-8 text-center text-sm text-gray-600",children:(0,n.jsx)("p",{children:l("subscription.note")})})]})}var C=s(78565),F=s(269371),k=s(812164);function R({initialStep:e,initialCountry:t}){let s=(0,i.useRouter)(),o=(0,F.sf)(),[l,d]=(0,r.useState)(!0),[u,g]=(0,r.useState)(null),[b,h]=(0,r.useState)({}),[x,N]=(0,r.useState)(null),[v,w]=(0,r.useState)(!1),T=async e=>{try{w(!0),N(null),a.vF.info("[OnboardingFlow] Received data from BusinessInfoForm:",e),console.log("\uD83D\uDEA8 [OnboardingFlow] Raw data from form:",JSON.stringify(e,null,2));let t={...b,...e};h(t);let s={business_name:e.businessName,business_type:e.businessType,country:e.country||"US",legal_structure:e.legalStructure,date_founded:e.dateFounded};a.vF.info("[OnboardingFlow] Sending to backend:",s),console.log("\uD83D\uDEA8 [OnboardingFlow] Backend data:",JSON.stringify(s,null,2));let n=await f.post("/api/onboarding/business-info",s);(0,C.r)("onboarding_business_info_submitted",{business_type:e.businessType,country:e.country,legal_structure:e.legalStructure,has_tenant_id:!!n.tenant_id}),(0,k.sx)(o,k.qY.ONBOARDING_STEP_COMPLETED,{step:"business_info",businessName:e.businessName,businessType:e.businessType,country:e.country,legalStructure:e.legalStructure}),await p.submitBusinessInfo(e),n.tenant_id&&m.sessionManagerEnhanced.clearCache(),g(c.SUBSCRIPTION_SELECTION)}catch(e){a.vF.error("[OnboardingFlow] Business info error",e),N(y.toComponentProps(e,{context:"business_info"}))}finally{w(!1)}},E=async(e,t)=>{try{w(!0),N(null);let n={...b,selectedPlan:e,billingCycle:t};if(h(n),await f.post("/api/onboarding/subscription",{selected_plan:e,billing_cycle:t}),(0,C.r)("onboarding_subscription_selected",{plan:e,billing_cycle:t,is_free_plan:"free"===e}),(0,k.sx)(o,k.qY.SUBSCRIPTION_SELECTED,{plan:e,billingCycle:t,isFreePlan:"free"===e}),(0,k.sx)(o,k.qY.ONBOARDING_STEP_COMPLETED,{step:"subscription_selection",plan:e,billingCycle:t}),await p.selectSubscription(e,t),"free"===e)await P(n);else{g(c.PAYMENT_PENDING);let n=b.country||"US";s.push(`/onboarding/payment?plan=${e}&billing=${t}&country=${encodeURIComponent(n)}`)}}catch(e){a.vF.error("[OnboardingFlow] Subscription selection error",e),N(y.toComponentProps(e,{context:"subscription"}))}finally{w(!1)}},P=async e=>{try{a.vF.info("[OnboardingFlow] Completing onboarding with data:",{businessName:e.businessName,businessType:e.businessType,selectedPlan:e.selectedPlan,country:e.country,legalStructure:e.legalStructure,dateFounded:e.dateFounded});let t=await f.completeOnboarding({businessName:e.businessName,businessType:e.businessType,selectedPlan:e.selectedPlan,billingCycle:e.billingCycle||"monthly",country:e.country||"US",legalStructure:e.legalStructure||"",dateFounded:e.dateFounded||""});a.vF.info("[OnboardingFlow] Complete onboarding response:",t),console.log("\uD83C\uDFAF [OnboardingFlow] Response tenantId:",t.tenantId),console.log("\uD83C\uDFAF [OnboardingFlow] Response tenant_id:",t.tenant_id);let s=t.tenantId||t.tenant_id||t.data?.tenantId||t.data?.tenant_id;if(!s&&t.data?.schemaSetup?.schema_name){let e=t.data.schemaSetup.schema_name;console.log("[OnboardingFlow] Extracting tenant ID from schema name:",e);let n=e.match(/tenant_([a-f0-9]{8}_[a-f0-9]{4}_[a-f0-9]{4}_[a-f0-9]{4}_[a-f0-9]{12})/);n&&(s=n[1].replace(/_/g,"-"),console.log("[OnboardingFlow] Extracted full tenant ID from schema:",s))}if(t.success&&s){(0,C.r)("onboarding_completed",{plan:e.selectedPlan,billing_cycle:e.billingCycle,business_type:e.businessType,country:e.country,tenant_id:s}),(0,k.sx)(o,k.qY.ONBOARDING_COMPLETED,{plan:e.selectedPlan,billingCycle:e.billingCycle,businessType:e.businessType,businessName:e.businessName,country:e.country,legalStructure:e.legalStructure,tenantId:s}),m.sessionManagerEnhanced.clearCache(),console.log("\uD83C\uDFAF [OnboardingFlow] Onboarding completed successfully"),console.log("\uD83D\uDD25 [OnboardingFlow] Ensuring onboarding completion is saved...");let t=[];t.push(fetch("/api/onboarding/ensure-complete",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({tenantId:s,businessName:e.businessName,selectedPlan:e.selectedPlan})}));let n=document.cookie,r=n.match(/(?:^|; )sid=([^;]*)/)?.[1]||n.match(/(?:^|; )session_token=([^;]*)/)?.[1];if(r){let e="https://api.dottapps.com";t.push(fetch(`${e}/api/onboarding/progress/update/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Session ${r}`},body:JSON.stringify({setup_completed:!0,needs_onboarding:!1,tenant_id:s})})),t.push(fetch(`${e}/api/sessions/refresh/`,{method:"POST",headers:{Authorization:`Session ${r}`}}))}try{(await Promise.allSettled(t)).forEach((e,t)=>{"fulfilled"===e.status&&e.value.ok?console.log(`✅ [OnboardingFlow] Backend update ${t+1} succeeded`):console.error(`❌ [OnboardingFlow] Backend update ${t+1} failed`)})}catch(e){console.error("❌ [OnboardingFlow] Error ensuring completion:",e)}console.log("\uD83D\uDD0D [OnboardingFlow] Verifying session before redirect..."),await new Promise(e=>setTimeout(e,1e3));try{let e=await fetch("/api/auth/session-verify",{credentials:"include",cache:"no-store"});if(e.ok){let t=await e.json();if(console.log("✅ [OnboardingFlow] Session verified:",t),!t.valid)throw console.error("❌ [OnboardingFlow] Session invalid after completion:",t.reason),Error("Session not properly established")}else console.error("❌ [OnboardingFlow] Session verification failed")}catch(e){console.error("❌ [OnboardingFlow] Session verification error:",e)}console.log("\uD83C\uDFAF [OnboardingFlow] Using window.location for redirect to ensure cookies are preserved"),window.location.href=`/${s}/dashboard`;return}if(t.redirect_url&&t.redirect_url.includes("session_lost")){a.vF.error("[OnboardingFlow] Session lost during onboarding"),window.location.href=t.redirect_url;return}if(t.requiresAuth){a.vF.error("[OnboardingFlow] Session lost during onboarding:",t),window.location.href="/auth/signin?message=session_expired&returnTo=/onboarding";return}else if(t.success&&t.redirectUrl){a.vF.warn("[OnboardingFlow] Onboarding completed but no tenant ID yet, redirecting to:",t.redirectUrl),window.location.href=t.redirectUrl;return}else if(t.success&&!s){a.vF.warn("[OnboardingFlow] Onboarding completed but tenant ID not immediately available, redirecting to dashboard"),m.sessionManagerEnhanced.clearCache(),window.location.href="/dashboard";return}else throw a.vF.error("[OnboardingFlow] Missing tenant ID in response:",t),Error("Unable to complete onboarding: missing tenant ID")}catch(e){throw a.vF.error("[OnboardingFlow] Completion error",e),e}};return l?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsx)(S.A,{size:"large",text:"Loading onboarding..."})}):x&&!u?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,n.jsxs)("div",{className:"max-w-md w-full p-6 bg-white rounded-lg shadow-lg",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:x.title}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:x.description}),(0,n.jsx)("div",{className:"space-y-2",children:x.suggestions?.map((e,t)=>(0,n.jsx)("button",{onClick:()=>window.location.reload(),className:"w-full py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-700",children:e.label},t))}),x.reference&&(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-4",children:["Reference: ",x.reference]})]})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto py-12 px-4",children:[(0,n.jsx)(A,{currentState:u}),x&&(0,n.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,n.jsxs)("p",{className:"text-red-600",children:[x.title,": ",x.description]})}),(u===c.NOT_STARTED||u===c.BUSINESS_INFO)&&(0,n.jsx)(D,{data:b,onSubmit:T,submitting:v,error:x}),u===c.SUBSCRIPTION_SELECTION&&(0,n.jsx)(M,{data:b,onSelect:E,onBack:()=>{g(c.BUSINESS_INFO),p.transitionTo(c.BUSINESS_INFO)},submitting:v,error:x}),u===c.PAYMENT_PENDING&&(0,n.jsxs)("div",{className:"text-center py-12",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Payment Required"}),(0,n.jsxs)("p",{className:"text-gray-600 mb-6",children:["You'll be redirected to complete payment for your ",b.selectedPlan," plan."]}),(0,n.jsx)(S.A,{text:"Redirecting to payment..."})]})]})})}function A({currentState:e}){let t=[{state:c.BUSINESS_INFO,label:"Business Info"},{state:c.SUBSCRIPTION_SELECTION,label:"Choose Plan"},{state:c.PAYMENT_PENDING,label:"Payment"},{state:c.COMPLETED,label:"Complete"}],s=t.findIndex(t=>t.state===e);return(0,n.jsx)("div",{className:"mb-12",children:(0,n.jsx)("div",{className:"relative",children:(0,n.jsx)("div",{className:"flex items-center justify-between",children:t.map((e,r)=>(0,n.jsxs)("div",{className:"flex-1 flex items-center",children:[(0,n.jsxs)("div",{className:"relative flex flex-col items-center",children:[(0,n.jsx)("div",{className:`
                  w-10 h-10 rounded-full flex items-center justify-center z-10
                  ${r<=s?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"}
                `,children:r+1}),(0,n.jsx)("div",{className:"mt-2 text-xs text-gray-600 whitespace-nowrap text-center",children:e.label})]}),r<t.length-1&&(0,n.jsx)("div",{className:`
                  flex-1 h-1 -mt-6
                  ${r<s?"bg-blue-600":"bg-gray-300"}
                `})]},e.state))})})})}function D({data:e,onSubmit:t,submitting:s,error:r}){return(0,n.jsx)(T,{initialData:e,onSubmit:t,submitting:s,error:r})}function M({data:e,onSelect:t,onBack:s,submitting:r,error:i}){return(0,n.jsx)(O,{initialData:e,onSelect:t,onBack:s,submitting:r,error:i})}function q(){let e=(0,i.useRouter)();(0,F.sf)();let{i18n:t}=(0,N.Bd)(),[s,a]=(0,r.useState)(!0),[o,l]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),[u,p]=(0,r.useState)(null);return s?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,n.jsx)(S.A,{size:"large",text:"Loading..."})}):o?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,n.jsxs)("div",{className:"max-w-md w-full p-6 bg-white rounded-lg shadow-lg",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error"}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:o}),(0,n.jsx)("button",{onClick:()=>e.push("/auth/signin"),className:"w-full py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Return to Sign In"})]})}):(0,n.jsx)(R,{initialStep:c,initialCountry:u})}s(596942)},379551:e=>{"use strict";e.exports=require("url")},380481:e=>{"use strict";e.exports=require("node:readline")},419121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},455511:e=>{"use strict";e.exports=require("crypto")},474998:e=>{"use strict";e.exports=require("perf_hooks")},508086:e=>{"use strict";e.exports=require("module")},529294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},541692:e=>{"use strict";e.exports=require("node:tls")},579646:e=>{"use strict";e.exports=require("child_process")},583997:e=>{"use strict";e.exports=require("tty")},584297:e=>{"use strict";e.exports=require("async_hooks")},594735:e=>{"use strict";e.exports=require("events")},629021:e=>{"use strict";e.exports=require("fs")},636686:e=>{"use strict";e.exports=require("diagnostics_channel")},638522:e=>{"use strict";e.exports=require("node:zlib")},663033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},710846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},719063:e=>{"use strict";e.exports=require("require-in-the-middle")},719771:e=>{"use strict";e.exports=require("process")},731421:e=>{"use strict";e.exports=require("node:child_process")},775919:e=>{"use strict";e.exports=require("node:worker_threads")},777030:e=>{"use strict";e.exports=require("node:net")},848161:e=>{"use strict";e.exports=require("node:os")},856801:e=>{"use strict";e.exports=require("import-in-the-middle")},903295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},937067:e=>{"use strict";e.exports=require("node:http")},955739:(e,t,s)=>{Promise.resolve().then(s.bind(s,370921))},973024:e=>{"use strict";e.exports=require("node:fs")}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[46593,81447,34223,78337],()=>s(312053));module.exports=n})();
//# sourceMappingURL=page.js.map