(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1112],{5077:(e,t,s)=>{Promise.resolve().then(s.bind(s,12492))},12492:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>p});var n,a=s(55166),r=s(68387),o=s(95155),l=s(12115),i=s(35695),u=s(81746),c=s(11024),d=s(52584),g=s(42749);function m(e){let{message:t="Loading dashboard..."}=e;return(0,o.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen p-4 bg-gray-50",children:[(0,o.jsx)("div",{className:"mb-4",children:(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}),(0,o.jsx)("p",{className:"text-gray-600 text-center",children:t})]})}var b=s(14090),f=s(14719),h=s(78007);let p=(n=()=>{let e=(0,i.useRouter)(),[t,s]=(0,l.useState)(!0),[n,p]=(0,l.useState)(!1),[v,x]=(0,l.useState)(null),[y,w]=(0,l.useState)({legal_name:"",business_type:"",legal_structure:"",country:"United States",founded_date:new Date().toISOString().split("T")[0]}),[_,j]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{try{let e=await (0,u.H)();j(e.userId)}catch(e){g.vF.error("[BusinessInfoPage] Error getting current user:",e)}})()},[]);let C=(0,l.useMemo)(()=>["legal_name","business_type","legal_structure","country"].every(e=>{var t;return null==(t=y[e])?void 0:t.trim()}),[y]),N=(0,l.useMemo)(()=>Object.entries(h.Xr).map(e=>{let[t,s]=e;return{value:s.name,label:s.name,code:t}}).sort((e,t)=>e.label.localeCompare(t.label)),[]),F=(0,l.useMemo)(()=>f.AH.map(e=>({value:e,label:e})),[]),S=(0,l.useMemo)(()=>f.AP.map(e=>({value:e,label:e})),[]);(0,l.useEffect)(()=>{(async()=>{try{s(!0);let e=(0,b.tv)("business_info");if(e)g.vF.debug("[BusinessInfoPage] Using cached business info",{cachedData:e}),w(t=>(0,a._)({},t,e));else try{g.vF.debug("[BusinessInfoPage] Fetching business info from Cognito");let e=await (0,c.T)(),t={legal_name:e["custom:businessname"]||"",business_type:e["custom:businesstype"]||"",legal_structure:e["custom:legalstructure"]||"",country:e["custom:businesscountry"]||"United States",founded_date:e["custom:datefounded"]||new Date().toISOString().split("T")[0]};(0,b.lx)("business_info",t,{ttl:36e5}),w(e=>(0,a._)({},e,t)),g.vF.debug("[BusinessInfoPage] Business info loaded from Cognito",{cognitoData:t})}catch(e){g.vF.error("[BusinessInfoPage] Failed to fetch business info from Cognito",e)}}catch(e){g.vF.error("[BusinessInfoPage] Failed to fetch business info",e),x("Failed to load business information. Please try again.")}finally{s(!1)}})()},[]);let R=e=>{let{name:t,value:s}=e.target;w(e=>(0,r._)((0,a._)({},e),{[t]:s}))},I=async t=>{if(t.preventDefault(),!C)return void x("Please fill in all required fields");x(null),p(!0);try{g.vF.debug("[BusinessInfoPage] Saving business info to Cognito and AppCache",y);let t=N.find(e=>e.value===y.country),s=(null==t?void 0:t.code)||"US",n=Date.now().toString(),o=Math.random().toString(36).substring(2,10),l="bus_".concat(n,"_").concat(o).padEnd(36,"0").substring(0,36),i={"custom:businessname":y.legal_name,"custom:businesstype":y.business_type,"custom:legalstructure":y.legal_structure,"custom:businesscountry":s,"custom:datefounded":y.founded_date,"custom:businessid":l,"custom:onboarding":"subscription","custom:updated_at":new Date().toISOString(),"custom:setupdone":"false","custom:attrversion":"1.0.0"};await (0,d.u)({userAttributes:i}),g.vF.debug("[BusinessInfoPage] Business info saved to Cognito successfully"),(0,b.lx)("businessId",l,{ttl:2592e6});let u=(0,r._)((0,a._)({},y),{business_id:l,country_code:s});if((0,b.lx)("business_info",u,{ttl:36e5}),_){let e={businessId:l,businessName:y.legal_name,businessType:y.business_type,legalStructure:y.legal_structure,countryCode:s,foundedDate:y.founded_date};(0,b.lx)("user_".concat(_,"_businessInfo"),e,{ttl:864e5})}let c={businessInfoCompleted:!0,currentStep:"subscription",lastUpdated:new Date().toISOString()};(0,b.lx)("onboarding_status",c,{ttl:864e5}),g.vF.debug("[BusinessInfoPage] Business info updated successfully, redirecting to subscription page"),setTimeout(()=>{e.push("/onboarding/subscription?source=business-info&ts="+Date.now(),{forceOptimisticNavigation:!0}),setTimeout(()=>{window.location.pathname.includes("/business-info")&&(g.vF.warn("[BusinessInfoPage] Router navigation failed, using direct location change"),window.location.href="/onboarding/subscription?source=business-info&fallback=true&ts="+Date.now())},1e3)},300)}catch(e){g.vF.error("[BusinessInfoPage] Failed to update business info",e),x("Failed to save business information. Please try again.")}finally{p(!1)}};return t?(0,o.jsx)(m,{message:"Loading your business information..."}):(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-gray-100",children:(0,o.jsx)("div",{className:"max-w-4xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:(0,o.jsx)("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:(0,o.jsxs)("div",{className:"p-6 sm:p-8",children:[(0,o.jsxs)("div",{className:"mb-8",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Business Information"}),(0,o.jsx)("p",{className:"mt-2 text-gray-600",children:"Please provide your business details to continue."})]}),v&&(0,o.jsx)("div",{className:"mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-md",children:(0,o.jsxs)("div",{className:"flex",children:[(0,o.jsx)("div",{className:"flex-shrink-0",children:(0,o.jsx)("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,o.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,o.jsx)("div",{className:"ml-3",children:(0,o.jsx)("p",{className:"text-sm text-red-700",children:v})})]})}),(0,o.jsxs)("form",{onSubmit:I,className:"space-y-8",children:[(0,o.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Business Details"}),(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{htmlFor:"legal_name",className:"block text-sm font-medium text-gray-700 mb-1",children:["Business Name ",(0,o.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,o.jsx)("input",{type:"text",id:"legal_name",name:"legal_name",value:y.legal_name,onChange:R,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",required:!0})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{htmlFor:"business_type",className:"block text-sm font-medium text-gray-700 mb-1",children:["Business Type ",(0,o.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,o.jsxs)("select",{id:"business_type",name:"business_type",value:y.business_type,onChange:R,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",required:!0,children:[(0,o.jsx)("option",{value:"",children:"Select Business Type"}),F.map(e=>(0,o.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{htmlFor:"legal_structure",className:"block text-sm font-medium text-gray-700 mb-1",children:["Legal Structure ",(0,o.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,o.jsxs)("select",{id:"legal_structure",name:"legal_structure",value:y.legal_structure,onChange:R,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",required:!0,children:[(0,o.jsx)("option",{value:"",children:"Select Legal Structure"}),S.map(e=>(0,o.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 mb-1",children:["Country ",(0,o.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,o.jsxs)("select",{id:"country",name:"country",value:y.country,onChange:R,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",required:!0,children:[(0,o.jsx)("option",{value:"",children:"Select Country"}),N.map(e=>(0,o.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"founded_date",className:"block text-sm font-medium text-gray-700 mb-1",children:"Date Founded"}),(0,o.jsx)("input",{type:"date",id:"founded_date",name:"founded_date",value:y.founded_date,onChange:R,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"})]})]})]}),(0,o.jsxs)("div",{className:"flex justify-between pt-6",children:[(0,o.jsx)("button",{type:"button",onClick:()=>e.back(),className:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors shadow-sm",children:"Back"}),(0,o.jsx)("button",{type:"submit",disabled:n||!C,className:"px-6 py-3 rounded-lg shadow-sm transition-colors ".concat(C?"bg-blue-600 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:n?(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):"Continue"})]})]})]})})})})},function(e){let t=(0,i.useRouter)(),[s,r]=(0,l.useState)(!0),[c,d]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{(async()=>{try{r(!0);let e=await (0,u.H)().catch(()=>null);e?(g.vF.debug("[AuthenticatedRoute] User is authenticated",{userId:e.userId}),d(!0)):(g.vF.debug("[AuthenticatedRoute] No authenticated user found"),t.push("/auth/signin?redirect="+encodeURIComponent(window.location.pathname)))}catch(e){g.vF.error("[AuthenticatedRoute] Authentication error",e),t.push("/auth/signin?redirect="+encodeURIComponent(window.location.pathname))}finally{r(!1)}})()},[t]),s)?(0,o.jsx)(m,{message:"Checking authentication..."}):c?(0,o.jsx)(n,(0,a._)({},e)):null})},14090:(e,t,s)=>{"use strict";s.d(t,{ZF:()=>c,lx:()=>i,tv:()=>u});var n=s(73767),a=s(81011),r=s(42749);let o=new Map,l=(0,n.D)(),i=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let n=s.ttl||18e5,a=Date.now()+n;return o.set(e,{data:t,expiry:a}),r.vF.debug("[CacheClient] Data cached successfully",{key:e}),!0}catch(t){return r.vF.error("[CacheClient] Error caching data",{key:e,error:t}),!1}},u=e=>{try{let t=o.get(e);if(!t)return r.vF.debug("[CacheClient] Cache miss",{key:e}),null;if(Date.now()>t.expiry)return r.vF.debug("[CacheClient] Cache expired",{key:e}),o.delete(e),null;return r.vF.debug("[CacheClient] Cache hit",{key:e}),t.data}catch(t){return r.vF.error("[CacheClient] Error retrieving cached data",{key:e,error:t}),null}},c=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{bypassCache:n=!1,ttl:o,query:c,variables:d}=s,g=(0,a.A)().substring(0,8);try{let s;if(!n){let t=u(e);if(t)return r.vF.debug("[CacheClient] Returning cached data",{cacheKey:e,requestId:g}),t}if(c){var m,b,f;if(r.vF.debug("[CacheClient] Executing GraphQL operation",{requestId:g,operationName:(null==(f=c.definitions)||null==(b=f[0])||null==(m=b.name)?void 0:m.value)||"Unknown"}),(s=await l.graphql({query:c,variables:d||{},authMode:"AMAZON_COGNITO_USER_POOLS"})).data){let e=Object.keys(s.data)[0];s=s.data[e]}}else r.vF.debug("[CacheClient] Using data provided directly",{requestId:g}),s=t;return i(e,s,{ttl:o}),s}catch(t){throw r.vF.error("[CacheClient] Fetch error",{cacheKey:e,requestId:g,error:t}),t}};setInterval(()=>{let e=0;for(let[t,s]of o.entries())s.isExpired()&&(o.delete(t),e++);e>0&&r.vF.debug("[cacheClient] Cleaned up expired entries",{expiredCount:e})},18e5)},19002:(e,t,s)=>{"use strict";s.d(t,{H:()=>r});var n=s(45103),a=s(84295);let r=async e=>{var t;let s=e.getConfig().Auth?.Cognito;(0,n.$y)(s);let r=await e.Auth.getTokens({forceRefresh:!1});(0,a.H0)(r);let{"cognito:username":o,sub:l}=r.idToken?.payload??{},i={username:o,userId:l},u=(t=r,t?.signInDetails);return u&&(i.signInDetails=u),i}},42749:(e,t,s)=>{"use strict";s.d(t,{vF:()=>o});let n={debug:0,info:1,warn:2,error:3},a="info",r=()=>!1,o={setLevel(e){void 0!==n[e]&&(a=e)},getLevel:()=>a,debug:(e,t)=>{},info:(e,t)=>{n[a]<=n.info&&(r()?void 0!==t?console.info("[SERVER INFO] ".concat(e),t):console.info("[SERVER INFO] ".concat(e)):void 0!==t?console.info(e,t):console.info(e))},warn:(e,t)=>{n[a]<=n.warn&&(r()?void 0!==t?console.warn("[SERVER WARN] ".concat(e),t):console.warn("[SERVER WARN] ".concat(e)):void 0!==t?console.warn(e,t):console.warn(e))},error:(e,t)=>{n[a]<=n.error&&(r()?void 0!==t?console.error("[SERVER ERROR] ".concat(e),t):console.error("[SERVER ERROR] ".concat(e)):void 0!==t?console.error(e,t):console.error(e))}}},52584:(e,t,s)=>{"use strict";s.d(t,{u:()=>v});var n=s(87970),a=s(24818),r=s(45103),o=s(27593),l=s(84295),i=s(88726),u=s(85565),c=s(59262),d=s(90808),g=s(55413),m=s(2242),b=s(41811),f=s(83854);let h=e=>(0,d.A)(g.e,(0,m._)("UpdateUserAttributes"),(0,b.T)(),{...f.C,...e});var p=s(32712);let v=async e=>{let{userAttributes:t,options:s}=e,d=n.H.getConfig().Auth?.Cognito,g=s?.clientMetadata;(0,r.$y)(d);let{userPoolEndpoint:m,userPoolId:b}=d,{tokens:f}=await (0,a.$)({forceRefresh:!1});(0,l.H0)(f);let v=h({endpointResolver:(0,p.o)({endpointOverride:m})}),{CodeDeliveryDetailsList:x}=await v({region:(0,i.J)(b),userAgentValue:(0,c.A)(o.BM.UpdateUserAttributes)},{AccessToken:f.accessToken.toString(),ClientMetadata:g,UserAttributes:(0,u.Q)(t)});return{...function(e){let t={};return Object.keys(e)?.forEach(e=>{t[e]={isUpdated:!0,nextStep:{updateAttributeStep:"DONE"}}}),t}(t),...function(e){let t={};return e?.forEach(e=>{let{AttributeName:s,DeliveryMedium:n,Destination:a}=e;s&&(t[s]={isUpdated:!1,nextStep:{updateAttributeStep:"CONFIRM_ATTRIBUTE_WITH_CODE",codeDeliveryDetails:{attributeName:s,deliveryMedium:n,destination:a}}})}),t}(x)}}},81746:(e,t,s)=>{"use strict";s.d(t,{H:()=>r});var n=s(87970),a=s(19002);let r=async()=>(0,a.H)(n.H)}},e=>{var t=t=>e(e.s=t);e.O(0,[54940,9296,79480,58430,18702,78007,14719,28441,31684,77358],()=>t(5077)),_N_E=e.O()}]);