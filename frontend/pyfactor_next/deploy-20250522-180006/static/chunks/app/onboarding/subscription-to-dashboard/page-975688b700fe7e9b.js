(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[14485,45066],{12912:(e,t,n)=>{Promise.resolve().then(n.bind(n,60225))},19002:(e,t,n)=>{"use strict";n.d(t,{H:()=>o});var a=n(45103),r=n(84295);let o=async e=>{var t;let n=e.getConfig().Auth?.Cognito;(0,a.$y)(n);let o=await e.Auth.getTokens({forceRefresh:!1});(0,r.H0)(o);let{"cognito:username":s,sub:i}=o.idToken?.payload??{},c={username:s,userId:i},l=(t=o,t?.signInDetails);return l&&(c.signInDetails=l),c}},19596:(e,t,n)=>{"use strict";n.d(t,{kd:()=>a});let a={BUSINESS_INFO:"business-info",SUBSCRIPTION:"subscription",PAYMENT:"payment",SETUP:"setup",COMPLETE:"complete",DASHBOARD:"dashboard"}},24818:(e,t,n)=>{"use strict";n.d(t,{$:()=>o});var a=n(87970),r=n(57762);let o=e=>(0,r.$)(a.H,e)},35695:(e,t,n)=>{"use strict";var a=n(18999);n.o(a,"useParams")&&n.d(t,{useParams:function(){return a.useParams}}),n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})},39641:(e,t,n)=>{"use strict";n.d(t,{C:()=>i,p:()=>s});var a=n(62904),r=n(61573);let o=new a.C("CoreStorageUtils"),s=()=>{try{if("undefined"!=typeof window&&window.localStorage)return window.localStorage}catch(e){o.info("localStorage not found. InMemoryStorage is used as a fallback.")}return new r._},i=()=>{try{if("undefined"!=typeof window&&window.sessionStorage)return window.sessionStorage.getItem("test"),window.sessionStorage;throw Error("sessionStorage is not defined")}catch(e){return o.info("sessionStorage not found. InMemoryStorage is used as a fallback."),new r._}}},42749:(e,t,n)=>{"use strict";n.d(t,{vF:()=>s});let a={debug:0,info:1,warn:2,error:3},r="info",o=()=>!1,s={setLevel(e){void 0!==a[e]&&(r=e)},getLevel:()=>r,debug:(e,t)=>{},info:(e,t)=>{a[r]<=a.info&&(o()?void 0!==t?console.info("[SERVER INFO] ".concat(e),t):console.info("[SERVER INFO] ".concat(e)):void 0!==t?console.info(e,t):console.info(e))},warn:(e,t)=>{a[r]<=a.warn&&(o()?void 0!==t?console.warn("[SERVER WARN] ".concat(e),t):console.warn("[SERVER WARN] ".concat(e)):void 0!==t?console.warn(e,t):console.warn(e))},error:(e,t)=>{a[r]<=a.error&&(o()?void 0!==t?console.error("[SERVER ERROR] ".concat(e),t):console.error("[SERVER ERROR] ".concat(e)):void 0!==t?console.error(e,t):console.error(e))}}},51174:(e,t,n)=>{"use strict";n.d(t,{$_:()=>l,BI:()=>I,FB:()=>v,Nf:()=>f,Pc:()=>d,fy:()=>y,getTenantId:()=>i,getTenantIdFromCognito:()=>h,h_:()=>g,isValidUUID:()=>c,jW:()=>p,oA:()=>u,pm:()=>w,updateTenantIdInCognito:()=>m});var a=n(81746),r=n(24818),o=n(62052);let s="tenantId",i=async()=>{try{var e,t,n,i,c,l;let u=await o.l.getItem(s);if(u)return u;let d=await (0,a.H)(),m=await (0,r.$)(),g=(null==d||null==(e=d.attributes)?void 0:e["custom:tenant_ID"])||(null==d||null==(t=d.attributes)?void 0:t["custom:tenantId"])||(null==m||null==(i=m.accessToken)||null==(n=i.payload)?void 0:n["custom:tenant_ID"])||(null==m||null==(l=m.accessToken)||null==(c=l.payload)?void 0:c["custom:tenantId"]);if(!g)throw Error("Tenant ID not found in user attributes or session");return await o.l.setItem(s,g),g}catch(e){throw console.error("Error getting tenant ID:",e),e}},c=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),l=async e=>{try{await o.l.setItem(s,e)}catch(e){throw console.error("Error storing tenant ID:",e),e}},u=async e=>{let{tenantId:t,metadata:n={}}=e;try{if(!t)return void console.error("Cannot store tenant info: No tenant ID provided");await o.l.setItem(s,t),window.__APP_CACHE||(window.__APP_CACHE={}),window.__APP_CACHE.tenant||(window.__APP_CACHE.tenant={}),window.__APP_CACHE.tenant.id=t,window.__APP_CACHE.tenant.metadata=n,window.__APP_CACHE.tenant.timestamp=Date.now();try{sessionStorage.setItem("tenant_id",t),sessionStorage.setItem("tenant_info",JSON.stringify({id:t,metadata:n,timestamp:Date.now()}))}catch(e){console.debug("Could not store tenant info in sessionStorage:",e)}console.debug("[TenantUtils] Stored tenant info for ID: ".concat(t))}catch(e){console.error("Error storing tenant info:",e)}},d=e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e,m=async e=>{try{let{updateUserAttributes:t}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158));await t({userAttributes:{"custom:tenant_ID":e}}),await l(e),console.debug("[TenantUtils] Updated tenant ID in Cognito: ".concat(e))}catch(t){console.error("Error updating tenant ID in Cognito:",t),await l(e)}},g=async e=>{try{await o.l.setItem("auth_tokens",e)}catch(e){throw console.error("Error setting tokens:",e),e}},h=async()=>{try{var e,t,n,i,c,l;let u=await o.l.getItem(s);if(u)return u;let d=await (0,a.H)(),m=await (0,r.$)(),g=(null==d||null==(e=d.attributes)?void 0:e["custom:tenant_ID"])||(null==d||null==(t=d.attributes)?void 0:t["custom:tenantId"])||(null==m||null==(i=m.accessToken)||null==(n=i.payload)?void 0:n["custom:tenant_ID"])||(null==m||null==(l=m.accessToken)||null==(c=l.payload)?void 0:c["custom:tenantId"]);if(!g)return null;return await o.l.setItem(s,g),g}catch(e){return console.error("Error getting tenant ID from Cognito:",e),null}},f=async e=>{try{if(!c(e))return!1;return(await fetch("/api/tenants/".concat(e,"/validate"))).ok}catch(e){return console.error("Error validating tenant ID:",e),!1}},w=e=>{let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return"00000000-0000-4000-a000-".concat(Math.abs(t).toString(16).padStart(12,"0"))},p=async()=>{try{let e=await i();if(!c(e))return console.error("Invalid tenant ID format:",e),null;return e}catch(e){return console.error("Error getting secure tenant ID:",e),null}},I=e=>c(e),v=e=>e?"tenant_".concat(e.replace(/-/g,"_")):"public",y=async()=>{try{let e=await i(),t={"Content-Type":"application/json","x-tenant-id":e};try{let{getCurrentUser:e}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158)),a=await e();a&&a.userId&&(t["x-user-id"]=a.userId)}catch(e){}return t}catch(e){return console.error("Error getting tenant headers:",e),{"Content-Type":"application/json"}}}},57762:(e,t,n)=>{"use strict";n.d(t,{$:()=>a});let a=(e,t)=>e.Auth.fetchAuthSession(t)},60225:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var a=n(55166),r=n(68387),o=n(95155),s=n(12115),i=n(35695),c=n(66591),l=n(19596),u=n(42749),d=n(51174);function m(){var e;let t=(0,i.useSearchParams)(),[n,m]=(0,s.useState)(null),[g,h]=(0,s.useState)(null);(0,s.useEffect)(()=>{try{let o=(0,d.getTenantId)();h(o),u.vF.info("[SubscriptionToDashboard] Preparing redirect with tenant ID: ".concat(o));let s=t.get("plan");if(s)return void m({plan:s,isFreePlan:"free"===s.toLowerCase()||"basic"===s.toLowerCase()});let i=sessionStorage.getItem("selectedPlan")||sessionStorage.getItem("pendingSubscription");if(i){var e,n;let t=JSON.parse(i);m((0,r._)((0,a._)({},t),{isFreePlan:(null==(e=t.plan)?void 0:e.toLowerCase())==="free"||(null==(n=t.plan)?void 0:n.toLowerCase())==="basic"}))}}catch(e){u.vF.error("Error retrieving plan data:",e)}},[t]);let f="Setting up your ".concat(n&&"basic"===((null==(e=n.plan)?void 0:e.toLowerCase())||"free")?"Basic":"Free"," account...");return(0,o.jsx)(c.A,{from:l.kd.SUBSCRIPTION,to:"dashboard",toPath:(()=>{let e="newAccount=true&plan=".concat((null==n?void 0:n.plan)||"free","&freePlan=true&direct=true");return g&&"undefined"!==g&&"null"!==g?"/".concat(g,"/dashboard?").concat(e):"/dashboard?".concat(e,"&noTenantId=true")})(),message:f,delayMs:2500,data:n,onBeforeNavigate:()=>{try{document.cookie="onboardingStep=dashboard; path=/; max-age=".concat(2592e3,"; samesite=lax"),document.cookie="subscriptionCompleted=true; path=/; max-age=".concat(2592e3,"; samesite=lax"),document.cookie="freePlanSelected=true; path=/; max-age=".concat(2592e3,"; samesite=lax"),document.cookie="selectedPlan=".concat((null==n?void 0:n.plan)||"free","; path=/; max-age=").concat(2592e3,"; samesite=lax"),document.cookie="onboardedStatus=COMPLETE; path=/; max-age=".concat(2592e3,"; samesite=lax"),localStorage.setItem("onboardingStatus","complete"),localStorage.setItem("freePlanSelected","true"),sessionStorage.setItem("freePlanActivated",JSON.stringify({plan:(null==n?void 0:n.plan)||"free",timestamp:Date.now(),activationSource:"onboarding"})),u.vF.info("[SubscriptionToDashboard] Dashboard redirect prepared with tenant: ".concat(g))}catch(e){u.vF.error("Error setting dashboard transition data:",e)}}})}},61573:(e,t,n)=>{"use strict";n.d(t,{_:()=>a});class a{constructor(){this.storage=new Map}get length(){return this.storage.size}key(e){return e>this.length-1?null:Array.from(this.storage.keys())[e]}setItem(e,t){this.storage.set(e,t)}getItem(e){return this.storage.get(e)??null}removeItem(e){this.storage.delete(e)}clear(){this.storage.clear()}}},66591:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var a=n(95155),r=n(12115),o=n(35695),s=n(77657),i=n(19596);function c(e){let{from:t="",to:n="",toPath:c="",message:l="",delayMs:u=1500,data:d=null,onBeforeNavigate:m=null}=e,g=(0,o.useRouter)(),[h,f]=(0,r.useState)(Math.ceil(u/1e3)),[w,p]=(0,r.useState)(0),I=()=>c||("dashboard"===n?"/dashboard":"/onboarding/".concat(n)),v=()=>{if(d)try{sessionStorage.setItem("onboardingTransitionData",JSON.stringify({from:t,to:n,timestamp:Date.now(),data:d}))}catch(e){console.error("Failed to persist transition data:",e)}};return(0,r.useEffect)(()=>{let e=setInterval(()=>{p(e=>Math.min(e+100/(u/100),100))},100),t=setInterval(()=>{f(e=>Math.max(e-1,0))},1e3),n=setTimeout(()=>{if(v(),m)try{m()}catch(e){console.error("Error in onBeforeNavigate callback:",e)}let e=I();g.push(e)},u);return()=>{clearInterval(e),clearInterval(t),clearTimeout(n)}},[u,g,t,n,c,m,d]),(0,a.jsx)("div",{className:"flex h-screen items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center max-w-md mx-auto p-8 rounded-xl bg-white shadow-sm",children:[(0,a.jsx)(s.A,{size:"large",showProgress:!0,progress:w}),(0,a.jsx)("h2",{className:"mt-6 text-xl font-semibold text-gray-800",children:l||(()=>{if(t===i.kd.BUSINESS_INFO&&n===i.kd.SUBSCRIPTION)return"Saving your business information...";if(t===i.kd.SUBSCRIPTION&&n===i.kd.PAYMENT)return"Preparing payment options...";if(t===i.kd.SUBSCRIPTION&&"dashboard"===n)return"Setting up your free account...";if(t===i.kd.PAYMENT&&n===i.kd.SETUP)return"Processing your payment...";if(t===i.kd.PAYMENT&&"dashboard"===n)return"Finalizing your account setup...";else if("dashboard"===n)return"Redirecting to dashboard...";else return"Redirecting to next step..."})()}),(0,a.jsxs)("p",{className:"mt-2 text-sm text-gray-500",children:["Redirecting ",n?"to ".concat(n):""," in ",h," second",1!==h?"s":""]}),(0,a.jsx)("div",{className:"mt-6 w-full bg-gray-100 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300 ease-in-out",style:{width:"".concat(w,"%")}})})]})})}},77657:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var a=n(95155);function r(e){let{size:t="medium",fullscreen:n=!1,message:r="Loading...",color:o="currentColor"}=e,s={small:{spinner:"h-4 w-4",text:"text-sm"},medium:{spinner:"h-8 w-8",text:"text-base"},large:{spinner:"h-12 w-12",text:"text-lg"}},i=s[t]||s.medium;return(0,a.jsx)("div",{className:n?"fixed inset-0 z-50 flex items-center justify-center bg-white bg-opacity-80":"flex flex-col items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"".concat(i.spinner," animate-spin"),style:{color:o},children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"opacity-25",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),r&&(0,a.jsx)("div",{className:"mt-3 ".concat(i.text," text-gray-700"),children:r})]})})}n(12115)},81746:(e,t,n)=>{"use strict";n.d(t,{H:()=>o});var a=n(87970),r=n(19002);let o=async()=>(0,r.H)(a.H)},94225:(e,t,n)=>{"use strict";n.d(t,{U:()=>r});var a=n(95730);class r{constructor(e){this.storage=e}async setItem(e,t){if(!this.storage)throw new a.h;this.storage.setItem(e,t)}async getItem(e){if(!this.storage)throw new a.h;return this.storage.getItem(e)}async removeItem(e){if(!this.storage)throw new a.h;this.storage.removeItem(e)}async clear(){if(!this.storage)throw new a.h;this.storage.clear()}}},95730:(e,t,n)=>{"use strict";n.d(t,{h:()=>o});var a=n(31241),r=n(65206);class o extends r.x{constructor(){super({name:a.m.PlatformNotSupported,message:"Function not supported on current platform"})}}}},e=>{var t=t=>e(e.s=t);e.O(0,[54940,9296,79480,62052,28441,31684,77358],()=>t(12912)),_N_E=e.O()}]);