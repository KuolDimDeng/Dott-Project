(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[97330],{8257:(e,t,n)=>{Promise.resolve().then(n.bind(n,21676))},21676:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>v});var a=n(95155),r=n(12115),o=n(35695),i=n(11024),s=n(52584),l=n(81746),c=n(81011),u=n(42749),d=n(29670),g=n(51174),m=n(57247),p=n(24818);let h=e=>{let{showSignOut:t=!1,showBackButton:n=!1}=e,r=(0,o.useRouter)(),i=async()=>{try{await signOut(),r.push("/sign-in")}catch(e){console.error("Error signing out:",e)}};return(0,a.jsx)("header",{className:"bg-white py-4 px-4 shadow-sm",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[n&&(0,a.jsx)("button",{onClick:()=>{r.push("/onboarding/business-info")},className:"mr-4 text-gray-600 hover:text-gray-900","aria-label":"Go back",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,a.jsx)("img",{src:"/logo.svg",alt:"Logo",className:"h-8",onError:e=>{e.target.onerror=null,e.target.src="/images/logo-fallback.png"}})]}),t&&(0,a.jsx)("button",{onClick:i,className:"text-sm text-gray-600 hover:text-gray-900",children:"Sign out"})]})})},f=[{id:"free",name:"Free",description:"Basic features for small businesses",price:0,features:["Basic reporting","Limited storage","Email support"]},{id:"professional",name:"Professional",description:"Advanced features for growing businesses",price:29,features:["Advanced reporting","Increased storage","Priority support"]},{id:"enterprise",name:"Enterprise",description:"Premium features for large businesses",price:99,features:["Full reporting suite","Unlimited storage","24/7 dedicated support"]}],b=e=>(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:e.className||"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),w=async()=>{try{let{tokens:e}=await (0,p.$)({forceRefresh:!0});if(null==e?void 0:e.idToken){sessionStorage.setItem("idToken",e.idToken.toString()),document.cookie="idToken=".concat(e.idToken.toString(),"; path=/; max-age=86400; SameSite=Strict; Secure"),document.cookie="authSessionId=".concat(e.idToken.toString().split(".")[2],"; path=/; max-age=86400; SameSite=Strict; Secure");try{let t=JSON.parse(atob(e.idToken.toString().split(".")[1])),n=new Date(1e3*t.exp).toISOString();u.vF.debug("[SubscriptionPage] Token refreshed, expires:",n)}catch(e){}}return(null==e?void 0:e.accessToken)&&(sessionStorage.setItem("accessToken",e.accessToken.toString()),document.cookie="accessToken=".concat(e.accessToken.toString(),"; path=/; max-age=86400; SameSite=Strict; Secure")),!0}catch(e){return u.vF.error("[SubscriptionPage] Error refreshing auth session:",e),!1}};function v(){let e=(0,o.useRouter)();(0,o.useSearchParams)();let[t,n]=(0,r.useState)({businessName:"Your Business",businessType:"Other"}),[p,v]=(0,r.useState)(null),[y,S]=(0,r.useState)("monthly"),[x,I]=(0,r.useState)(!0),[E,_]=(0,r.useState)(null),[T,C]=(0,r.useState)(!1),[N,F]=(0,r.useState)(null);(0,r.useEffect)(()=>{let t=async()=>{try{let e;I(!0),u.vF.info("[SubscriptionPage] Initializing subscription page");try{let e=(0,d.gd)("businessInfo");if(e)u.vF.debug("[SubscriptionPage] Using cached business info"),n(e);else{let e=await (0,i.T)();if(e["custom:businessname"]){let t={businessName:e["custom:businessname"]||"Your Business",businessType:e["custom:businesstype"]||"Other",legalName:e["custom:legalname"]||e["custom:businessname"]||"Your Business",country:e["custom:country"]||"US"};n(t),(0,d.mm)("businessInfo",t,{ttl:36e5})}}}catch(e){u.vF.warn("[SubscriptionPage] Failed to get business info, using defaults:",e)}try{let t=await (0,i.T)();if(!(e=t["custom:tenant_ID"]||t["custom:businessid"])||!(0,g.isValidUUID)(e)){e=(0,c.A)(),u.vF.info("[SubscriptionPage] Generated new tenant ID:",e),(0,d.mm)("tenant_id",e,{ttl:2592e6});try{await (0,s.u)({userAttributes:{"custom:tenant_ID":e,"custom:businessid":e,"custom:updated_at":new Date().toISOString()}})}catch(e){u.vF.warn("[SubscriptionPage] Could not update Cognito with tenant ID:",e)}}}catch(t){e=(0,c.A)(),u.vF.warn("[SubscriptionPage] Error getting tenant ID, generated fallback:",e)}F(e)}catch(e){u.vF.error("[SubscriptionPage] Error initializing subscription:",e),_("Failed to load subscription information. Please try refreshing the page.")}finally{I(!1)}};(async()=>{try{await (0,l.H)(),await t()}catch(t){u.vF.error("[SubscriptionPage] Error authenticating user:",t),e.push("/sign-in")}})()},[e]);let A=async()=>{try{if(C(!0),_(null),u.vF.info("[SubscriptionPage] Free plan selected"),!N){let e=(0,c.A)();F(e),u.vF.info("[SubscriptionPage] Generated new tenant ID for free plan:",e)}localStorage.setItem("subscription_completed","true"),localStorage.setItem("tenant_id",N),localStorage.setItem("subscription_plan","free"),localStorage.setItem("subscription_date",new Date().toISOString()),document.cookie="tenant_id=".concat(N,"; path=/; max-age=2592000; SameSite=Strict"),document.cookie="subscription_plan=free; path=/; max-age=2592000; SameSite=Strict",document.cookie="subscription_status=active; path=/; max-age=2592000; SameSite=Strict",u.vF.info("[SubscriptionPage] Storing subscription data locally"),(0,m.jJ)(N);try{"function"==typeof d.mm&&((0,d.mm)("selectedPlan","free",{ttl:2592e6}),(0,d.mm)("subscription_status","active",{ttl:2592e6})),sessionStorage.setItem("selectedPlan","free"),sessionStorage.setItem("subscription_status","active")}catch(e){u.vF.warn("[SubscriptionPage] Error saving to session storage:",e)}await w();let e="/"+N+"/dashboard?fromSubscription=true&plan=free";u.vF.info("[SubscriptionPage] Redirecting to dashboard:",e),window.location.href=e}catch(t){u.vF.error("[SubscriptionPage] Error in free plan selection:",t),_("There was an error setting up your account. Please try again.");try{let t=(0,m.If)()||N||(0,c.A)();u.vF.info("[SubscriptionPage] Attempting fallback redirect with ID:",t),await w(),setTimeout(()=>{e.push("/"+t+"/dashboard?fromSubscription=true&recovery=true")},500)}catch(t){u.vF.error("[SubscriptionPage] Fallback redirect failed:",t),setTimeout(()=>{e.push("/")},1500)}}finally{C(!1)}},k=async t=>{try{if(C(!0),_(null),u.vF.info("[SubscriptionPage] Paid plan selected:",{planId:t,billingCycle:y}),!N){let e=(0,c.A)();F(e),u.vF.info("[SubscriptionPage] Generated new tenant ID for paid plan:",e)}localStorage.setItem("subscription_completed","true"),localStorage.setItem("tenant_id",N),localStorage.setItem("subscription_plan",t),localStorage.setItem("billing_cycle",y),localStorage.setItem("subscription_date",new Date().toISOString()),u.vF.info("[SubscriptionPage] Storing subscription data locally"),(0,m.jJ)(N);try{"function"==typeof d.mm&&((0,d.mm)("selectedPlan",t,{ttl:2592e6}),(0,d.mm)("billingCycle",y,{ttl:2592e6}),(0,d.mm)("subscription_status","pending",{ttl:2592e6})),sessionStorage.setItem("selectedPlan",t),sessionStorage.setItem("billingCycle",y),sessionStorage.setItem("subscription_status","pending")}catch(e){u.vF.warn("[SubscriptionPage] Error saving to session storage:",e)}await w();let n="/"+N+"/dashboard?fromSubscription=true&plan="+t;u.vF.info("[SubscriptionPage] Redirecting to dashboard:",n),setTimeout(()=>{e.push(n)},500)}catch(t){u.vF.error("[SubscriptionPage] Error in paid plan selection:",t),_("There was an error setting up your subscription. Please try again."),setTimeout(()=>{e.push("/")},1500)}finally{C(!1)}},P=e=>{v(e),"free"===e?A():k(e)};return x?(0,a.jsx)("div",{className:"flex h-screen items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-blue-600 border-r-transparent align-[-0.125em]",role:"status",children:(0,a.jsx)("span",{className:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]",children:"Loading..."})}),(0,a.jsx)("p",{className:"mt-4 text-lg text-gray-700",children:"Loading subscription options..."})]})}):E?(0,a.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-50 p-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md p-6 bg-white rounded-lg shadow-lg",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-12 h-12 mx-auto mb-4 rounded-full bg-red-100",children:(0,a.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,a.jsx)("h2",{className:"mb-4 text-xl font-semibold text-center text-gray-800",children:"Error Loading Subscription Options"}),(0,a.jsx)("p",{className:"mb-6 text-center text-gray-600",children:E}),(0,a.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,a.jsx)("button",{onClick:()=>{_(null),window.location.reload()},className:"w-full px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50",children:"Try Again"}),(0,a.jsx)("button",{onClick:()=>e.push("/onboarding/business-info"),className:"w-full px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50",children:"Back to Business Info"})]})]})}):(0,a.jsxs)("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[(0,a.jsx)(h,{showSignOut:!0,showBackButton:!0}),(0,a.jsx)("main",{className:"flex-grow px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-center mb-8 text-slate-800",children:"Choose Your Subscription Plan"}),(0,a.jsx)("p",{className:"text-md text-gray-600 text-center max-w-3xl mx-auto mb-8",children:"Select the plan that best fits your business needs. You can upgrade or downgrade your subscription at any time."}),(0,a.jsx)("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-3 gap-6",children:f.map(e=>(0,a.jsxs)("div",{className:"border rounded-lg overflow-hidden "+(p===e.id?"border-2 border-blue-500 shadow-md":"border-gray-200"),children:[(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:e.name}),(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:e.description}),(0,a.jsxs)("p",{className:"text-3xl font-bold mb-6",children:["$"+e.price,(0,a.jsxs)("span",{className:"text-lg font-normal text-gray-500",children:["/",y]})]}),(0,a.jsx)("button",{onClick:()=>P(e.id),disabled:T,className:"w-full py-2 px-4 rounded-md "+(T?"bg-gray-300 cursor-not-allowed":p===e.id?"bg-blue-500 text-white":"bg-gray-100 text-gray-800 hover:bg-gray-200")+" focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",children:T&&p===e.id?"Processing...":"Select "+e.name+" Plan"})]}),(0,a.jsx)("div",{className:"px-6 pb-6",children:(0,a.jsx)("ul",{className:"space-y-2",children:e.features.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)(b,{className:"h-5 w-5 text-green-500 mr-2"}),(0,a.jsx)("span",{className:"text-gray-700",children:e})]},t))})})]},e.id))}),(0,a.jsxs)("div",{className:"mt-10 flex flex-col items-center",children:[(0,a.jsx)("p",{className:"text-gray-700 mb-4",children:"Billing Cycle"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>S("monthly"),className:"px-4 py-2 rounded-md "+("monthly"===y?"bg-blue-500 text-white":"bg-gray-100 text-gray-800"),children:"Monthly"}),(0,a.jsx)("button",{onClick:()=>S("annual"),className:"px-4 py-2 rounded-md "+("annual"===y?"bg-blue-500 text-white":"bg-gray-100 text-gray-800"),children:"Annual (Save 10%)"})]})]})]})})]})}},29670:(e,t,n)=>{"use strict";n.d(t,{$R:()=>c,A6:()=>s,Ay:()=>d,IL:()=>l,bB:()=>u,gd:()=>i,mm:()=>o});var a=n(42749);let r=null;try{window.AWSCache&&(r=window.AWSCache,a.vF.debug("[appCache] AWS App Cache initialized successfully"))}catch(e){a.vF.warn("[appCache] Failed to initialize AWS App Cache:",e)}async function o(e,t,n){try{if(!e)throw Error("Cache key is required");if(r)await r.set(e,t,n),a.vF.debug("[appCache] Set value for key: ".concat(e));else{let r={value:t,timestamp:Date.now(),ttl:n?1e3*n:null};window.sessionStorage.setItem(e,JSON.stringify(r)),a.vF.debug("[appCache] Set value in sessionStorage for key: ".concat(e))}}catch(t){throw a.vF.error("[appCache] Error setting cache value for key ".concat(e,":"),t),t}}async function i(e){try{if(!e)throw Error("Cache key is required");if(r){let t=await r.get(e);return a.vF.debug("[appCache] Retrieved value for key: ".concat(e)),t}{let t=window.sessionStorage.getItem(e);if(!t)return null;let{value:n,timestamp:r,ttl:o}=JSON.parse(t);if(o&&Date.now()-r>o)return window.sessionStorage.removeItem(e),a.vF.debug("[appCache] Removed expired value for key: ".concat(e)),null;return a.vF.debug("[appCache] Retrieved value from sessionStorage for key: ".concat(e)),n}}catch(t){return a.vF.error("[appCache] Error getting cache value for key ".concat(e,":"),t),null}}async function s(e){try{if(!e)throw Error("Cache key is required");r?(await r.remove(e),a.vF.debug("[appCache] Removed value for key: ".concat(e))):(window.sessionStorage.removeItem(e),a.vF.debug("[appCache] Removed value from sessionStorage for key: ".concat(e)))}catch(t){throw a.vF.error("[appCache] Error removing cache value for key ".concat(e,":"),t),t}}async function l(){try{r?(await r.clear(),a.vF.debug("[appCache] Cleared all values from AWS App Cache")):(window.sessionStorage.clear(),a.vF.debug("[appCache] Cleared all values from sessionStorage"))}catch(e){throw a.vF.error("[appCache] Error clearing cache:",e),e}}let c=s,u=l,d={setCacheValue:o,getCacheValue:i,removeCacheValue:s,clearCache:l,setAppCacheItem:o,getAppCacheItem:i,removeAppCacheItem:c,clearAppCache:u}},42749:(e,t,n)=>{"use strict";n.d(t,{vF:()=>i});let a={debug:0,info:1,warn:2,error:3},r="info",o=()=>!1,i={setLevel(e){void 0!==a[e]&&(r=e)},getLevel:()=>r,debug:(e,t)=>{},info:(e,t)=>{a[r]<=a.info&&(o()?void 0!==t?console.info("[SERVER INFO] ".concat(e),t):console.info("[SERVER INFO] ".concat(e)):void 0!==t?console.info(e,t):console.info(e))},warn:(e,t)=>{a[r]<=a.warn&&(o()?void 0!==t?console.warn("[SERVER WARN] ".concat(e),t):console.warn("[SERVER WARN] ".concat(e)):void 0!==t?console.warn(e,t):console.warn(e))},error:(e,t)=>{a[r]<=a.error&&(o()?void 0!==t?console.error("[SERVER ERROR] ".concat(e),t):console.error("[SERVER ERROR] ".concat(e)):void 0!==t?console.error(e,t):console.error(e))}}},51174:(e,t,n)=>{"use strict";n.d(t,{$_:()=>c,BI:()=>w,FB:()=>v,Nf:()=>h,Pc:()=>d,fy:()=>y,getTenantId:()=>s,getTenantIdFromCognito:()=>p,h_:()=>m,isValidUUID:()=>l,jW:()=>b,oA:()=>u,pm:()=>f,updateTenantIdInCognito:()=>g});var a=n(81746),r=n(24818),o=n(62052);let i="tenantId",s=async()=>{try{var e,t,n,s,l,c;let u=await o.l.getItem(i);if(u)return u;let d=await (0,a.H)(),g=await (0,r.$)(),m=(null==d||null==(e=d.attributes)?void 0:e["custom:tenant_ID"])||(null==d||null==(t=d.attributes)?void 0:t["custom:tenantId"])||(null==g||null==(s=g.accessToken)||null==(n=s.payload)?void 0:n["custom:tenant_ID"])||(null==g||null==(c=g.accessToken)||null==(l=c.payload)?void 0:l["custom:tenantId"]);if(!m)throw Error("Tenant ID not found in user attributes or session");return await o.l.setItem(i,m),m}catch(e){throw console.error("Error getting tenant ID:",e),e}},l=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),c=async e=>{try{await o.l.setItem(i,e)}catch(e){throw console.error("Error storing tenant ID:",e),e}},u=async e=>{let{tenantId:t,metadata:n={}}=e;try{if(!t)return void console.error("Cannot store tenant info: No tenant ID provided");await o.l.setItem(i,t),window.__APP_CACHE||(window.__APP_CACHE={}),window.__APP_CACHE.tenant||(window.__APP_CACHE.tenant={}),window.__APP_CACHE.tenant.id=t,window.__APP_CACHE.tenant.metadata=n,window.__APP_CACHE.tenant.timestamp=Date.now();try{sessionStorage.setItem("tenant_id",t),sessionStorage.setItem("tenant_info",JSON.stringify({id:t,metadata:n,timestamp:Date.now()}))}catch(e){console.debug("Could not store tenant info in sessionStorage:",e)}console.debug("[TenantUtils] Stored tenant info for ID: ".concat(t))}catch(e){console.error("Error storing tenant info:",e)}},d=e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e,g=async e=>{try{let{updateUserAttributes:t}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158));await t({userAttributes:{"custom:tenant_ID":e}}),await c(e),console.debug("[TenantUtils] Updated tenant ID in Cognito: ".concat(e))}catch(t){console.error("Error updating tenant ID in Cognito:",t),await c(e)}},m=async e=>{try{await o.l.setItem("auth_tokens",e)}catch(e){throw console.error("Error setting tokens:",e),e}},p=async()=>{try{var e,t,n,s,l,c;let u=await o.l.getItem(i);if(u)return u;let d=await (0,a.H)(),g=await (0,r.$)(),m=(null==d||null==(e=d.attributes)?void 0:e["custom:tenant_ID"])||(null==d||null==(t=d.attributes)?void 0:t["custom:tenantId"])||(null==g||null==(s=g.accessToken)||null==(n=s.payload)?void 0:n["custom:tenant_ID"])||(null==g||null==(c=g.accessToken)||null==(l=c.payload)?void 0:l["custom:tenantId"]);if(!m)return null;return await o.l.setItem(i,m),m}catch(e){return console.error("Error getting tenant ID from Cognito:",e),null}},h=async e=>{try{if(!l(e))return!1;return(await fetch("/api/tenants/".concat(e,"/validate"))).ok}catch(e){return console.error("Error validating tenant ID:",e),!1}},f=e=>{let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return"00000000-0000-4000-a000-".concat(Math.abs(t).toString(16).padStart(12,"0"))},b=async()=>{try{let e=await s();if(!l(e))return console.error("Invalid tenant ID format:",e),null;return e}catch(e){return console.error("Error getting secure tenant ID:",e),null}},w=e=>l(e),v=e=>e?"tenant_".concat(e.replace(/-/g,"_")):"public",y=async()=>{try{let e=await s(),t={"Content-Type":"application/json","x-tenant-id":e};try{let{getCurrentUser:e}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158)),a=await e();a&&a.userId&&(t["x-user-id"]=a.userId)}catch(e){}return t}catch(e){return console.error("Error getting tenant headers:",e),{"Content-Type":"application/json"}}}},57247:(e,t,n)=>{"use strict";n.d(t,{GJ:()=>m,If:()=>s,hs:()=>d,jJ:()=>p,yt:()=>u});var a=n(51174),r=n(42749);let o={TENANT_ID:"tenant_id",TENANT_RECOVERY_ATTEMPTS:"tenant_recovery_attempts",LAST_KNOWN_TENANT:"last_known_tenant_id",FALLBACK_ACTIVATED:"tenant_fallback_activated",EMERGENCY_RECOVERY_EXECUTED:"emergency_recovery_executed",EMERGENCY_RECOVERY_TIMESTAMP:"emergency_recovery_timestamp"},i=!1,s=()=>{try{var e,t;let n=localStorage.getItem(o.TENANT_ID);if(n&&(0,a.isValidUUID)(n))return r.vF.debug("[TenantFallback] Using tenant ID from localStorage:",n),n;let i=sessionStorage.getItem(o.TENANT_ID);if(i&&(0,a.isValidUUID)(i))return r.vF.debug("[TenantFallback] Using tenant ID from sessionStorage:",i),localStorage.setItem(o.TENANT_ID,i),i;try{let e=l();if(e&&(0,a.isValidUUID)(e))return r.vF.debug("[TenantFallback] Extracted tenant ID from URL path:",e),localStorage.setItem(o.TENANT_ID,e),e}catch(e){r.vF.error("[TenantFallback] Error extracting tenant ID from URL:",e)}if((null==(t=window.__APP_CACHE)||null==(e=t.tenant)?void 0:e.id)&&(0,a.isValidUUID)(window.__APP_CACHE.tenant.id))return r.vF.debug("[TenantFallback] Using tenant ID from AppCache:",window.__APP_CACHE.tenant.id),localStorage.setItem(o.TENANT_ID,window.__APP_CACHE.tenant.id),window.__APP_CACHE.tenant.id;let s=localStorage.getItem(o.LAST_KNOWN_TENANT);if(s&&(0,a.isValidUUID)(s))return r.vF.debug("[TenantFallback] Using last known tenant ID:",s),localStorage.setItem(o.TENANT_ID,s),s;return r.vF.warn("[TenantFallback] Could not find a valid tenant ID from any source"),null}catch(e){return r.vF.error("[TenantFallback] Error getting fallback tenant ID:",e),null}},l=()=>{try{for(let e of window.location.pathname.split("/").filter(Boolean))if((0,a.isValidUUID)(e))return e;return null}catch(e){return r.vF.error("[TenantFallback] Error extracting tenant ID from URL:",e),null}},c=()=>{try{if("true"===localStorage.getItem(o.FALLBACK_ACTIVATED))return!0;if(parseInt(localStorage.getItem(o.TENANT_RECOVERY_ATTEMPTS)||"0",10)>=2&&s())return localStorage.setItem(o.FALLBACK_ACTIVATED,"true"),!0;return!1}catch(e){return r.vF.error("[TenantFallback] Error checking if tenant recovery should activate:",e),!1}},u=(e,t)=>{try{let n=parseInt(localStorage.getItem(o.TENANT_RECOVERY_ATTEMPTS)||"0",10);return localStorage.setItem(o.TENANT_RECOVERY_ATTEMPTS,String(n+1)),r.vF.warn("[TenantFallback] API failure #".concat(n+1," at ").concat(e,":"),(null==t?void 0:t.message)||t),c()}catch(e){return r.vF.error("[TenantFallback] Error recording API failure:",e),!1}},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let t=e||s();if(!t)return r.vF.error("[TenantFallback] Cannot generate recovery URL without a tenant ID"),"/";return"/".concat(t,"/dashboard?recovery=true")}catch(e){return r.vF.error("[TenantFallback] Error generating recovery dashboard URL:",e),"/"}},g=()=>{if(i)return!0;try{let e=parseInt(localStorage.getItem(o.EMERGENCY_RECOVERY_TIMESTAMP)||"0",10),t=Date.now();if(t-e<1e4)return r.vF.warn("[TenantFallback] Throttling emergency recovery - last recovery was ".concat(t-e,"ms ago")),!0;return!1}catch(e){return r.vF.error("[TenantFallback] Error checking recovery throttle:",e),!1}},m=()=>{if(window.location.pathname.includes("/auth/")||window.location.pathname.includes("/sign-in")||window.location.pathname.includes("/sign-up")||"/"===window.location.pathname||"/login"===window.location.pathname)return r.vF.debug("[TenantFallback] Skipping emergency recovery on auth/public page"),!1;if(g())return!1;i=!0;try{let e=s();if(localStorage.setItem(o.EMERGENCY_RECOVERY_TIMESTAMP,Date.now().toString()),localStorage.setItem(o.EMERGENCY_RECOVERY_EXECUTED,"true"),e){let t=d(e);return r.vF.info("[TenantFallback] Executing emergency recovery navigation to:",t),setTimeout(()=>{try{window.location.href=t}catch(e){r.vF.error("[TenantFallback] Navigation error during emergency recovery:",e),i=!1}},100),!0}if(window.location.pathname.includes("/dashboard"))return r.vF.error("[TenantFallback] Emergency recovery failed - no valid tenant ID found, redirecting to home"),setTimeout(()=>{try{window.location.href="/"}catch(e){r.vF.error("[TenantFallback] Navigation error during fallback to home:",e),i=!1}},100),!1;return r.vF.warn("[TenantFallback] No tenant ID available, but not disrupting current page"),i=!1,!1}catch(e){return r.vF.error("[TenantFallback] Critical error in emergency recovery:",e),i=!1,!1}},p=e=>{if(!e||!(0,a.isValidUUID)(e))if(!e)return r.vF.error("[TenantFallback] Cannot store null tenant ID"),!1;else{let t=(0,a.pm)(e);if(!t)return r.vF.error("[TenantFallback] Cannot store invalid tenant ID and validation failed"),!1;e=t}try{return localStorage.setItem(o.TENANT_ID,e),sessionStorage.setItem(o.TENANT_ID,e),localStorage.setItem(o.LAST_KNOWN_TENANT,e),window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.tenant=window.__APP_CACHE.tenant||{},window.__APP_CACHE.tenant.id=e,!0}catch(e){return r.vF.error("[TenantFallback] Error storing tenant ID reliably:",e),!1}}}},e=>{var t=t=>e(e.s=t);e.O(0,[54940,9296,79480,58430,62052,85152,28441,31684,77358],()=>t(8257)),_N_E=e.O()}]);