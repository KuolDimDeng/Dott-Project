(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[36937],{27494:(e,t,n)=>{"use strict";n.d(t,{$n:()=>o,KZ:()=>r,tg:()=>a});var i=n(42749);let r=()=>"req_"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),o=e=>{try{let t=e.split(".")[1];if(!t)throw Error("Invalid token format");let n=t.replace(/-/g,"+").replace(/_/g,"/"),i=decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(i)}catch(e){return i.vF.error("[authUtils] Failed to parse JWT:",e),{}}},s=["/","/index","/home","/auth/signin","/auth/signup","/auth/forgot-password","/auth/reset-password","/auth/verify","/auth/verify-email","/about","/privacy","/terms","/auth/reset","/auth/reset/confirm","/auth/callback","/api/health","/api/public","/api/login","/api/signup","/login","/signup","/reset-password","/onboarding/business-info","/onboarding/subscription","/onboarding/payment","/onboarding/setup"],a=e=>{if("/"===e||""===e||"/index.html"===e)return i.vF.debug("[authUtils] Route ".concat(e," is public (root path)")),!0;if(e.startsWith("/onboarding/"))return i.vF.debug("[authUtils] Route ".concat(e," is treated as public for redirection purposes")),!0;let t=e.endsWith("/")?e.slice(0,-1):e;if(i.vF.debug("[authUtils] Checking if route is public: ".concat(e," (normalized: ").concat(t,")")),s.includes(t))return i.vF.debug("[authUtils] Route ".concat(e," is public (exact match)")),!0;let n=s.some(e=>t===e||t.startsWith(e+"/")&&"/"!==e);return i.vF.debug("[authUtils] Route ".concat(e," is ").concat(n?"public":"private"," (prefix match)")),n}},29670:(e,t,n)=>{"use strict";n.d(t,{$R:()=>l,A6:()=>a,Ay:()=>d,IL:()=>c,bB:()=>u,gd:()=>s,mm:()=>o});var i=n(42749);let r=null;try{window.AWSCache&&(r=window.AWSCache,i.vF.debug("[appCache] AWS App Cache initialized successfully"))}catch(e){i.vF.warn("[appCache] Failed to initialize AWS App Cache:",e)}async function o(e,t,n){try{if(!e)throw Error("Cache key is required");if(r)await r.set(e,t,n),i.vF.debug("[appCache] Set value for key: ".concat(e));else{let r={value:t,timestamp:Date.now(),ttl:n?1e3*n:null};window.sessionStorage.setItem(e,JSON.stringify(r)),i.vF.debug("[appCache] Set value in sessionStorage for key: ".concat(e))}}catch(t){throw i.vF.error("[appCache] Error setting cache value for key ".concat(e,":"),t),t}}async function s(e){try{if(!e)throw Error("Cache key is required");if(r){let t=await r.get(e);return i.vF.debug("[appCache] Retrieved value for key: ".concat(e)),t}{let t=window.sessionStorage.getItem(e);if(!t)return null;let{value:n,timestamp:r,ttl:o}=JSON.parse(t);if(o&&Date.now()-r>o)return window.sessionStorage.removeItem(e),i.vF.debug("[appCache] Removed expired value for key: ".concat(e)),null;return i.vF.debug("[appCache] Retrieved value from sessionStorage for key: ".concat(e)),n}}catch(t){return i.vF.error("[appCache] Error getting cache value for key ".concat(e,":"),t),null}}async function a(e){try{if(!e)throw Error("Cache key is required");r?(await r.remove(e),i.vF.debug("[appCache] Removed value for key: ".concat(e))):(window.sessionStorage.removeItem(e),i.vF.debug("[appCache] Removed value from sessionStorage for key: ".concat(e)))}catch(t){throw i.vF.error("[appCache] Error removing cache value for key ".concat(e,":"),t),t}}async function c(){try{r?(await r.clear(),i.vF.debug("[appCache] Cleared all values from AWS App Cache")):(window.sessionStorage.clear(),i.vF.debug("[appCache] Cleared all values from sessionStorage"))}catch(e){throw i.vF.error("[appCache] Error clearing cache:",e),e}}let l=a,u=c,d={setCacheValue:o,getCacheValue:s,removeCacheValue:a,clearCache:c,setAppCacheItem:o,getAppCacheItem:s,removeAppCacheItem:l,clearAppCache:u}},42749:(e,t,n)=>{"use strict";n.d(t,{vF:()=>s});let i={debug:0,info:1,warn:2,error:3},r="info",o=()=>!1,s={setLevel(e){void 0!==i[e]&&(r=e)},getLevel:()=>r,debug:(e,t)=>{},info:(e,t)=>{i[r]<=i.info&&(o()?void 0!==t?console.info("[SERVER INFO] ".concat(e),t):console.info("[SERVER INFO] ".concat(e)):void 0!==t?console.info(e,t):console.info(e))},warn:(e,t)=>{i[r]<=i.warn&&(o()?void 0!==t?console.warn("[SERVER WARN] ".concat(e),t):console.warn("[SERVER WARN] ".concat(e)):void 0!==t?console.warn(e,t):console.warn(e))},error:(e,t)=>{i[r]<=i.error&&(o()?void 0!==t?console.error("[SERVER ERROR] ".concat(e),t):console.error("[SERVER ERROR] ".concat(e)):void 0!==t?console.error(e,t):console.error(e))}}},60005:(e,t,n)=>{"use strict";n.d(t,{GC:()=>g,refreshUserSession:()=>m,w8:()=>h});var i=n(24818),r=n(42749),o=n(27494),s=n(60584),a=n(29670);try{window.__APP_CACHE||(window.__APP_CACHE={}),window.__APP_CACHE.auth||(window.__APP_CACHE.auth={}),(window.__APP_CACHE.auth.idToken||(0,a.gd)("idToken"))&&!window.__APP_CACHE.auth.token&&(r.vF.info("[Auth] Migrating from ID token to access token auth"),(0,i.$)().then(e=>{var t,n;(null==e||null==(t=e.tokens)?void 0:t.accessToken)&&(window.__APP_CACHE.auth.token=e.tokens.accessToken.toString(),(0,a.mm)("token",e.tokens.accessToken.toString()),(null==e||null==(n=e.tokens)?void 0:n.idToken)&&(window.__APP_CACHE.auth.idToken=e.tokens.idToken.toString(),(0,a.mm)("idToken",e.tokens.idToken.toString())),r.vF.info("[Auth] Successfully migrated to access token auth"))}).catch(e=>{r.vF.warn("[Auth] Failed to migrate to access token auth:",e)}))}catch(e){r.vF.error("[Auth] Error in token migration:",e)}let c=!1,l=0,u=null,d=0,f=0;function h(){if(!window.__hubProtectionInitialized){r.vF.debug("[Hub Protection] Setting up token refresh event deduplication");let e=s.Hub.dispatch,t=new Map;s.Hub.dispatch=function(n,i){if("auth"===n&&"tokenRefresh"===i.event){let e=Date.now(),n="".concat(i.event);if(t.has(n)){let o=t.get(n);if(e-o<2e3)return void r.vF.debug("[Hub Protection] Dropping duplicate event: ".concat(i.event," (").concat(e-o,"ms ago)"))}if(t.set(n,e),t.size>25){let e=Array.from(t.keys())[0];t.delete(e)}}return e.call(this,n,i)},window.__hubProtectionInitialized=!0,r.vF.debug("[Hub Protection] Hub event deduplication initialized")}}function g(){try{return window.__APP_CACHE||(window.__APP_CACHE={}),window.__APP_CACHE.auth||(window.__APP_CACHE.auth={}),window.__APP_CACHE.auth.provider||(r.vF.info('[Auth] Setting missing auth provider to "cognito" in APP_CACHE'),window.__APP_CACHE.auth.provider="cognito"),!0}catch(e){return r.vF.error("[Auth] Error ensuring auth provider:",e),!1}}h(),g(),setInterval(()=>{f=0},3e5);let m=async()=>{r.vF.info("[Auth] Attempting to refresh user session");try{if(c)return r.vF.info("[Auth] Another refresh is already in progress, waiting for it to complete"),u;let e=Date.now();if(e-l<2e4&&(r.vF.debug("[Auth] Refresh attempt too soon after previous attempt, using cached token"),e-d<9e5))return!0;return c=!0,l=e,u=(async()=>{try{var e,t,n,o,s,a;if(++f>3)return r.vF.warn("[Auth] Maximum refresh attempts (".concat(3,") reached")),await w();let c=null==(n=window)||null==(t=n.__APP_CACHE)||null==(e=t.auth)?void 0:e.provider;if(!c)return r.vF.warn("[Auth] No auth provider found in APP_CACHE"),await w();if("function"==typeof window.refreshAuthToken){r.vF.info("[Auth] Using refreshAuthToken function");let e=await window.refreshAuthToken();if(null==e?void 0:e.success)return r.vF.info("[Auth] Token refresh successful"),d=Date.now(),e.tokens&&p(e.tokens),!0}try{r.vF.info("[Auth] Attempting to refresh session using Amplify");let e=await (0,i.$)({forceRefresh:!0});if(null==e?void 0:e.tokens)return r.vF.info("[Auth] Amplify session refresh successful"),d=Date.now(),p({idToken:null==(o=e.tokens.idToken)?void 0:o.toString(),accessToken:null==(s=e.tokens.accessToken)?void 0:s.toString(),refreshToken:null==(a=e.tokens.refreshToken)?void 0:a.toString()}),!0}catch(e){r.vF.error("[Auth] Amplify refresh failed:",e)}if("cognito"===c&&window.AWS&&window.AWS.Cognito){r.vF.info("[Auth] Attempting Cognito session refresh");try{let e=window.AWS.Cognito.Auth;if(e&&"function"==typeof e.currentSession){let t=await e.currentSession();if(t)return d=Date.now(),p({idToken:t.getIdToken().getJwtToken(),accessToken:t.getAccessToken().getJwtToken(),refreshToken:t.getRefreshToken().getToken()}),r.vF.info("[Auth] Updated token in APP_CACHE via Cognito"),!0}}catch(e){r.vF.error("[Auth] Cognito refresh failed:",e)}}return await w()}finally{c=!1}})(),await u}catch(e){return r.vF.error("[Auth] Error refreshing session:",e),c=!1,await w()}};function p(e){try{if(window.__APP_CACHE||(window.__APP_CACHE={}),window.__APP_CACHE.auth||(window.__APP_CACHE.auth={}),e.accessToken){window.__APP_CACHE.auth.token=e.accessToken,(0,a.mm)("token",e.accessToken),window.__APP_CACHE.auth.provider="cognito";let t=(0,o.$n)(e.accessToken);t.exp&&(window.__APP_CACHE.auth.tokenExpiry=1e3*t.exp,(0,a.mm)("tokenExpiry",1e3*t.exp))}if(e.idToken){window.__APP_CACHE.auth.idToken=e.idToken,(0,a.mm)("idToken",e.idToken);let t=(0,o.$n)(e.idToken);t.sub&&(window.__APP_CACHE.auth.userId=t.sub,(0,a.mm)("userId",t.sub))}e.refreshToken&&(window.__APP_CACHE.auth.refreshToken=e.refreshToken,(0,a.mm)("refreshToken",e.refreshToken));let t=Date.now();return window.__APP_CACHE.auth.tokenTimestamp=t,(0,a.mm)("tokenTimestamp",t),window.__APP_CACHE.auth.hasSession=!0,(0,a.mm)("hasSession",!0),r.vF.debug("[RefreshSession] Stored tokens in APP_CACHE"),!0}catch(e){return r.vF.error("[AuthCache] Error storing tokens in APP_CACHE:",e),!1}}let w=async()=>{r.vF.warn("[Auth] Forcing relogin due to expired session");try{let e=window.location.pathname+window.location.search;return window.__APP_CACHE&&(window.__APP_CACHE.auth||(window.__APP_CACHE.auth={}),window.__APP_CACHE.auth.redirectAfterLogin=e,(0,a.mm)("redirectAfterLogin",e)),window.__APP_CACHE&&window.__APP_CACHE.auth&&(window.__APP_CACHE.auth.token=null,window.__APP_CACHE.auth.accessToken=null,window.__APP_CACHE.auth.refreshToken=null,window.__APP_CACHE.auth.hasSession=!1,window.__APP_CACHE.auth.tokenExpiry=null),window.toast&&"function"==typeof window.toast.error?window.toast.error("Your session has expired. Redirecting to login..."):alert("Your session has expired. Please log in again."),await new Promise(e=>setTimeout(e,2e3)),window.location.href="/login?expired=true&redirect="+encodeURIComponent(e),!1}catch(e){return r.vF.error("[Auth] Error in forceRelogin:",e),window.location.href="/login",!1}}},60584:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Amplify:()=>i.E,Hub:()=>b,configureAmplify:()=>E,confirmResetPassword:()=>l.P,confirmSignUp:()=>a.z,confirmUserAttribute:()=>w.w,fetchAuthSession:()=>f.$,fetchAuthSessionWithConfig:()=>R,fetchUserAttributes:()=>d.T,fetchUserAttributesWithConfig:()=>I,getCurrentUser:()=>u.H,getCurrentUserWithConfig:()=>H,initAmplify:()=>T,isAmplifyConfigured:()=>F,resendSignUpCode:()=>h.h,resetPassword:()=>c.x,safeSignOut:()=>S,sendUserAttributeVerificationCode:()=>p.c,setUpTOTP:()=>v.x,signIn:()=>o.J,signInWithConfig:()=>N,signInWithRedirect:()=>m.$,signOut:()=>r.C,signOutWithConfig:()=>U,signUp:()=>s.H,updateUserAttributes:()=>g.u});var i=n(63900),r=n(82354),o=n(23639),s=n(95027),a=n(55481),c=n(27755),l=n(80079),u=n(81746),d=n(11024),f=n(24818),h=n(97220),g=n(52584),m=n(15102),p=n(35220),w=n(71194),v=n(35030),A=n(51148),y=n(42749),C=n(49509);let b=A.YZ,_="1o5v84mrgn4gt87khtr179uc5b",x="us-east-1_JPL8vGfb6",P="us-east-1";y.vF.debug("[AmplifyUnified] Configuration values:",{COGNITO_CLIENT_ID:_,COGNITO_USER_POOL_ID:x,AWS_REGION:P});let k=!1,E=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(k&&!e)return y.vF.debug("[AmplifyUnified] Amplify already configured, skipping"),!0;try{e&&(y.vF.info("[AmplifyUnified] Force reconfiguring Amplify"),window.__amplifyConfigured&&(window.__amplifyConfigured=!1))}catch(e){y.vF.error("[AmplifyUnified] Error during force reconfigure:",e)}try{y.vF.info("[AmplifyUnified] Configuring Amplify",{environment:"production",isDevelopment:!1});let e=x||C.env.NEXT_PUBLIC_USER_POOL_ID||"us-east-1_JPL8vGfb6",t=_||C.env.NEXT_PUBLIC_USER_POOL_CLIENT_ID||"1o5v84mrgn4gt87khtr179uc5b";if(!e||!t)return y.vF.error("[AmplifyUnified] Missing required configuration:",{hasUserPoolId:!!e,hasClientId:!!t}),k=!1,!1;let n={Auth:{Cognito:{userPoolId:e,userPoolClientId:t,identityPoolId:C.env.NEXT_PUBLIC_COGNITO_IDENTITY_POOL_ID,region:P||"us-east-1",loginWith:{email:!0,username:!0,phone:!1},httpOptions:{timeout:3e4,connectTimeout:1e4,rejectUnauthorized:!1,retryable:!0,maxRetries:3}}}};y.vF.debug("[AmplifyUnified] Amplify configuration:",{userPoolId:n.Auth.Cognito.userPoolId,userPoolClientId:n.Auth.Cognito.userPoolClientId,region:n.Auth.Cognito.region}),i.E.configure(n);let r=i.E.getConfig();if(!(r&&r.Auth&&r.Auth.Cognito&&r.Auth.Cognito.userPoolId))return y.vF.error("[AmplifyUnified] Configuration verification failed",{hasConfig:!!r,hasAuth:!!(r&&r.Auth),hasCognito:!!(r&&r.Auth&&r.Auth.Cognito)}),k=!1,!1;return b.listen("auth",e=>{if("signOut"===e.payload.event||"signIn_failure"===e.payload.event){var t,n;y.vF.debug("[AmplifyUnified] Auth event that might require reconfiguration:",{event:e.payload.event,data:e.payload.data});let r=i.E.getConfig();(null==r||null==(n=r.Auth)||null==(t=n.Cognito)?void 0:t.userPoolId)||(y.vF.warn("[AmplifyUnified] Configuration lost after auth event, reconfiguring..."),E())}}),k=!0,y.vF.info("[AmplifyUnified] Amplify configured successfully"),window.__amplifyConfigured=!0,!0}catch(e){return y.vF.error("[AmplifyUnified] Failed to configure Amplify:",{error:e.message,stack:e.stack}),k=!1,!1}};try{E()}catch(e){y.vF.error("[AmplifyUnified] Error during initial Amplify configuration:",e)}let F=()=>{var e,t;if(!k)return y.vF.info("[AmplifyUnified] Amplify configuration status check: Not configured"),!1;let n=i.E.getConfig(),r=!!(n&&(null==(t=n.Auth)||null==(e=t.Cognito)?void 0:e.userPoolId));return y.vF.debug("[AmplifyUnified] Amplify configuration status:",{isConfigured:k,hasAuth:r,config:{isConfigured:k,hasAuth:r}}),k&&r},S=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{global:!0};try{y.vF.info("[AmplifyUnified] Amplify configuration status before sign out:",{isConfigured:F()}),F()||(y.vF.warn("[AmplifyUnified] Attempting to reconfigure Amplify before signing out"),E());try{return await (0,r.C)(e),y.vF.info("[AmplifyUnified] Successfully signed out user"),!0}catch(e){if(y.vF.error("[AmplifyUnified] Error during Amplify signOut:",e),"AuthUserPoolException"===e.name||e.message&&e.message.includes("UserPool not configured")){y.vF.warn("[AmplifyUnified] Auth UserPool not configured, attempting recovery"),E();try{window.__APP_CACHE&&(window.__APP_CACHE.auth={},window.__APP_CACHE.user={},y.vF.info("[AmplifyUnified] Cleared app cache for auth data"))}catch(e){y.vF.error("[AmplifyUnified] Error clearing app cache:",e)}}return!0}}catch(e){return y.vF.error("[AmplifyUnified] Unexpected error in safeSignOut:",e),!0}},j=async function(e){for(var t,n,i=arguments.length,r=Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];try{if(e===o.J)try{if(await (0,u.H)()){y.vF.warn("[AmplifyUnified] User already authenticated, signing out first");try{await S({global:!0})}catch(e){y.vF.error("[AmplifyUnified] Error signing out before signIn:",e)}}}catch(e){(null==(t=e.message)?void 0:t.includes("not authenticated"))||y.vF.warn("[AmplifyUnified] Error checking current user before signIn:",e)}F()||(y.vF.warn("[AmplifyUnified] Amplify not configured before auth function call, configuring now"),E(!0));let i=0;for(;i<=3;)try{return await e(...r)}catch(r){if(i++,y.vF.error("[AmplifyUnified] Error in ".concat(e.name," (retry ").concat(i,"/").concat(3,"):"),{name:r.name,message:r.message,code:r.code,statusCode:null==r||null==(n=r.response)?void 0:n.status,retryable:r.retryable}),("AuthUserPoolException"===r.name||r.message&&r.message.includes("UserPool not configured"))&&(y.vF.warn("[AmplifyUnified] Auth UserPool not configured, attempting recovery (retry ".concat(i,"/").concat(3,")")),E(!0),i<=3)){await new Promise(e=>setTimeout(e,1e3*i));continue}if(("NetworkError"===r.name||r.message&&(r.message.includes("network")||r.message.includes("Network")||r.message.includes("SSL")||r.message.includes("certificate")||r.message.includes("CORS")||r.message.includes("timeout"))||"NETWORK_ERROR"===r.code||"NetworkingError"===r.code)&&(y.vF.warn("[AmplifyUnified] Network error, attempting retry with backoff (retry ".concat(i,"/").concat(3,")")),E(!0),i<=3)){let e=Math.min(2e3*Math.pow(2,i-1),1e4);y.vF.info("[AmplifyUnified] Waiting ".concat(e,"ms before retry")),await new Promise(t=>setTimeout(t,e));continue}if(i>3)throw r;let t=1e3*i;await new Promise(e=>setTimeout(e,t))}throw Error("[AmplifyUnified] Failed to execute ".concat(e.name," after ").concat(3," retries"))}catch(e){throw y.vF.error("[AmplifyUnified] Error in ensureConfigAndCall:",e),e}},T=()=>window.__amplifyConfigured?window.__amplifyConfigured:(y.vF.info("[AmplifyUnified] Initializing Amplify from hook"),E(),!0),N=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return j(o.J,...t)},U=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return j(r.C,...t)},H=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return j(u.H,...t)},I=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return j(d.T,...t)},R=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return j(f.$,...t)}},77657:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(95155);function r(e){let{size:t="medium",fullscreen:n=!1,message:r="Loading...",color:o="currentColor"}=e,s={small:{spinner:"h-4 w-4",text:"text-sm"},medium:{spinner:"h-8 w-8",text:"text-base"},large:{spinner:"h-12 w-12",text:"text-lg"}},a=s[t]||s.medium;return(0,i.jsx)("div",{className:n?"fixed inset-0 z-50 flex items-center justify-center bg-white bg-opacity-80":"flex flex-col items-center justify-center p-4",children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("div",{className:"".concat(a.spinner," animate-spin"),style:{color:o},children:(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"opacity-25",children:[(0,i.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,i.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),r&&(0,i.jsx)("div",{className:"mt-3 ".concat(a.text," text-gray-700"),children:r})]})})}n(12115)},83095:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>w});var i=n(95155),r=n(11518),o=n.n(r),s=n(12115),a=n(35695),c=n(42749),l=n(87449),u=n(98029),d=n(66766),f=n(77657),h=n(27787),g=n(60005);let m="\n  @keyframes fadeTransition {\n    0% { opacity: 0; transform: translateY(10px); }\n    100% { opacity: 1; transform: translateY(0); }\n  }\n  \n  .page-transition {\n    animation: fadeTransition 0.4s ease-out;\n  }\n  \n  .progress-bar-transition {\n    transition: width 0.5s ease-in-out;\n  }\n",p=e=>{if(!e)return"business-info";if(e.includes("/business-info"));else if(e.includes("/subscription"))return"subscription";else if(e.includes("/payment"))return"payment";else if(e.includes("/setup"))return"setup";else if(e.includes("/complete"))return"complete";return"business-info"};function w(e){let{children:t}=e,n=(0,a.useRouter)(),r=(0,a.usePathname)(),w=(0,a.useSearchParams)(),[v]=(0,h.lT)(),[A,y]=(0,s.useState)(!0),[C,b]=(0,s.useState)(!1),[_,x]=(0,s.useState)(!1);var P="(max-width: 768px)";let[k,E]=(0,s.useState)(!1);(0,s.useEffect)(()=>{{let e=window.matchMedia(P);E(e.matches);let t=e=>{E(e.matches)};return e.addEventListener?(e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}):(e.addListener(t),()=>{e.removeListener(t)})}},[P]);let[F,S]=(0,s.useState)(""),[j,T]=(0,s.useState)(!1),N="true"===w.get("noredirect"),U="true"===w.get("noloop"),H=w.get("from"),I=(0,s.useMemo)(()=>Object.entries(u.kd).filter(e=>{let[t]=e;return"complete"!==t}).map(e=>{let[t,n]=e;return{key:t,label:n.title,description:n.description,step:n.step}}).sort((e,t)=>e.step-t.step),[]),R=async()=>{try{b(!0),c.vF.debug("[OnboardingLayout] Attempting to refresh user session");let e=await (0,g.refreshUserSession)();if(e&&e.tokens)return c.vF.debug("[OnboardingLayout] Session refreshed successfully"),x(!1),!0;c.vF.warn("[OnboardingLayout] Standard session refresh failed, trying fallback");let t=sessionStorage.getItem("idToken"),n=sessionStorage.getItem("accessToken");if(t)return c.vF.debug("[OnboardingLayout] Using fallback tokens from sessionStorage"),window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.auth=window.__APP_CACHE.auth||{},window.__APP_CACHE.auth.idToken=t,window.__APP_CACHE.auth.token=t,n&&(window.__APP_CACHE.auth.accessToken=n),window.__APP_CACHE.auth.hasSession=!0,window.__APP_CACHE.auth.provider="cognito",x(!1),!0;return c.vF.warn("[OnboardingLayout] Failed to refresh session, tokens not returned"),x(!0),!1}catch(e){return c.vF.error("[OnboardingLayout] Error refreshing session:",e),x(!0),!1}finally{b(!1)}};if((0,s.useEffect)(()=>{S(p(r)),T(!1),setTimeout(()=>T(!0),50)},[r]),(0,s.useEffect)(()=>{(async()=>{var e,t;if(r.startsWith("/onboarding")){c.vF.debug("[OnboardingLayout] Onboarding route is public, skipping strict auth check"),R().catch(e=>{c.vF.warn("[OnboardingLayout] Optional token refresh failed:",e)}),y(!1);return}if(N||U){c.vF.debug("[OnboardingLayout] Circuit breaker active, skipping navigation checks"),y(!1);return}if("middleware"===H||"signin"===H){c.vF.debug("[OnboardingLayout] Request from known source, skipping navigation checks"),y(!1);return}let i=document.cookie.includes("authToken=")||document.cookie.includes("idToken="),o=(null==(t=window.__APP_CACHE)||null==(e=t.auth)?void 0:e.bypassValidation)===!0||"true"===localStorage.getItem("bypassAuthValidation");if(!i&&!o&&(c.vF.debug("[OnboardingLayout] No auth tokens found, attempting refresh"),!await R())){c.vF.debug("[OnboardingLayout] Refresh failed, redirecting to signin"),n.push("/auth/signin?from=onboarding&noredirect=true");return}let s=I.findIndex(e=>e.key===F);if(s>=0&&s<I.length-1){let e=I[s+1];try{n.prefetch("/onboarding/".concat(e.key))}catch(e){}}y(!1)})();let e=setInterval(()=>{R().catch(e=>{c.vF.error("[OnboardingLayout] Interval refresh error:",e)})},3e5);return()=>clearInterval(e)},[F,N,U,H,n,I,r]),A)return(0,i.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,i.jsx)(f.A,{size:"lg"})});if(_&&!N)return(0,i.jsxs)("div",{className:"flex h-screen flex-col items-center justify-center p-4 text-center",children:[(0,i.jsx)("div",{className:"mb-4 text-red-500",children:(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,i.jsx)("h2",{className:"mb-2 text-2xl font-bold",children:"Session Expired"}),(0,i.jsx)("p",{className:"mb-6 text-gray-600",children:"Your session has expired. Please sign in again to continue the onboarding process."}),(0,i.jsx)("button",{onClick:()=>n.push("/auth/signin?from=onboarding&session_expired=true"),className:"rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 focus:outline-none",children:"Sign In Again"})]});let O=I.findIndex(e=>e.key===F),L=Math.round((O+1)/I.length*100),W=()=>"Step ".concat(O+1," of ").concat(I.length),z=(()=>{switch(F){case"business-info":return{title:"Let's set up your business profile",subtitle:"Tell us about your business to customize your experience"};case"subscription":return{title:"Choose the right plan for your needs",subtitle:"Select the subscription that works best for your business"};case"payment":return{title:"Complete your payment",subtitle:"Secure payment to activate your subscription"};case"setup":return{title:"Setting up your account",subtitle:"We're preparing everything for you"};default:return{title:"Welcome to Pyfactor",subtitle:"Let's get started with your onboarding"}}})();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o(),{id:m.__hash,children:m}),(0,i.jsx)(l.t,{children:(0,i.jsxs)("div",{className:"flex flex-col min-h-screen md:flex-row bg-gray-50",children:[C&&(0,i.jsx)("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50 z-50 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg flex flex-col items-center",children:[(0,i.jsx)(f.A,{size:"lg"}),(0,i.jsx)("p",{className:"mt-4 text-gray-700",children:"Refreshing your session..."})]})}),(0,i.jsx)("div",{className:"hidden md:flex md:w-5/12 lg:w-4/12 xl:w-5/12 bg-gradient-to-b from-blue-600 to-blue-800 text-white flex-col",children:(0,i.jsxs)("div",{className:"p-8 lg:p-12 flex flex-col h-full",children:[(0,i.jsx)("div",{className:"mb-12",children:(0,i.jsx)(d.default,{src:"/static/images/Pyfactor.png",alt:"Pyfactor Logo",width:150,height:50,className:"h-12 w-auto",onError:e=>{e.target.src="/static/images/PyfactorLandingpage.png"}})}),(0,i.jsxs)("div",{className:"mt-auto flex-grow flex flex-col justify-center",children:[(0,i.jsx)("div",{className:"text-sm font-medium text-blue-200 mb-3",children:W()}),(0,i.jsx)("h1",{className:"text-3xl lg:text-4xl font-bold mb-4",children:z.title}),(0,i.jsx)("p",{className:"text-xl text-blue-100",children:z.subtitle}),(0,i.jsxs)("div",{className:"mt-8 mb-8",children:[(0,i.jsxs)("div",{className:"flex mb-2 items-center justify-between",children:[(0,i.jsx)("div",{children:(0,i.jsx)("span",{className:"text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-blue-600 bg-blue-200",children:W()})}),(0,i.jsx)("div",{className:"text-right",children:(0,i.jsxs)("span",{className:"text-xs font-semibold inline-block text-blue-200",children:[L,"%"]})})]}),(0,i.jsx)("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-blue-700",children:(0,i.jsx)("div",{style:{width:"".concat(L,"%")},className:"progress-bar-transition shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-300"})})]}),(0,i.jsxs)("div",{className:"mt-8 bg-blue-700 bg-opacity-50 p-6 rounded-lg border border-blue-400 border-opacity-20",children:[(0,i.jsx)("p",{className:"italic text-blue-100 mb-4",children:'"Pyfactor streamlined our accounting processes and saved us countless hours. The onboarding was simple and the team was incredibly helpful."'}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-400 flex items-center justify-center text-blue-800 font-bold mr-3",children:"JS"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"font-medium",children:"Jane Smith"}),(0,i.jsx)("p",{className:"text-sm text-blue-200",children:"CEO, Smith Consulting"})]})]})]})]})]})}),(0,i.jsxs)("div",{className:"flex-grow md:overflow-auto",children:[(0,i.jsxs)("header",{className:"md:hidden bg-white border-b border-gray-200 p-4",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(d.default,{src:"/static/images/Pyfactor.png",alt:"Pyfactor Logo",width:120,height:40,className:"h-8 w-auto"}),(0,i.jsx)("div",{className:"text-sm font-medium text-gray-600",children:W()})]}),(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)("div",{className:"overflow-hidden h-1 text-xs flex rounded bg-gray-200",children:(0,i.jsx)("div",{style:{width:"".concat(L,"%")},className:"progress-bar-transition shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-600"})})})]}),(0,i.jsx)("main",{className:"p-4 md:p-8 lg:p-12 ".concat(j?"page-transition":"opacity-0"),children:t}),(0,i.jsx)("footer",{className:"py-4 px-6 border-t border-gray-200 mt-auto",children:(0,i.jsxs)("div",{className:"flex justify-between items-center text-sm text-gray-500",children:[(0,i.jsxs)("div",{children:["\xa9 ",new Date().getFullYear()," Pyfactor"]}),(0,i.jsxs)("div",{className:"flex space-x-4",children:[(0,i.jsx)("a",{href:"#",className:"hover:text-gray-700",children:"Terms"}),(0,i.jsx)("a",{href:"#",className:"hover:text-gray-700",children:"Privacy"}),(0,i.jsx)("a",{href:"#",className:"hover:text-gray-700",children:"Support"})]})]})})]})]})})]})}},91150:(e,t,n)=>{Promise.resolve().then(n.bind(n,83095))}},e=>{var t=t=>e(e.s=t);e.O(0,[54940,9296,79480,58430,84620,23639,38501,78746,66766,38772,91392,38272,69077,28441,31684,77358],()=>t(91150)),_N_E=e.O()}]);