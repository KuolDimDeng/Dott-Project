(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[42311],{14090:(e,t,s)=>{"use strict";s.d(t,{ZF:()=>d,lx:()=>l,tv:()=>c});var r=s(73767),a=s(81011),n=s(42749);let i=new Map,o=(0,r.D)(),l=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let r=s.ttl||18e5,a=Date.now()+r;return i.set(e,{data:t,expiry:a}),n.vF.debug("[CacheClient] Data cached successfully",{key:e}),!0}catch(t){return n.vF.error("[CacheClient] Error caching data",{key:e,error:t}),!1}},c=e=>{try{let t=i.get(e);if(!t)return n.vF.debug("[CacheClient] Cache miss",{key:e}),null;if(Date.now()>t.expiry)return n.vF.debug("[CacheClient] Cache expired",{key:e}),i.delete(e),null;return n.vF.debug("[CacheClient] Cache hit",{key:e}),t.data}catch(t){return n.vF.error("[CacheClient] Error retrieving cached data",{key:e,error:t}),null}},d=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{bypassCache:r=!1,ttl:i,query:d,variables:u}=s,m=(0,a.A)().substring(0,8);try{let s;if(!r){let t=c(e);if(t)return n.vF.debug("[CacheClient] Returning cached data",{cacheKey:e,requestId:m}),t}if(d){var p,b,f;if(n.vF.debug("[CacheClient] Executing GraphQL operation",{requestId:m,operationName:(null==(f=d.definitions)||null==(b=f[0])||null==(p=b.name)?void 0:p.value)||"Unknown"}),(s=await o.graphql({query:d,variables:u||{},authMode:"AMAZON_COGNITO_USER_POOLS"})).data){let e=Object.keys(s.data)[0];s=s.data[e]}}else n.vF.debug("[CacheClient] Using data provided directly",{requestId:m}),s=t;return l(e,s,{ttl:i}),s}catch(t){throw n.vF.error("[CacheClient] Fetch error",{cacheKey:e,requestId:m,error:t}),t}};setInterval(()=>{let e=0;for(let[t,s]of i.entries())s.isExpired()&&(i.delete(t),e++);e>0&&n.vF.debug("[cacheClient] Cleaned up expired entries",{expiredCount:e})},18e5)},30721:(e,t,s)=>{"use strict";s.d(t,{t:()=>o});var r=s(95155),a=s(12115),n=s(29670);let i={default:3,signin:3,businessInfo:2,dashboard:3};class o extends a.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error caught by ErrorBoundary:",e,t),this.setState({errorInfo:t}),this.props.onError&&this.props.onError(e,t)}render(){return this.state.hasError?this.props.fallback||(0,r.jsxs)("div",{className:"error-boundary",children:[(0,r.jsx)("h2",{children:"Something went wrong"}),(0,r.jsxs)("details",{style:{whiteSpace:"pre-wrap"},children:[(0,r.jsx)("summary",{children:"Error details"}),this.state.error&&this.state.error.toString(),(0,r.jsx)("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]}),this.props.resetButton&&(0,r.jsx)("button",{onClick:()=>this.setState({hasError:!1,error:null,errorInfo:null}),className:"reset-button",children:"Try again"})]}):this.props.children}constructor(e){super(e),this.handleResetState=()=>{try{Object.keys(i).forEach(e=>{!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";(0,n.mm)("".concat(e,"_redirect_count"),"0")}(e)}),(0,n.A6)("signin_attempts"),(0,n.A6)("business_auth_errors"),(0,n.A6)("middleware_redirect_counter"),(0,n.A6)("preventSigninRedirects"),sessionStorage.clear(),localStorage.clear(),this.setState({hasError:!1,error:null,errorInfo:null,resetMessage:"Application state reset successfully. Reloading..."}),setTimeout(()=>{window.location.href="/"},1500)}catch(e){this.setState({resetMessage:"Failed to reset state: ".concat(e.message,". Try reloading manually.")})}},this.state={hasError:!1,error:null,errorInfo:null}}}},32590:(e,t,s)=>{"use strict";s.d(t,{J:()=>a});var r=s(44367);s(42749);let a=()=>{let{user:e,isLoading:t,hasSession:s,hasError:a}=(0,r.w)();return{user:e,isLoading:t,isAuthenticated:s&&!a&&!!e,hasError:a}}},56798:(e,t,s)=>{"use strict";let r;s.r(t),s.d(t,{default:()=>eg});var a=s(95155),n=s(12115),i=s(35695),o=s(44367),l=s(32590),c=s(99944),d=s(29670);function u(){let[e,t]=(0,n.useState)("not_started"),[s,r]=(0,n.useState)("business_info"),[a,i]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{try{let e=(0,d.gd)("user_pref_".concat(c.V4.ONBOARDING_STATUS)),s=(0,d.gd)("user_pref_".concat(c.V4.ONBOARDING_STEP));if(e&&s){t(e),r(s),i(!0);return}let a=await (0,c.cD)(),n=await (0,c.YR)();t(a||"not_started"),r(n||"business_info"),a&&(0,d.mm)("user_pref_".concat(c.V4.ONBOARDING_STATUS),a),n&&(0,d.mm)("user_pref_".concat(c.V4.ONBOARDING_STEP),n)}catch(e){console.error("Error loading onboarding data:",e)}finally{i(!0)}})()},[]);let o=async(a,n)=>{try{a&&t(a),n&&r(n),a&&(0,d.mm)("user_pref_".concat(c.V4.ONBOARDING_STATUS),a),n&&(0,d.mm)("user_pref_".concat(c.V4.ONBOARDING_STEP),n),await (0,c.dA)({status:a||e,step:n||s})}catch(e){console.error("Error updating onboarding data:",e)}},l=async()=>{await o("completed","done")},u=async t=>{if(!t)return;let s=e;"not_started"===e&&(s="in_progress"),await o(s,t)};return{status:e,step:s,isLoaded:a,updateOnboarding:o,completeOnboarding:l,goToStep:u,isComplete:"completed"===e}}var m=s(49509);let p=e=>(Object.keys(e).forEach(t=>{"object"==typeof e[t]&&null!==e[t]&&p(e[t])}),Object.freeze(e)),b={api:{baseURL:m.env.NEXT_PUBLIC_BACKEND_URL||"https://127.0.0.1:8000",endpoints:{auth:{profile:"/api/profile/",google:"/api/onboarding/token-exchange/",refresh:"/api/onboarding/token/refresh/",verify:"/api/onboarding/token/verify/"},onboarding:{status:"/api/onboarding/status/",businessInfo:"/api/onboarding/save-business-info/",subscription:"/api/onboarding/subscription/",payment:"/api/onboarding/payment/",setup:{root:"/api/onboarding/setup/",start:"/api/onboarding/setup/start/",status:"/api/onboarding/setup/status/",cancel:"/api/onboarding/setup/cancel/"},complete:"/api/onboarding/complete/",taskStatus:e=>"/api/onboarding/tasks/".concat(e,"/status/")},database:{healthCheck:"/api/onboarding/database/health-check/",status:"/api/onboarding/database/status/",reset:"/api/onboarding/database/reset/"}}},websocket:{baseURL:m.env.NEXT_PUBLIC_WS_URL||(()=>{let e="https:"===window.location.protocol?"wss:":"ws:";return"".concat(e,"//").concat(window.location.hostname,":8000")})(),reconnectAttempts:3,reconnectInterval:1e3,endpoints:{onboarding:(e,t)=>"/ws/onboarding/".concat(e,"/?token=").concat(t)}},app:{name:"Dott",title:"Dott: Small Business Software",description:"Streamline your business operations with Dott",keywords:"business management, finance, operations",favicon:"/static/images/favicon.png",logo:"/static/images/Pyfactor.png",version:"1.0.0",env:"production",url:m.env.NEXT_PUBLIC_APP_URL||"https://localhost:3000",plans:{validPlans:["Basic","Professional"],validBillingCycles:["monthly","annual"],defaultPlan:"Basic",defaultBillingCycle:"monthly"}},routes:{public:["/"],auth:{paths:["/auth"],signIn:"/auth/signin",signOut:"/auth/signout",error:"/auth/error",verifyRequest:"/auth/verify-request",callback:"/api/auth/callback"},static:["/static","/_next","/favicon.ico","/assets","/images"],onboarding:{paths:["/onboarding"],root:"/onboarding",success:"/onboarding/success",error:"/onboarding/error",steps:{businessInfo:"/onboarding/business-info",subscription:"/onboarding/subscription",payment:"/onboarding/payment",setup:"/onboarding/setup"}},protected:["/dashboard","/settings","/profile"],database:{paths:["/api/onboarding/database"],healthCheck:"/api/onboarding/database/health-check/",status:"/api/onboarding/database/status/",reset:"/api/onboarding/database/reset/"}},onboarding:{steps:{INITIAL:"business-info",BUSINESS_INFO:"business-info",SUBSCRIPTION:"subscription",PAYMENT:"payment",SETUP:"setup",COMPLETE:"complete"},transitions:{"business-info":["subscription"],subscription:["payment","setup"],payment:["setup"],setup:["complete"],complete:["dashboard"]},storage:{key:"onboarding_data",version:"1.0",draftExpiration:864e5},queryKeys:{status:"onboarding",steps:"onboardingSteps",progress:"onboardingProgress"}},auth:{tokenGracePeriod:36e5,sessionMaxAge:2592e3,refreshInterval:300,providers:["google","apple"],retryDelay:1e3,maxRetries:3},security:{headers:{"X-DNS-Prefetch-Control":"on","Strict-Transport-Security":"max-age=63072000; includeSubDomains; preload","X-Frame-Options":"DENY","X-Content-Type-Options":"nosniff","Referrer-Policy":"strict-origin-when-cross-origin","Permissions-Policy":"camera=(), microphone=(), geolocation=(), payment=()","X-XSS-Protection":"1; mode=block"},csrf:!0,rateLimit:{windowMs:9e5,max:100}},validation:{businessName:{minLength:2,maxLength:100},password:{minLength:8,requireNumbers:!0,requireSpecialChars:!0}},storage:{prefix:"app_",version:"1.0.0",keys:{auth:"auth_state",theme:"theme_preference",onboarding:"onboarding_progress",onboardingDrafts:"onboarding_drafts"},draftExpiration:864e5},ui:{theme:"light",animation:{duration:300},colors:{background:{primary:"#ffffff",secondary:"#ffffff",paper:"#ffffff"}},toast:{duration:5e3,position:"top-right",limit:3,style:{fontSize:"14px",padding:"16px",backgroundColor:"#ffffff"},toastStyle:{backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",padding:"16px"},toastClassName:"custom-toast-class"}},errors:{codes:{UNAUTHORIZED:"unauthorized",SESSION_EXPIRED:"session_expired",VALIDATION_ERROR:"validation_error",SERVER_ERROR:"server_error",NETWORK_ERROR:"network_error",REFRESH_TOKEN_FAILED:"refresh_token_failed",TOKEN_EXPIRED:"token_expired",AUTHENTICATION_FAILED:"authentication_failed",PLAN_VALIDATION_ERROR:"plan_validation_error",ONBOARDING_STEP_INVALID:"onboarding_step_invalid",ONBOARDING_DATA_MISSING:"onboarding_data_missing",ONBOARDING_TRANSITION_INVALID:"onboarding_transition_invalid"},messages:{default:"An unexpected error occurred",network:"Unable to connect to server",session:"Your session has expired. Please sign in again.",unauthorized:"You are not authorized to access this resource",refresh_failed:"Unable to refresh authentication. Please sign in again.",token_expired:"Your session has expired. Please sign in again.",auth_failed:"Authentication failed. Please try again.",validation_error:"Please check your input and try again",plan_validation_error:"Invalid plan selection",step_validation:"Unable to proceed. Please complete the current step.",transition_error:"Invalid step transition.",initialization_failed:"Failed to initialize onboarding process."}}};p(b);let f={BUSINESS_INFO:"business-info",SUBSCRIPTION:"subscription",PAYMENT:"payment",COMPLETE:"complete"},g={FREE:"free",PROFESSIONAL:"professional"},x={MONTHLY:"monthly",ANNUAL:"annual"},h={INVALID_PLAN:"INVALID_PLAN"};f.BUSINESS_INFO,f.SUBSCRIPTION,f.PAYMENT;let y={"business-info":b.routes.onboarding.steps.businessInfo,subscription:b.routes.onboarding.steps.subscription,payment:b.routes.onboarding.steps.payment,complete:b.routes.onboarding.steps.complete||"/dashboard"},v={"business-info":b.api.endpoints.onboarding.businessInfo,subscription:b.api.endpoints.onboarding.subscription,payment:b.api.endpoints.onboarding.payment,complete:b.api.endpoints.onboarding.complete,status:b.api.endpoints.onboarding.status},N={"business-info":e=>["businessName","industry","country","legalStructure"].every(t=>!!(null==e?void 0:e[t])),subscription:e=>!!(null==e?void 0:e.selected_plan)&&Object.values(g).includes(e.selected_plan)&&!!(null==e?void 0:e.billingCycle)&&Object.values(x).includes(e.billingCycle),payment:e=>(null==e?void 0:e.selected_plan)===g.FREE||(null==e?void 0:e.selected_plan)===g.PROFESSIONAL&&!!(null==e?void 0:e.paymentMethod)},w={"business-info":[],subscription:["business-info"],payment:["subscription"]},S=(e,t,s)=>{var r;if(e===f.BUSINESS_INFO)return!0;let a=null==s?void 0:s.selected_plan;if(e===f.SUBSCRIPTION&&t===f.BUSINESS_INFO||e===f.COMPLETE&&t===f.SUBSCRIPTION&&a===g.FREE||e===f.COMPLETE&&t===f.PAYMENT&&a===g.PROFESSIONAL)return!0;let n=w[e];return null==(r=null==n?void 0:n.every(e=>{var t;return null==(t=N[e])?void 0:t.call(N,s)}))||r},{isStepValid:j,getStepRoute:P,getStepApiEndpoint:E}={isStepValid:(e,t)=>{var s,r;return null==(r=null==(s=N[e])?void 0:s.call(N,t))||r},getStepRoute:e=>y[e]||y["business-info"],getStepApiEndpoint:e=>v[e]||v["business-info"],validatePlanAccess:(e,t)=>e===f.PAYMENT&&t!==g.PROFESSIONAL?{valid:!1,error:h.INVALID_PLAN,message:"Payment is only available for Professional plan"}:{valid:!0},validateStepTransition:(e,t,s)=>t===f.BUSINESS_INFO||S(t,e,s)},_={BUSINESS_INFO:"businessinfo",SUBSCRIPTION:"subscription",PAYMENT:"payment",SETUP:"setup",COMPLETE:"complete"},C={[_.BUSINESS_INFO]:{title:"Business Information",description:"Tell us about your business",next_step:_.SUBSCRIPTION,prevStep:null,isRequired:!0,route:"/onboarding/business-info"},[_.SUBSCRIPTION]:{title:"Choose Your Subscription",description:"Select the plan that fits your business needs",next_step:_.PAYMENT,prevStep:_.BUSINESS_INFO,isRequired:!0,route:"/onboarding/subscription"},[_.PAYMENT]:{title:"Payment Details",description:"Complete your subscription with payment information",next_step:_.SETUP,prevStep:_.SUBSCRIPTION,isRequired:!1,route:"/onboarding/payment"},[_.SETUP]:{title:"Setup Your Account",description:"Configure your account settings to get started",next_step:_.COMPLETE,prevStep:_.PAYMENT,isRequired:!0,route:"/onboarding/setup"},[_.COMPLETE]:{title:"Onboarding Complete",description:"Your account is ready to use",next_step:null,prevStep:_.SETUP,isRequired:!1,route:"/onboarding/complete"}};_.BUSINESS_INFO,_.SUBSCRIPTION,_.PAYMENT,_.SETUP,_.COMPLETE,_.BUSINESS_INFO,_.SUBSCRIPTION,_.PAYMENT,_.SETUP,e=>!!(null==e?void 0:e.setupCompleted);var I=s(30721),k=s(78452),F=s(10647),O=s(38637),A=s.n(O),T=s(66766);let R=e=>{let{title:t,description:s,current_step:r,totalSteps:n,stepName:i}=e;return(0,a.jsxs)("div",{className:"text-center mb-6 w-full",children:[(0,a.jsxs)("div",{className:"text-gray-500 text-sm mb-2",children:["Step ",r," of ",n," - ",i]}),(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2 text-gray-900 dark:text-white",children:t}),s&&(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:s})]})};R.propTypes={title:A().string.isRequired,description:A().string,current_step:A().number.isRequired,totalSteps:A().number.isRequired,stepName:A().string.isRequired};var M=s(98029);let U=e=>{let{steps:t,orientation:s="horizontal"}=e,r=Array.isArray(t)?t:Object.entries(M.kd).filter(e=>{let[t]=e;return"complete"!==t}).map(e=>{let[t,s]=e;return{key:t,label:s.title,description:s.description,step:s.step}}).sort((e,t)=>e.step-t.step),n=t.findIndex(e=>e.current);return(0,a.jsx)("div",{className:"w-full mb-8",children:(0,a.jsx)("div",{className:"".concat("vertical"===s?"flex flex-col space-y-8":"flex justify-between"),children:r.map((e,t)=>(0,a.jsxs)("div",{className:"".concat("vertical"===s?"flex items-center":"flex flex-col items-center"),children:["vertical"!==s&&t>0&&(0,a.jsx)("div",{className:"absolute h-0.5 bg-gray-200",style:{left:"".concat((t-.5)*(100/r.length),"%"),right:"".concat(100-(t+.5)*(100/r.length),"%"),top:"1.25rem"},children:(0,a.jsx)("div",{className:"h-full ".concat(t<n?"bg-primary-main":"bg-gray-200")})}),(0,a.jsx)("div",{className:"\n                relative z-10 flex items-center justify-center w-10 h-10 rounded-full \n                ".concat(e.completed?"bg-green-500 text-white":e.current?"bg-primary-main text-white ring-4 ring-primary-light":"bg-gray-200 text-gray-500","\n              "),children:e.completed?(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):(0,a.jsx)("span",{children:t+1})}),(0,a.jsxs)("div",{className:"".concat("vertical"===s?"ml-4":"mt-2"," text-center"),children:[(0,a.jsx)("div",{className:"\n                  text-sm font-medium \n                  ".concat(e.current?"text-primary-main font-semibold":"text-gray-500","\n                "),children:e.label}),(e.current||"vertical"===s)&&e.description&&(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:e.description})]}),"vertical"===s&&t<r.length-1&&(0,a.jsx)("div",{className:"absolute w-0.5 bg-gray-200 -left-5 top-10 h-8",children:(0,a.jsx)("div",{className:"w-full h-full ".concat(t<n?"bg-primary-main":"bg-gray-200")})})]},e.key||t))})})};U.propTypes={steps:A().arrayOf(A().shape({key:A().string,label:A().string.isRequired,description:A().string,current:A().bool,completed:A().bool})).isRequired,orientation:A().oneOf(["horizontal","vertical"])};let L=n.memo(U);var B=s(87449),D=s(42749),z=s(51313);let V=()=>{var e,t,r;let{user:a}=(0,l.J)(),{getCurrentStep:c,moveToNextStep:d}=u(),[m,p]=(0,n.useState)(!1),[b,f]=(0,n.useState)(null),g=(0,i.useRouter)(),{data:x}=(0,o.w)(),{updateOnboardingStatus:h}=u(),y=(0,B.d)();(0,n.useEffect)(()=>{try{let s=[];for(let e=0;e<sessionStorage.length;e++)s.push(sessionStorage.key(e));D.vF.debug("[usePaymentForm] SessionStorage state:",{allKeys:s,hasSubscriptionKey:null!==sessionStorage.getItem("pendingSubscription")});let r=sessionStorage.getItem("pendingSubscription");if(D.vF.debug("[usePaymentForm] Raw pendingSubscription:",{raw:r,type:typeof r,isEmpty:!r,length:(null==r?void 0:r.length)||0}),r){let s;try{var e,t;s=JSON.parse(r),D.vF.debug("[usePaymentForm] Parsed subscription data successfully:",{data:s,properties:Object.keys(s),planType:typeof s.plan,planValue:s.plan,planLowerCase:null==(e=s.plan)?void 0:e.toLowerCase(),isProfessionalOrEnterprise:["professional","enterprise"].includes(null==(t=s.plan)?void 0:t.toLowerCase())})}catch(e){D.vF.error("[usePaymentForm] Failed to parse subscription data:",{parseError:e.message,rawData:r}),s=null}s?f(s):D.vF.error("[usePaymentForm] Invalid subscription data format")}else D.vF.error("[usePaymentForm] No subscription data found in sessionStorage")}catch(e){D.vF.error("[usePaymentForm] Error loading subscription data:",{error:e.message,stack:e.stack})}},[]);let v=b&&b.plan?b.plan.toLowerCase():(null==a||null==(t=a.attributes)||null==(e=t["custom:subscription_plan"])?void 0:e.toLowerCase())||"professional",N=(null==b?void 0:b.billing_interval)||(null==b?void 0:b.interval)||(null==a||null==(r=a.attributes)?void 0:r["custom:billing_cycle"])||"monthly";(0,n.useEffect)(()=>{var e;D.vF.debug("[usePaymentForm] Using subscription details:",{subscriptionPlan:v,billingCycle:N,rawSubscriptionData:b,fromSessionStorage:!!b,fromUserAttributes:!!(null==a||null==(e=a.attributes)?void 0:e["custom:subscription_plan"])})},[v,N,b,a]);let[w,S]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{var e;let t=(null==x||null==(e=x.user)?void 0:e.paymentMethod)||"credit_card";"credit_card"!==t?(D.vF.info("[usePaymentForm] Non-credit card payment method detected:",{paymentMethod:t}),S(!0)):S(!1)},[x]),(0,n.useEffect)(()=>{w&&(D.vF.info("[usePaymentForm] Redirecting to dashboard"),g.push("/dashboard"))},[w,g]),{handlePaymentSuccess:async e=>{p(!0);try{D.vF.debug("[usePaymentForm] Payment success handler:",{plan:v,interval:N,paymentMethodId:e}),D.vF.debug("[usePaymentForm] Processing payment",{paymentId:e,timestamp:new Date().toISOString()});let t=await fetch("/api/onboarding/payment/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentId:e,plan:v,interval:N,amount:"professional"===v?1500:4500,currency:"usd"})});if(!t.ok)throw Error("Payment processing failed");let r=await t.json();if(!r.success)throw Error(r.error||"Payment processing failed");D.vF.debug("[usePaymentForm] Payment processed successfully",{result:r,timestamp:new Date().toISOString()});try{let{updateUserAttributes:e}=await Promise.all([s.e(84620),s.e(23639),s.e(38501),s.e(31861),s.e(87707)]).then(s.bind(s,55158)),t={"custom:onboarding":"payment","custom:updated_at":new Date().toISOString()};D.vF.debug("[usePaymentForm] Updating user attributes directly",t),await e({userAttributes:{"custom:onboarding":"payment","custom:updated_at":new Date().toISOString()}}),D.vF.debug("[usePaymentForm] User attributes updated successfully")}catch(e){D.vF.error("[usePaymentForm] Failed to update user attributes",{error:e.message,stack:e.stack})}try{if("function"==typeof h)await h(z.jo.COMPLETE),D.vF.info("[usePaymentForm] Updated onboarding status to COMPLETE");else{D.vF.warn("[usePaymentForm] updateOnboardingStatus function not available, skipping status update");let e=new Date;e.setFullYear(e.getFullYear()+1),document.cookie="onboardingStep=payment; path=/; expires=".concat(e.toUTCString()),document.cookie="onboardedStatus=payment; path=/; expires=".concat(e.toUTCString()),document.cookie="subscriptionPlan=".concat(v.toUpperCase(),";path=/;max-age=31536000")}}catch(e){D.vF.error("[usePaymentForm] Failed to update onboarding status, continuing anyway:",{error:e.message})}sessionStorage.setItem("pendingSchemaSetup",JSON.stringify({plan:v,paymentMethod:"credit_card",timestamp:new Date().toISOString(),status:"pending"})),y.success("Payment successful"),D.vF.info("[usePaymentForm] Redirecting to dashboard after successful payment"),setTimeout(()=>{window.location.replace(r.redirect||"/dashboard")},1e3)}catch(e){D.vF.error("[usePaymentForm] Payment verification failed:",e),y.error(e.message||"Failed to process payment")}finally{p(!1)}},handleBack:async()=>{try{await g.push("/onboarding/subscription")}catch(e){D.vF.error("Navigation back failed:",e),y.error("Failed to navigate back")}},isLoading:m,user:null==x?void 0:x.user}},Y=e=>{let{children:t,className:s="",fullWidth:r=!1}=e;return(0,a.jsx)("div",{className:"mx-auto ".concat(r?"w-full":"max-w-4xl"," px-4 py-8 sm:px-6 lg:px-8 ").concat(s),children:(0,a.jsx)("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:(0,a.jsx)("div",{className:"p-6 sm:p-8",children:t})})})};Y.propTypes={children:A().node.isRequired,className:A().string,fullWidth:A().bool};var H=s(14090),q=s(73841),G=s(49430),J=s(49509);let X=()=>{if(!r){let e=J.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY;if(!e)throw D.vF.error("[StripeProvider] Missing Stripe publishable key"),Error("Missing Stripe publishable key");r=(0,G.c)(e,{betas:["partitioned_cookies_beta_1"],cookieOptions:{secure:!0,sameSite:"none",partitioned:!0}}),D.vF.debug("[StripeProvider] Initialized Stripe with partitioned cookie support")}return r};function K(e){let{children:t,options:s}=e,[r,i]=(0,n.useState)(null);return(0,n.useEffect)(()=>{(async()=>{try{let e=await X();i(e)}catch(e){D.vF.error("[StripeProvider] Error loading Stripe:",e)}})()},[]),(0,a.jsx)(q.Elements,{stripe:r,options:s,children:t})}var W=s(15498),Z=s(20171);let $=e=>{let{subscriptionData:t,onSuccess:s,onError:r}=e,i=(0,q.useStripe)(),o=(0,q.useElements)(),[l,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(""),[m,p]=(0,n.useState)("");(0,n.useEffect)(()=>{if(!t||!t.plan)return void r("Missing subscription data. Please select a plan first.");(async()=>{try{c(!0);let e=await Z.A.post("/api/payments/create-payment-intent",{plan:t.plan,billingCycle:t.billingCycle||"monthly"});if(e.data&&e.data.clientSecret)p(e.data.clientSecret),D.vF.debug("[StripePaymentForm] Payment intent created successfully");else throw Error("Failed to create payment intent")}catch(t){var e,s,a,n;D.vF.error("[StripePaymentForm] Error creating payment intent:",t),u((null==(s=t.response)||null==(e=s.data)?void 0:e.message)||"Failed to create payment intent"),r((null==(n=t.response)||null==(a=n.data)?void 0:a.message)||"Failed to create payment intent")}finally{c(!1)}})()},[t,r]);let b=async e=>{if(e.preventDefault(),i&&o&&m)try{c(!0),u("");let e=o.getElement(q.CardElement);if(!e)throw Error("Card element not found");let{error:r,paymentIntent:n}=await i.confirmCardPayment(m,{payment_method:{card:e,billing_details:{}}});if(r)throw Error(r.message);if("succeeded"===n.status){var t,a;let e={paymentId:n.id,timestamp:new Date().toISOString(),amount:n.amount/100,currency:n.currency,status:n.status,method:"card",lastFour:(null==(a=n.payment_method_details)||null==(t=a.card)?void 0:t.last4)||""};D.vF.debug("[StripePaymentForm] Payment successful:",{id:n.id}),s(e)}else throw Error("Payment status: ".concat(n.status))}catch(e){D.vF.error("[StripePaymentForm] Payment error:",e),u(e.message||"Failed to process your payment. Please try again."),r(e.message||"Failed to process your payment. Please try again.")}finally{c(!1)}};return(0,a.jsxs)("form",{onSubmit:b,className:"w-full space-y-6",children:[(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"card-element",className:"block text-sm font-medium text-gray-700 mb-1",children:"Card Details"}),(0,a.jsx)("div",{className:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus-within:ring-2 focus-within:ring-indigo-500 focus-within:border-indigo-500",children:(0,a.jsx)(q.CardElement,{id:"card-element",options:{style:{base:{fontSize:"16px",color:"#32325d",fontFamily:'"Inter", -apple-system, BlinkMacSystemFont, sans-serif',"::placeholder":{color:"#a0aec0"}},invalid:{color:"#e53e3e",iconColor:"#e53e3e"}}}})}),d&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d})]})})}),(0,a.jsxs)("div",{className:"flex items-center justify-center mt-2 mb-6 text-xs text-gray-500",children:[(0,a.jsx)(W.A,{className:"h-4 w-4 mr-1"}),(0,a.jsx)("span",{children:"Your payment information is secure and encrypted"})]}),(0,a.jsx)("button",{type:"submit",disabled:!i||!o||l||!m,className:"w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg shadow-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 focus:outline-none",children:l?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Pay $".concat(((null==t?void 0:t.price)||0).toFixed(2))}),(0,a.jsx)("div",{className:"mt-4 flex justify-center",children:(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Use Stripe test card: 4242 4242 4242 4242, any future date, any CVC"})})]})},Q=e=>{let{subscriptionData:t,onSuccess:s,onError:r,paymentMethod:i="card"}=e,[o,c]=(0,n.useState)(!1),{user:d}=(0,l.J)();if("paypal"===i)return(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsxs)("div",{className:"w-full max-w-md bg-blue-50 rounded-lg p-6 border border-blue-200 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center mb-4",children:[(0,a.jsxs)("svg",{className:"w-6 h-6 text-blue-600 mr-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:[(0,a.jsx)("path",{d:"M7.763 3c-.507 0-.967.258-1.221.683l-3.2 6.597C3.123 10.846 3.64 11.5 4.305 11.5h4.34c.608 0 1.143-.394 1.324-.97l1.474-4.698C11.637 5.116 11.075 4.5 10.327 4.5H7.763z"}),(0,a.jsx)("path",{d:"M3 14.5c0-.828.707-1.5 1.5-1.5h5c.828 0 1.5.672 1.5 1.5v4c0 .828-.672 1.5-1.5 1.5h-5c-.793 0-1.5-.672-1.5-1.5v-4z"}),(0,a.jsx)("path",{d:"M14.177 3c-.507 0-.967.258-1.221.683l-3.2 6.597c-.219.566.298 1.22.963 1.22h4.34c.608 0 1.143-.394 1.324-.97l1.474-4.698C17.051 5.116 16.489 4.5 15.741 4.5h-1.564z"}),(0,a.jsx)("path",{d:"M12 14.5c0-.828.707-1.5 1.5-1.5h5c.828 0 1.5.672 1.5 1.5v4c0 .828-.672 1.5-1.5 1.5h-5c-.793 0-1.5-.672-1.5-1.5v-4z"})]}),(0,a.jsx)("span",{className:"text-blue-600 font-semibold",children:"PayPal"})]}),(0,a.jsx)("p",{className:"text-center text-sm text-blue-700 mb-6",children:"You'll be redirected to PayPal to complete your payment"})]}),(0,a.jsx)("button",{className:"w-full max-w-md py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg shadow-sm transition-colors focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 focus:outline-none",onClick:()=>alert("PayPal integration coming soon"),disabled:o,children:o?(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Continue to PayPal"})]});let u=async e=>{await (0,H.ZF)("payment_details",{id:e.paymentId,method:"card",lastFour:e.lastFour,timestamp:new Date().toISOString()},{bypassCache:!0}),s(e)};return(0,a.jsx)(K,{options:{appearance:{theme:"stripe",variables:{colorPrimary:"#4f46e5",colorBackground:"#ffffff",colorText:"#1f2937",colorDanger:"#ef4444",fontFamily:"Inter, system-ui, sans-serif",borderRadius:"8px"}}},children:(0,a.jsx)($,{subscriptionData:t,onSuccess:u,onError:r})})};var ee=s(95241),et=s(66656);let es=()=>(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})}),er=()=>(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M19 14V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zm-9-1c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13-6v11c0 1.1-.9 2-2 2H4v-2h17V7h2z"})}),ea=()=>(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-4.5 14H8c-.28 0-.5-.22-.5-.5v-1c0-.28.22-.5.5-.5h7.5c.28 0 .5.22.5.5v1c0 .28-.22.5-.5.5zm3-3H8c-.28 0-.5-.22-.5-.5v-1c0-.28.22-.5.5-.5h10.5c.28 0 .5.22.5.5v1c0 .28-.22.5-.5.5zm0-3H8c-.28 0-.5-.22-.5-.5v-1c0-.28.22-.5.5-.5h10.5c.28 0 .5.22.5.5v1c0 .28-.22.5-.5.5z"})}),en=()=>(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"})}),ei=()=>(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M12 12.75c1.63 0 3.07.39 4.24.9 1.08.48 1.76 1.56 1.76 2.73V18H6v-1.61c0-1.18.68-2.26 1.76-2.73 1.17-.52 2.61-.91 4.24-.91zM4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm1.13 1.1c-.37-.06-.74-.1-1.13-.1-.99 0-1.93.21-2.78.58C.48 14.9 0 15.62 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29zM20 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm1.13 1.1c.37-.06.74-.1 1.13-.1.99 0 1.93.21 2.78.58.86.32 1.34 1.04 1.34 1.85V18h-4.5v-1.61c0-.83-.23-1.61-.63-2.29zM12 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3z"})}),eo=()=>(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"})}),el=()=>(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M16.59 7.58L10 14.17l-3.59-3.58L5 12l5 5 8-8zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})}),ec=()=>(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M4 10h3v7H4v-7zm6.5 0h3v7h-3v-7zM2 19h20v3H2v-3zm15-9h3v7h-3v-7zm-5-7L2 6v2h20V6L12 3z"})}),ed=()=>(0,a.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})}),eu=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"monthly";return"professional"===e?"monthly"===t?"15":"150":"enterprise"===e?"monthly"===t?"45":"450":"0"},em=e=>{let{metadata:t}=e,{handlePaymentSuccess:s,handleBack:r,isLoading:o,user:c}=V(),{currentStep:d,isStepCompleted:m,getOnboardingState:p}=u(),{user:b,setUserAttributes:f}=(0,l.J)(),g=(0,i.useRouter)(),{updateOnboardingStatus:x}=u();(0,n.useEffect)(()=>{try{let e=p?p():"unknown",t=document.cookie.split(";").find(e=>e.trim().startsWith("onboardingStep=")),s=document.cookie.split(";").find(e=>e.trim().startsWith("onboardedStatus="));if("payment"!==d&&x){D.vF.debug("[Payment Component] Attempting to update step to payment from component");try{x("PAYMENT")}catch(e){D.vF.error("[Payment Component] Failed to update step from component:",{error:e.message})}}D.vF.debug("[Payment Component] Onboarding status check:",{currentStep:d,onboardingState:e,cookies:{onboardingStep:t?t.split("=")[1]:"not found",onboardedStatus:s?s.split("=")[1]:"not found"},completedSteps:{businessInfo:m("businessinfo"),subscription:m("subscription"),payment:m("payment"),setup:m("setup")}})}catch(e){D.vF.error("[Payment Component] Error logging onboarding state:",{error:e.message})}},[d,m,p,x]);let[h,y]=(0,n.useState)(null),[v,N]=(0,n.useState)(!0),[w,S]=(0,n.useState)(null),[j,P]=(0,n.useState)(!1);(0,n.useEffect)(()=>{try{let t=sessionStorage.getItem("pendingSubscription");if(t){var e;let s=JSON.parse(t);D.vF.debug("[Payment Component] Loaded subscription data:",{data:s});let r=null==(e=s.plan)?void 0:e.toLowerCase();if(!r||!["professional","enterprise"].includes(r)){D.vF.error("[Payment Component] Invalid subscription plan:",{plan:r,fullData:s}),y("Invalid subscription plan. Payment is only required for Professional and Enterprise tiers.");return}S(s)}else D.vF.error("[Payment Component] No pending subscription found in sessionStorage"),y("No subscription data found. Please select a plan first.")}catch(e){D.vF.error("[Payment Component] Error loading subscription data:",{error:e.message}),y("Error loading subscription data")}finally{N(!1)}},[]),(0,n.useEffect)(()=>{if(!v&&w&&w.plan){let e=w.plan.toLowerCase();"professional"!==e&&"enterprise"!==e&&(D.vF.error("[Payment Component] Not a paid plan:",{normalizedPlan:e}),y("Invalid subscription plan. Payment is only required for Professional and Enterprise tiers."))}},[v,w]),(0,n.useEffect)(()=>{!v&&w&&w.payment_method&&"credit_card"!==w.payment_method&&(D.vF.debug("[Payment Component] Non-credit card payment method selected, setting redirect flag:",{paymentMethod:w.payment_method}),y("Non-credit card payment method selected"))},[v,w]),(0,n.useEffect)(()=>{h&&!v&&(h.includes("Invalid subscription plan")||h.includes("No subscription data found")?g.replace("/onboarding/subscription"):h.includes("Non-credit card payment method")&&g.replace("/dashboard"))},[h,v,g]);let E=(()=>{var e,t;if(w&&"object"==typeof w&&w.plan){let e=String(w.plan).toLowerCase();if(["professional","enterprise"].includes(e))return e}let s=null==b||null==(t=b.attributes)||null==(e=t["custom:subscription_plan"])?void 0:e.toLowerCase();return s&&["professional","enterprise"].includes(s)?s:"professional"})(),_=(()=>{var e,t;if(w&&"object"==typeof w){if(w.billing_interval&&["monthly","annual"].includes(w.billing_interval))return w.billing_interval;if(w.interval&&["monthly","annual"].includes(w.interval))return w.interval}let s=null==b||null==(t=b.attributes)||null==(e=t["custom:billing_cycle"])?void 0:e.toLowerCase();return s&&["monthly","annual"].includes(s)?s:"monthly"})(),C=(null==w?void 0:w.payment_method)||"credit_card";(0,n.useEffect)(()=>{var e;D.vF.debug("[Payment Component] Using subscription details:",{subscriptionPlan:E,billingCycle:_,paymentMethod:C,fromSessionStorage:!!w,rawSubscriptionData:w,fromUserAttributes:!!(null==b||null==(e=b.attributes)?void 0:e["custom:subscription_plan"])})},[E,_,C,w,b]);let I=[{label:"Business Info",current:!1,completed:m("businessinfo")},{label:"Subscription",current:!1,completed:m("subscription")},..."professional"===E||"enterprise"===E?[{label:"Payment",current:"payment"===d,completed:m("payment")}]:[],{label:"Setup",current:"setup"===d,completed:m("setup")}],k=async()=>{P(!0),N(!0),y(null);try{let e="pay_".concat(Date.now());sessionStorage.setItem("pendingSchemaSetup",JSON.stringify({plan:E,paymentMethod:"credit_card",timestamp:new Date().toISOString(),status:"pending"})),await s(e),D.vF.info("[Payment] Payment successful, redirecting to dashboard")}catch(e){D.vF.error("Payment submission failed:",e),y(e.message||"Failed to process payment"),P(!1)}finally{N(!1)}};return(D.vF.debug("[Payment Component] Verifying payment access:",{subscriptionPlanCheck:{subscriptionPlan:E,isValidPlan:"professional"===E||"enterprise"===E,rawSubscriptionData:w},stepCheck:{currentStep:d,isValidStep:"payment"===d},userData:{hasUserData:!!b,userAttrs:(null==b?void 0:b.attributes)||{}},sessionPlan:(null==w?void 0:w.plan)||"none"}),"professional"!==E&&"enterprise"!==E)?(D.vF.warn("[Payment Component] Invalid payment page access - wrong plan:",{subscriptionPlan:E,currentStep:d,reason:"Invalid plan: ".concat(E),userDataExists:!!b,sessionStorageData:JSON.parse(sessionStorage.getItem("pendingSubscription")||"null")}),(0,a.jsxs)("div",{className:"max-w-lg mx-auto px-4",children:[(0,a.jsx)("div",{className:"mt-4 mb-3 bg-red-100 dark:bg-red-900 border border-red-400 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg shadow-md",children:"Payment is only available for Professional and Enterprise tiers"}),(0,a.jsxs)("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-xl shadow-md mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2 text-gray-900 dark:text-white",children:"Plan Selection Issue"}),(0,a.jsxs)("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:["You selected the ",(0,a.jsx)("strong",{children:E})," plan, which doesn't require payment. Please return to plan selection and choose either Professional or Enterprise tier if you'd like to proceed with payment."]}),(0,a.jsx)("button",{className:"w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition duration-200 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed",onClick:r,disabled:o||v,children:"Back to Plan Selection"})]})]})):"credit_card"!==C?(0,a.jsx)("div",{className:"max-w-lg mx-auto px-4",children:(0,a.jsxs)("div",{className:"mt-4 bg-blue-100 dark:bg-blue-900 border border-blue-400 text-blue-700 dark:text-blue-200 px-4 py-3 rounded-lg shadow-md flex items-center",children:[(0,a.jsx)("span",{children:"Redirecting to dashboard..."}),(0,a.jsx)("div",{className:"ml-3 animate-spin h-5 w-5 border-2 border-blue-600 border-t-transparent rounded-full"})]})}):o?(0,a.jsx)(Y,{title:t.title,description:t.description,children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,a.jsx)("div",{className:"w-12 h-12 mb-6 text-blue-500 animate-spin",children:(0,a.jsx)(F.A,{className:"w-full h-full"})}),(0,a.jsx)("h2",{className:"text-xl font-medium text-gray-800 mb-2",children:"Processing your payment"}),(0,a.jsx)("p",{className:"text-gray-500 text-center max-w-md",children:"Please wait while we confirm your subscription details..."})]})}):j?(0,a.jsx)(Y,{title:t.title,description:t.description,children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,a.jsx)("div",{className:"w-16 h-16 mb-6 text-green-500",children:(0,a.jsx)(ee.A,{className:"w-full h-full"})}),(0,a.jsx)("h2",{className:"text-xl font-medium text-gray-800 mb-2",children:"Payment Successful!"}),(0,a.jsxs)("p",{className:"text-gray-500 text-center max-w-md",children:["Your ",null==w?void 0:w.plan," plan is now active. Redirecting you to complete your setup..."]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("div",{className:"w-24 h-1 bg-gray-200 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-blue-500 animate-pulse"})})})]})}):h?(0,a.jsx)(Y,{title:t.title,description:t.description,children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,a.jsx)("div",{className:"w-16 h-16 mb-6 text-red-500",children:(0,a.jsx)(et.A,{className:"w-full h-full"})}),(0,a.jsx)("h2",{className:"text-xl font-medium text-gray-800 mb-3",children:"Payment Error"}),(0,a.jsx)("p",{className:"text-gray-500 text-center max-w-md mb-6",children:h}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",onClick:()=>g.push("/onboarding/subscription"),children:"Back to Plans"}),(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",onClick:()=>{N(!0),y(null);try{let e=sessionStorage.getItem("pendingSubscription");if(e){let t=JSON.parse(e);D.vF.debug("[Payment Component] Reloaded subscription data on retry",{data:t}),S(t)}}catch(e){D.vF.error("[Payment Component] Error reloading data on retry:",{error:e.message})}finally{setTimeout(()=>{N(!1)},500)}},children:"Try Again"})]})]})}):(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4",children:[(0,a.jsx)(L,{steps:I}),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 w-full",children:[(0,a.jsxs)("div",{className:"text-center mb-8 w-full",children:[(0,a.jsx)(T.default,{src:"/static/images/Pyfactor.png",alt:"Dott Logo",width:150,height:50,priority:!0}),(0,a.jsx)(R,{title:t.title,description:t.description,current_step:3,totalSteps:"free"===E?3:4,stepName:"Payment"})]}),(0,a.jsxs)("div",{className:"w-full mb-8 rounded-2xl overflow-hidden shadow-lg bg-white dark:bg-gray-800 transition-all duration-300",children:[(0,a.jsxs)("div",{className:"p-6 relative ".concat("professional"===E?'before:content-[""] before:absolute before:top-0 before:left-0 before:right-0 before:h-1 before:bg-gradient-to-r before:from-blue-600 before:to-blue-400':'before:content-[""] before:absolute before:top-0 before:left-0 before:right-0 before:h-1 before:bg-gradient-to-r before:from-purple-700 before:to-purple-400'),children:[(0,a.jsxs)("div",{className:"mb-8 flex flex-col items-center",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold mb-2 text-gray-900 dark:text-white",children:["professional"===E?"Professional":"Enterprise"," Plan"]}),(0,a.jsx)("span",{className:"px-4 py-1 mb-2 bg-blue-600 text-white text-sm font-medium rounded-full",children:"monthly"===_?"Monthly Billing":"Annual Billing"}),"annual"===_&&(0,a.jsx)("span",{className:"px-3 py-0.5 text-xs font-semibold text-green-700 border border-green-500 rounded-full dark:text-green-400 dark:border-green-400",children:"Save 17%"})]}),(0,a.jsx)("hr",{className:"mb-6 border-gray-200 dark:border-gray-700"}),(0,a.jsxs)("div",{className:"mb-6 flex flex-col items-center p-4 rounded-lg bg-blue-50 dark:bg-blue-900/20 animate-fadeIn",children:[(0,a.jsx)("h3",{className:"text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Payment Method"}),(0,a.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-200",children:[(0,a.jsx)(eo,{}),(0,a.jsx)("span",{className:"ml-1",children:"Credit/Debit Card"})]})]}),(0,a.jsx)("div",{className:"flex justify-center mb-6 flex-wrap",children:(()=>{let e=[(0,a.jsxs)("span",{className:"inline-flex items-center m-1 px-2.5 py-0.5 rounded-full text-xs font-medium border border-blue-500 text-blue-700 bg-white dark:bg-gray-800 dark:text-blue-300",children:[(0,a.jsx)(es,{}),(0,a.jsx)("span",{className:"ml-1",children:"Global Business Solution"})]},"global"),(0,a.jsxs)("span",{className:"inline-flex items-center m-1 px-2.5 py-0.5 rounded-full text-xs font-medium border border-blue-500 text-blue-700 bg-white dark:bg-gray-800 dark:text-blue-300",children:[(0,a.jsx)(ea,{}),(0,a.jsx)("span",{className:"ml-1",children:"Advanced Inventory"})]},"inventory")];return"enterprise"===E&&e.push((0,a.jsxs)("span",{className:"inline-flex items-center m-1 px-2.5 py-0.5 rounded-full text-xs font-medium border border-blue-500 text-blue-700 bg-white dark:bg-gray-800 dark:text-blue-300",children:[(0,a.jsx)(en,{}),(0,a.jsx)("span",{className:"ml-1",children:"Enhanced Security"})]},"security"),(0,a.jsxs)("span",{className:"inline-flex items-center m-1 px-2.5 py-0.5 rounded-full text-xs font-medium border border-blue-500 text-blue-700 bg-white dark:bg-gray-800 dark:text-blue-300",children:[(0,a.jsx)(ei,{}),(0,a.jsx)("span",{className:"ml-1",children:"Unlimited Users"})]},"teams")),e})()}),["GH","KE","NG","ZA","TZ","UG","RW"].includes((null==b?void 0:b.businessCountry)||"US")?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 my-2 mr-2",children:[(0,a.jsx)(er,{}),(0,a.jsx)("span",{className:"ml-1",children:"Mobile Money Support"})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Includes M-Pesa, MTN, Airtel Money, and other local options","enterprise"===E&&" with preferential rates"]})]}):["US","CA"].includes((null==b?void 0:b.businessCountry)||"US")?(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 my-2",children:[(0,a.jsx)(er,{}),(0,a.jsx)("span",{className:"ml-1",children:"enterprise"===E?"Advanced Invoice Factoring":"Invoice Factoring Available"})]}):null,(0,a.jsxs)("div",{className:"mb-8 mt-6",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium mb-3 text-gray-700 dark:text-gray-300",children:["Your ","professional"===E?"Professional":"Enterprise"," plan includes:"]}),"professional"===E?(0,a.jsxs)("ul",{className:"pl-5 mb-4",children:[(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Up to 3 users"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Advanced inventory management with forecasting"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Global payments with reduced transaction fees"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"15 GB of storage"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Advanced reporting and analytics"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"AI-powered business insights"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Priority support"})})]}):"enterprise"===E?(0,a.jsxs)("ul",{className:"pl-5 mb-4",children:[(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Unlimited users"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Everything in Professional plan"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Preferential transaction fees"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Unlimited storage"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Custom roles & permissions"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Dedicated account manager"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Advanced security features"})})]}):null]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-sm font-medium mb-3 text-gray-700 dark:text-gray-300",children:"professional"===E?"Available add-ons at discounted rates:":"Included add-ons:"}),"professional"===E?(0,a.jsxs)("ul",{className:"pl-5 mb-4",children:[(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Payroll & Tax processing"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"HR & CRM modules"})})]}):"enterprise"===E?(0,a.jsxs)("ul",{className:"pl-5 mb-4",children:[(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Full Payroll & Tax processing included"})}),(0,a.jsx)("li",{className:"mb-3 relative pl-6 text-gray-600 dark:text-gray-300 before:content-['✓'] before:absolute before:left-0 before:text-green-500 before:font-bold",children:(0,a.jsx)("p",{className:"text-sm",children:"Integrated HR & CRM modules"})})]}):null]}),(0,a.jsx)("hr",{className:"mb-6 mt-6 border-gray-200 dark:border-gray-700"}),(0,a.jsxs)("div",{className:"p-6 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-center",children:[(0,a.jsxs)("h3",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400 mb-2",children:["$",eu(E,_)," ",(0,a.jsx)("span",{className:"text-lg font-normal text-gray-600 dark:text-gray-400",children:"monthly"===_?"/month":"/year"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"monthly"===_?"Monthly subscription":"Annual subscription"}),"annual"===_&&(0,a.jsxs)("p",{className:"mt-2 text-sm font-medium text-green-600 dark:text-green-400",children:["You save $","professional"===E?30:90," per year"]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap justify-center mt-4 animate-fadeIn",children:[(0,a.jsxs)("span",{className:"inline-flex items-center m-1 px-2.5 py-0.5 rounded-full text-xs font-medium border border-gray-300 text-gray-700 dark:text-gray-300 dark:border-gray-600",children:[(0,a.jsx)(ed,{}),(0,a.jsx)("span",{className:"ml-1",children:"Secure Payment"})]}),(0,a.jsxs)("span",{className:"inline-flex items-center m-1 px-2.5 py-0.5 rounded-full text-xs font-medium border border-gray-300 text-gray-700 dark:text-gray-300 dark:border-gray-600",children:[(0,a.jsx)(el,{}),(0,a.jsx)("span",{className:"ml-1",children:"Cancel Anytime"})]}),(0,a.jsxs)("span",{className:"inline-flex items-center m-1 px-2.5 py-0.5 rounded-full text-xs font-medium border border-gray-300 text-gray-700 dark:text-gray-300 dark:border-gray-600",children:[(0,a.jsx)(ec,{}),(0,a.jsx)("span",{className:"ml-1",children:"Invoice Available"})]})]})]}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(Q,{subscriptionData:w,onSuccess:k,onError:y,paymentMethod:C})})]})]})]})};em.propTypes={metadata:A().shape({title:A().string.isRequired,description:A().string.isRequired,next_step:A().string,prevStep:A().string}).isRequired};let ep=(0,n.memo)(em),eb=()=>(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center min-h-[60vh]",children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"animate-spin h-12 w-12 text-blue-600 mb-4",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})})}),(0,a.jsx)("h2",{className:"text-xl font-medium text-gray-700",children:"Preparing payment details..."}),(0,a.jsx)("p",{className:"text-gray-500 mt-2",children:"This will only take a moment"})]})}),ef=()=>{let e=(0,i.useRouter)(),[t,s]=(0,n.useTransition)(),{data:r,status:c}=(0,o.w)(),{user:d,status:m,updateUserCache:p,getUserFromCache:b}=(0,l.J)(),{getCurrentStep:f,getOnboardingState:g}=u(),[x,h]=(0,n.useState)(!0),[y,v]=(0,n.useState)(null),[N,w]=(0,n.useState)(null);return((0,n.useEffect)(()=>{if(!x&&!t){var r,a,n,i;let t=b(),o=(null==t||null==(a=t.subscription)||null==(r=a.plan)?void 0:r.toLowerCase())||(null==d||null==(i=d.attributes)||null==(n=i["custom:subscription_plan"])?void 0:n.toLowerCase())||"starter";"professional"!==o&&"enterprise"!==o&&(D.vF.info("[PaymentPage] Free plan detected, redirecting to setup",{plan:o}),s(()=>{e.replace("/onboarding/setup")}))}},[x,t,d,e,b]),(0,n.useEffect)(()=>{!async function(){try{h(!0);let t=await (0,H.ZF)("subscription",null,{bypassCache:!1});if(t){D.vF.debug("[PaymentPage] Loaded subscription from cache",{data:t}),v(t),h(!1);return}if(!t){let t=sessionStorage.getItem("pendingSubscription");if(t)try{let e=JSON.parse(t);D.vF.debug("[PaymentPage] Loaded subscription from sessionStorage",{data:e}),await (0,H.ZF)("subscription",e,{bypassCache:!0}),v(e),sessionStorage.removeItem("pendingSubscription")}catch(t){D.vF.error("[PaymentPage] Failed to parse subscription data:",{error:t.message||String(t)});let e={plan:"professional",billing_interval:"monthly",payment_method:"credit_card",created_at:new Date().toISOString()};v(e);try{await (0,H.ZF)("subscription",e,{bypassCache:!0})}catch(e){D.vF.error("[PaymentPage] Failed to store fallback plan in cache:",{error:e.message||String(e)})}}else D.vF.warn("[PaymentPage] No subscription data found in sessionStorage - redirecting to subscription page"),e.replace("/onboarding/subscription")}}catch(t){D.vF.error("[PaymentPage] Error loading subscription data:",{error:(null==t?void 0:t.message)||String(t)||"Unknown error"}),w(Error((null==t?void 0:t.message)||"Failed to load subscription data. Please try again.")),setTimeout(()=>{e.replace("/onboarding/subscription")},1500)}finally{h(!1)}}()},[e]),x||t)?(0,a.jsx)(eb,{}):(0,a.jsx)(I.t,{fallback:t=>(0,a.jsx)("div",{className:"max-w-3xl mx-auto mt-8 p-8 bg-white rounded-xl shadow-sm",children:(0,a.jsxs)("div",{className:"flex flex-col items-center py-6",children:[(0,a.jsx)("div",{className:"w-16 h-16 mb-6 text-red-500",children:(0,a.jsx)(k.A,{className:"w-full h-full"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-red-600 mb-3",children:"Payment Component Error"}),(0,a.jsx)("p",{className:"text-gray-600 text-center max-w-md mb-6",children:t.message||"An unexpected error occurred while loading the payment form"}),(0,a.jsxs)("button",{onClick:()=>e.refresh(),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center gap-2 transition-colors",children:[(0,a.jsx)(F.A,{className:"w-4 h-4"}),"Try Again"]})]})}),children:(0,a.jsx)(ep,{metadata:C[_.PAYMENT],subscriptionData:y})})},eg=()=>(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)(eb,{}),children:(0,a.jsx)(ef,{})})},98854:(e,t,s)=>{Promise.resolve().then(s.bind(s,56798))}},e=>{var t=t=>e(e.s=t);e.O(0,[54940,9296,79480,58430,20171,66766,18702,91392,17196,44367,76728,69077,28441,31684,77358],()=>t(98854)),_N_E=e.O()}]);