(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[69566],{102:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>p});var n=t(95155),s=t(12115),i=t(35695),a=t(44367),o=t(48860);t(2487),t(25465);var l=t(66766);function d(e){let{message:r="Loading...",progress:t=0,showProgress:s=!1,isLoading:i=!0,image:a=null,isBackground:o=!1,error:d=null,onRetry:c=null}=e;return o?(0,n.jsx)("div",{className:"fixed bottom-4 right-4 z-[1000] max-w-[400px] rounded-lg bg-white dark:bg-gray-800 p-4 shadow-lg",children:(0,n.jsx)("div",{className:"w-full text-center",children:d?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"mb-2 text-sm text-error-main",children:d}),c&&(0,n.jsx)("span",{className:"text-xs cursor-pointer underline",onClick:c,children:"Retry"})]}):(0,n.jsxs)(n.Fragment,{children:[s&&(0,n.jsx)("div",{className:"relative h-2 w-full mb-2 overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700",children:(0,n.jsx)("div",{className:"h-full rounded-full bg-primary-main",style:{width:"".concat(t,"%")}})}),(0,n.jsx)("p",{className:"text-sm",children:r}),s&&(0,n.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[t,"% complete"]})]})})}):(0,n.jsxs)("div",{className:"flex min-h-screen flex-col items-center justify-center gap-6 bg-white dark:bg-gray-900 p-4",children:[a&&(0,n.jsx)("div",{className:"mb-8",children:(0,n.jsx)(l.default,{src:a.src,alt:a.alt,width:a.width,height:a.height,priority:!0})}),d?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h6",{className:"mb-2 text-xl font-semibold text-error-main",children:d}),c&&(0,n.jsx)("p",{className:"text-sm cursor-pointer underline",onClick:c,children:"Retry"})]}):s?(0,n.jsxs)("div",{className:"w-full max-w-[400px] text-center",children:[(0,n.jsx)("div",{className:"relative h-2 w-full mb-4 overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700",children:(0,n.jsx)("div",{className:"h-full rounded-full bg-primary-main transition-all duration-300",style:{width:"".concat(t,"%")}})}),(0,n.jsx)("h6",{className:"mb-2 text-lg font-semibold",children:r}),(0,n.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[t,"% Complete"]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"h-10 w-10 animate-spin rounded-full border-4 border-gray-300 border-t-primary-main"}),(0,n.jsx)("p",{className:"text-base text-gray-500 dark:text-gray-400",children:r})]})]})}var c=t(77657),u=t(42749),g=t(11024),m=t(52584),x=t(51313),h=t(38637),f=t.n(h);window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.onboarding=window.__APP_CACHE.onboarding||{};try{window.__APP_CACHE||(window.__APP_CACHE={}),window.__APP_CACHE.onboarding||(window.__APP_CACHE.onboarding={}),window.__APP_CACHE.onboarding.inProgress=!0,window.__APP_CACHE.onboarding.step="business-info",window.__APP_CACHE.onboarding.lastUpdated=new Date().toISOString()}catch(e){u.vF.error("[Onboarding] Failed to set app cache storage",e)}function b(){let e=(0,i.useRouter)();return(0,s.useEffect)(()=>{u.vF.info("[Onboarding] Redirecting directly to business-info"),e.replace("/onboarding/business-info")},[e]),(0,n.jsxs)("div",{className:"flex flex-col justify-center items-center min-h-screen p-6 gap-4",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-center mb-4",children:"Redirecting to business information..."}),(0,n.jsx)(c.A,{size:"large"})]})}function p(){return(0,n.jsx)(b,{})}let w=(0,s.memo)(function(e){let{error:r,resetErrorBoundary:t,stepNumber:i=1}=e,[a,o]=s.useState(!1),l=s.useRef(crypto.randomUUID()).current;s.useEffect(()=>{u.vF.error("Onboarding error occurred:",{errorId:l,stepNumber:i,error:null==r?void 0:r.message,stack:null==r?void 0:r.stack})},[r,i,l]);let d=async()=>{try{o(!0),await t()}catch(e){u.vF.error("Onboarding reset failed:",{errorId:l,error:e.message})}finally{o(!1)}};return(0,n.jsxs)("div",{className:"flex flex-col justify-center items-center min-h-screen p-6 gap-4",children:[(0,n.jsxs)("div",{className:"max-w-lg w-full bg-red-50 border border-red-200 rounded-lg p-4 text-red-700 relative",children:[(0,n.jsxs)("div",{className:"flex items-start",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsxs)("h3",{className:"text-sm font-medium",children:["Error in Step ",i]}),(0,n.jsx)("div",{className:"mt-2 text-sm",children:(null==r?void 0:r.message)||"Failed to load onboarding"})]})]}),(0,n.jsx)("div",{className:"mt-4",children:(0,n.jsx)("button",{className:"px-4 py-2 rounded-md text-sm font-medium ".concat(a?"bg-gray-300 cursor-not-allowed":"bg-red-100 text-red-800 hover:bg-red-200"),onClick:d,disabled:a,children:a?(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"w-4 h-4 mr-2",children:(0,n.jsx)(c.A,{size:"small"})}),(0,n.jsx)("span",{children:"Processing..."})]}):"Try Again"})})]}),(0,n.jsxs)("div",{className:"text-sm text-gray-500 text-center",children:["Please try again or contact support if the problem persists.",(0,n.jsx)("br",{}),"Error Reference: ",l]})]})}),j=(0,s.memo)(function(){let e=(0,i.useRouter)(),{data:r,status:t}=(0,a.w)(),[l,h]=(0,s.useState)(!1),[f,b]=(0,s.useState)(0),[p,w]=(0,s.useState)(!1),j=s.useRef(crypto.randomUUID()),{current_step:v,loading:y,error:_,initialized:N,initialize:C,progress:A,selected_plan:P}=function(){let e=(0,i.useRouter)(),{session:r,isLoading:t,refreshSession:n}=(0,a.w)(),o=null==r?void 0:r.userAttributes,[l,d]=(0,s.useState)(!1),[c,h]=(0,s.useState)(null),[f,b]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{if(!r&&!f){u.vF.debug("[useOnboarding] No session data, attempting refresh"),b(!0);try{await n();try{let e=await (0,g.T)();if(u.vF.debug("[useOnboarding] Fetched attributes directly:",e),e&&!c){let r=e["custom:onboarding"]||x.jo.NOT_STARTED;h(r)}}catch(e){u.vF.warn("[useOnboarding] Failed to fetch attributes directly:",e)}}catch(e){u.vF.warn("[useOnboarding] Session refresh failed:",e)}}})()},[r,f,n,c]);let p=(0,s.useCallback)(()=>{if(o){let e=o.onboardingStatus||o["custom:onboarding"]||x.jo.NOT_STARTED;return"string"==typeof e?e.toUpperCase():e}return c?"string"==typeof c?c.toUpperCase():c:x.jo.NOT_STARTED},[o,c]),w=(0,s.useCallback)(e=>{let r="string"==typeof e?e.toUpperCase():e,t={[x.jo.NOT_STARTED]:x.jo.BUSINESS_INFO,[x.jo.BUSINESS_INFO]:x.jo.SUBSCRIPTION,[x.jo.SUBSCRIPTION]:e=>"free"===e||"basic"===e?x.jo.SETUP:x.jo.PAYMENT,[x.jo.PAYMENT]:x.jo.SETUP,[x.jo.SETUP]:x.jo.COMPLETE,[x.jo.COMPLETE]:"dashboard"},n=(null==o?void 0:o["custom:subplan"])||null,s=t[r];return"function"==typeof s?s(n):s},[o]),j=(0,s.useCallback)(async e=>{d(!0);try{return h(e),await (0,m.u)({userAttributes:{"custom:onboarding":e,"custom:updated_at":new Date().toISOString()}}),u.vF.debug("[useOnboarding] Status updated in Cognito:",{newStatus:e,timestamp:new Date().toISOString()}),await n(),!0}catch(e){return u.vF.error("[useOnboarding] Failed to update status in Cognito:",e),!1}finally{d(!1)}},[n]),v=(0,s.useCallback)(r=>{e.push("/onboarding/".concat(r.toLowerCase()))},[e]);return(0,s.useEffect)(()=>{let r=window.location.pathname.includes("/onboarding/");t||l||o||r||c||(u.vF.debug("[useOnboarding] No user data outside onboarding flow, redirecting to signin"),e.push("/auth/signin"))},[t,o,l,e,c]),{currentStep:p(),updateOnboardingStatus:j,getNextStep:w,navigateToStep:v,isLoading:t||l,user:o||{"custom:onboarding":c}}}((0,o.mN)({defaultValues:{selected_plan:"",billingCycle:"monthly",tier:""}})),E=()=>{if(!p){u.vF.info("[Onboarding] Using fallback navigation for new user"),w(!0);try{window.__APP_CACHE||(window.__APP_CACHE={}),window.__APP_CACHE.onboarding||(window.__APP_CACHE.onboarding={}),window.__APP_CACHE.onboarding.inProgress=!0,window.__APP_CACHE.onboarding.step="business-info",window.__APP_CACHE.onboarding.lastUpdated=new Date().toISOString()}catch(e){u.vF.error("[Onboarding] Failed to set app cache storage",e)}e.push("/onboarding/business-info")}};if((0,s.useEffect)(()=>{let e,r=!0;(async()=>{if(!N&&!l&&"authenticated"===t)try{h(!0),u.vF.info("Starting store initialization",{requestId:j.current,attempt:f+1,tier:P}),await C(),r&&u.vF.debug("Store initialization complete",{requestId:j.current,current_step:v,initialized:!0,tier:P})}catch(t){u.vF.error("Store initialization failed:",{requestId:j.current,error:t.message,attempt:f+1,tier:P}),f<3?e=setTimeout(()=>{r&&b(e=>e+1)},1e3*Math.pow(2,f)):E()}finally{r&&h(!1)}})();let n=setTimeout(()=>{"authenticated"!==t||N||p||(u.vF.warn("[Onboarding] Safety timeout triggered, using fallback navigation"),E())},8e3);return()=>{r=!1,e&&clearTimeout(e),clearTimeout(n)}},[C,N,l,t,v,f,P,e,p]),!N||y||l){let e=l?"Initializing... (Attempt ".concat(f+1,"/3)"):N||"authenticated"!==t?"".concat((null==A?void 0:A.current_step)||"Preparing"," ").concat(P?"(".concat(P," tier)"):""," (").concat((null==A?void 0:A.progress)||0,"%)"):"Loading your information...";return(0,n.jsx)(d,{message:e,progress:(null==A?void 0:A.progress)||0,isIndeterminate:!(null==A?void 0:A.progress),tier:P})}if(_){if(u.vF.error("[Onboarding] Store error detected, attempting fallback",{error:_.message,fallbackTriggered:p}),!p)return E(),(0,n.jsxs)("div",{className:"flex flex-col justify-center items-center min-h-screen p-6 gap-4",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-center mb-4",children:"Redirecting to business information..."}),(0,n.jsx)(c.A,{size:"large"})]});throw Error(_.message||"Failed to initialize onboarding",{cause:_})}let S=null==v?void 0:v.toLowerCase().replace("_","-");return(0,s.useEffect)(()=>{if(S&&e){let r=window.location.pathname,t="/onboarding/".concat(S);"/onboarding"===r&&r!==t?(u.vF.info("[Onboarding] Redirecting from ".concat(r," to step: ").concat(t)),e.push(t)):u.vF.debug("[Onboarding] No redirect needed: current=".concat(r,", target=").concat(t))}else"authenticated"!==t||S||p||(u.vF.info("[Onboarding] No current step detected for authenticated user, using fallback"),E())},[S,e,t,p]),(0,n.jsxs)("div",{className:"flex flex-col justify-center items-center min-h-screen p-6 gap-4",children:[(0,n.jsxs)("h2",{className:"text-xl font-semibold text-center mb-4",children:["Redirecting to ",S||"your next step","..."]}),(0,n.jsx)(c.A,{size:"large"})]})});w.propTypes={error:f().shape({message:f().string,stack:f().string}),resetErrorBoundary:f().func.isRequired,stepNumber:f().number},j.propTypes={}},2487:(e,r,t)=>{"use strict";t.d(r,{Ay:()=>m});var n=t(55166),s=t(68387),i=(t(36465),t(95155)),a=t(12115),o=t(83984),l=t(75663),d=t(38637),c=t.n(d);function u(e){let{error:r,resetErrorBoundary:t,isLoading:n=!1}=e,{t:s}=(0,l.Bd)();return(0,i.jsx)("div",{className:"p-6 rounded-lg bg-red-50 border border-red-200 dark:bg-red-900/20 dark:border-red-800",children:(0,i.jsxs)("div",{className:"flex items-start",children:[(0,i.jsx)("div",{className:"flex-shrink-0",children:(0,i.jsx)("svg",{className:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,i.jsxs)("div",{className:"ml-3",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-red-800 dark:text-red-200",children:s("error.title","Something went wrong")}),(0,i.jsx)("div",{className:"mt-2 text-sm text-red-700 dark:text-red-300",children:(0,i.jsx)("p",{children:r.message||s("error.unknown","An unexpected error occurred")})}),!1,(0,i.jsx)("div",{className:"mt-4",children:(0,i.jsx)("button",{type:"button",onClick:t,disabled:n,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,i.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,i.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),s("error.retrying","Retrying...")]}):s("error.retry","Try again")})})]})]})})}function g(e){let{children:r,fallback:t,onReset:l,onError:d}=e,[c,g]=(0,a.useState)(!1),m=async function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];if(l)try{g(!0),await l(...r)}catch(e){console.error("Error during reset:",e)}finally{g(!1)}};return(0,i.jsx)(o.tH,{FallbackComponent:e=>t?t((0,s._)((0,n._)({},e),{isLoading:c})):(0,i.jsx)(u,(0,s._)((0,n._)({},e),{isLoading:c})),onReset:m,onError:d,children:r})}g.propTypes={children:c().node.isRequired,fallback:c().func,onReset:c().func,onError:c().func};let m=g;c().node.isRequired},14469:(e,r,t)=>{Promise.resolve().then(t.bind(t,102))}},e=>{var r=r=>e(e.s=r);e.O(0,[54940,9296,79480,58430,84620,23639,38501,78746,66766,31296,83259,44367,28835,76728,11249,28441,31684,77358],()=>r(14469)),_N_E=e.O()}]);