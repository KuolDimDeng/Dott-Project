(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[40194,45066],{19002:(t,e,n)=>{"use strict";n.d(e,{H:()=>o});var r=n(45103),a=n(84295);let o=async t=>{var e;let n=t.getConfig().Auth?.Cognito;(0,r.$y)(n);let o=await t.Auth.getTokens({forceRefresh:!1});(0,a.H0)(o);let{"cognito:username":s,sub:i}=o.idToken?.payload??{},c={username:s,userId:i},l=(e=o,e?.signInDetails);return l&&(c.signInDetails=l),c}},24818:(t,e,n)=>{"use strict";n.d(e,{$:()=>o});var r=n(87970),a=n(57762);let o=t=>(0,a.$)(r.H,t)},25126:(t,e,n)=>{"use strict";n.d(e,{Ix:()=>l,NS:()=>s,oH:()=>c,pi:()=>i});var r=n(55166),a=n(68387),o=n(42749);let s=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{context:n="unknown",defaultValue:r={},throwOnHtml:a=!1,logFullHtml:s=!1}=e;try{let e=await t.text();if(!e||!e.trim())return o.vF.warn("[".concat(n,"] Empty response received")),r;if(e.trim().startsWith("<!DOCTYPE")||e.trim().startsWith("<html")||e.includes("<body")){let t=s?e:e.substring(0,200);if(a)throw o.vF.error("[".concat(n,"] Received HTML instead of JSON:"),t),Error("Server returned HTML instead of JSON");return o.vF.warn("[".concat(n,"] Received HTML instead of JSON:"),t),r}try{return JSON.parse(e)}catch(t){if(e.includes("<!DOCTYPE")||e.includes("<html")||e.includes("<head")||e.includes("<body")){if(a)throw o.vF.error("[".concat(n,"] Received HTML in response that couldn't be parsed as JSON")),Error("Server returned HTML instead of JSON");return o.vF.warn("[".concat(n,"] Received HTML in response that couldn't be parsed as JSON")),r}return o.vF.error("[".concat(n,"] Error parsing JSON:"),t),r}}catch(t){return o.vF.error("[".concat(n,"] Error reading response:"),t),r}},i=t=>{try{let e=new Date().toISOString(),n=(0,a._)((0,r._)({},t),{timestamp:e,userAgent:navigator.userAgent,windowLocation:window.location.href}),s=JSON.parse(localStorage.getItem("redirectDebugLogs")||"[]");s.push(n);let i=s.slice(-10);localStorage.setItem("redirectDebugLogs",JSON.stringify(i)),o.vF.debug("Redirect debug info:",n)}catch(t){o.vF.error("Failed to store redirect debug info:",t)}},c=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{preserveForm:n=!1,source:r="unknown"}=e;i({source:r,destination:t,sessionId:sessionStorage.getItem("sessionId")||localStorage.getItem("sessionId")||"unknown",additionalData:{preserveForm:n,redirectMethod:"forceRedirect"}});try{return n?window.location.assign(t):window.location.replace(t),new Promise(e=>{setTimeout(()=>{o.vF.warn("Primary redirect to ".concat(t," may have failed. Trying fallback..."));try{n?window.location.replace(t):window.location.assign(t),setTimeout(()=>{if(o.vF.warn("Fallback redirect to ".concat(t," may have failed. Trying window.open...")),!window.open(t,"_self")){o.vF.warn("window.open redirect to ".concat(t," failed. Creating and clicking a link..."));let e=document.createElement("a");e.href=t,e.target="_self",document.body.appendChild(e),e.click(),document.body.removeChild(e)}e()},1e3)}catch(t){o.vF.error("All redirect methods failed:",t),e()}},2e3)})}catch(e){throw o.vF.error("Redirect to ".concat(t," failed:"),e),e}},l=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{tenantId:r,queryParams:a={},source:s="unknown",force:l=!1}=e,{getTenantId:d,isValidUUID:u}=await Promise.resolve().then(n.bind(n,51174)),h=r;if((!h||!u(h))&&(!(h=d())||!u(h))){if(o.vF.warn("[redirectToDashboard] No valid UUID tenant ID available for dashboard redirect from ".concat(s)),h&&h.startsWith("tenant_")){o.vF.warn("[redirectToDashboard] Found tenant ID with incorrect format: ".concat(h));try{let t=await fetch("/api/tenant/create",{method:"POST",headers:{"Content-Type":"application/json"}});if(t.ok){let e=await t.json();e.tenantId&&u(e.tenantId)&&(o.vF.info("[redirectToDashboard] Converted invalid tenant ID to valid UUID: ".concat(e.tenantId)),h=e.tenantId)}}catch(t){o.vF.error("[redirectToDashboard] Error converting invalid tenant ID: ".concat(t.message))}}if(!h||!u(h))if(l)return c("/auth/signin?error=no_tenant_id",{source:"".concat(s,"-fallback"),preserveForm:!1});else return t.push("/auth/signin?error=no_tenant_id")}let g=new URLSearchParams(a).toString(),w="/".concat(h,"/dashboard").concat(g?"?".concat(g):"");return(i({source:s,destination:w,tenantId:h,additionalData:{force:l,queryParams:a}}),o.vF.info("[redirectToDashboard] Redirecting to tenant-specific dashboard: ".concat(w)),l)?c(w,{source:"".concat(s,"-forced"),preserveForm:!1}):t.push(w)}},35695:(t,e,n)=>{"use strict";var r=n(18999);n.o(r,"useParams")&&n.d(e,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(e,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(e,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(e,{useSearchParams:function(){return r.useSearchParams}})},39641:(t,e,n)=>{"use strict";n.d(e,{C:()=>i,p:()=>s});var r=n(62904),a=n(61573);let o=new r.C("CoreStorageUtils"),s=()=>{try{if("undefined"!=typeof window&&window.localStorage)return window.localStorage}catch(t){o.info("localStorage not found. InMemoryStorage is used as a fallback.")}return new a._},i=()=>{try{if("undefined"!=typeof window&&window.sessionStorage)return window.sessionStorage.getItem("test"),window.sessionStorage;throw Error("sessionStorage is not defined")}catch(t){return o.info("sessionStorage not found. InMemoryStorage is used as a fallback."),new a._}}},42749:(t,e,n)=>{"use strict";n.d(e,{vF:()=>s});let r={debug:0,info:1,warn:2,error:3},a="info",o=()=>!1,s={setLevel(t){void 0!==r[t]&&(a=t)},getLevel:()=>a,debug:(t,e)=>{},info:(t,e)=>{r[a]<=r.info&&(o()?void 0!==e?console.info("[SERVER INFO] ".concat(t),e):console.info("[SERVER INFO] ".concat(t)):void 0!==e?console.info(t,e):console.info(t))},warn:(t,e)=>{r[a]<=r.warn&&(o()?void 0!==e?console.warn("[SERVER WARN] ".concat(t),e):console.warn("[SERVER WARN] ".concat(t)):void 0!==e?console.warn(t,e):console.warn(t))},error:(t,e)=>{r[a]<=r.error&&(o()?void 0!==e?console.error("[SERVER ERROR] ".concat(t),e):console.error("[SERVER ERROR] ".concat(t)):void 0!==e?console.error(t,e):console.error(t))}}},51174:(t,e,n)=>{"use strict";n.d(e,{$_:()=>l,BI:()=>I,FB:()=>y,Nf:()=>f,Pc:()=>u,fy:()=>p,getTenantId:()=>i,getTenantIdFromCognito:()=>w,h_:()=>g,isValidUUID:()=>c,jW:()=>v,oA:()=>d,pm:()=>m,updateTenantIdInCognito:()=>h});var r=n(81746),a=n(24818),o=n(62052);let s="tenantId",i=async()=>{try{var t,e,n,i,c,l;let d=await o.l.getItem(s);if(d)return d;let u=await (0,r.H)(),h=await (0,a.$)(),g=(null==u||null==(t=u.attributes)?void 0:t["custom:tenant_ID"])||(null==u||null==(e=u.attributes)?void 0:e["custom:tenantId"])||(null==h||null==(i=h.accessToken)||null==(n=i.payload)?void 0:n["custom:tenant_ID"])||(null==h||null==(l=h.accessToken)||null==(c=l.payload)?void 0:c["custom:tenantId"]);if(!g)throw Error("Tenant ID not found in user attributes or session");return await o.l.setItem(s,g),g}catch(t){throw console.error("Error getting tenant ID:",t),t}},c=t=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t),l=async t=>{try{await o.l.setItem(s,t)}catch(t){throw console.error("Error storing tenant ID:",t),t}},d=async t=>{let{tenantId:e,metadata:n={}}=t;try{if(!e)return void console.error("Cannot store tenant info: No tenant ID provided");await o.l.setItem(s,e),window.__APP_CACHE||(window.__APP_CACHE={}),window.__APP_CACHE.tenant||(window.__APP_CACHE.tenant={}),window.__APP_CACHE.tenant.id=e,window.__APP_CACHE.tenant.metadata=n,window.__APP_CACHE.tenant.timestamp=Date.now();try{sessionStorage.setItem("tenant_id",e),sessionStorage.setItem("tenant_info",JSON.stringify({id:e,metadata:n,timestamp:Date.now()}))}catch(t){console.debug("Could not store tenant info in sessionStorage:",t)}console.debug("[TenantUtils] Stored tenant info for ID: ".concat(e))}catch(t){console.error("Error storing tenant info:",t)}},u=t=>t?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():t,h=async t=>{try{let{updateUserAttributes:e}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158));await e({userAttributes:{"custom:tenant_ID":t}}),await l(t),console.debug("[TenantUtils] Updated tenant ID in Cognito: ".concat(t))}catch(e){console.error("Error updating tenant ID in Cognito:",e),await l(t)}},g=async t=>{try{await o.l.setItem("auth_tokens",t)}catch(t){throw console.error("Error setting tokens:",t),t}},w=async()=>{try{var t,e,n,i,c,l;let d=await o.l.getItem(s);if(d)return d;let u=await (0,r.H)(),h=await (0,a.$)(),g=(null==u||null==(t=u.attributes)?void 0:t["custom:tenant_ID"])||(null==u||null==(e=u.attributes)?void 0:e["custom:tenantId"])||(null==h||null==(i=h.accessToken)||null==(n=i.payload)?void 0:n["custom:tenant_ID"])||(null==h||null==(l=h.accessToken)||null==(c=l.payload)?void 0:c["custom:tenantId"]);if(!g)return null;return await o.l.setItem(s,g),g}catch(t){return console.error("Error getting tenant ID from Cognito:",t),null}},f=async t=>{try{if(!c(t))return!1;return(await fetch("/api/tenants/".concat(t,"/validate"))).ok}catch(t){return console.error("Error validating tenant ID:",t),!1}},m=t=>{let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e&=e;return"00000000-0000-4000-a000-".concat(Math.abs(e).toString(16).padStart(12,"0"))},v=async()=>{try{let t=await i();if(!c(t))return console.error("Invalid tenant ID format:",t),null;return t}catch(t){return console.error("Error getting secure tenant ID:",t),null}},I=t=>c(t),y=t=>t?"tenant_".concat(t.replace(/-/g,"_")):"public",p=async()=>{try{let t=await i(),e={"Content-Type":"application/json","x-tenant-id":t};try{let{getCurrentUser:t}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158)),r=await t();r&&r.userId&&(e["x-user-id"]=r.userId)}catch(t){}return e}catch(t){return console.error("Error getting tenant headers:",t),{"Content-Type":"application/json"}}}},57762:(t,e,n)=>{"use strict";n.d(e,{$:()=>r});let r=(t,e)=>t.Auth.fetchAuthSession(e)},57893:(t,e,n)=>{Promise.resolve().then(n.bind(n,75588))},61573:(t,e,n)=>{"use strict";n.d(e,{_:()=>r});class r{constructor(){this.storage=new Map}get length(){return this.storage.size}key(t){return t>this.length-1?null:Array.from(this.storage.keys())[t]}setItem(t,e){this.storage.set(t,e)}getItem(t){return this.storage.get(t)??null}removeItem(t){this.storage.delete(t)}clear(){this.storage.clear()}}},75588:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>l});var r=n(95155),a=n(12115),o=n(35695),s=n(42749),i=n(51174),c=n(25126);function l(t){let{params:e}=t,n=(0,o.useRouter)();return(0,a.useEffect)(()=>{let t=null==e?void 0:e.tenantId,r=(null==e?void 0:e.slug)||[];try{if(s.vF.info("[TenantCatchAllPage] Tenant ID: ".concat(t,", Slug: ").concat(Array.isArray(r)?r.join("/"):r)),!t){s.vF.error("[TenantCatchAllPage] No tenant ID provided in URL path"),(0,c.Ix)(n,{source:"tenant-catchall-no-id"});return}if(!(0,i.isValidUUID)(t)){s.vF.error("[TenantCatchAllPage] Invalid tenant ID format: ".concat(t)),(0,c.Ix)(n,{source:"tenant-catchall-invalid-id"});return}(0,i.$_)(t);let e=Array.isArray(r)?r.join("/"):r;(0,c.Ix)(n,{tenantId:t,queryParams:{section:e},source:"tenant-catchall-redirect"})}catch(t){s.vF.error("[TenantCatchAllPage] Error processing tenant route:",t),(0,c.Ix)(n,{source:"tenant-catchall-error"})}},[n,e]),(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Redirecting to dashboard..."}),(0,r.jsx)("p",{className:"text-gray-500",children:"Please wait while we load your data."})]})})}},81746:(t,e,n)=>{"use strict";n.d(e,{H:()=>o});var r=n(87970),a=n(19002);let o=async()=>(0,a.H)(r.H)},94225:(t,e,n)=>{"use strict";n.d(e,{U:()=>a});var r=n(95730);class a{constructor(t){this.storage=t}async setItem(t,e){if(!this.storage)throw new r.h;this.storage.setItem(t,e)}async getItem(t){if(!this.storage)throw new r.h;return this.storage.getItem(t)}async removeItem(t){if(!this.storage)throw new r.h;this.storage.removeItem(t)}async clear(){if(!this.storage)throw new r.h;this.storage.clear()}}},95730:(t,e,n)=>{"use strict";n.d(e,{h:()=>o});var r=n(31241),a=n(65206);class o extends a.x{constructor(){super({name:r.m.PlatformNotSupported,message:"Function not supported on current platform"})}}}},t=>{var e=e=>t(t.s=e);t.O(0,[54940,9296,79480,62052,28441,31684,77358],()=>e(57893)),_N_E=t.O()}]);