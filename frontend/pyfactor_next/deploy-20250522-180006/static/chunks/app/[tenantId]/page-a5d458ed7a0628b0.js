(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11748,45066],{5166:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>u});var r=n(95155),a=n(12115),o=n(35695),s=n(14882);let i=t=>{switch(t){case"small":return"h-4 w-4";case"large":return"h-12 w-12";default:return"h-8 w-8"}},c=t=>{let{size:e="medium",className:n="",text:a="Loading...",showText:o=!0}=t,s=i(e),c="animate-spin rounded-full border-t-2 border-b-2 border-blue-500 mx-auto ".concat(s," ").concat(n);return(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:c}),o&&(0,r.jsx)("p",{className:"mt-3 text-gray-500",children:a})]})};function u(t){let{params:e}=t,n=(0,o.useRouter)(),{setTenantId:i}=(0,s.n8)();return(0,a.useEffect)(()=>{(async()=>{if(!e)return;let t=e.tenantId;t&&(i(t),n.push("/dashboard"))})()},[e,n,i]),(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(c,{size:"large"})})}},14882:(t,e,n)=>{"use strict";n.d(e,{Ku:()=>u,WE:()=>d,n8:()=>l});var r=n(95155),a=n(12115);n(39786);var o=n(42749),s=n(51174),i=n(49852);let c=(0,a.createContext)({tenantId:null,tenantInfo:null,loading:!0,error:null,setTenantId:()=>{},fetchTenantInfo:()=>Promise.resolve(null),switchTenant:()=>Promise.resolve(!1),clearTenant:()=>{},initializeTenant:()=>Promise.resolve(),verifyTenantAccess:()=>Promise.resolve(!0)}),u=()=>{let t=(0,a.useContext)(c);return t||(o.vF.warn("[TenantContext] useTenant called outside of provider, returning empty context"),{tenantId:null,tenantInfo:null,loading:!1,error:null,setTenantId:()=>{},fetchTenantInfo:()=>Promise.resolve(null),switchTenant:()=>Promise.resolve(!1),clearTenant:()=>{},initializeTenant:()=>Promise.resolve(),verifyTenantAccess:()=>Promise.resolve(!0)})},l=u,d=t=>{let{children:e}=t,[n,u]=(0,a.useState)(null),[l,d]=(0,a.useState)(null),[f,h]=(0,a.useState)(!0),[g,w]=(0,a.useState)(null),[m,p]=(0,a.useState)([]),v=(0,a.useRef)({tenantInfo:0,tenantList:0}),y=(0,a.useRef)({tenantInfo:!1,tenantList:!1}),I=(0,a.useCallback)(()=>{let t=window.location.pathname;return"/"===t||""===t||"/index.html"===t||t.startsWith("/auth/")||"/about"===t||"/privacy"===t||"/terms"===t},[!0]);(0,a.useEffect)(()=>{I()&&h(!1)},[I]);let T=(0,a.useCallback)(async()=>{var t,e;try{let e=await fetch("/api/tenant/from-token");if(!e.ok){if(I()&&(401===e.status||403===e.status))return o.vF.debug("[TenantContext] Auth error on public page (expected)"),null;let n=await e.json();if("UserUnAuthenticatedException"===n.name||(null==(t=n.message)?void 0:t.includes("User needs to be authenticated")))throw Error("User needs to be authenticated");throw Error("Error getting tenant ID from token: ".concat(e.statusText))}return(await e.json()).tenantId}catch(t){if(I()&&("UserUnAuthenticatedException"===t.name||(null==(e=t.message)?void 0:e.includes("User needs to be authenticated"))))return o.vF.debug("[TenantContext] Auth error on public page (expected)"),null;throw t}},[I]),C=(0,a.useCallback)(async t=>{if(t&&t!==n&&(u(t),1))try{await (0,s.updateTenantIdInCognito)(t),o.vF.info("[TenantContext] Tenant ID updated in Cognito: ".concat(t))}catch(t){o.vF.error("[TenantContext] Error updating tenant ID in Cognito:",t)}},[n]),b=(0,a.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n;try{if(!t)return o.vF.warn("[TenantContext] No tenant ID provided to fetch info"),null;let e=Date.now();if(y.current.tenantInfo||e-v.current.tenantInfo<2e3)return o.vF.debug("[TenantContext] Skipping tenant info fetch (too frequent or in progress)"),l;y.current.tenantInfo=!0,h(!0);try{let e=await i.K.getTenantInfo(t);if(v.current.tenantInfo=Date.now(),e)return o.vF.info("[TenantContext] Fetched tenant info for: ".concat(t)),d(e),e;return o.vF.warn("[TenantContext] No tenant info returned for: ".concat(t)),null}catch(n){o.vF.warn("[TenantContext] Failed to fetch tenant info, using mock: ".concat(n.message));let e={id:t,name:"Tenant ".concat(t.substring(0,8)),description:"Mock tenant for development",isActive:!0};return d(e),e}}catch(t){return o.vF.error("[TenantContext] Error fetching tenant info: ".concat(t)),w(t),null}finally{h(!1),y.current.tenantInfo=!1}},[n,l]),x=(0,a.useCallback)(async t=>{try{if(!t)return o.vF.warn("[TenantContext] No tenant ID provided to switch to"),!1;return await C(t),await b(t),o.vF.info("[TenantContext] Successfully switched to tenant: ".concat(t)),!0}catch(t){return o.vF.error("[TenantContext] Error switching tenant:",t),!1}},[C,b]),E=(0,a.useCallback)(async()=>{try{await (0,s.updateTenantIdInCognito)(""),u(null),d(null),o.vF.info("[TenantContext] Tenant context cleared")}catch(t){o.vF.error("[TenantContext] Error clearing tenant ID in Cognito:",t)}},[]),S=(0,a.useCallback)(async()=>{if(I()){o.vF.debug("[TenantContext] Skipping tenant initialization for public page"),h(!1);return}try{h(!0)}catch(e){if(I())return o.vF.debug("[TenantContext] Error ignored on public page:",e.message),h(!1),null;{var t;let n=window.location.pathname;if((n.includes("/auth/signin")||n.includes("/auth/signup")||n.includes("/auth/verify")||n.includes("/auth/reset-password"))&&("UserUnAuthenticatedException"===e.name||(null==(t=e.message)?void 0:t.includes("User needs to be authenticated"))))return o.vF.debug("[TenantContext] User not authenticated on auth page (expected)"),h(!1),null}o.vF.error("[TenantContext] Error initializing tenant context:",e),w(e)}finally{h(!1)}},[I,T,b]),k=(0,a.useCallback)(async t=>{try{if(!t)return o.vF.warn("[TenantContext] No tenant ID provided to verify access"),!1;let e=await i.K.verifyTenantAccess(t);return o.vF.info("[TenantContext] User access to tenant ".concat(t,": ").concat(e)),e}catch(t){return o.vF.error("[TenantContext] Error verifying tenant access:",t),!1}},[]);return(0,a.useEffect)(()=>{S()},[S]),(0,r.jsx)(c.Provider,{value:{tenantId:n,tenantInfo:l,loading:f,error:g,setTenantId:C,fetchTenantInfo:b,switchTenant:x,clearTenant:E,initializeTenant:S,verifyTenantAccess:k},children:e})}},19002:(t,e,n)=>{"use strict";n.d(e,{H:()=>o});var r=n(45103),a=n(84295);let o=async t=>{var e;let n=t.getConfig().Auth?.Cognito;(0,r.$y)(n);let o=await t.Auth.getTokens({forceRefresh:!1});(0,a.H0)(o);let{"cognito:username":s,sub:i}=o.idToken?.payload??{},c={username:s,userId:i},u=(e=o,e?.signInDetails);return u&&(c.signInDetails=u),c}},24818:(t,e,n)=>{"use strict";n.d(e,{$:()=>o});var r=n(87970),a=n(57762);let o=t=>(0,a.$)(r.H,t)},35695:(t,e,n)=>{"use strict";var r=n(18999);n.o(r,"useParams")&&n.d(e,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(e,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(e,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(e,{useSearchParams:function(){return r.useSearchParams}})},37811:t=>{var e,n,r,a=t.exports={};function o(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}try{e="function"==typeof setTimeout?setTimeout:o}catch(t){e=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}function i(t){if(e===setTimeout)return setTimeout(t,0);if((e===o||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}var c=[],u=!1,l=-1;function d(){u&&r&&(u=!1,r.length?c=r.concat(c):l=-1,c.length&&f())}function f(){if(!u){var t=i(d);u=!0;for(var e=c.length;e;){for(r=c,c=[];++l<e;)r&&r[l].run();l=-1,e=c.length}r=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function g(){}a.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new h(t,e)),1!==c.length||u||i(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=g,a.addListener=g,a.once=g,a.off=g,a.removeListener=g,a.removeAllListeners=g,a.emit=g,a.prependListener=g,a.prependOnceListener=g,a.listeners=function(t){return[]},a.binding=function(t){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw Error("process.chdir is not supported")},a.umask=function(){return 0}},39641:(t,e,n)=>{"use strict";n.d(e,{C:()=>i,p:()=>s});var r=n(62904),a=n(61573);let o=new r.C("CoreStorageUtils"),s=()=>{try{if("undefined"!=typeof window&&window.localStorage)return window.localStorage}catch(t){o.info("localStorage not found. InMemoryStorage is used as a fallback.")}return new a._},i=()=>{try{if("undefined"!=typeof window&&window.sessionStorage)return window.sessionStorage.getItem("test"),window.sessionStorage;throw Error("sessionStorage is not defined")}catch(t){return o.info("sessionStorage not found. InMemoryStorage is used as a fallback."),new a._}}},39786:(t,e,n)=>{"use strict";n.d(e,{s:()=>a});class r extends Error{}function a(t,e){let n;if("string"!=typeof t)throw new r("Invalid token specified: must be a string");e||(e={});let a=+(!0!==e.header),o=t.split(".")[a];if("string"!=typeof o)throw new r(`Invalid token specified: missing part #${a+1}`);try{n=function(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw Error("base64 string is not of the correct length")}try{var n;return n=e,decodeURIComponent(atob(n).replace(/(.)/g,(t,e)=>{let n=e.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}catch(t){return atob(e)}}(o)}catch(t){throw new r(`Invalid token specified: invalid base64 for part #${a+1} (${t.message})`)}try{return JSON.parse(n)}catch(t){throw new r(`Invalid token specified: invalid json for part #${a+1} (${t.message})`)}}r.prototype.name="InvalidTokenError"},49852:(t,e,n)=>{"use strict";n.d(e,{K:()=>o});var r=n(29729),a=n(42749);let o={async getTenantInfo(t){try{if(!t)return a.vF.warn("[apiService] No tenant ID provided to getTenantInfo"),null;return(await r.Ay.get("/api/tenants/".concat(t))).data}catch(e){if(e.response&&404===e.response.status)return a.vF.warn("[apiService] Tenant not found: ".concat(t)),null;return a.vF.warn("[apiService] Error fetching tenant info: ".concat(e.message,". Using mock data.")),{id:t,name:"Business ".concat(t.substring(0,8)),type:"business",status:"active",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}},async getUserTenants(){try{return(await r.Ay.get("/api/tenants")).data}catch(t){return a.vF.warn("[apiService] Error fetching user tenants: ".concat(t.message,". Using mock data.")),[{id:"11111111-1111-1111-1111-111111111111",name:"",type:"business",status:"active",isOwner:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]}}}},51174:(t,e,n)=>{"use strict";n.d(e,{$_:()=>u,BI:()=>v,FB:()=>y,Nf:()=>w,Pc:()=>d,fy:()=>I,getTenantId:()=>i,getTenantIdFromCognito:()=>g,h_:()=>h,isValidUUID:()=>c,jW:()=>p,oA:()=>l,pm:()=>m,updateTenantIdInCognito:()=>f});var r=n(81746),a=n(24818),o=n(62052);let s="tenantId",i=async()=>{try{var t,e,n,i,c,u;let l=await o.l.getItem(s);if(l)return l;let d=await (0,r.H)(),f=await (0,a.$)(),h=(null==d||null==(t=d.attributes)?void 0:t["custom:tenant_ID"])||(null==d||null==(e=d.attributes)?void 0:e["custom:tenantId"])||(null==f||null==(i=f.accessToken)||null==(n=i.payload)?void 0:n["custom:tenant_ID"])||(null==f||null==(u=f.accessToken)||null==(c=u.payload)?void 0:c["custom:tenantId"]);if(!h)throw Error("Tenant ID not found in user attributes or session");return await o.l.setItem(s,h),h}catch(t){throw console.error("Error getting tenant ID:",t),t}},c=t=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t),u=async t=>{try{await o.l.setItem(s,t)}catch(t){throw console.error("Error storing tenant ID:",t),t}},l=async t=>{let{tenantId:e,metadata:n={}}=t;try{if(!e)return void console.error("Cannot store tenant info: No tenant ID provided");await o.l.setItem(s,e),window.__APP_CACHE||(window.__APP_CACHE={}),window.__APP_CACHE.tenant||(window.__APP_CACHE.tenant={}),window.__APP_CACHE.tenant.id=e,window.__APP_CACHE.tenant.metadata=n,window.__APP_CACHE.tenant.timestamp=Date.now();try{sessionStorage.setItem("tenant_id",e),sessionStorage.setItem("tenant_info",JSON.stringify({id:e,metadata:n,timestamp:Date.now()}))}catch(t){console.debug("Could not store tenant info in sessionStorage:",t)}console.debug("[TenantUtils] Stored tenant info for ID: ".concat(e))}catch(t){console.error("Error storing tenant info:",t)}},d=t=>t?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():t,f=async t=>{try{let{updateUserAttributes:e}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158));await e({userAttributes:{"custom:tenant_ID":t}}),await u(t),console.debug("[TenantUtils] Updated tenant ID in Cognito: ".concat(t))}catch(e){console.error("Error updating tenant ID in Cognito:",e),await u(t)}},h=async t=>{try{await o.l.setItem("auth_tokens",t)}catch(t){throw console.error("Error setting tokens:",t),t}},g=async()=>{try{var t,e,n,i,c,u;let l=await o.l.getItem(s);if(l)return l;let d=await (0,r.H)(),f=await (0,a.$)(),h=(null==d||null==(t=d.attributes)?void 0:t["custom:tenant_ID"])||(null==d||null==(e=d.attributes)?void 0:e["custom:tenantId"])||(null==f||null==(i=f.accessToken)||null==(n=i.payload)?void 0:n["custom:tenant_ID"])||(null==f||null==(u=f.accessToken)||null==(c=u.payload)?void 0:c["custom:tenantId"]);if(!h)return null;return await o.l.setItem(s,h),h}catch(t){return console.error("Error getting tenant ID from Cognito:",t),null}},w=async t=>{try{if(!c(t))return!1;return(await fetch("/api/tenants/".concat(t,"/validate"))).ok}catch(t){return console.error("Error validating tenant ID:",t),!1}},m=t=>{let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e&=e;return"00000000-0000-4000-a000-".concat(Math.abs(e).toString(16).padStart(12,"0"))},p=async()=>{try{let t=await i();if(!c(t))return console.error("Invalid tenant ID format:",t),null;return t}catch(t){return console.error("Error getting secure tenant ID:",t),null}},v=t=>c(t),y=t=>t?"tenant_".concat(t.replace(/-/g,"_")):"public",I=async()=>{try{let t=await i(),e={"Content-Type":"application/json","x-tenant-id":t};try{let{getCurrentUser:t}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158)),r=await t();r&&r.userId&&(e["x-user-id"]=r.userId)}catch(t){}return e}catch(t){return console.error("Error getting tenant headers:",t),{"Content-Type":"application/json"}}}},57762:(t,e,n)=>{"use strict";n.d(e,{$:()=>r});let r=(t,e)=>t.Auth.fetchAuthSession(e)},61573:(t,e,n)=>{"use strict";n.d(e,{_:()=>r});class r{constructor(){this.storage=new Map}get length(){return this.storage.size}key(t){return t>this.length-1?null:Array.from(this.storage.keys())[t]}setItem(t,e){this.storage.set(t,e)}getItem(t){return this.storage.get(t)??null}removeItem(t){this.storage.delete(t)}clear(){this.storage.clear()}}},81746:(t,e,n)=>{"use strict";n.d(e,{H:()=>o});var r=n(87970),a=n(19002);let o=async()=>(0,a.H)(r.H)},84249:(t,e,n)=>{Promise.resolve().then(n.bind(n,5166))},94225:(t,e,n)=>{"use strict";n.d(e,{U:()=>a});var r=n(95730);class a{constructor(t){this.storage=t}async setItem(t,e){if(!this.storage)throw new r.h;this.storage.setItem(t,e)}async getItem(t){if(!this.storage)throw new r.h;return this.storage.getItem(t)}async removeItem(t){if(!this.storage)throw new r.h;this.storage.removeItem(t)}async clear(){if(!this.storage)throw new r.h;this.storage.clear()}}},95730:(t,e,n)=>{"use strict";n.d(e,{h:()=>o});var r=n(31241),a=n(65206);class o extends a.x{constructor(){super({name:r.m.PlatformNotSupported,message:"Function not supported on current platform"})}}}},t=>{var e=e=>t(t.s=e);t.O(0,[54940,9296,79480,20171,79189,62052,29729,28441,31684,77358],()=>e(84249)),_N_E=t.O()}]);