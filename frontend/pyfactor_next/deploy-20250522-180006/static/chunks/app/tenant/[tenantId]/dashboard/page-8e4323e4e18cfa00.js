(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3276],{13022:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>S});var s=t(95155),n=t(12115),r=t(35695),o=t(42749);let i=(0,n.createContext)({currentView:"main",showMainDashboard:!0,showKPIDashboard:!1,showHRDashboard:!1,showInventoryDashboard:!1,showCRMDashboard:!1,showSalesDashboard:!1,showTransportDashboard:!1,drawerOpen:!0,showForm:!1,formOption:null,setCurrentView:()=>{},toggleDrawer:()=>{},showDashboardView:()=>{},resetAllViews:()=>{},setFormView:()=>{},closeForm:()=>{}});function u(e){let{children:a}=e,[t,r]=(0,n.useState)(!1);(0,n.useEffect)(()=>{r(!0)},[]);let[o,u]=(0,n.useState)("main"),[c,l]=(0,n.useState)(!0),[d,h]=(0,n.useState)(!1),[b,m]=(0,n.useState)(!1),[g,p]=(0,n.useState)(!1),[f,w]=(0,n.useState)(!1),[S,v]=(0,n.useState)(!1),[x,k]=(0,n.useState)(!1),[D,y]=(0,n.useState)(!!t),[A,I]=(0,n.useState)(!1),[_,j]=(0,n.useState)(null);(0,n.useEffect)(()=>{t&&y(!0)},[t]);let T=(0,n.useCallback)(()=>{y(e=>!e)},[]),C=(0,n.useCallback)(()=>{l(!1),h(!1),m(!1),p(!1),w(!1),v(!1),k(!1),I(!1),j(null)},[]),F=(0,n.useCallback)(e=>{switch(C(),e){case"main":default:l(!0);break;case"kpi":h(!0);break;case"hr":m(!0);break;case"inventory":p(!0);break;case"crm":w(!0);break;case"sales":v(!0);break;case"transport":k(!0)}u(e)},[C]),N=(0,n.useCallback)(e=>{C(),j(e),I(!0)},[C]),E=(0,n.useCallback)(()=>{I(!1),j(null),l(!0)},[]),P=(0,n.useMemo)(()=>({currentView:o,showMainDashboard:c,showKPIDashboard:d,showHRDashboard:b,showInventoryDashboard:g,showCRMDashboard:f,showSalesDashboard:S,showTransportDashboard:x,drawerOpen:D,showForm:A,formOption:_,setCurrentView:u,toggleDrawer:T,showDashboardView:F,resetAllViews:C,setFormView:N,closeForm:E}),[o,c,d,b,g,f,S,x,D,A,_,u,T,F,C,N,E]);return(0,s.jsx)(i.Provider,{value:P,children:a})}var c=t(15343),l=t(47611),d=t(51174),h=t(33339),b=t(24139),m=t(11024);t(41515);var g=t(57247),p=t(31632);let f=()=>{let e=p.A.get("tenant_id")||p.A.get("subscription_plan")||"true"===localStorage.getItem("subscription_completed"),a=window.location.search.includes("fromSubscription=true");return o.vF.debug("[TenantDashboard] Emergency access check:",{hasEmergencyTokens:e,fromSubscription:a,cookies:{tenant_id:p.A.get("tenant_id"),subscription_plan:p.A.get("subscription_plan")}}),e&&a},w=async e=>{try{return e&&((0,g.jJ)(e),localStorage.setItem("tenant_id",e),p.A.set("tenant_id",e,{path:"/",expires:30})),sessionStorage.setItem("recovery_attempted","true"),sessionStorage.setItem("recovery_timestamp",new Date().toISOString()),!0}catch(e){return o.vF.error("[TenantDashboard] Session recovery failed:",e),!1}};function S(){let e=(0,r.useParams)(),a=(0,r.useRouter)(),t=(0,r.useSearchParams)(),i=null==e?void 0:e.tenantId,S="true"===t.get("fromSignIn"),v="true"===t.get("fromSubscription"),x=v&&f(),[k,D]=(0,n.useState)(!0),[y,A]=(0,n.useState)(null),[I,_]=(0,n.useState)(!1),[j,T]=(0,n.useState)("pending");if((0,n.useEffect)(()=>{(async()=>{try{if(o.vF.info("[TenantDashboard] Initializing dashboard for tenant:",i),x){o.vF.info("[TenantDashboard] Using emergency access mode from subscription"),await w(i),T("active"),_(!0),D(!1);return}let e=p.A.get("idToken")||sessionStorage.getItem("idToken");try{let e=await (0,m.T)();o.vF.debug("[TenantDashboard] User attributes:",e),_(!0);let a=e["custom:tenant_ID"]||e["custom:businessid"]||(0,g.If)();a&&a!==i&&(o.vF.warn("[TenantDashboard] Tenant ID mismatch:",{urlTenantId:i,cognitoTenantId:a}),(0,d.$_)(i)),T("active")}catch(t){o.vF.warn("[TenantDashboard] Cognito auth check failed:",t),e||x?(o.vF.info("[TenantDashboard] Using emergency token fallback"),await w(i)?(T("active"),_(!0)):(A("Your session has expired. Please sign in again."),a.push("/auth/signin"))):(o.vF.error("[TenantDashboard] No valid authentication found"),A("Please sign in to access your dashboard"),a.push("/auth/signin"))}D(!1)}catch(e){o.vF.error("[TenantDashboard] Dashboard initialization error:",e),D(!1),_(!0),A("Dashboard initialization error: ".concat(e.message))}})()},[i,a,S,x]),k)return(0,s.jsx)(l.A,{message:"Loading your dashboard..."});if(y)return(0,s.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:(0,s.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full",children:[(0,s.jsx)("h2",{className:"text-xl font-medium text-red-600 mb-4",children:"Dashboard Error"}),(0,s.jsx)("p",{className:"text-gray-700 mb-6",children:y}),(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsx)("button",{onClick:()=>{D(!0),A(null),_(!1),window.location.reload()},className:"w-full py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Try Again"}),(0,s.jsx)("button",{onClick:()=>a.push("/auth/signin"),className:"w-full py-2 px-4 border border-gray-300 text-gray-700 rounded hover:bg-gray-50",children:"Return to Sign In"})]})]})});if("pending"===j)return(0,s.jsx)(l.A,{message:"Preparing your dashboard environment..."});let C={newAccount:"true"===t.get("newAccount"),plan:t.get("plan"),mockData:"true"===t.get("mockData"),setupStatus:t.get("setupStatus"),fromSignIn:S,fromSubscription:v};return(0,s.jsx)(n.Suspense,{fallback:(0,s.jsx)(l.A,{message:"Loading dashboard content..."}),children:(0,s.jsx)(h.p,{children:(0,s.jsx)(b.oA,{tenantId:i,children:(0,s.jsx)(u,{children:(0,s.jsx)(c.A,{newAccount:C.newAccount,plan:C.plan,mockData:C.mockData,setupStatus:C.setupStatus,tenantId:i,fromSignIn:S,fromSubscription:v})})})})})}},15343:(e,a,t)=>{"use strict";t.d(a,{A:()=>s.A});var s=t(14745)},96467:(e,a,t)=>{Promise.resolve().then(t.bind(t,13022))}},e=>{var a=a=>e(e.s=a);e.O(0,[54940,9296,79480,58430,84620,23639,38501,78746,20171,79189,6874,62052,66766,31296,66352,38772,35162,37921,8896,29729,44367,47856,67953,3963,83531,93078,14719,14745,28441,31684,77358],()=>a(96467)),_N_E=e.O()}]);