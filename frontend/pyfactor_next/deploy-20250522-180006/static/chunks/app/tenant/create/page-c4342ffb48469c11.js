(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[19208],{6654:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return a}});let r=n(12115);function a(e,t){let n=(0,r.useRef)(null),a=(0,r.useRef)(null);return(0,r.useCallback)(r=>{if(null===r){let e=n.current;e&&(n.current=null,e());let t=a.current;t&&(a.current=null,t())}else e&&(n.current=o(e,r)),t&&(a.current=o(t,r))},[e,t])}function o(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let n=e(t);return"function"==typeof n?n:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},14882:(e,t,n)=>{"use strict";n.d(t,{Ku:()=>c,WE:()=>d,n8:()=>u});var r=n(95155),a=n(12115);n(39786);var o=n(42749),s=n(51174),i=n(49852);let l=(0,a.createContext)({tenantId:null,tenantInfo:null,loading:!0,error:null,setTenantId:()=>{},fetchTenantInfo:()=>Promise.resolve(null),switchTenant:()=>Promise.resolve(!1),clearTenant:()=>{},initializeTenant:()=>Promise.resolve(),verifyTenantAccess:()=>Promise.resolve(!0)}),c=()=>{let e=(0,a.useContext)(l);return e||(o.vF.warn("[TenantContext] useTenant called outside of provider, returning empty context"),{tenantId:null,tenantInfo:null,loading:!1,error:null,setTenantId:()=>{},fetchTenantInfo:()=>Promise.resolve(null),switchTenant:()=>Promise.resolve(!1),clearTenant:()=>{},initializeTenant:()=>Promise.resolve(),verifyTenantAccess:()=>Promise.resolve(!0)})},u=c,d=e=>{let{children:t}=e,[n,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(null),[f,m]=(0,a.useState)(!0),[h,g]=(0,a.useState)(null),[p,y]=(0,a.useState)([]),w=(0,a.useRef)({tenantInfo:0,tenantList:0}),v=(0,a.useRef)({tenantInfo:!1,tenantList:!1}),x=(0,a.useCallback)(()=>{let e=window.location.pathname;return"/"===e||""===e||"/index.html"===e||e.startsWith("/auth/")||"/about"===e||"/privacy"===e||"/terms"===e},[!0]);(0,a.useEffect)(()=>{x()&&m(!1)},[x]);let b=(0,a.useCallback)(async()=>{var e,t;try{let t=await fetch("/api/tenant/from-token");if(!t.ok){if(x()&&(401===t.status||403===t.status))return o.vF.debug("[TenantContext] Auth error on public page (expected)"),null;let n=await t.json();if("UserUnAuthenticatedException"===n.name||(null==(e=n.message)?void 0:e.includes("User needs to be authenticated")))throw Error("User needs to be authenticated");throw Error("Error getting tenant ID from token: ".concat(t.statusText))}return(await t.json()).tenantId}catch(e){if(x()&&("UserUnAuthenticatedException"===e.name||(null==(t=e.message)?void 0:t.includes("User needs to be authenticated"))))return o.vF.debug("[TenantContext] Auth error on public page (expected)"),null;throw e}},[x]),I=(0,a.useCallback)(async e=>{if(e&&e!==n&&(c(e),1))try{await (0,s.updateTenantIdInCognito)(e),o.vF.info("[TenantContext] Tenant ID updated in Cognito: ".concat(e))}catch(e){o.vF.error("[TenantContext] Error updating tenant ID in Cognito:",e)}},[n]),C=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n;try{if(!e)return o.vF.warn("[TenantContext] No tenant ID provided to fetch info"),null;let t=Date.now();if(v.current.tenantInfo||t-w.current.tenantInfo<2e3)return o.vF.debug("[TenantContext] Skipping tenant info fetch (too frequent or in progress)"),u;v.current.tenantInfo=!0,m(!0);try{let t=await i.K.getTenantInfo(e);if(w.current.tenantInfo=Date.now(),t)return o.vF.info("[TenantContext] Fetched tenant info for: ".concat(e)),d(t),t;return o.vF.warn("[TenantContext] No tenant info returned for: ".concat(e)),null}catch(n){o.vF.warn("[TenantContext] Failed to fetch tenant info, using mock: ".concat(n.message));let t={id:e,name:"Tenant ".concat(e.substring(0,8)),description:"Mock tenant for development",isActive:!0};return d(t),t}}catch(e){return o.vF.error("[TenantContext] Error fetching tenant info: ".concat(e)),g(e),null}finally{m(!1),v.current.tenantInfo=!1}},[n,u]),T=(0,a.useCallback)(async e=>{try{if(!e)return o.vF.warn("[TenantContext] No tenant ID provided to switch to"),!1;return await I(e),await C(e),o.vF.info("[TenantContext] Successfully switched to tenant: ".concat(e)),!0}catch(e){return o.vF.error("[TenantContext] Error switching tenant:",e),!1}},[I,C]),j=(0,a.useCallback)(async()=>{try{await (0,s.updateTenantIdInCognito)(""),c(null),d(null),o.vF.info("[TenantContext] Tenant context cleared")}catch(e){o.vF.error("[TenantContext] Error clearing tenant ID in Cognito:",e)}},[]),k=(0,a.useCallback)(async()=>{if(x()){o.vF.debug("[TenantContext] Skipping tenant initialization for public page"),m(!1);return}try{m(!0)}catch(t){if(x())return o.vF.debug("[TenantContext] Error ignored on public page:",t.message),m(!1),null;{var e;let n=window.location.pathname;if((n.includes("/auth/signin")||n.includes("/auth/signup")||n.includes("/auth/verify")||n.includes("/auth/reset-password"))&&("UserUnAuthenticatedException"===t.name||(null==(e=t.message)?void 0:e.includes("User needs to be authenticated"))))return o.vF.debug("[TenantContext] User not authenticated on auth page (expected)"),m(!1),null}o.vF.error("[TenantContext] Error initializing tenant context:",t),g(t)}finally{m(!1)}},[x,b,C]),_=(0,a.useCallback)(async e=>{try{if(!e)return o.vF.warn("[TenantContext] No tenant ID provided to verify access"),!1;let t=await i.K.verifyTenantAccess(e);return o.vF.info("[TenantContext] User access to tenant ".concat(e,": ").concat(t)),t}catch(e){return o.vF.error("[TenantContext] Error verifying tenant access:",e),!1}},[]);return(0,a.useEffect)(()=>{k()},[k]),(0,r.jsx)(l.Provider,{value:{tenantId:n,tenantInfo:u,loading:f,error:h,setTenantId:I,fetchTenantInfo:C,switchTenant:T,clearTenant:j,initializeTenant:k,verifyTenantAccess:_},children:t})}},19002:(e,t,n)=>{"use strict";n.d(t,{H:()=>o});var r=n(45103),a=n(84295);let o=async e=>{var t;let n=e.getConfig().Auth?.Cognito;(0,r.$y)(n);let o=await e.Auth.getTokens({forceRefresh:!1});(0,a.H0)(o);let{"cognito:username":s,sub:i}=o.idToken?.payload??{},l={username:s,userId:i},c=(t=o,t?.signInDetails);return c&&(l.signInDetails=c),l}},39641:(e,t,n)=>{"use strict";n.d(t,{C:()=>i,p:()=>s});var r=n(62904),a=n(61573);let o=new r.C("CoreStorageUtils"),s=()=>{try{if("undefined"!=typeof window&&window.localStorage)return window.localStorage}catch(e){o.info("localStorage not found. InMemoryStorage is used as a fallback.")}return new a._},i=()=>{try{if("undefined"!=typeof window&&window.sessionStorage)return window.sessionStorage.getItem("test"),window.sessionStorage;throw Error("sessionStorage is not defined")}catch(e){return o.info("sessionStorage not found. InMemoryStorage is used as a fallback."),new a._}}},39786:(e,t,n)=>{"use strict";n.d(t,{s:()=>a});class r extends Error{}function a(e,t){let n;if("string"!=typeof e)throw new r("Invalid token specified: must be a string");t||(t={});let a=+(!0!==t.header),o=e.split(".")[a];if("string"!=typeof o)throw new r(`Invalid token specified: missing part #${a+1}`);try{n=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var n;return n=t,decodeURIComponent(atob(n).replace(/(.)/g,(e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}catch(e){return atob(t)}}(o)}catch(e){throw new r(`Invalid token specified: invalid base64 for part #${a+1} (${e.message})`)}try{return JSON.parse(n)}catch(e){throw new r(`Invalid token specified: invalid json for part #${a+1} (${e.message})`)}}r.prototype.name="InvalidTokenError"},44114:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>d});var r=n(55166),a=n(68387),o=n(95155),s=n(12115),i=n(35695),l=n(14882),c=n(42749),u=n(8928);function d(){let e=(0,i.useRouter)(),{createTenant:t}=(0,l.Ku)(),[n,d]=(0,s.useState)({name:"",description:"",industry:"",address:"",country:"",timezone:""}),[f,m]=(0,s.useState)(!1),[h,g]=(0,s.useState)(""),p=e=>{let{name:t,value:n}=e.target;d(e=>(0,a._)((0,r._)({},e),{[t]:n}))},y=async r=>{if(r.preventDefault(),!n.name.trim())return void g("Tenant name is required");m(!0),g("");try{let r=await t(n);c.vF.info("[CreateTenant] Tenant created successfully:",r),e.push("/tenant/".concat(r.id,"/dashboard"))}catch(e){c.vF.error("[CreateTenant] Error creating tenant:",e),g(e.message||"Failed to create tenant. Please try again."),m(!1)}};return(0,o.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,o.jsx)(u.A,{}),(0,o.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-12 sm:px-6 lg:px-8",children:(0,o.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,o.jsxs)("div",{className:"text-center mb-8",children:[(0,o.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Create New Tenant"}),(0,o.jsx)("p",{className:"mt-2 text-gray-600",children:"Enter the details for your new tenant"})]}),h&&(0,o.jsx)("div",{className:"mb-6 p-4 bg-red-50 rounded-md border border-red-200",children:(0,o.jsx)("p",{className:"text-sm text-red-600",children:h})}),(0,o.jsxs)("form",{onSubmit:y,className:"space-y-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:["Tenant Name ",(0,o.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,o.jsx)("input",{type:"text",id:"name",name:"name",value:n.name,onChange:p,required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"E.g., My Company"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,o.jsx)("textarea",{id:"description",name:"description",value:n.description,onChange:p,rows:3,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Brief description of your tenant"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"industry",className:"block text-sm font-medium text-gray-700",children:"Industry"}),(0,o.jsxs)("select",{id:"industry",name:"industry",value:n.industry,onChange:p,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",children:[(0,o.jsx)("option",{value:"",children:"Select Industry"}),(0,o.jsx)("option",{value:"retail",children:"Retail"}),(0,o.jsx)("option",{value:"healthcare",children:"Healthcare"}),(0,o.jsx)("option",{value:"finance",children:"Finance"}),(0,o.jsx)("option",{value:"technology",children:"Technology"}),(0,o.jsx)("option",{value:"manufacturing",children:"Manufacturing"}),(0,o.jsx)("option",{value:"education",children:"Education"}),(0,o.jsx)("option",{value:"hospitality",children:"Hospitality"}),(0,o.jsx)("option",{value:"other",children:"Other"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700",children:"Address"}),(0,o.jsx)("input",{type:"text",id:"address",name:"address",value:n.address,onChange:p,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Business address"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700",children:"Country"}),(0,o.jsx)("input",{type:"text",id:"country",name:"country",value:n.country,onChange:p,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Country"})]}),(0,o.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row justify-end space-y-4 sm:space-y-0 sm:space-x-4 pt-4",children:[(0,o.jsx)("button",{type:"button",onClick:()=>{e.push("/tenant/select")},className:"inline-flex justify-center items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),(0,o.jsx)("button",{type:"submit",disabled:f,className:"\n                  inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white \n                  ".concat(f?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500","\n                "),children:f?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating..."]}):"Create Tenant"})]})]})]})})]})}},49852:(e,t,n)=>{"use strict";n.d(t,{K:()=>o});var r=n(29729),a=n(42749);let o={async getTenantInfo(e){try{if(!e)return a.vF.warn("[apiService] No tenant ID provided to getTenantInfo"),null;return(await r.Ay.get("/api/tenants/".concat(e))).data}catch(t){if(t.response&&404===t.response.status)return a.vF.warn("[apiService] Tenant not found: ".concat(e)),null;return a.vF.warn("[apiService] Error fetching tenant info: ".concat(t.message,". Using mock data.")),{id:e,name:"Business ".concat(e.substring(0,8)),type:"business",status:"active",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}},async getUserTenants(){try{return(await r.Ay.get("/api/tenants")).data}catch(e){return a.vF.warn("[apiService] Error fetching user tenants: ".concat(e.message,". Using mock data.")),[{id:"11111111-1111-1111-1111-111111111111",name:"",type:"business",status:"active",isOwner:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]}}}},51174:(e,t,n)=>{"use strict";n.d(t,{$_:()=>c,BI:()=>w,FB:()=>v,Nf:()=>g,Pc:()=>d,fy:()=>x,getTenantId:()=>i,getTenantIdFromCognito:()=>h,h_:()=>m,isValidUUID:()=>l,jW:()=>y,oA:()=>u,pm:()=>p,updateTenantIdInCognito:()=>f});var r=n(81746),a=n(24818),o=n(62052);let s="tenantId",i=async()=>{try{var e,t,n,i,l,c;let u=await o.l.getItem(s);if(u)return u;let d=await (0,r.H)(),f=await (0,a.$)(),m=(null==d||null==(e=d.attributes)?void 0:e["custom:tenant_ID"])||(null==d||null==(t=d.attributes)?void 0:t["custom:tenantId"])||(null==f||null==(i=f.accessToken)||null==(n=i.payload)?void 0:n["custom:tenant_ID"])||(null==f||null==(c=f.accessToken)||null==(l=c.payload)?void 0:l["custom:tenantId"]);if(!m)throw Error("Tenant ID not found in user attributes or session");return await o.l.setItem(s,m),m}catch(e){throw console.error("Error getting tenant ID:",e),e}},l=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),c=async e=>{try{await o.l.setItem(s,e)}catch(e){throw console.error("Error storing tenant ID:",e),e}},u=async e=>{let{tenantId:t,metadata:n={}}=e;try{if(!t)return void console.error("Cannot store tenant info: No tenant ID provided");await o.l.setItem(s,t),window.__APP_CACHE||(window.__APP_CACHE={}),window.__APP_CACHE.tenant||(window.__APP_CACHE.tenant={}),window.__APP_CACHE.tenant.id=t,window.__APP_CACHE.tenant.metadata=n,window.__APP_CACHE.tenant.timestamp=Date.now();try{sessionStorage.setItem("tenant_id",t),sessionStorage.setItem("tenant_info",JSON.stringify({id:t,metadata:n,timestamp:Date.now()}))}catch(e){console.debug("Could not store tenant info in sessionStorage:",e)}console.debug("[TenantUtils] Stored tenant info for ID: ".concat(t))}catch(e){console.error("Error storing tenant info:",e)}},d=e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e,f=async e=>{try{let{updateUserAttributes:t}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158));await t({userAttributes:{"custom:tenant_ID":e}}),await c(e),console.debug("[TenantUtils] Updated tenant ID in Cognito: ".concat(e))}catch(t){console.error("Error updating tenant ID in Cognito:",t),await c(e)}},m=async e=>{try{await o.l.setItem("auth_tokens",e)}catch(e){throw console.error("Error setting tokens:",e),e}},h=async()=>{try{var e,t,n,i,l,c;let u=await o.l.getItem(s);if(u)return u;let d=await (0,r.H)(),f=await (0,a.$)(),m=(null==d||null==(e=d.attributes)?void 0:e["custom:tenant_ID"])||(null==d||null==(t=d.attributes)?void 0:t["custom:tenantId"])||(null==f||null==(i=f.accessToken)||null==(n=i.payload)?void 0:n["custom:tenant_ID"])||(null==f||null==(c=f.accessToken)||null==(l=c.payload)?void 0:l["custom:tenantId"]);if(!m)return null;return await o.l.setItem(s,m),m}catch(e){return console.error("Error getting tenant ID from Cognito:",e),null}},g=async e=>{try{if(!l(e))return!1;return(await fetch("/api/tenants/".concat(e,"/validate"))).ok}catch(e){return console.error("Error validating tenant ID:",e),!1}},p=e=>{let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return"00000000-0000-4000-a000-".concat(Math.abs(t).toString(16).padStart(12,"0"))},y=async()=>{try{let e=await i();if(!l(e))return console.error("Invalid tenant ID format:",e),null;return e}catch(e){return console.error("Error getting secure tenant ID:",e),null}},w=e=>l(e),v=e=>e?"tenant_".concat(e.replace(/-/g,"_")):"public",x=async()=>{try{let e=await i(),t={"Content-Type":"application/json","x-tenant-id":e};try{let{getCurrentUser:e}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158)),r=await e();r&&r.userId&&(t["x-user-id"]=r.userId)}catch(e){}return t}catch(e){return console.error("Error getting tenant headers:",e),{"Content-Type":"application/json"}}}},61573:(e,t,n)=>{"use strict";n.d(t,{_:()=>r});class r{constructor(){this.storage=new Map}get length(){return this.storage.size}key(e){return e>this.length-1?null:Array.from(this.storage.keys())[e]}setItem(e,t){this.storage.set(e,t)}getItem(e){return this.storage.get(e)??null}removeItem(e){this.storage.delete(e)}clear(){this.storage.clear()}}},81746:(e,t,n)=>{"use strict";n.d(t,{H:()=>o});var r=n(87970),a=n(19002);let o=async()=>(0,a.H)(r.H)},82331:(e,t,n)=>{Promise.resolve().then(n.bind(n,44114))},94225:(e,t,n)=>{"use strict";n.d(t,{U:()=>a});var r=n(95730);class a{constructor(e){this.storage=e}async setItem(e,t){if(!this.storage)throw new r.h;this.storage.setItem(e,t)}async getItem(e){if(!this.storage)throw new r.h;return this.storage.getItem(e)}async removeItem(e){if(!this.storage)throw new r.h;this.storage.removeItem(e)}async clear(){if(!this.storage)throw new r.h;this.storage.clear()}}},95730:(e,t,n)=>{"use strict";n.d(t,{h:()=>o});var r=n(31241),a=n(65206);class o extends a.x{constructor(){super({name:r.m.PlatformNotSupported,message:"Function not supported on current platform"})}}}},e=>{var t=t=>e(e.s=t);e.O(0,[54940,9296,79480,58430,20171,79189,62052,66766,31296,29729,44367,76e3,28441,31684,77358],()=>t(82331)),_N_E=e.O()}]);