(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879,45066],{19002:(t,e,n)=>{"use strict";n.d(e,{H:()=>r});var a=n(45103),s=n(84295);let r=async t=>{var e;let n=t.getConfig().Auth?.Cognito;(0,a.$y)(n);let r=await t.Auth.getTokens({forceRefresh:!1});(0,s.H0)(r);let{"cognito:username":o,sub:i}=r.idToken?.payload??{},l={username:o,userId:i},c=(e=r,e?.signInDetails);return c&&(l.signInDetails=c),l}},24818:(t,e,n)=>{"use strict";n.d(e,{$:()=>r});var a=n(87970),s=n(57762);let r=t=>(0,s.$)(a.H,t)},33259:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});var a=n(95155),s=n(12115),r=n(35695),o=n(51174);function i(){let[t,e]=(0,s.useState)(""),[n,i]=(0,s.useState)(!1),[l,c]=(0,s.useState)(""),[d,u]=(0,s.useState)(null),[h,m]=(0,s.useState)([]),g=(0,r.useRouter)();(0,s.useEffect)(()=>{(async()=>{let t=await (0,o.getTenantIdFromCognito)();t&&e(t)})(),(async()=>{try{let t=await fetch("/api/tenant/list");if(t.ok){let e=await t.json();e.success&&e.tenants&&m(e.tenants)}}catch(t){console.error("Error fetching tenants:",t)}})()},[]);let w=async()=>{if(!t)return void u("Please enter a tenant ID");i(!0),u(null),c("Setting up dashboard...");try{if(!await (0,o.updateTenantIdInCognito)(t)){u("Failed to update Cognito with tenant ID"),i(!1);return}let e=await fetch("/api/tenant/setup-dashboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tenantId:t})}),n=await e.json();e.ok&&n.success?(c("Dashboard setup successful!"),setTimeout(()=>{g.push("/".concat(t,"/dashboard"))},1500)):u(n.message||"Failed to set up dashboard")}catch(t){u("Error: ".concat(t.message))}finally{i(!1)}};return(0,a.jsxs)("div",{className:"container mx-auto p-8 max-w-2xl",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Dashboard Debug Setup"}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Configure Dashboard"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"tenantId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tenant ID"}),(0,a.jsx)("input",{type:"text",id:"tenantId",value:t,onChange:t=>e(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter tenant ID"})]}),h.length>0&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Available Tenants"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-2 max-h-40 overflow-y-auto",children:h.map(t=>(0,a.jsxs)("button",{onClick:()=>e(t.id),className:"text-left px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-md",children:[(0,a.jsx)("div",{className:"font-medium",children:t.name}),(0,a.jsx)("div",{className:"text-xs text-gray-500 font-mono",children:t.id})]},t.id))})]}),l&&!d&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 text-blue-700 rounded",children:[l,n&&(0,a.jsx)("div",{className:"mt-2 flex justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-700"})})]}),d&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded",children:d}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>{if(!t)return void u("Please enter a tenant ID");g.push("/".concat(t,"/dashboard"))},className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"View Dashboard"}),(0,a.jsx)("button",{onClick:w,disabled:n,className:"px-4 py-2 rounded ".concat(n?"bg-gray-300 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:n?"Setting Up...":"Set Up Dashboard"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Dashboard Debug Controls"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("button",{onClick:()=>g.push("/dashboard"),className:"w-full px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"Go to Main Dashboard"})}),(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("button",{onClick:async()=>{await (0,o.updateTenantIdInCognito)(""),e(""),c("Tenant ID cleared from Cognito")},className:"w-full px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Clear Tenant ID Storage"})})]})]})]})}},35695:(t,e,n)=>{"use strict";var a=n(18999);n.o(a,"useParams")&&n.d(e,{useParams:function(){return a.useParams}}),n.o(a,"usePathname")&&n.d(e,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(e,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(e,{useSearchParams:function(){return a.useSearchParams}})},39641:(t,e,n)=>{"use strict";n.d(e,{C:()=>i,p:()=>o});var a=n(62904),s=n(61573);let r=new a.C("CoreStorageUtils"),o=()=>{try{if("undefined"!=typeof window&&window.localStorage)return window.localStorage}catch(t){r.info("localStorage not found. InMemoryStorage is used as a fallback.")}return new s._},i=()=>{try{if("undefined"!=typeof window&&window.sessionStorage)return window.sessionStorage.getItem("test"),window.sessionStorage;throw Error("sessionStorage is not defined")}catch(t){return r.info("sessionStorage not found. InMemoryStorage is used as a fallback."),new s._}}},51174:(t,e,n)=>{"use strict";n.d(e,{$_:()=>c,BI:()=>p,FB:()=>y,Nf:()=>w,Pc:()=>u,fy:()=>I,getTenantId:()=>i,getTenantIdFromCognito:()=>g,h_:()=>m,isValidUUID:()=>l,jW:()=>b,oA:()=>d,pm:()=>f,updateTenantIdInCognito:()=>h});var a=n(81746),s=n(24818),r=n(62052);let o="tenantId",i=async()=>{try{var t,e,n,i,l,c;let d=await r.l.getItem(o);if(d)return d;let u=await (0,a.H)(),h=await (0,s.$)(),m=(null==u||null==(t=u.attributes)?void 0:t["custom:tenant_ID"])||(null==u||null==(e=u.attributes)?void 0:e["custom:tenantId"])||(null==h||null==(i=h.accessToken)||null==(n=i.payload)?void 0:n["custom:tenant_ID"])||(null==h||null==(c=h.accessToken)||null==(l=c.payload)?void 0:l["custom:tenantId"]);if(!m)throw Error("Tenant ID not found in user attributes or session");return await r.l.setItem(o,m),m}catch(t){throw console.error("Error getting tenant ID:",t),t}},l=t=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t),c=async t=>{try{await r.l.setItem(o,t)}catch(t){throw console.error("Error storing tenant ID:",t),t}},d=async t=>{let{tenantId:e,metadata:n={}}=t;try{if(!e)return void console.error("Cannot store tenant info: No tenant ID provided");await r.l.setItem(o,e),window.__APP_CACHE||(window.__APP_CACHE={}),window.__APP_CACHE.tenant||(window.__APP_CACHE.tenant={}),window.__APP_CACHE.tenant.id=e,window.__APP_CACHE.tenant.metadata=n,window.__APP_CACHE.tenant.timestamp=Date.now();try{sessionStorage.setItem("tenant_id",e),sessionStorage.setItem("tenant_info",JSON.stringify({id:e,metadata:n,timestamp:Date.now()}))}catch(t){console.debug("Could not store tenant info in sessionStorage:",t)}console.debug("[TenantUtils] Stored tenant info for ID: ".concat(e))}catch(t){console.error("Error storing tenant info:",t)}},u=t=>t?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():t,h=async t=>{try{let{updateUserAttributes:e}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158));await e({userAttributes:{"custom:tenant_ID":t}}),await c(t),console.debug("[TenantUtils] Updated tenant ID in Cognito: ".concat(t))}catch(e){console.error("Error updating tenant ID in Cognito:",e),await c(t)}},m=async t=>{try{await r.l.setItem("auth_tokens",t)}catch(t){throw console.error("Error setting tokens:",t),t}},g=async()=>{try{var t,e,n,i,l,c;let d=await r.l.getItem(o);if(d)return d;let u=await (0,a.H)(),h=await (0,s.$)(),m=(null==u||null==(t=u.attributes)?void 0:t["custom:tenant_ID"])||(null==u||null==(e=u.attributes)?void 0:e["custom:tenantId"])||(null==h||null==(i=h.accessToken)||null==(n=i.payload)?void 0:n["custom:tenant_ID"])||(null==h||null==(c=h.accessToken)||null==(l=c.payload)?void 0:l["custom:tenantId"]);if(!m)return null;return await r.l.setItem(o,m),m}catch(t){return console.error("Error getting tenant ID from Cognito:",t),null}},w=async t=>{try{if(!l(t))return!1;return(await fetch("/api/tenants/".concat(t,"/validate"))).ok}catch(t){return console.error("Error validating tenant ID:",t),!1}},f=t=>{let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e&=e;return"00000000-0000-4000-a000-".concat(Math.abs(e).toString(16).padStart(12,"0"))},b=async()=>{try{let t=await i();if(!l(t))return console.error("Invalid tenant ID format:",t),null;return t}catch(t){return console.error("Error getting secure tenant ID:",t),null}},p=t=>l(t),y=t=>t?"tenant_".concat(t.replace(/-/g,"_")):"public",I=async()=>{try{let t=await i(),e={"Content-Type":"application/json","x-tenant-id":t};try{let{getCurrentUser:t}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158)),a=await t();a&&a.userId&&(e["x-user-id"]=a.userId)}catch(t){}return e}catch(t){return console.error("Error getting tenant headers:",t),{"Content-Type":"application/json"}}}},57762:(t,e,n)=>{"use strict";n.d(e,{$:()=>a});let a=(t,e)=>t.Auth.fetchAuthSession(e)},61573:(t,e,n)=>{"use strict";n.d(e,{_:()=>a});class a{constructor(){this.storage=new Map}get length(){return this.storage.size}key(t){return t>this.length-1?null:Array.from(this.storage.keys())[t]}setItem(t,e){this.storage.set(t,e)}getItem(t){return this.storage.get(t)??null}removeItem(t){this.storage.delete(t)}clear(){this.storage.clear()}}},76618:(t,e,n)=>{Promise.resolve().then(n.bind(n,33259))},81746:(t,e,n)=>{"use strict";n.d(e,{H:()=>r});var a=n(87970),s=n(19002);let r=async()=>(0,s.H)(a.H)},94225:(t,e,n)=>{"use strict";n.d(e,{U:()=>s});var a=n(95730);class s{constructor(t){this.storage=t}async setItem(t,e){if(!this.storage)throw new a.h;this.storage.setItem(t,e)}async getItem(t){if(!this.storage)throw new a.h;return this.storage.getItem(t)}async removeItem(t){if(!this.storage)throw new a.h;this.storage.removeItem(t)}async clear(){if(!this.storage)throw new a.h;this.storage.clear()}}},95730:(t,e,n)=>{"use strict";n.d(e,{h:()=>r});var a=n(31241),s=n(65206);class r extends s.x{constructor(){super({name:a.m.PlatformNotSupported,message:"Function not supported on current platform"})}}}},t=>{var e=e=>t(t.s=e);t.O(0,[54940,9296,79480,62052,28441,31684,77358],()=>e(76618)),_N_E=t.O()}]);