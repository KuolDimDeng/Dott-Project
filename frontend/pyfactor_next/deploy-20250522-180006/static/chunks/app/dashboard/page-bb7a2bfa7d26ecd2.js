(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[35105,45066],{15827:(e,t,r)=>{"use strict";r.d(t,{default:()=>i});var o=r(12115),n=r(35695),a=r(25578),s=r(51174);function i(){let e=(0,n.useRouter)();return(0,o.useEffect)(()=>{(async()=>{let e=new URL(window.location);if("/dashboard"===e.pathname&&("true"===e.searchParams.get("fromAuth")||"true"===e.searchParams.get("fromSignIn"))){a.v.info("[MiddlewareHeaderHandler] Detected auth response, checking for tenant ID");try{let t=await (0,s.getTenantIdFromCognito)();if(t){a.v.info("[MiddlewareHeaderHandler] Found tenant ID after auth: ".concat(t));let r={};e.searchParams.forEach((e,t)=>{r[t]=e}),r.direct="true";let o=Object.entries(r).map(e=>{let[t,r]=e;return"".concat(t,"=").concat(encodeURIComponent(r))}).join("&"),n="/".concat(t,"/dashboard").concat(o?"?".concat(o):"");a.v.info("[MiddlewareHeaderHandler] Redirecting to tenant URL after auth: ".concat(n)),setTimeout(()=>{window.location.href=n},100);return}}catch(e){a.v.error("[MiddlewareHeaderHandler] Error checking tenant ID from Cognito:",e)}}let t=document.querySelectorAll('meta[http-equiv^="x-"]'),r={};if(t.forEach(e=>{let t=e.getAttribute("http-equiv"),o=e.getAttribute("content");r[t]=o,a.v.info("[MiddlewareHeaderHandler] Found meta tag: ".concat(t," = ").concat(o))}),"true"===r["x-reset-navigation"]){a.v.info("[MiddlewareHeaderHandler] Resetting navigation state"),localStorage.removeItem("lastRedirect"),localStorage.removeItem("redirectAttempts");try{let e=await (0,s.getTenantIdFromCognito)();setTimeout(()=>{e?window.location.href="/".concat(e,"/dashboard?direct=true&fromSignIn=true"):window.location.href="/dashboard?fromSignIn=true"},500)}catch(e){a.v.error("[MiddlewareHeaderHandler] Error getting tenant ID during reset:",e),window.location.href="/dashboard?fromSignIn=true"}return}let o="true"===r["x-should-redirect"],n=r["x-redirect-path"];if(r["x-tenant-id"]){let e=r["x-tenant-id"];if(e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)){a.v.info("[MiddlewareHeaderHandler] Storing tenant ID in Cognito: ".concat(e));try{await (0,s.updateTenantIdInCognito)(e)}catch(e){a.v.error("[MiddlewareHeaderHandler] Error storing tenant ID in Cognito:",e)}}}if(o&&n&&window.location.pathname!==n.split("?")[0]){a.v.info("[MiddlewareHeaderHandler] Should redirect to: ".concat(n));try{let e=await (0,s.getTenantIdFromCognito)(),t=n.match(/^\/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\//i);if(e&&!t&&n.startsWith("/dashboard")){let t="/".concat(e,"/dashboard?direct=true&fromSignIn=true");a.v.info("[MiddlewareHeaderHandler] Adding tenant ID to path: ".concat(t)),window.location.href=t;return}let r=localStorage.getItem("lastRedirect"),o=parseInt(localStorage.getItem("redirectAttempts")||"0");if(r===n){if(o++,localStorage.setItem("redirectAttempts",o.toString()),o>=2){a.v.warn("[MiddlewareHeaderHandler] Detected redirect loop, breaking cycle"),localStorage.removeItem("lastRedirect"),localStorage.removeItem("redirectAttempts");let t=n.match(/^\/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\//i);if(t&&t[1]){let e=t[1];window.location.href="/".concat(e,"/dashboard?direct=true&fromSignIn=true")}else e?window.location.href="/".concat(e,"/dashboard?direct=true&fromSignIn=true"):window.location.href="/dashboard?fromSignIn=true&reset=true";return}}else o=1,localStorage.setItem("redirectAttempts","1");localStorage.setItem("lastRedirect",n),n&&(window.location.href=n)}catch(e){a.v.error("[MiddlewareHeaderHandler] Error during redirection:",e),n&&(window.location.href=n)}}})()},[e]),null}},19002:(e,t,r)=>{"use strict";r.d(t,{H:()=>a});var o=r(45103),n=r(84295);let a=async e=>{var t;let r=e.getConfig().Auth?.Cognito;(0,o.$y)(r);let a=await e.Auth.getTokens({forceRefresh:!1});(0,n.H0)(a);let{"cognito:username":s,sub:i}=a.idToken?.payload??{},c={username:s,userId:i},d=(t=a,t?.signInDetails);return d&&(c.signInDetails=d),c}},24818:(e,t,r)=>{"use strict";r.d(t,{$:()=>a});var o=r(87970),n=r(57762);let a=e=>(0,n.$)(o.H,e)},25578:(e,t,r)=>{"use strict";r.d(t,{v:()=>d});var o=r(29670);let n={DEBUG:0,INFO:1,WARN:2,ERROR:3},a=n.INFO,s=()=>{try{{let e=(0,o.gd)("logLevel");if(e&&void 0!==n[e])return n[e]}}catch(e){}return a},i=()=>new Date().toISOString(),c=(e,t)=>{let r=i();return"[".concat(r,"] [").concat(e,"] ").concat(t)},d={debug:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];s()<=n.DEBUG&&console.debug(c("DEBUG",e),...r)},info:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];s()<=n.INFO&&console.info(c("INFO",e),...r)},warn:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];s()<=n.WARN&&console.warn(c("WARN",e),...r)},error:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];s()<=n.ERROR&&console.error(c("ERROR",e),...r)},setLogLevel:e=>{try{void 0!==n[e]&&(0,o.mm)("logLevel",e)}catch(e){}}}},29670:(e,t,r)=>{"use strict";r.d(t,{$R:()=>d,A6:()=>i,Ay:()=>u,IL:()=>c,bB:()=>l,gd:()=>s,mm:()=>a});var o=r(42749);let n=null;try{window.AWSCache&&(n=window.AWSCache,o.vF.debug("[appCache] AWS App Cache initialized successfully"))}catch(e){o.vF.warn("[appCache] Failed to initialize AWS App Cache:",e)}async function a(e,t,r){try{if(!e)throw Error("Cache key is required");if(n)await n.set(e,t,r),o.vF.debug("[appCache] Set value for key: ".concat(e));else{let n={value:t,timestamp:Date.now(),ttl:r?1e3*r:null};window.sessionStorage.setItem(e,JSON.stringify(n)),o.vF.debug("[appCache] Set value in sessionStorage for key: ".concat(e))}}catch(t){throw o.vF.error("[appCache] Error setting cache value for key ".concat(e,":"),t),t}}async function s(e){try{if(!e)throw Error("Cache key is required");if(n){let t=await n.get(e);return o.vF.debug("[appCache] Retrieved value for key: ".concat(e)),t}{let t=window.sessionStorage.getItem(e);if(!t)return null;let{value:r,timestamp:n,ttl:a}=JSON.parse(t);if(a&&Date.now()-n>a)return window.sessionStorage.removeItem(e),o.vF.debug("[appCache] Removed expired value for key: ".concat(e)),null;return o.vF.debug("[appCache] Retrieved value from sessionStorage for key: ".concat(e)),r}}catch(t){return o.vF.error("[appCache] Error getting cache value for key ".concat(e,":"),t),null}}async function i(e){try{if(!e)throw Error("Cache key is required");n?(await n.remove(e),o.vF.debug("[appCache] Removed value for key: ".concat(e))):(window.sessionStorage.removeItem(e),o.vF.debug("[appCache] Removed value from sessionStorage for key: ".concat(e)))}catch(t){throw o.vF.error("[appCache] Error removing cache value for key ".concat(e,":"),t),t}}async function c(){try{n?(await n.clear(),o.vF.debug("[appCache] Cleared all values from AWS App Cache")):(window.sessionStorage.clear(),o.vF.debug("[appCache] Cleared all values from sessionStorage"))}catch(e){throw o.vF.error("[appCache] Error clearing cache:",e),e}}let d=i,l=c,u={setCacheValue:a,getCacheValue:s,removeCacheValue:i,clearCache:c,setAppCacheItem:a,getAppCacheItem:s,removeAppCacheItem:d,clearAppCache:l}},35695:(e,t,r)=>{"use strict";var o=r(18999);r.o(o,"useParams")&&r.d(t,{useParams:function(){return o.useParams}}),r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})},39641:(e,t,r)=>{"use strict";r.d(t,{C:()=>i,p:()=>s});var o=r(62904),n=r(61573);let a=new o.C("CoreStorageUtils"),s=()=>{try{if("undefined"!=typeof window&&window.localStorage)return window.localStorage}catch(e){a.info("localStorage not found. InMemoryStorage is used as a fallback.")}return new n._},i=()=>{try{if("undefined"!=typeof window&&window.sessionStorage)return window.sessionStorage.getItem("test"),window.sessionStorage;throw Error("sessionStorage is not defined")}catch(e){return a.info("sessionStorage not found. InMemoryStorage is used as a fallback."),new n._}}},42749:(e,t,r)=>{"use strict";r.d(t,{vF:()=>s});let o={debug:0,info:1,warn:2,error:3},n="info",a=()=>!1,s={setLevel(e){void 0!==o[e]&&(n=e)},getLevel:()=>n,debug:(e,t)=>{},info:(e,t)=>{o[n]<=o.info&&(a()?void 0!==t?console.info("[SERVER INFO] ".concat(e),t):console.info("[SERVER INFO] ".concat(e)):void 0!==t?console.info(e,t):console.info(e))},warn:(e,t)=>{o[n]<=o.warn&&(a()?void 0!==t?console.warn("[SERVER WARN] ".concat(e),t):console.warn("[SERVER WARN] ".concat(e)):void 0!==t?console.warn(e,t):console.warn(e))},error:(e,t)=>{o[n]<=o.error&&(a()?void 0!==t?console.error("[SERVER ERROR] ".concat(e),t):console.error("[SERVER ERROR] ".concat(e)):void 0!==t?console.error(e,t):console.error(e))}}},47611:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var o=r(95155),n=r(12115),a=r(35695);function s(e){let{message:t="Loading your dashboard..."}=e,s=(0,a.useRouter)(),i=(0,a.usePathname)(),c=(0,a.useSearchParams)(),[d,l]=(0,n.useState)(0),[u,h]=(0,n.useState)(t),[g,w]=(0,n.useState)(null),f=(0,n.useRef)({refreshInProgress:!1,lastRefreshTime:0,recoveryInProgress:!1,lastRecoveryTime:0,redirectInProgress:!1}),m=(0,n.useCallback)(()=>{let e=Date.now()-f.current.lastRefreshTime;return e<15e3&&(console.log("[DashboardLoader] Auth refresh on cooldown (".concat(Math.round(e/1e3),"s elapsed of ").concat(15,"s cooldown)")),!0)},[]),v=(0,n.useCallback)(()=>{let e=Date.now()-f.current.lastRecoveryTime;return e<1e4&&(console.log("[DashboardLoader] Recovery on cooldown (".concat(Math.round(e/1e3),"s elapsed of ").concat(10,"s cooldown)")),!0)},[]),p=(0,n.useCallback)(()=>{var e,t;if(v()||f.current.recoveryInProgress)return void console.log("[DashboardLoader] Recovery already in progress or on cooldown, skipping");f.current.recoveryInProgress=!0,f.current.lastRecoveryTime=Date.now(),console.log("[DashboardLoader] Attempting to recover from network error"),((null==g?void 0:g.type)==="ChunkLoadError"||(null==g||null==(e=g.message)?void 0:e.includes("Loading chunk"))||(null==g||null==(t=g.message)?void 0:t.includes("Failed to fetch")))&&(console.log("[DashboardLoader] Clearing cache for chunk/network error"),"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(e=>{e.forEach(e=>e.unregister())}).catch(e=>{console.error("[DashboardLoader] Error unregistering service workers:",e)}),"caches"in window&&caches.keys().then(e=>{e.forEach(e=>caches.delete(e))}).catch(e=>{console.error("[DashboardLoader] Error clearing cache:",e)})),setTimeout(()=>{let e=new URL(window.location);e.searchParams.set("cb",Date.now()),e.searchParams.set("recovery","true"),window.location.href=e.toString(),setTimeout(()=>{f.current.recoveryInProgress=!1},5e3)},1500)},[g,v]),y=async()=>{if(m()||f.current.refreshInProgress)return console.log("[DashboardLoader] Auth refresh already in progress or on cooldown, skipping"),!1;f.current.refreshInProgress=!0,f.current.lastRefreshTime=Date.now();try{var e,t;console.log("[DashboardLoader] Refreshing auth session");let{fetchAuthSession:o}=await Promise.all([r.e(54940),r.e(9296),r.e(79480),r.e(58430),r.e(84620),r.e(23639),r.e(38501),r.e(31861),r.e(28786)]).then(r.bind(r,55158)),n=await o({forceRefresh:!0});return(null==(e=n.tokens)?void 0:e.accessToken)&&(window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.auth=window.__APP_CACHE.auth||{},window.__APP_CACHE.auth.accessToken=n.tokens.accessToken.toString(),window.__APP_CACHE.auth.idToken=n.tokens.idToken.toString(),window.__APP_CACHE.auth.refreshed=Date.now()),!!(null==(t=n.tokens)?void 0:t.accessToken)}catch(e){return console.error("[DashboardLoader] Error refreshing auth session:",e),!1}finally{f.current.refreshInProgress=!1}},I=async e=>{try{console.log("[DashboardLoader] Setting tenant ID in Cognito via API: ".concat(e));let t=0;window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.tenant=window.__APP_CACHE.tenant||{},window.__APP_CACHE.tenant.id=e;let r=async()=>{try{let t=await fetch("/api/tenant/attribute",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tenantId:e}),timeout:1e4});return t.ok||console.error("[DashboardLoader] Error setting tenant ID in Cognito via API"),t}catch(e){if(t<3)return t++,console.log("[DashboardLoader] Retrying tenant ID set (".concat(t,"/").concat(3,")")),await new Promise(e=>setTimeout(e,1e3*t)),r();throw e}};await r()}catch(e){console.error("[DashboardLoader] Failed to set tenant ID in Cognito:",e)}};return(0,n.useEffect)(()=>{let e=new URLSearchParams(window.location.search);if(e.get("recovery")){console.log("[DashboardLoader] This is a recovery attempt, ensuring clean state"),window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.operations={};let t=e.get("attempt");if(t){let e=parseInt(t,10);if(window.__APP_CACHE.recoveryAttempts=e,e>3){console.log("[DashboardLoader] Multiple recovery attempts detected, trying more aggressive cleanup");try{window.indexedDB&&["amplify-datastore-storage","aws.amplify.storage"].forEach(e=>{try{window.indexedDB.deleteDatabase(e),console.log("[DashboardLoader] Deleted database: "+e)}catch(e){}})}catch(e){}}}}else window.__APP_CACHE&&(window.__APP_CACHE.recoveryAttempts=0);let t=e=>{if(f.current.recoveryInProgress)return;let t=e.message||e.error&&e.error.message||"";t&&(t.includes("ChunkLoadError")||t.includes("Loading chunk")||t.includes("Failed to fetch")||t.includes("NetworkError")||t.includes("Network Error"))&&(console.error("[DashboardLoader] Detected loading error:",t),w({type:t.includes("ChunkLoadError")?"ChunkLoadError":"NetworkError",message:t,timestamp:Date.now()}),h("Error loading dashboard components. Attempting recovery..."),window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.lastError={type:t.includes("ChunkLoadError")?"ChunkLoadError":"NetworkError",message:t,timestamp:Date.now()},(t.includes("ChunkLoadError")||t.includes("NetworkError")||t.includes("Network Error"))&&!v()&&p())};return window.addEventListener("error",t),window.addEventListener("unhandledrejection",e=>{e.reason&&e.reason.message&&t({message:e.reason.message})}),()=>{window.removeEventListener("error",t),window.removeEventListener("unhandledrejection",t)}},[p,v,c]),(0,n.useEffect)(()=>{if(f.current.redirectInProgress)return;let e=e=>{let t=document.querySelector('meta[http-equiv="'.concat(e,'"]'));return t?t.content:null},t="true"===e("x-should-redirect"),r=e("x-redirect-path"),o="true"===e("x-dashboard-error"),n=e("x-tenant-id"),a="true"===e("x-auth-refresh-needed"),c=i.includes("fromAuth=true")||i.includes("direct=true")||i.includes("retry="),u=i.match(/^\/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\//i),h=u?u[1]:null;if(console.log("[DashboardLoader] Redirect info:",{shouldRedirect:t,redirectPath:r,dashboardError:o,tenantIdMeta:n,pathTenantId:h,hasAuthParam:c,attempts:d,currentPath:i,errorDetails:g}),g){let e=setTimeout(()=>{v()||p()},2e3);return()=>clearTimeout(e)}if(!a||f.current.refreshInProgress||m()||y().catch(e=>{console.error("[DashboardLoader] Auth refresh error:",e)}),t&&r&&d<5){f.current.redirectInProgress=!0,l(e=>e+1);let e=Math.min(500*d,2e3);console.log("[DashboardLoader] Redirecting to ".concat(r," in ").concat(e,"ms (attempt ").concat(d+1,")")),setTimeout(()=>{try{s.push(r),setTimeout(()=>{f.current.redirectInProgress=!1},5e3)}catch(e){console.error("[DashboardLoader] Redirect error:",e),f.current.redirectInProgress=!1}},e);return}n&&(window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.tenant=window.__APP_CACHE.tenant||{},window.__APP_CACHE.tenant.id=n,h||I(n).catch(e=>{console.error("[DashboardLoader] Error setting tenant attribute:",e)}))},[i,d,s,g,p,m,v,I]),(0,o.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-gray-100 bg-opacity-70 backdrop-blur-sm",children:(0,o.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md mx-4 text-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mx-auto mb-4"}),(0,o.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:u}),g&&(0,o.jsx)("div",{className:"mt-3 bg-red-50 p-3 rounded-md",children:(0,o.jsx)("p",{className:"text-red-700 text-sm",children:"Error loading dashboard components. Attempting to recover..."})})]})})}},51174:(e,t,r)=>{"use strict";r.d(t,{$_:()=>d,BI:()=>p,FB:()=>y,Nf:()=>f,Pc:()=>u,fy:()=>I,getTenantId:()=>i,getTenantIdFromCognito:()=>w,h_:()=>g,isValidUUID:()=>c,jW:()=>v,oA:()=>l,pm:()=>m,updateTenantIdInCognito:()=>h});var o=r(81746),n=r(24818),a=r(62052);let s="tenantId",i=async()=>{try{var e,t,r,i,c,d;let l=await a.l.getItem(s);if(l)return l;let u=await (0,o.H)(),h=await (0,n.$)(),g=(null==u||null==(e=u.attributes)?void 0:e["custom:tenant_ID"])||(null==u||null==(t=u.attributes)?void 0:t["custom:tenantId"])||(null==h||null==(i=h.accessToken)||null==(r=i.payload)?void 0:r["custom:tenant_ID"])||(null==h||null==(d=h.accessToken)||null==(c=d.payload)?void 0:c["custom:tenantId"]);if(!g)throw Error("Tenant ID not found in user attributes or session");return await a.l.setItem(s,g),g}catch(e){throw console.error("Error getting tenant ID:",e),e}},c=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),d=async e=>{try{await a.l.setItem(s,e)}catch(e){throw console.error("Error storing tenant ID:",e),e}},l=async e=>{let{tenantId:t,metadata:r={}}=e;try{if(!t)return void console.error("Cannot store tenant info: No tenant ID provided");await a.l.setItem(s,t),window.__APP_CACHE||(window.__APP_CACHE={}),window.__APP_CACHE.tenant||(window.__APP_CACHE.tenant={}),window.__APP_CACHE.tenant.id=t,window.__APP_CACHE.tenant.metadata=r,window.__APP_CACHE.tenant.timestamp=Date.now();try{sessionStorage.setItem("tenant_id",t),sessionStorage.setItem("tenant_info",JSON.stringify({id:t,metadata:r,timestamp:Date.now()}))}catch(e){console.debug("Could not store tenant info in sessionStorage:",e)}console.debug("[TenantUtils] Stored tenant info for ID: ".concat(t))}catch(e){console.error("Error storing tenant info:",e)}},u=e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e,h=async e=>{try{let{updateUserAttributes:t}=await Promise.all([r.e(58430),r.e(84620),r.e(23639),r.e(38501),r.e(31861),r.e(94901)]).then(r.bind(r,55158));await t({userAttributes:{"custom:tenant_ID":e}}),await d(e),console.debug("[TenantUtils] Updated tenant ID in Cognito: ".concat(e))}catch(t){console.error("Error updating tenant ID in Cognito:",t),await d(e)}},g=async e=>{try{await a.l.setItem("auth_tokens",e)}catch(e){throw console.error("Error setting tokens:",e),e}},w=async()=>{try{var e,t,r,i,c,d;let l=await a.l.getItem(s);if(l)return l;let u=await (0,o.H)(),h=await (0,n.$)(),g=(null==u||null==(e=u.attributes)?void 0:e["custom:tenant_ID"])||(null==u||null==(t=u.attributes)?void 0:t["custom:tenantId"])||(null==h||null==(i=h.accessToken)||null==(r=i.payload)?void 0:r["custom:tenant_ID"])||(null==h||null==(d=h.accessToken)||null==(c=d.payload)?void 0:c["custom:tenantId"]);if(!g)return null;return await a.l.setItem(s,g),g}catch(e){return console.error("Error getting tenant ID from Cognito:",e),null}},f=async e=>{try{if(!c(e))return!1;return(await fetch("/api/tenants/".concat(e,"/validate"))).ok}catch(e){return console.error("Error validating tenant ID:",e),!1}},m=e=>{let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return"00000000-0000-4000-a000-".concat(Math.abs(t).toString(16).padStart(12,"0"))},v=async()=>{try{let e=await i();if(!c(e))return console.error("Invalid tenant ID format:",e),null;return e}catch(e){return console.error("Error getting secure tenant ID:",e),null}},p=e=>c(e),y=e=>e?"tenant_".concat(e.replace(/-/g,"_")):"public",I=async()=>{try{let e=await i(),t={"Content-Type":"application/json","x-tenant-id":e};try{let{getCurrentUser:e}=await Promise.all([r.e(58430),r.e(84620),r.e(23639),r.e(38501),r.e(31861),r.e(94901)]).then(r.bind(r,55158)),o=await e();o&&o.userId&&(t["x-user-id"]=o.userId)}catch(e){}return t}catch(e){return console.error("Error getting tenant headers:",e),{"Content-Type":"application/json"}}}},57762:(e,t,r)=>{"use strict";r.d(t,{$:()=>o});let o=(e,t)=>e.Auth.fetchAuthSession(t)},58112:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var o=r(95155),n=r(12115),a=r(35695),s=r(47611),i=r(15827),c=r(51174);let d=r(42749).vF;function l(){let e=(0,a.useSearchParams)(),t=(0,a.useRouter)(),l=e.get("tenantId")||null,u="true"===e.get("fromSignIn"),h="true"===e.get("fromAuth"),g="true"===e.get("reset");console.info("Dashboard: tenantId=".concat(l,", fromSignIn=").concat(u));let w="",f="Loading your dashboard...",[m,v]=(0,n.useState)(!0),[p,y]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{(async()=>{if(!p){v(!0);try{d.debug("[Dashboard] Initializing dashboard");let e=new URLSearchParams(window.location.search).get("temp_tenant");if(e){d.info("[Dashboard] Found temporary tenant ID in URL:",e);let{isValidUUID:o}=await Promise.resolve().then(r.bind(r,51174));if(o(e)){d.info("[Dashboard] Temporary tenant ID is valid UUID format:",e),await (0,c.updateTenantIdInCognito)(e),t.push("/".concat(e,"/dashboard"));return}d.warn("[Dashboard] Temporary tenant ID is not valid UUID format:",e);try{let{fetchUserAttributes:o}=await Promise.all([r.e(58430),r.e(84620),r.e(23639),r.e(38501),r.e(31861),r.e(94901)]).then(r.bind(r,55158)),n=await o(),a=await fetch("/api/tenant/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tempTenantId:e,businessName:n["custom:businessname"]||"",businessType:n["custom:businesstype"]||"Other"})});if(a.ok){let e=await a.json();if(e.success&&e.tenantId){await (0,c.updateTenantIdInCognito)(e.tenantId),d.info("[Dashboard] Created permanent tenant, redirecting:",e.tenantId),t.push("/".concat(e.tenantId,"/dashboard"));return}}}catch(e){d.error("[Dashboard] Error creating permanent tenant:",e)}}if(g)return(0,o.jsxs)("div",{children:[(0,o.jsx)(i.default,{}),(0,o.jsx)(s.A,{message:"Resetting navigation..."}),(0,o.jsx)("meta",{httpEquiv:"x-reset-navigation",content:"true"}),(0,o.jsx)("meta",{httpEquiv:"x-tenant-id",content:l||""})]});if(l){let e=new URLSearchParams({fromSignIn:"true",direct:"true"}).toString();w="/".concat(l,"/dashboard?").concat(e),f="Loading your dashboard..."}else u||h?(w="/dashboard?fromSignIn=true",f="Setting up your dashboard..."):(w="/auth/signin?error=no_tenant_id",f="Redirecting to sign in...")}catch(e){d.error("[Dashboard] Initialization error:",e)}finally{v(!1),y(!0)}}})()},[t,g,l,u,h]),(0,o.jsxs)("div",{children:[(0,o.jsx)(i.default,{}),(0,o.jsx)(s.A,{message:f}),(0,o.jsx)("meta",{httpEquiv:"x-should-redirect",content:"true"}),(0,o.jsx)("meta",{httpEquiv:"x-redirect-path",content:w}),l&&(0,o.jsx)("meta",{httpEquiv:"x-tenant-id",content:l})]})}},61573:(e,t,r)=>{"use strict";r.d(t,{_:()=>o});class o{constructor(){this.storage=new Map}get length(){return this.storage.size}key(e){return e>this.length-1?null:Array.from(this.storage.keys())[e]}setItem(e,t){this.storage.set(e,t)}getItem(e){return this.storage.get(e)??null}removeItem(e){this.storage.delete(e)}clear(){this.storage.clear()}}},81746:(e,t,r)=>{"use strict";r.d(t,{H:()=>a});var o=r(87970),n=r(19002);let a=async()=>(0,n.H)(o.H)},94225:(e,t,r)=>{"use strict";r.d(t,{U:()=>n});var o=r(95730);class n{constructor(e){this.storage=e}async setItem(e,t){if(!this.storage)throw new o.h;this.storage.setItem(e,t)}async getItem(e){if(!this.storage)throw new o.h;return this.storage.getItem(e)}async removeItem(e){if(!this.storage)throw new o.h;this.storage.removeItem(e)}async clear(){if(!this.storage)throw new o.h;this.storage.clear()}}},94420:(e,t,r)=>{Promise.resolve().then(r.bind(r,58112))},95730:(e,t,r)=>{"use strict";r.d(t,{h:()=>a});var o=r(31241),n=r(65206);class a extends n.x{constructor(){super({name:o.m.PlatformNotSupported,message:"Function not supported on current platform"})}}}},e=>{var t=t=>e(e.s=t);e.O(0,[54940,9296,79480,62052,28441,31684,77358],()=>t(94420)),_N_E=e.O()}]);