(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[78931],{68143:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>S,fetch:()=>d,fetchData:()=>h,getAuthTokens:()=>C,getCurrentTenant:()=>P,getRequestTenantHeaders:()=>f,handleApiError:()=>l,logout:()=>E,post:()=>g,postData:()=>v,put:()=>w,putData:()=>p,setTenantId:()=>A,verifyTenantContext:()=>_});var a=n(55166),r=n(29729),i=n(42749),o=n(47856),s=n(75335),c=n(51174);let l=function(e){var t,n,a,r,s,c;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{fallbackData:u=null,showNotification:h=!0,rethrow:d=!1,customMessage:v=null}=l,g={url:null==(t=e.config)?void 0:t.url,method:null==(n=e.config)?void 0:n.method,status:null==(a=e.response)?void 0:a.status,statusText:null==(r=e.response)?void 0:r.statusText,message:e.message,tenantContext:(0,o.E6)()};(null==(s=e.response)?void 0:s.data)&&(g.responseData=e.response.data),i.vF.error("[ApiService] Request failed:",g);let p=v||"An error occurred while processing your request.";if("ECONNABORTED"===e.code||(null==(c=e.message)?void 0:c.includes("timeout"))?p=v||"Request timed out. The server is taking too long to respond.":e.response?401===e.response.status||403===e.response.status?p=v||"Authentication error. Please login again.":404===e.response.status?p=v||"Resource not found.":e.response.status>=500&&(p=v||"Server error. Please try again later."):e.request&&(p=v||"No response received from server. Please check your connection."),h&&i.vF.warn(p),null!==u)return u;if(d)throw e;return null},u=e=>e.includes(".")||e.includes("download")||e.includes("print")||e.endsWith("/")?e:"".concat(e,"/"),h=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{useCache:n=!0,cacheTTL:c=null,params:h={},headers:d={},fallbackData:v=null,showErrorNotification:g=!0,timeout:p=3e4,forceRefresh:w=!1,tenantOverride:_=null,customMessage:A,notify:P=!0,skipAuthCheck:C=!1,maxRetries:E=2,enableRetry:S=!0}=t;try{let t=u(e);if(i.vF.debug("[ApiService] Fetching ".concat(t),{useCache:n,forceRefresh:w,tenantOverride:_?"custom":"default"}),n&&!w){let e=s.$.get(t,h);if(e)return i.vF.debug("[ApiService] Cache hit for ".concat(t)),e;i.vF.debug("[ApiService] Cache miss for ".concat(t))}let l=_?{"X-Tenant-ID":_}:f(),v=await r.SP.get(t,{params:h,headers:(0,a._)({},l,d),timeout:p});return(0,o.J_)(v),n&&v.data&&s.$.set(t,h,v.data,c),v.data}catch(e){return l(e,{fallbackData:v,showNotification:g,rethrow:!1,customMessage:A})}},d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(e,t)},v=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{headers:c={},fallbackData:h=null,showErrorNotification:d=!0,invalidateCache:v=!0,timeout:g=3e4,tenantOverride:p=null,customMessage:w,maxRetries:_=1,enableRetry:A=!1}=n;try{let n,l=u(e);i.vF.debug("[ApiService] Posting to ".concat(l));let h=p?{"X-Tenant-ID":p}:f(),d={headers:(0,a._)({},h,c),timeout:g};return n=A&&_>0?await (0,r.qN)(()=>r.SP.post(l,t,d),_):await r.SP.post(l,t,d),(0,o.J_)(n),v&&s.$.invalidateStartingWith(l),n.data}catch(e){return l(e,{fallbackData:h,showNotification:d,rethrow:!1,customMessage:w})}},g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return v(e,t,n)},p=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{headers:c={},fallbackData:h=null,showErrorNotification:d=!0,invalidateCache:v=!0,timeout:g=3e4,tenantOverride:p=null,customMessage:w}=n;try{let n=u(e);i.vF.debug("[ApiService] Putting to ".concat(n));let l=p?{"X-Tenant-ID":p}:f(),h=await r.SP.put(n,t,{headers:(0,a._)({},l,c),timeout:g});return(0,o.J_)(h),v&&s.$.invalidateStartingWith(n),h.data}catch(e){return l(e,{fallbackData:h,showNotification:d,rethrow:!1,customMessage:w})}},w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return p(e,t,n)},_=async()=>{let e=(0,o.E6)();if(e&&e.tenantId)return i.vF.debug("[ApiService] Tenant context verified: ".concat(e.tenantId)),!0;let t=(0,c.getTenantId)();return t?(i.vF.debug("[ApiService] Setting tenant ID from saved preferences: ".concat(t)),await A(t),!0):(i.vF.warn("[ApiService] No tenant context available"),!1)},A=async e=>{if(!e)return void i.vF.warn("[ApiService] Attempted to set empty tenant ID");(0,o.ed)({tenantId:e,schemaName:(0,c.FB)(e)}),i.vF.debug("[ApiService] Tenant ID set: ".concat(e))},f=()=>({}),P=async()=>{try{return(await r.SP.get("/api/tenant/current/")).data}catch(e){return i.vF.error("[ApiService] Error getting current tenant:",e),null}},C=async()=>{try{{window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.auth=window.__APP_CACHE.auth||{};let{accessToken:e,idToken:t}=window.__APP_CACHE.auth;if(e&&t)return{accessToken:e,idToken:t}}return null}catch(e){return i.vF.error("[ApiService] Error getting auth tokens:",e),null}},E=async()=>{try{await r.SP.post("/api/auth/logout/"),window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.auth=window.__APP_CACHE.auth||{},window.__APP_CACHE.auth.accessToken=null,window.__APP_CACHE.auth.idToken=null,window.__APP_CACHE.auth.refreshToken=null}catch(e){throw i.vF.error("[ApiService] Error logging out:",e),e}},S={handleApiError:l,fetchData:h,fetch:d,postData:v,post:g,putData:p,put:w,verifyTenantContext:_,setTenantId:A,getRequestTenantHeaders:f,getCurrentTenant:P,getAuthTokens:C,logout:E}},69418:(e,t,n)=>{Promise.resolve().then(n.bind(n,68143))},75335:(e,t,n)=>{"use strict";n.d(t,{$:()=>i,d:()=>o});var a=n(42749);class r{set(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e4;if(e&&(this.cache.set(e,t),n>0)){let t=Date.now()+n;this.expirations.set(e,t),setTimeout(()=>{this.expirations.get(e)<=Date.now()&&(this.cache.delete(e),this.expirations.delete(e))},n)}}get(e){if(e&&this.cache.has(e)){let t=this.expirations.get(e);if(t&&t<=Date.now()){this.cache.delete(e),this.expirations.delete(e);return}return this.cache.get(e)}}has(e){if(!e||!this.cache.has(e))return!1;let t=this.expirations.get(e);return!(t&&t<=Date.now())||(this.cache.delete(e),this.expirations.delete(e),!1)}delete(e){e&&(this.cache.delete(e),this.expirations.delete(e))}clear(){this.cache.clear(),this.expirations.clear()}invalidatePattern(e){let t=e instanceof RegExp?e:new RegExp(e);for(let e of this.cache.keys())t.test(e)&&(a.vF.debug("[DataCache] Invalidating cached key matching pattern: ".concat(e)),this.delete(e))}constructor(){this.cache=new Map,this.expirations=new Map}}let i=new r,o=new r}},e=>{var t=t=>e(e.s=t);e.O(0,[54940,9296,79480,20171,79189,62052,84439,29729,47856,28441,31684,77358],()=>t(69418)),_N_E=e.O()}]);