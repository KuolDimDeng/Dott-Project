"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[51221],{51221:(e,a,n)=>{n.r(a),n.d(a,{default:()=>c});var s=n(55166),t=n(68387),l=n(95155),o=n(12115),r=n(58799),i=n(29729);let c=e=>{let{preferredProvider:a=null,businessCountry:n=null,autoConnect:c=!1}=e,[d,u]=(0,o.useState)(""),[h,m]=(0,o.useState)(""),[b,x]=(0,o.useState)(""),[p,g]=(0,o.useState)(!1),[f,k]=(0,o.useState)(null),[v,y]=(0,o.useState)(null),[j,w]=(0,o.useState)({open:!1,message:"",severity:"info"}),[N,_]=(0,o.useState)(null);(0,o.useEffect)(()=>{a&&("plaid"===a?n&&["GB","DE","FR","IT","ES","NL","BE","AT","CH","SE","DK","NO","FI","PT","IE","GR","PL","CZ","HU","RO"].includes(n)?u("Europe"):u("America"):"paystack"===a?(u("Africa"),m("Mobile Money")):"dlocal"===a&&u("South America"),c&&setTimeout(()=>{B()},100))},[a,n,c]);let A=e=>{m(e.target.value),x("")},S=e=>{if(a)return a;switch(e){case"America":case"Europe":return"plaid";case"Africa":return"Mobile Money"===h?"africas_talking":b;case"South America":return"dlocal";case"Asia":return"salt_edge";default:return"unknown"}},B=async()=>{if(a&&d){g(!0),k(null);try{let e=S(d);console.log("Auto-connecting to bank with provider: ".concat(e,", region: ").concat(d));let a={region:d,provider:e};"Africa"===d&&(a.sub_option=h,"Banks"===h&&(a.bank_provider=b)),n&&(a.country_code=n);let s=await i.SP.post("/api/banking/create_link_token/",a);if(s.data.link_token)y(s.data.link_token);else if(s.data.auth_url)window.location.href=s.data.auth_url;else throw Error("Invalid response from server")}catch(e){console.error("Error auto-connecting to bank:",e),k("Failed to initialize bank connection. Please try again."),w({open:!0,message:"Failed to connect bank",severity:"error"})}finally{g(!1)}}},E=async()=>{g(!0),k(null);let e=S(d);try{let a={region:d,provider:e};"Africa"===d&&(a.sub_option=h,"Banks"===h&&(a.bank_provider=b)),n&&(a.country_code=n);let s=await i.SP.post("/api/banking/create_link_token/",a);if(s.data.link_token)y(s.data.link_token);else if(s.data.auth_url)window.location.href=s.data.auth_url;else throw Error("Invalid response from server")}catch(e){console.error("Error creating link token:",e),k("Failed to initialize bank connection. Please try again."),w({open:!0,message:"Failed to connect bank",severity:"error"})}finally{g(!1)}},{open:C,ready:M}=(0,r.usePlaidLink)({token:v,onSuccess:(e,a)=>{console.log("Bank connection successful"),P(e)},onExit:(e,a)=>{console.log("Plaid Link exited",e,a),e&&w({open:!0,message:"Failed to connect bank",severity:"error"})},onEvent:(e,a)=>{console.log("Plaid Link event",e,a)}});(0,o.useEffect)(()=>{v&&M&&C()},[v,M,C]);let P=async e=>{try{let a=await i.SP.post("/api/banking/exchange_token/",{public_token:e});if(a.data.success)_(a.data.bank_info),w({open:!0,message:"Bank connected successfully",severity:"success"});else throw Error("Failed to exchange token")}catch(e){console.error("Error exchanging token:",e),w({open:!0,message:"Failed to connect bank. Please try again.",severity:"error"})}};return c&&p&&!N?(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Connecting to Your Bank"}),(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center py-10",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"We're setting up your bank connection based on your business location. Please wait a moment..."})]})]}):(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Connect Your Bank"}),N?(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-blue-600 mb-2",children:"Successfully Connected!"}),(0,l.jsxs)("p",{className:"mb-4",children:["You are now connected to ",N.institution_name,"."]}),(0,l.jsx)("ul",{className:"divide-y divide-gray-200",children:N.accounts.map((e,a)=>(0,l.jsxs)("li",{className:"py-3",children:[(0,l.jsxs)("div",{className:"font-medium",children:["Account: ",e.name]}),(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:["Type: ",e.type,", Balance: $",e.balances.current.toFixed(2)]})]},a))}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mt-4",children:"You can now view your transactions and account details in the Banking Dashboard."}),(0,l.jsx)("a",{href:"/dashboard/banking",className:"mt-4 w-full block py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white text-center rounded-md",children:"Go to Banking Dashboard"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"mb-4",children:"Please choose the region where your bank is located. This helps us provide you with the most appropriate connection method for your bank."}),a&&n?(0,l.jsx)("div",{className:"mb-4 p-3 bg-blue-50 text-blue-800 rounded-md",children:(0,l.jsxs)("span",{className:"font-medium",children:["Based on your business location (",n,"), we've selected the best connection method for you."]})}):null,(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Your Region"}),(0,l.jsxs)("select",{value:d,onChange:e=>{u(e.target.value),m(""),x("")},className:"w-full p-2 border border-gray-300 rounded-md bg-white focus:ring-blue-500 focus:border-blue-500",children:[(0,l.jsx)("option",{value:"",disabled:!0,children:"Select a region"}),(0,l.jsx)("option",{value:"America",children:"America"}),(0,l.jsx)("option",{value:"Europe",children:"Europe"}),(0,l.jsx)("option",{value:"Africa",children:"Africa"}),(0,l.jsx)("option",{value:"South America",children:"South America"}),(0,l.jsx)("option",{value:"Asia",children:"Asia"})]})]}),"Africa"===d&&(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsxs)("fieldset",{children:[(0,l.jsx)("legend",{className:"text-sm font-medium text-gray-700 mb-2",children:"Choose a connection method"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("label",{className:"inline-flex items-center",children:[(0,l.jsx)("input",{type:"radio",value:"Mobile Money",checked:"Mobile Money"===h,onChange:A,className:"h-4 w-4 text-blue-600 focus:ring-blue-500"}),(0,l.jsx)("span",{className:"ml-2",children:"Mobile Money"})]}),(0,l.jsx)("div",{children:(0,l.jsxs)("label",{className:"inline-flex items-center",children:[(0,l.jsx)("input",{type:"radio",value:"Banks",checked:"Banks"===h,onChange:A,className:"h-4 w-4 text-blue-600 focus:ring-blue-500"}),(0,l.jsx)("span",{className:"ml-2",children:"Traditional Banks"})]})})]})]})}),"Africa"===d&&"Banks"===h&&(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Bank Provider"}),(0,l.jsxs)("select",{value:b,onChange:e=>{x(e.target.value)},className:"w-full p-2 border border-gray-300 rounded-md bg-white focus:ring-blue-500 focus:border-blue-500",children:[(0,l.jsx)("option",{value:"",disabled:!0,children:"Select a provider"}),(0,l.jsx)("option",{value:"Mono",children:"Mono"}),(0,l.jsx)("option",{value:"Stitch",children:"Stitch"})]})]}),(0,l.jsx)("button",{className:"w-full py-2 px-4 rounded-md ".concat(d&&("Africa"!==d||h&&("Banks"!==h||b))&&!p?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-300 cursor-not-allowed"),onClick:E,disabled:!d||"Africa"===d&&(!h||"Banks"===h&&!b)||p,children:p?(0,l.jsxs)("svg",{className:"animate-spin h-5 w-5 mx-auto text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):"Connect"})]}),f&&(0,l.jsx)("p",{className:"mt-4 text-red-600",children:f}),j.open&&(0,l.jsx)("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50",children:(0,l.jsx)("div",{className:"p-3 rounded-md shadow-lg ".concat("success"===j.severity?"bg-green-50 text-green-800 border border-green-200":"error"===j.severity?"bg-red-50 text-red-800 border border-red-200":"bg-blue-50 text-blue-800 border border-blue-200"),children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("span",{children:j.message}),(0,l.jsxs)("button",{onClick:(e,a)=>{"clickaway"!==a&&w((0,t._)((0,s._)({},j),{open:!1}))},className:"ml-3 text-gray-400 hover:text-gray-500 focus:outline-none",children:[(0,l.jsx)("span",{className:"sr-only",children:"Close"}),(0,l.jsx)("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]})})})]})}}}]);