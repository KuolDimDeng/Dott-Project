"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[65045],{65045:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var a=s(55166),r=s(68387),i=s(95155),l=s(12115),n=s(29729),d=s(29670),o=s(60005),c=s(66352),m=s(42749),x=s(99783);let u=()=>{let e=e=>c.oR.success(e),t=e=>c.oR.error(e),s=e=>c.oR.loading(e),u=e=>c.oR.error(e,{icon:"⚠️"}),[p,h]=(0,l.useState)(0),[f,g]=(0,l.useState)(""),[y,b]=(0,l.useState)([]),[j,w]=(0,l.useState)([]),[N,v]=(0,l.useState)(null),[_,k]=(0,l.useState)(!1),[S,C]=(0,l.useState)([]),[A,T]=(0,l.useState)(!1),[E,F]=(0,l.useState)(null),[D,L]=(0,l.useState)(!0),M=(0,l.useCallback)(()=>{try{return(0,d.gd)("tenantId")||(0,d.gd)("businessid")||"default"}catch(e){return console.error("Error accessing AppCache for tenantId:",e),"default"}},[]),[R,P]=(0,l.useState)(M()),[z,H]=(0,l.useState)({form_type:"W4",tax_year:new Date().getFullYear(),filing_status:"single",allowances:0,additional_withholding:0,exemptions:!1,state_code:"NY",employee_id:"",is_submitted:!1,effective_date:new Date}),[U,B]=(0,l.useState)(null),I=l.useRef(null),J=l.useRef(null);(0,l.useEffect)(()=>()=>{L(!1),I.current&&clearTimeout(I.current),J.current&&clearTimeout(J.current)},[]),(0,l.useEffect)(()=>{O()},[f]),(0,l.useEffect)(()=>{if(y.length>0){let e=f.toLowerCase().trim();e?w(y.filter(t=>t.first_name&&t.first_name.toLowerCase().includes(e)||t.last_name&&t.last_name.toLowerCase().includes(e)||t.email&&t.email.toLowerCase().includes(e)||t.department&&t.department.toLowerCase().includes(e)||t.job_title&&t.job_title.toLowerCase().includes(e))):w(y)}else w([])},[y,f]);let O=async()=>{I.current&&clearTimeout(I.current),I.current=setTimeout(async()=>{if(D){T(!0),F(null);try{let e=M();if(!e){F("Unable to determine your organization ID. Please try refreshing the page."),T(!1);return}let t=await x.Ay.get("/api/hr/employees",{params:{q:f,tenant_id:e}});if(!D)return;t&&t.data?Array.isArray(t.data)?b(t.data):t.data.employees&&Array.isArray(t.data.employees)?b(t.data.employees):b([]):b([])}catch(e){if(m.vF.error("[EmployeeTaxManagement] Error fetching employees:",e),!D)return;if(401===e.status||e.message&&e.message.includes("Authentication"))try{await (0,o.refreshUserSession)(),s("Refreshing your session..."),O()}catch(e){F("Authentication error. Please refresh the page and log in again.")}else F("Failed to load employees. Please try again.");b([])}finally{D&&T(!1)}}},500)},V=async e=>{if(!e)return void t("No employee selected");J.current&&clearTimeout(J.current),J.current=setTimeout(async()=>{if(D){T(!0),F(null);try{let t=M(),s=await x.Ay.get("/api/taxes/forms/employee/".concat(e),{params:{tenant_id:t}});if(!D)return;s&&s.data?Array.isArray(s.data)?C(s.data):s.data.forms&&Array.isArray(s.data.forms)?C(s.data.forms):C([]):C([])}catch(t){if(m.vF.error("[EmployeeTaxManagement] Error fetching tax forms:",t),!D)return;if(401===t.status||t.message&&t.message.includes("Authentication"))try{await (0,o.refreshUserSession)(),V(e)}catch(e){F("Authentication error. Please refresh the page and log in again.")}else F("Failed to load tax forms. Please try again.");C([])}finally{D&&T(!1)}}},300)},W=()=>{O()},Y=e=>{v(e),V(e.id),h(1)},q=()=>{if(!N)return void u("Please select an employee first");H((0,r._)((0,a._)({},z),{employee_id:N.id})),k(!0)},G=()=>{k(!1)},K=async()=>{if(Q()){T(!0);try{let t=new FormData;Object.keys(z).forEach(e=>{"effective_date"===e?t.append(e,new Date(z[e]).toISOString().split("T")[0]):t.append(e,z[e])}),U&&t.append("file",U),await n.SP.post("/api/taxes/forms/",t,{headers:{"Content-Type":"multipart/form-data"}}),e("Tax form successfully submitted"),V(N.id),G()}catch(e){console.error("Error submitting tax form:",e),t("Failed to submit tax form")}finally{T(!1)}}},Q=()=>z.form_type&&z.tax_year&&z.filing_status?!!U||!z.is_submitted||(u("Please upload a form file for submitted forms"),!1):(u("Please fill in all required fields"),!1),X=async s=>{if(window.confirm("Are you sure you want to delete this tax form?")){T(!0);try{await n.SP.delete("/api/taxes/forms/".concat(s,"/")),e("Tax form successfully deleted"),V(N.id)}catch(e){console.error("Error deleting tax form:",e),t("Failed to delete tax form")}finally{T(!1)}}},Z=async e=>{try{let t=await n.SP.get("/api/taxes/forms/".concat(e,"/download/"),{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([t.data])),a=document.createElement("a");a.href=s,a.setAttribute("download","tax_form_".concat(e,".pdf")),document.body.appendChild(a),a.click(),a.parentNode.removeChild(a),window.URL.revokeObjectURL(s)}catch(e){console.error("Error downloading tax form:",e),t("Failed to download tax form")}};return(0,i.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[0===p?(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-semibold mb-2",children:"Employee Tax Management"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Select an employee to manage their tax forms and information."})]}),(0,i.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:(0,i.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,i.jsx)("div",{className:"flex-grow",children:(0,i.jsx)("input",{type:"text",placeholder:"Search employees by name, email, or department...",value:f,onChange:e=>{g(e.target.value)},className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyPress:e=>"Enter"===e.key&&W()})}),(0,i.jsx)("button",{onClick:W,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Search"})]})}),A?(0,i.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):E?(0,i.jsxs)("div",{className:"bg-red-50 text-red-700 p-4 rounded-lg mb-4",children:[(0,i.jsx)("p",{className:"font-medium",children:"Error"}),(0,i.jsx)("p",{children:E}),(0,i.jsx)("button",{onClick:O,className:"mt-2 px-4 py-1 bg-red-100 text-red-800 rounded hover:bg-red-200",children:"Try Again"})]}):0===j.length?(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",strokeWidth:"1.5",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"})}),(0,i.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No employees found"}),(0,i.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:f.trim()?'No results match "'.concat(f,'"'):"Get started by adding employees to your organization."})]}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,i.jsx)("thead",{className:"bg-gray-50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employee ID"}),(0,i.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),(0,i.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Department"}),(0,i.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Job Title"}),(0,i.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,i.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,i.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(e=>{var t,s;return(0,i.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.employee_number||e.id.substring(0,8)}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,i.jsxs)("div",{className:"h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-medium",children:[null==(t=e.first_name)?void 0:t[0],null==(s=e.last_name)?void 0:s[0]]})}),(0,i.jsx)("div",{className:"ml-4",children:(0,i.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.first_name," ",e.last_name]})})]})}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.department||"N/A"}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.job_title||"N/A"}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.email}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,i.jsx)("button",{onClick:()=>Y(e),className:"text-blue-600 hover:text-blue-900",children:"Manage Tax Forms"})})]},e.id)})})]})})]}):(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,i.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,i.jsxs)("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[(0,i.jsxs)("h1",{className:"text-2xl font-semibold",children:["Tax Forms for ",N?"".concat(N.first_name," ").concat(N.last_name):""]}),(0,i.jsxs)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center space-x-2",onClick:q,children:[(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),(0,i.jsx)("span",{children:"Add Tax Form"})]})]})}),(0,i.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Employee ID"}),(0,i.jsx)("p",{className:"mt-1",children:(null==N?void 0:N.employee_number)||(null==N?void 0:N.id.substring(0,8))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Department"}),(0,i.jsx)("p",{className:"mt-1",children:(null==N?void 0:N.department)||"Not assigned"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Job Title"}),(0,i.jsx)("p",{className:"mt-1",children:(null==N?void 0:N.job_title)||"Not assigned"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Email"}),(0,i.jsx)("p",{className:"mt-1",children:null==N?void 0:N.email})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Tax Filing Status"}),(0,i.jsx)("p",{className:"mt-1",children:(null==N?void 0:N.tax_filing_status)==="S"?"Single":(null==N?void 0:N.tax_filing_status)==="M"?"Married Filing Jointly":(null==N?void 0:N.tax_filing_status)==="H"?"Head of Household":"Not Specified"})]})]})}),(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsx)("h2",{className:"text-lg font-medium mb-4",children:"Tax Forms"}),A?(0,i.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):E?(0,i.jsxs)("div",{className:"bg-red-50 text-red-700 p-4 rounded-lg mb-4",children:[(0,i.jsx)("p",{className:"font-medium",children:"Error"}),(0,i.jsx)("p",{children:E}),(0,i.jsx)("button",{onClick:()=>V(N.id),className:"mt-2 px-4 py-1 bg-red-100 text-red-800 rounded hover:bg-red-200",children:"Try Again"})]}):0===S.length?(0,i.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,i.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,i.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No tax forms"}),(0,i.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"No tax forms have been added for this employee yet."}),(0,i.jsx)("div",{className:"mt-6",children:(0,i.jsxs)("button",{type:"button",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:q,children:[(0,i.jsx)("svg",{className:"-ml-1 mr-2 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})}),"Add a Tax Form"]})})]}):(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,i.jsx)("thead",{className:"bg-gray-50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Form Type"}),(0,i.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tax Year"}),(0,i.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Filing Status"}),(0,i.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"State"}),(0,i.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Submission Date"}),(0,i.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,i.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,i.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.form_type}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.tax_year}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:"single"===e.filing_status?"Single":"married_joint"===e.filing_status?"Married Filing Jointly":"married_separate"===e.filing_status?"Married Filing Separately":"head_household"===e.filing_status?"Head of Household":e.filing_status}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.state_code||"Federal"}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.submission_date?new Date(e.submission_date).toLocaleDateString():"N/A"}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,i.jsx)("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(e.is_submitted?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.is_submitted?"Submitted":"Draft"})}),(0,i.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,i.jsxs)("div",{className:"flex space-x-2",children:[(0,i.jsx)("button",{className:"text-indigo-600 hover:text-indigo-900",onClick:()=>console.log("Edit form",e.id),children:"Edit"}),e.is_submitted&&(0,i.jsx)("button",{className:"text-blue-600 hover:text-blue-900",onClick:()=>Z(e.id),children:"Download"}),(0,i.jsx)("button",{className:"text-red-600 hover:text-red-900",onClick:()=>X(e.id),children:"Delete"})]})})]},e.id))})]})}),(0,i.jsx)("div",{className:"mt-6 flex justify-end",children:(0,i.jsx)("button",{className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50",onClick:()=>h(0),children:"Back to Employee Search"})})]})]}),_&&(0,i.jsx)("div",{className:"fixed inset-0 overflow-y-auto z-50",children:(0,i.jsxs)("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,i.jsx)("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:(0,i.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),(0,i.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),(0,i.jsxs)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[(0,i.jsx)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:(0,i.jsx)("div",{className:"sm:flex sm:items-start",children:(0,i.jsxs)("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full",children:[(0,i.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4",children:"Add New Tax Form"}),(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)("form",{className:"space-y-4"})})]})})}),(0,i.jsxs)("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[(0,i.jsx)("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:K,disabled:A,children:A?(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"animate-spin h-4 w-4 mr-2 border-b-2 border-white rounded-full"}),"Submitting..."]}):"Submit"}),(0,i.jsx)("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:G,children:"Cancel"})]})]})]})})]})}}}]);