"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[44367],{29670:(e,r,t)=>{t.d(r,{$R:()=>c,A6:()=>i,Ay:()=>d,IL:()=>u,bB:()=>l,gd:()=>a,mm:()=>o});var n=t(42749);let s=null;try{window.AWSCache&&(s=window.AWSCache,n.vF.debug("[appCache] AWS App Cache initialized successfully"))}catch(e){n.vF.warn("[appCache] Failed to initialize AWS App Cache:",e)}async function o(e,r,t){try{if(!e)throw Error("Cache key is required");if(s)await s.set(e,r,t),n.vF.debug("[appCache] Set value for key: ".concat(e));else{let s={value:r,timestamp:Date.now(),ttl:t?1e3*t:null};window.sessionStorage.setItem(e,JSON.stringify(s)),n.vF.debug("[appCache] Set value in sessionStorage for key: ".concat(e))}}catch(r){throw n.vF.error("[appCache] Error setting cache value for key ".concat(e,":"),r),r}}async function a(e){try{if(!e)throw Error("Cache key is required");if(s){let r=await s.get(e);return n.vF.debug("[appCache] Retrieved value for key: ".concat(e)),r}{let r=window.sessionStorage.getItem(e);if(!r)return null;let{value:t,timestamp:s,ttl:o}=JSON.parse(r);if(o&&Date.now()-s>o)return window.sessionStorage.removeItem(e),n.vF.debug("[appCache] Removed expired value for key: ".concat(e)),null;return n.vF.debug("[appCache] Retrieved value from sessionStorage for key: ".concat(e)),t}}catch(r){return n.vF.error("[appCache] Error getting cache value for key ".concat(e,":"),r),null}}async function i(e){try{if(!e)throw Error("Cache key is required");s?(await s.remove(e),n.vF.debug("[appCache] Removed value for key: ".concat(e))):(window.sessionStorage.removeItem(e),n.vF.debug("[appCache] Removed value from sessionStorage for key: ".concat(e)))}catch(r){throw n.vF.error("[appCache] Error removing cache value for key ".concat(e,":"),r),r}}async function u(){try{s?(await s.clear(),n.vF.debug("[appCache] Cleared all values from AWS App Cache")):(window.sessionStorage.clear(),n.vF.debug("[appCache] Cleared all values from sessionStorage"))}catch(e){throw n.vF.error("[appCache] Error clearing cache:",e),e}}let c=i,l=u,d={setCacheValue:o,getCacheValue:a,removeCacheValue:i,clearCache:u,setAppCacheItem:o,getAppCacheItem:a,removeAppCacheItem:c,clearAppCache:l}},44367:(e,r,t)=>{t.d(r,{O:()=>f,w:()=>g});var n=t(12115),s=t(11024),o=t(24818),a=t(42749),i=t(29670);function u(){try{let e=(0,i.gd)("idToken"),r=(0,i.gd)("accessToken"),t=(0,i.gd)("refreshToken");if(!e||!r)return null;return{idToken:e,accessToken:r,refreshToken:t}}catch(e){return a.vF.error("[TokenManager] Error getting tokens:",e),null}}let c=new Map,l=0,d=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,t=Date.now(),n=c.get(e);if(!n||t-n>r){if(c.set(e,t),c.size>50){let e=t-r;for(let[r,t]of c.entries())t<e&&c.delete(r)}return!0}return!1},f=async()=>{try{let e=(0,i.gd)("user_attributes");if(e)return d("[useSession] Using cached user attributes")&&a.vF.debug("[useSession] Using cached user attributes"),e;let r=await (0,s.T)();return r&&(0,i.mm)("user_attributes",r,{ttl:36e5}),a.vF.debug("[useSession] Successfully retrieved user attributes from Cognito"),r}catch(e){return a.vF.warn("[useSession] Error retrieving user attributes from Cognito:",e),null}};function g(){let[e,r]=(0,n.useState)(null),[t,s]=(0,n.useState)(!0),[c,g]=(0,n.useState)(null),h=(0,n.useRef)(!1),w=(0,n.useRef)(null),k=(0,n.useRef)(0),m=(0,n.useRef)(0),v=(0,n.useRef)(0),p=(0,n.useRef)(!0),S=(0,n.useRef)(Date.now());(0,n.useEffect)(()=>()=>{p.current=!1},[]);let b=(0,n.useCallback)(async()=>{let t=Date.now(),n=t-S.current;if(n<2e4)return d("[useSession] Throttling refresh - only ".concat(n,"ms since last refresh"))&&a.vF.debug("[useSession] Throttling refresh - only ".concat(Math.round(n/1e3),"s since last refresh, minimum is ").concat(20,"s")),e;if(l>0){let r=t-l;if(r<2e4)return d("[useSession] Recent global refresh detected")&&a.vF.debug("[useSession] Recent global refresh detected ".concat(Math.round(r/1e3),"s ago, skipping")),e}if(S.current=t,w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{p.current&&(s(!1),d("[useSession] Loading timeout reached")&&a.vF.warn("[useSession] Global loading timeout reached, forcing loading state to false"),f().then(e=>{p.current&&e&&(d("[useSession] Using Cognito attributes fallback after timeout")&&a.vF.info("[useSession] Loading timed out with no session. Using Cognito attributes fallback."),r({tokens:u()||{},userAttributes:e,isPartial:!0}),window.__sessionUsedFallback=!0)}).catch(e=>{a.vF.warn("[useSession] Failed to get fallback attributes after timeout:",e)}))},2e4),k.current>=5){let r=t-m.current;if(r<6e4)return d("[useSession] In cooldown period")&&a.vF.warn("[useSession] In cooldown period (".concat(Math.round((6e4-r)/1e3),"s remaining). Using cached data.")),s(!1),e;k.current=0}if(m.current=t,h.current||window.__tokenRefreshInProgress)return v.current++,(v.current%5==0||d("[useSession] Refresh already in progress"))&&a.vF.debug("[useSession] Refresh already in progress, skipping"),e;if(window.__tokenRefreshCooldown&&Date.now()<window.__tokenRefreshCooldown){d("[useSession] In global cooldown period")&&a.vF.warn("[useSession] In global cooldown period, skipping refresh"),s(!1);let t=await f();return t&&!e&&r({userAttributes:t}),e}try{var c,b;h.current=!0,window.__tokenRefreshInProgress=!0,d("[useSession] Refreshing session")&&a.vF.debug("[useSession] Refreshing session"),s(!0);let t=u();if(t&&!function(){try{let e=(0,i.gd)("tokenTimestamp");if(!e)return!0;return Date.now()-e>3e6}catch(e){return a.vF.error("[TokenManager] Error checking token expiration:",e),!0}}()){d("[useSession] Using cached tokens")&&a.vF.debug("[useSession] Using cached tokens");let e=await f();if(e)return r({tokens:t,userAttributes:e}),s(!1),h.current=!1,window.__tokenRefreshInProgress=!1,{tokens:t,userAttributes:e}}let n=await (0,o.$)();if(null==n||null==(c=n.tokens)?void 0:c.idToken){let e={idToken:n.tokens.idToken.toString(),accessToken:n.tokens.accessToken.toString(),refreshToken:null==(b=n.tokens.refreshToken)?void 0:b.toString()};if(e)try{e.idToken&&(0,i.mm)("idToken",e.idToken,{ttl:36e5}),e.accessToken&&(0,i.mm)("accessToken",e.accessToken,{ttl:36e5}),e.refreshToken&&(0,i.mm)("refreshToken",e.refreshToken,{ttl:864e5}),(0,i.mm)("tokenTimestamp",Date.now(),{ttl:864e5}),a.vF.debug("[TokenManager] Tokens stored in AppCache")}catch(e){a.vF.error("[TokenManager] Error storing tokens:",e)}let t=await f();t&&(r({tokens:e,userAttributes:t}),l=Date.now(),k.current=0,(0,i.mm)("user_info",{email:t.email,firstName:t.given_name,lastName:t.family_name,tenantId:t["custom:tenant_ID"]||t["custom:businessid"]},{ttl:864e5}),d("[useSession] Session refreshed successfully")&&a.vF.debug("[useSession] Session refreshed successfully"))}else throw Error("No ID token found in session");return s(!1),e}catch(e){return k.current++,a.vF.error("[useSession] Failed to refresh session:",{message:e.message,code:e.code,failureCount:k.current}),g(e),k.current>=5&&(window.__tokenRefreshCooldown=Date.now()+6e4,a.vF.warn("[useSession] Maximum refresh failures (".concat(5,") reached. Entering cooldown for ").concat(60,"s"))),s(!1),null}finally{h.current=!1,window.__tokenRefreshInProgress=!1,w.current&&(clearTimeout(w.current),w.current=null)}},[e]);return(0,n.useEffect)(()=>{b();let e=setInterval(()=>{b()},9e5);return()=>{w.current&&clearTimeout(w.current),clearInterval(e)}},[b]),(0,n.useEffect)(()=>{let n=setTimeout(()=>{t&&(s(!1),a.vF.warn("[useSession] Global loading timeout reached, forcing loading state to false"),e||f().then(e=>{e&&(a.vF.info("[useSession] Loading timed out with no session. Using Cognito attributes fallback."),r({userAttributes:e}))}).catch(e=>{a.vF.error("[useSession] Failed to get Cognito attributes after timeout:",e)}))},22e3);return()=>clearTimeout(n)},[t,e]),{user:e,loading:t,error:c}}}}]);