"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[64977],{64977:(e,s,t)=>{t.r(s),t.d(s,{default:()=>m});var n=t(55166),r=t(68387),a=t(95155),l=t(12115),o=t(35695);t(17727);var i=t(33152),c=t(33339),d=t(11024);let m=e=>{let{userData:s}=e;console.log("MyAccount component rendered with userData:",s);let[t,m]=(0,l.useState)(0),[u,x]=(0,l.useState)(!1),[h,f]=(0,l.useState)(!1),[p,g]=(0,l.useState)("confirm"),[b,v]=(0,l.useState)(""),[y,j]=(0,l.useState)(!1),[N,w]=(0,l.useState)(s),k=(0,o.useRouter)(),{notifySuccess:_,notifyError:C}=(0,c.h)();(0,l.useEffect)(()=>{(async()=>{try{let e=await (0,d.T)();e&&(console.log("Successfully fetched user attributes:",e),w((0,r._)((0,n._)({},s),{firstName:e.given_name||e["custom:firstname"]||(null==s?void 0:s.firstName)||"",lastName:e.family_name||e["custom:lastname"]||(null==s?void 0:s.lastName)||"",first_name:e.given_name||e["custom:firstname"]||(null==s?void 0:s.first_name)||"",last_name:e.family_name||e["custom:lastname"]||(null==s?void 0:s.last_name)||"",email:e.email||(null==s?void 0:s.email),name:e.name||"".concat(e.given_name||""," ").concat(e.family_name||"").trim()||(null==s?void 0:s.name),tenantId:e["custom:tenant_Id"]||e["custom:tenant_ID"]||e["custom:tenant_id"]||(null==s?void 0:s.tenantId),sub:e.sub||(null==s?void 0:s.sub),id:e.sub||(null==s?void 0:s.id)||(null==s?void 0:s.sub)})))}catch(e){console.error("Error fetching user attributes:",e)}})()},[s]);let A=N||s,S=e=>{m(e)},I=()=>{x(!0)},P=()=>{f(!0),g("confirm")},T=()=>{f(!1),g("confirm"),v("")},D=()=>{g("feedback")},E=async()=>{try{var e;j(!0);let s=(null==A?void 0:A.tenantId)||localStorage.getItem("tenantId")||(null==(e=document.cookie.split("; ").find(e=>e.startsWith("tenantId=")))?void 0:e.split("=")[1]),t=(null==A?void 0:A.id)||(null==A?void 0:A.sub);if(console.log("Account closure - userDisplayData:",A),console.log("Account closure - request parameters:",{userId:t,fromUserData_id:null==A?void 0:A.id,fromUserData_sub:null==A?void 0:A.sub,tenantId:s,feedbackReason:b}),!s){console.error("Account closure failed - Missing required tenant ID"),C("Unable to process your request. Missing tenant information. Please try logging out and back in, or contact support."),j(!1);return}if(!t){console.error("Account closure failed - Missing required user ID"),C("Unable to process your request. Missing user information. Please try logging out and back in, or contact support."),j(!1);return}let n=0,r=!1,a=null;for(;n<3&&!r;)try{let e;n>0&&await new Promise(e=>setTimeout(e,1e3*n));let l=await fetch("/api/user/close-account",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:b,userId:t,tenantId:s,retry:n})}),o=await l.text();try{e=o?JSON.parse(o):{success:!0}}catch(s){console.error("Error parsing JSON response:",s,"Response was:",o),e={success:!0}}if(!l.ok){if(o.includes("pg_hba.conf")||o.includes("database")){console.warn("Database connection error on attempt ".concat(n+1,":"),(null==e?void 0:e.message)||(null==e?void 0:e.error)),a=Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"Database connection error"),n++;continue}throw Error((null==e?void 0:e.message)||(null==e?void 0:e.error)||"Failed to close account")}r=!0,console.log("Account closure response:",e),localStorage.clear(),document.cookie.split(";").forEach(e=>{document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires=".concat(new Date().toUTCString(),";path=/"))}),_("Account closure request submitted successfully"),setTimeout(()=>{k.push("/account-closed")},2e3)}catch(e){a=e,n++,console.warn("Account closure attempt ".concat(n," failed:"),e)}if(!r){if(a.message.includes("pg_hba.conf"))throw Error("Unable to connect to the database. Our servers may be experiencing issues. Please try again later.");throw a}}catch(e){console.error("Error closing account:",e),j(!1),g("feedback"),C(e.message.includes("database")||e.message.includes("pg_hba.conf")?"Our system is currently experiencing database connection issues. Please try again later or contact support.":e.message||"There was an error closing your account. Please try again or contact support.")}},M=()=>(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})});return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold mb-8",children:"My Account"}),(0,a.jsxs)("div",{className:"mb-6 bg-white shadow overflow-hidden sm:rounded-lg",children:[(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsx)("nav",{className:"-mb-px flex",children:(0,a.jsx)("button",{className:"whitespace-nowrap py-4 px-6 border-b-2 font-medium text-sm ".concat(0===t?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),onClick:()=>S(0),children:"Account Information"})})}),(0,a.jsx)("div",{className:"p-6",children:0===t&&(()=>{var e,s;return(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsxs)("div",{className:"w-16 h-16 rounded-full bg-blue-900 text-white flex items-center justify-center text-2xl mr-4",children:[(null==A||null==(e=A.firstName)?void 0:e.charAt(0))||"",(null==A||null==(s=A.lastName)?void 0:s.charAt(0))||""]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-medium",children:(null==A?void 0:A.full_name)||((null==A?void 0:A.firstName)&&(null==A?void 0:A.lastName)?"".concat(A.firstName," ").concat(A.lastName):(null==A?void 0:A.firstName)||((null==A?void 0:A.email)?A.email.split("@")[0]:"Guest"))}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:(null==A?void 0:A.email)||""})]})]}),(0,a.jsx)("hr",{className:"my-4 border-gray-200"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"font-medium mb-1",children:"Business Name"}),(0,a.jsx)("p",{className:"text-gray-800",children:(null==A?void 0:A.businessName)||(null==A?void 0:A["custom:businessname"])||""})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 font-medium",children:"Subscription Plan"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat((null==A?void 0:A.subscriptionType)==="free"||(null==A?void 0:A.subscription_type)==="free"?"bg-gray-100 text-gray-800":"bg-blue-100 text-blue-800"," mr-2"),children:(null==A?void 0:A.subscriptionType)==="enterprise"||(null==A?void 0:A.subscription_type)==="enterprise"?"Enterprise Plan":(null==A?void 0:A.subscriptionType)==="professional"||(null==A?void 0:A.subscription_type)==="professional"?"Professional Plan":"Free Plan"}),((null==A?void 0:A.subscriptionType)==="free"||(null==A?void 0:A.subscription_type)==="free")&&(0,a.jsx)("button",{onClick:I,className:"text-xs px-2 py-1 rounded border border-blue-600 text-blue-600 hover:bg-blue-50",children:"Upgrade"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 font-medium",children:"Phone Number"}),(0,a.jsx)("p",{className:"text-gray-800",children:(null==A?void 0:A.phone_number)||"Not provided"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 font-medium",children:"Account Created"}),(0,a.jsx)("p",{className:"text-gray-800",children:(null==A?void 0:A.created_at)?new Date(A.created_at).toLocaleDateString():"Not available"})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex flex-wrap gap-3",children:[(0,a.jsxs)("button",{className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:()=>k.push("/settings/profile"),children:[(0,a.jsx)(M,{}),(0,a.jsx)("span",{className:"ml-2",children:"Edit Profile"})]}),(0,a.jsxs)("button",{className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",onClick:P,children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),(0,a.jsx)("span",{className:"ml-2",children:"Close Account"})]})]})]})})})()})]}),(0,a.jsx)(i.A,{open:u,onClose:()=>x(!1)}),(0,a.jsx)(()=>h?(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,a.jsx)("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:(0,a.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),(0,a.jsxs)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:["confirm"===p&&(0,a.jsxs)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[(0,a.jsxs)("div",{className:"sm:flex sm:items-start",children:[(0,a.jsx)("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:(0,a.jsx)("svg",{className:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,a.jsxs)("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Close Your Account"}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Are you sure you want to close your account? This action cannot be undone. All your data will be permanently removed from our servers."})})]})]}),(0,a.jsxs)("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[(0,a.jsx)("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:D,children:"Yes, close my account"}),(0,a.jsx)("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm",onClick:T,children:"Cancel"})]})]}),"feedback"===p&&(0,a.jsxs)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[(0,a.jsx)("div",{className:"sm:flex sm:items-start",children:(0,a.jsxs)("div",{className:"mt-3 text-center sm:mt-0 sm:text-left w-full",children:[(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Help Us Improve"}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"We're sorry to see you go. Please let us know why you're closing your account:"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,a.jsx)("input",{type:"radio",className:"form-radio h-4 w-4 text-blue-600",checked:"app_functionality"===b,onChange:()=>v("app_functionality")}),(0,a.jsx)("span",{className:"text-gray-700",children:"The app doesn't meet my needs"})]}),(0,a.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,a.jsx)("input",{type:"radio",className:"form-radio h-4 w-4 text-blue-600",checked:"usability_issues"===b,onChange:()=>v("usability_issues")}),(0,a.jsx)("span",{className:"text-gray-700",children:"App is difficult to use"})]}),(0,a.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,a.jsx)("input",{type:"radio",className:"form-radio h-4 w-4 text-blue-600",checked:"found_alternative"===b,onChange:()=>v("found_alternative")}),(0,a.jsx)("span",{className:"text-gray-700",children:"I found a better alternative"})]}),(0,a.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,a.jsx)("input",{type:"radio",className:"form-radio h-4 w-4 text-blue-600",checked:"other"===b,onChange:()=>v("other")}),(0,a.jsx)("span",{className:"text-gray-700",children:"Other reason"})]})]})]})]})}),(0,a.jsxs)("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[(0,a.jsx)("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:E,disabled:!b,children:"Submit & Close Account"}),(0,a.jsx)("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm",onClick:()=>g("confirm"),children:"Back"})]})]}),"processing"===p&&(0,a.jsx)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"mx-auto flex items-center justify-center h-12 w-12",children:(0,a.jsxs)("svg",{className:"animate-spin h-6 w-6 text-blue-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),(0,a.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900 mt-4",children:"Closing Your Account"}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Please wait while we process your request. This might take a moment..."})})]})})]})]})}):null,{})]})}}}]);