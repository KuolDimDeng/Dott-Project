"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[33400],{16905:(e,t,s)=>{s.d(t,{E:()=>r});var a=s(29670);let r={get:async e=>(0,a.gd)(e),set:async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=s.expires?1e3*s.expires:void 0;return(0,a.mm)(e,t,{ttl:r})},remove:async e=>(0,a.A6)(e),clear:async()=>(0,a.IL)(),keys:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Object.keys(window.__APP_CACHE||{}).filter(t=>t.startsWith(e))}}},33400:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x});var a=s(95155),r=s(12115),l=s(35695),n=s(42749),c=s(16905),i=s(24818),d=s(19689),o=s(8754);let x=()=>{(0,l.useRouter)();let[e,t]=(0,r.useState)([]),[s,x]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),[u,p]=(0,r.useState)(""),[g,b]=(0,r.useState)(null),[f,y]=(0,r.useState)(!1),[j,N]=(0,r.useState)(1),[w,v]=(0,r.useState)(10),[k,C]=(0,r.useState)(1),[_,S]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=async()=>{try{var e,s;let a=(null==(s=(await (0,i.$)()).tokens)||null==(e=s.idToken)?void 0:e.toString())||"",r=new URLSearchParams({page:j,limit:w});u&&r.append("search",u);let l=await fetch("/api/crm/contacts/?".concat(r.toString()),{headers:{Authorization:"Bearer ".concat(a)}});if(!l.ok)throw Error("API returned status ".concat(l.status));let n=await l.json(),d="crm_contacts_".concat(u,"_").concat(j,"_").concat(w);await c.E.set(d,JSON.stringify(n),{expires:300}),t(n.results||[]),C(n.total_pages||1),x(!1)}catch(e){n.vF.error("Error updating contacts:",e),h("Failed to update contacts. Please try again later."),x(!1)}};(async()=>{try{x(!0);let s="crm_contacts_".concat(u,"_").concat(j,"_").concat(w),a=await c.E.get(s);if(a){let s=JSON.parse(a);t(s.results||[]),C(s.total_pages||1),x(!1),e();return}await e()}catch(e){n.vF.error("Error fetching contacts:",e),h("Failed to load contacts. Please try again later."),x(!1)}})()},[j,w,u]);let E=e=>{N(e)},P=e=>{b(e),S(!0)},A=async()=>{if(g)try{var s,a;let r=(null==(a=(await (0,i.$)()).tokens)||null==(s=a.idToken)?void 0:s.toString())||"";(await fetch("/api/crm/contacts/".concat(g.id,"/"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(r)}})).ok?(t(e.filter(e=>e.id!==g.id)),C(k-1)):n.vF.error("Failed to delete contact")}catch(e){n.vF.error("Error deleting contact:",e)}finally{S(!1),b(null)}},F=()=>{S(!1),b(null)};return s&&0===e.length?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-t-blue-500 border-b-blue-700 rounded-full animate-spin"})}):(0,a.jsxs)("div",{className:"p-6 bg-gray-50",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-black mb-4",children:"Contact Management"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-sm font-medium text-black",children:"Total Contacts"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-black mt-2",children:k*w})]}),(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-sm font-medium text-black",children:"Primary Contacts"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-black mt-2",children:e.filter(e=>e.is_primary).length})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center flex-wrap gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:(0,a.jsx)(o.WI,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{type:"text",placeholder:"Search Contacts",className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md bg-white text-black focus:ring-blue-500 focus:border-blue-500 min-w-[300px]",value:u,onChange:e=>{p(e.target.value),N(1)}})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("button",{className:"flex items-center px-4 py-2 border border-gray-300 rounded-md bg-white text-black hover:bg-gray-50 transition-colors",children:[(0,a.jsx)(o.O7,{className:"h-5 w-5 mr-2"}),"Filter"]}),(0,a.jsxs)("button",{className:"flex items-center px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 transition-colors",children:[(0,a.jsx)(o.RE,{className:"h-5 w-5 mr-2"}),"Add Contact"]})]})]}),(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-100",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-black uppercase tracking-wider",children:"Name"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-black uppercase tracking-wider",children:"Email"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-black uppercase tracking-wider",children:"Phone"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-black uppercase tracking-wider",children:"Job Title"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-black uppercase tracking-wider",children:"Company"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-black uppercase tracking-wider",children:"Primary"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-black uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"text-sm font-medium text-black",children:[e.first_name," ",e.last_name]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm text-black",children:e.email})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm text-black",children:e.phone})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm text-black",children:e.job_title})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm text-black",children:e.customer_name})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm text-black",children:e.is_primary?(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"Yes"}):(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800",children:"No"})})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,a.jsx)("button",{className:"text-blue-600 hover:text-blue-900 mr-3",children:(0,a.jsx)(o.IT,{className:"h-5 w-5"})}),(0,a.jsx)("button",{className:"text-green-600 hover:text-green-900 mr-3",children:(0,a.jsx)(o.qU,{className:"h-5 w-5"})}),(0,a.jsx)("button",{onClick:()=>P(e),className:"text-red-600 hover:text-red-900",children:(0,a.jsx)(o.d7,{className:"h-5 w-5"})})]})]},e.id))})]})}),(0,a.jsxs)("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[(0,a.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,a.jsx)("button",{onClick:()=>E(j-1),disabled:1===j,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ".concat(1===j?"bg-gray-100 text-gray-400":"bg-white text-gray-700 hover:bg-gray-50"),children:"Previous"}),(0,a.jsx)("button",{onClick:()=>E(j+1),disabled:j===k,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md ".concat(j===k?"bg-gray-100 text-gray-400":"bg-white text-gray-700 hover:bg-gray-50"),children:"Next"})]}),(0,a.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing ",(0,a.jsx)("span",{className:"font-medium",children:j*w-w+1})," to"," ",(0,a.jsx)("span",{className:"font-medium",children:Math.min(j*w,k*w)})," ","of ",(0,a.jsx)("span",{className:"font-medium",children:k*w})," results"]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("select",{value:w,onChange:e=>{v(parseInt(e.target.value,10)),N(1)},className:"mr-4 border border-gray-300 rounded-md py-1 px-2 text-gray-700",children:[5,10,25].map(e=>(0,a.jsxs)("option",{value:e,children:[e," per page"]},e))}),(0,a.jsxs)("nav",{className:"inline-flex rounded-md shadow-sm","aria-label":"Pagination",children:[(0,a.jsxs)("button",{onClick:()=>E(j-1),disabled:1===j,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 text-sm font-medium ".concat(1===j?"bg-gray-100 text-gray-400":"bg-white text-gray-500 hover:bg-gray-50"),children:[(0,a.jsx)("span",{className:"sr-only",children:"Previous"}),(0,a.jsx)("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),[...Array(Math.min(5,Math.ceil(k))).keys()].map((e,t)=>{let s=t+1;return k>5&&(s=j<3?t+1:j>=k-2?k-4+t:j-2+t),(0,a.jsx)("button",{onClick:()=>E(s),className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium ".concat(j===s?"bg-blue-50 text-blue-600":"bg-white text-gray-500 hover:bg-gray-50"),children:s},s)}),(0,a.jsxs)("button",{onClick:()=>E(j+1),disabled:j===k,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 text-sm font-medium ".concat(j===k?"bg-gray-100 text-gray-400":"bg-white text-gray-500 hover:bg-gray-50"),children:[(0,a.jsx)("span",{className:"sr-only",children:"Next"}),(0,a.jsx)("svg",{className:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})]})]})]})]})]})]}),(0,a.jsxs)(d.lG,{open:_,onClose:F,className:"relative z-50",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black/30","aria-hidden":"true"}),(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:(0,a.jsxs)(d.lG.Panel,{className:"mx-auto max-w-md rounded-lg bg-white p-6 shadow-xl",children:[(0,a.jsx)(d.lG.Title,{className:"text-lg font-medium text-black mb-4",children:"Delete Contact"}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("p",{className:"text-sm text-black",children:"Are you sure you want to delete this contact? This action cannot be undone."})}),(0,a.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:F,className:"px-4 py-2 border border-gray-300 rounded-md text-black bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Cancel"}),(0,a.jsx)("button",{onClick:A,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"Delete"})]})]})})]})]})}}}]);