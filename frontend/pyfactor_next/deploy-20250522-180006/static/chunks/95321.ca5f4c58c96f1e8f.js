"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[95321],{95321:(e,t,r)=>{r.r(t),r.d(t,{default:()=>A});var a=r(55166),n=r(68387),s=r(36465),l=r(95155),o=r(12115),i=r(35695),d=r(29729),c=r(78007),m=r(90306),u=r(60005),p=r(66352),h=r(47037),g=r(29670);r(99783);var y=r(42749),x=r(62376);function b(e){let{onConnectionRestored:t}=e,[r,a]=(0,o.useState)(!1),[n,s]=(0,o.useState)(null),[i,c]=(0,o.useState)(!1),m=async()=>{a(!0);try{y.vF.info("[BackendConnectionCheck] Verifying backend connection...");let e=await (0,d.verifyBackendConnection)();y.vF.info("[BackendConnectionCheck] Connection check result:",e),s(e),e.success?(p.oR.success("Backend connection successful!"),t&&t()):p.oR.error("Cannot connect to backend server")}catch(e){y.vF.error("[BackendConnectionCheck] Error verifying connection:",e),s({success:!1,message:e.message,troubleshooting:"An unexpected error occurred during connection check"}),p.oR.error("Error checking connection")}finally{a(!1)}};return((0,o.useEffect)(()=>{m()},[]),n)?(0,l.jsx)("div",{className:"p-4 bg-white rounded-lg shadow-md",children:(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Backend Connection Check"}),(0,l.jsx)("p",{className:"text-gray-600 mb-4",children:"There seems to be an issue connecting to the backend server. Let's diagnose the problem."})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,l.jsx)("button",{onClick:m,disabled:r,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:r?"Checking...":"Check Connection"}),(0,l.jsx)("button",{onClick:()=>{try{(0,d.resetCircuitBreakers)("/employees"),p.oR.success("Circuit breaker reset successfully"),setTimeout(()=>{m()},1e3)}catch(e){y.vF.error("[BackendConnectionCheck] Error resetting circuit breakers:",e),p.oR.error("Failed to reset circuit breakers")}},className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",children:"Reset Circuit Breaker"}),(0,l.jsx)("button",{onClick:()=>c(!i),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",children:i?"Hide Details":"Show Details"})]}),n&&(0,l.jsxs)("div",{className:"mt-4 p-3 rounded ".concat(n.success?"bg-green-100":"bg-red-100"),children:[(0,l.jsxs)("p",{className:"font-semibold",children:["Status: ",n.success?"Connected":"Connection Failed"]}),n.message&&(0,l.jsx)("p",{className:"mt-2",children:n.message}),!n.success&&n.troubleshooting&&(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("p",{className:"font-medium",children:"Troubleshooting:"}),(0,l.jsx)("p",{className:"text-sm text-gray-700",children:n.troubleshooting})]})]}),i&&(0,l.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,l.jsx)("h3",{className:"font-medium mb-2",children:"Troubleshooting Steps:"}),(0,l.jsxs)("ol",{className:"list-decimal pl-4 space-y-2 text-sm",children:[(0,l.jsx)("li",{children:"Verify that the backend server is running. Check terminal for error messages."}),(0,l.jsx)("li",{children:"Try resetting the circuit breaker using the button above."}),(0,l.jsx)("li",{children:"Check if there are CORS issues (Cross-Origin Resource Sharing)."}),(0,l.jsx)("li",{children:"Make sure SSL certificates are properly set up for HTTPS connections."}),(0,l.jsx)("li",{children:"Restart both the frontend and backend servers if the issue persists."}),(0,l.jsx)("li",{children:"Check browser console for detailed error messages."})]})]})]})}):(0,l.jsx)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-md shadow-sm mb-4",children:(0,l.jsx)("p",{className:"text-blue-800 font-medium",children:"Checking backend connection..."})})}r(37845);let f=e=>{var{variant:t,component:r,className:o,color:i,children:d,gutterBottom:c}=e,m=(0,s._)(e,["variant","component","className","color","children","gutterBottom"]);let u="";return"h4"!==t&&("h1"!==r||t)?"h5"===t?u="text-xl font-semibold":"h6"===t?u="text-lg font-medium":"subtitle1"===t||"subtitle2"===t?u="text-sm font-medium":"body1"===t?u="text-base":"body2"===t&&(u="text-sm"):u="text-2xl font-bold","textSecondary"===i?u+=" text-gray-500":"primary"===i?u+=" text-blue-600":"error"===i&&(u+=" text-red-600"),c&&(u+=" mb-2"),(0,l.jsx)(r||"p",(0,n._)((0,a._)({className:"".concat(u," ").concat(o||"")},m),{children:d}))},_=e=>{let{severity:t,className:r,children:a}=e,n="bg-blue-50",s="border-blue-400",o="text-blue-800";return"error"===t?(n="bg-red-50",s="border-red-400",o="text-red-800"):"warning"===t?(n="bg-yellow-50",s="border-yellow-400",o="text-yellow-800"):"success"===t?(n="bg-green-50",s="border-green-400",o="text-green-800"):"info"===t&&(n="bg-blue-50",s="border-blue-400",o="text-blue-800"),(0,l.jsx)("div",{className:"p-4 mb-4 ".concat(n," border-l-4 ").concat(s," ").concat(o," ").concat(r||""),children:a})},v=e=>{let{variant:t,color:r,size:a,onClick:n,disabled:s,type:o,className:i,startIcon:d,children:c}=e,m="inline-flex items-center justify-center rounded-md font-medium focus:outline-none focus:ring-2 focus:ring-offset-2";return"small"===a?m+=" px-2.5 py-1.5 text-xs":"large"===a?m+=" px-6 py-3 text-base":m+=" px-4 py-2 text-sm","contained"===t?"primary"===r?m+=" bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500":"secondary"===r?m+=" bg-purple-600 text-white hover:bg-purple-700 focus:ring-purple-500":"error"===r?m+=" bg-red-600 text-white hover:bg-red-700 focus:ring-red-500":"info"===r?m+=" bg-sky-600 text-white hover:bg-sky-700 focus:ring-sky-500":m+=" bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500":"outlined"===t?"primary"===r?m+=" border border-blue-500 text-blue-700 hover:bg-blue-50 focus:ring-blue-500":"secondary"===r?m+=" border border-purple-500 text-purple-700 hover:bg-purple-50 focus:ring-purple-500":"error"===r?m+=" border border-red-500 text-red-700 hover:bg-red-50 focus:ring-red-500":"info"===r?m+=" border border-sky-500 text-sky-700 hover:bg-sky-50 focus:ring-sky-500":m+=" border border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-gray-500":"primary"===r?m+=" text-blue-700 hover:bg-blue-50 focus:ring-blue-500":"secondary"===r?m+=" text-purple-700 hover:bg-purple-50 focus:ring-purple-500":"error"===r?m+=" text-red-700 hover:bg-red-50 focus:ring-red-500":m+=" text-gray-700 hover:bg-gray-50 focus:ring-gray-500",s&&(m=m.replace(/hover:[^ ]*/g,"")+" opacity-50 cursor-not-allowed"),(0,l.jsxs)("button",{type:o||"button",onClick:s?void 0:n,disabled:s,className:"".concat(m," ").concat(i||""),children:[d&&(0,l.jsx)("span",{className:"mr-2",children:d}),c]})},j=e=>{let{label:t,fullWidth:r,multiline:n,rows:s,value:o,onChange:i,required:d,placeholder:c,name:m,type:u,inputProps:p,variant:h,className:g,onClick:y,autoComplete:x}=e;return(0,l.jsxs)("div",{className:"mb-4 ".concat(r?"w-full":""," ").concat(g||""),children:[t&&(0,l.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[t,d&&(0,l.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),n?(0,l.jsx)("textarea",{name:m,value:o||"",onChange:i,onClick:y,placeholder:c,rows:s||3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}):(0,l.jsx)("input",(0,a._)({type:u||"text",name:m,value:o||"",onChange:i,onClick:y,placeholder:c,autoComplete:x,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm"},p))]})},w=e=>{let{size:t,color:r,className:a}=e;return(0,l.jsxs)("svg",{className:"animate-spin ".concat("small"===t?"h-4 w-4":"h-6 w-6"," ").concat("inherit"===r?"text-current":"text-blue-600"," ").concat(a||""),xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})},N=e=>{let{children:t,title:r,subtitle:a,onSubmit:n,isLoading:s,submitLabel:o}=e;return(0,l.jsxs)("form",{onSubmit:n,className:"bg-white rounded-lg shadow-lg overflow-hidden",children:[(0,l.jsxs)("div",{className:"px-6 py-4 bg-gradient-to-r from-blue-500 to-blue-600",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-white mb-1",children:r}),a&&(0,l.jsx)("p",{className:"text-blue-100 text-sm",children:a})]}),(0,l.jsx)("div",{className:"p-6",children:t}),(0,l.jsxs)("div",{className:"px-6 py-4 bg-gray-50 flex justify-end space-x-2",children:[(0,l.jsx)(v,{variant:"outlined",color:"primary",type:"button",className:"w-24",onClick:()=>window.history.back(),children:"Cancel"}),(0,l.jsxs)(v,{variant:"contained",color:"primary",type:"submit",className:"w-24",disabled:s,children:[s?(0,l.jsx)(w,{size:"small",color:"inherit",className:"mr-2"}):null,o||"Save"]})]})]})},k=e=>{let{isEdit:t=!1,onSubmit:r,newEmployee:a,handleInputChange:n,isLoading:s,setNewEmployee:o,setShowAddForm:i,setShowEditForm:d,employees:c=[]}=e;return(0,l.jsxs)(N,{title:t?"Edit Employee":"Add New Employee",subtitle:t?"Update employee information":"Add a new employee to your organization",onSubmit:r,onCancel:()=>{t&&d?d(!1):i&&setEmployeeTab("list"),y.vF.debug("[EmployeeManagement] Form canceled:",t?"edit":"add")},isSubmitting:s,submitLabel:t?"Update Employee":"Add Employee",children:[!t&&(0,l.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:(0,l.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,l.jsx)("span",{className:"font-medium",children:"Note:"})," User invitation functionality has been moved to the User Management section in Settings."]})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,l.jsx)(j,{label:"First Name",name:"first_name",value:a.first_name,onChange:n,required:!0,fullWidth:!0}),(0,l.jsx)(j,{label:"Date Joined",type:"date",name:"date_joined",value:a.date_joined||new Date().toISOString().split("T")[0],onChange:n,required:!0,fullWidth:!0}),(0,l.jsx)(j,{label:"Middle Name",name:"middle_name",value:a.middle_name,onChange:n,fullWidth:!0}),(0,l.jsx)(j,{label:"Last Name",name:"last_name",value:a.last_name,onChange:n,required:!0,fullWidth:!0}),(0,l.jsx)(j,{label:"Date of Birth",type:"date",name:"dob",value:a.dob,onChange:n,required:!0,fullWidth:!0}),(0,l.jsx)(j,{label:"Email",type:"email",name:"email",value:a.email,onChange:n,required:!0,fullWidth:!0}),(0,l.jsx)(j,{label:"Phone Number",type:"tel",name:"phone_number",value:a.phone_number,onChange:n,fullWidth:!0}),(0,l.jsx)(j,{label:"Job Title",name:"job_title",value:a.job_title,onChange:n,required:!0,fullWidth:!0}),(0,l.jsx)(j,{label:"Department",name:"department",value:a.department,onChange:n,fullWidth:!0}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Compensation Type"}),(0,l.jsxs)("select",{name:"compensation_type",value:a.compensation_type,onChange:n,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[(0,l.jsx)("option",{value:"SALARY",children:"Salary (Yearly)"}),(0,l.jsx)("option",{value:"WAGE",children:"Wage (Hourly)"})]})]}),"SALARY"===a.compensation_type?(0,l.jsx)(j,{label:"Annual Salary",type:"number",name:"salary",value:a.salary,onChange:n,fullWidth:!0,inputProps:{min:"0",step:"0.01"}}):(0,l.jsx)(j,{label:"Hourly Wage",type:"number",name:"wage_per_hour",value:a.wage_per_hour,onChange:n,fullWidth:!0,inputProps:{min:"0",step:"0.01"}}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employment Type"}),(0,l.jsxs)("select",{name:"employment_type",value:a.employment_type,onChange:n,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[(0,l.jsx)("option",{value:"FT",children:"Full-time"}),(0,l.jsx)("option",{value:"PT",children:"Part-time"})]})]})]}),"WAGE"===a.compensation_type&&(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,l.jsx)(j,{label:"Hours Per Day",type:"number",name:"hours_per_day",value:a.hours_per_day,onChange:n,fullWidth:!0,inputProps:{min:"0",max:"24",step:"0.5"}}),(0,l.jsx)(j,{label:"Days Per Week",type:"number",name:"days_per_week",value:a.days_per_week,onChange:n,fullWidth:!0,inputProps:{min:"1",max:"7",step:"1"}}),(0,l.jsx)(j,{label:"Overtime Rate",type:"number",name:"overtime_rate",value:a.overtime_rate,onChange:n,fullWidth:!0,inputProps:{min:"0",step:"0.01"}})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",name:"ID_verified",checked:a.ID_verified,onChange:e=>n({target:{name:"ID_verified",value:e.target.checked}}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,l.jsx)("label",{className:"ml-2 block text-sm text-gray-700",children:"ID Verified"})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",name:"areManager",checked:a.areManager,onChange:e=>n({target:{name:"areManager",value:e.target.checked}}),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,l.jsx)("label",{className:"ml-2 block text-sm text-gray-700",children:"Is Manager"})]}),a.areManager&&(0,l.jsxs)("div",{className:"col-span-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supervising Employees"}),(0,l.jsx)("div",{className:"mt-2 space-y-2 max-h-60 overflow-y-auto border border-gray-300 rounded-md p-2",children:c.filter(e=>e.id!==a.id).map(e=>(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"radio",name:"supervising",id:"supervising-".concat(e.id),value:e.id,checked:a.supervising===e.id,onChange:t=>{n({target:{name:"supervising",value:t.target.checked?e.id:null}})},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),(0,l.jsxs)("label",{htmlFor:"supervising-".concat(e.id),className:"ml-2 block text-sm text-gray-700",children:[e.first_name," ",e.last_name]})]},e.id))}),(0,l.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Select one employee to supervise"})]})]})]})},C=()=>{let[e,t]=(0,o.useState)({first_name:"",last_name:"",middle_name:"",email:"",phone_number:"",address:"",city:"",state:"",zip_code:"",country:"US",dob:"",gender:"",marital_status:"",payment_method:{bank_name:"",account_number:"",account_number_confirm:"",routing_number:"",mobile_wallet_id:""},emergency_contact:{name:"",relationship:"",phone:""}}),[r,s]=(0,o.useState)(!1),[i,d]=(0,o.useState)(!1),[c,m]=(0,o.useState)(null),[u,p]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{try{var e,r,s,l,o,i,d;let c=(null==(r=window.__APP_CACHE)||null==(e=r.tenant)?void 0:e.currentTenantId)||(null==(s=(l=window).getCacheValue)?void 0:s.call(l,"tenantId"))||localStorage.getItem("tenantId"),m=null;try{let e=c?"/api/user/profile?tenantId=".concat(encodeURIComponent(c)):"/api/user/profile";console.log("Fetching user profile from API:",e);let t=await fetch(e,{headers:{"Cache-Control":"no-cache","X-Dashboard-Route":"true",Authorization:"Bearer "+(localStorage.getItem("idToken")||sessionStorage.getItem("idToken")||""),"X-Tenant-ID":c||""},credentials:"include"});if(t.ok){let e=await t.json();e&&e.profile&&(console.log("Successfully fetched user profile from API"),m={first_name:e.profile.firstName||e.profile.first_name||"",last_name:e.profile.lastName||e.profile.last_name||"",email:e.profile.email||"",phone_number:e.profile.phoneNumber||e.profile.phone_number||"",address:e.profile.street||e.profile.address||"",city:e.profile.city||"",state:e.profile.state||"",zip_code:e.profile.postcode||e.profile.zip_code||"",country:e.profile.country||"US"})}}catch(e){console.error("Error fetching from User Profile API:",e),e.response?(console.error("API Error Status:",e.response.status),console.error("API Error Headers:",e.response.headers)):e.request&&console.error("No response received:",e.request),(401===e.status||e.response&&401===e.response.status)&&console.warn("[UserProfile] Authentication error (401), will try Cognito fallback")}if(!m&&(null==(d=window.__APP_CACHE)||null==(i=d.userProfile)||null==(o=i.data)?void 0:o.profile)){console.log("Using App Cache for user profile data");let e=window.__APP_CACHE.userProfile.data.profile;m={first_name:e.firstName||e.first_name||"",last_name:e.lastName||e.last_name||"",email:e.email||"",phone_number:e.phoneNumber||e.phone_number||"",address:e.street||e.address||"",city:e.city||"",state:e.state||"",zip_code:e.postcode||e.zip_code||""}}if(!m)try{console.log("[UserProfile] Falling back to Cognito attributes");let e=null;if("function"==typeof window.fetchUserAttributes)try{console.log("[UserProfile] Using window.fetchUserAttributes"),e=await window.fetchUserAttributes()}catch(e){console.warn("[UserProfile] Error with fetchUserAttributes:",e.message)}if(!e&&window.Auth&&"function"==typeof window.Auth.currentAuthenticatedUser)try{console.log("[UserProfile] Using Auth.currentAuthenticatedUser"),e=(await window.Auth.currentAuthenticatedUser()).attributes}catch(e){console.warn("[UserProfile] Error with Auth.currentAuthenticatedUser:",e.message)}if(!e&&window.Amplify&&window.Amplify.Auth)try{console.log("[UserProfile] Using Amplify v6 API"),e=(await window.Amplify.Auth.currentAuthenticatedUser()).attributes}catch(e){console.warn("[UserProfile] Error with Amplify.Auth:",e.message)}e?m={first_name:e.given_name||e["custom:firstname"]||"",last_name:e.family_name||e["custom:lastname"]||"",email:e.email||"",phone_number:e.phone_number||""}:console.warn("[UserProfile] Could not retrieve user attributes from any method")}catch(e){console.error("Error fetching from Cognito:",e)}m||(console.log("No user data found, using defaults"),m={first_name:"",last_name:"",email:""}),t(e=>(0,n._)((0,a._)({},e,m),{payment_method:e.payment_method,emergency_contact:e.emergency_contact}))}catch(e){console.error("Error fetching personal information:",e)}})()},[]);let h=e=>{let{name:r,value:s}=e.target;if(r.includes(".")){let[e,l]=r.split(".");t(t=>(0,n._)((0,a._)({},t),{[e]:(0,n._)((0,a._)({},t[e]),{[l]:s})}))}else t(e=>(0,n._)((0,a._)({},e),{[r]:s}))},g=async l=>{if(l.preventDefault(),r&&e.accountNumber&&e.accountNumberConfirmation&&e.accountNumber!==e.accountNumberConfirmation)return void setAlertMessage({type:"error",message:"Account numbers do not match. Please verify and try again."});setLoading(!0);try{let r={};"stripe"===e.paymentProvider?(r.bank_name=e.bankName,e.accountNumber&&e.routingNumber&&(r.account_number=e.accountNumber,r.routing_number=e.routingNumber)):"mpesa"===e.paymentProvider?r.mpesa_phone_number=e.mpesaPhoneNumber:"paypal"===e.paymentProvider&&(r.paypal_email=e.paypalEmail);let l=await fetch("/api/payments/employees/".concat(employeeData.id,"/payment-method/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(token)},body:JSON.stringify({provider:e.paymentProvider,details:r})}),o=await l.json();if(l.ok)o.secure_storage?setAlertMessage({type:"success",message:"Your information was saved successfully. For security, your full account details are stored securely with our payment processor and only the last 4 digits are stored in our system."}):setAlertMessage({type:"success",message:"Your information was saved successfully!"}),t(e=>(0,n._)((0,a._)({},e),{accountNumberConfirmation:""})),s(!1);else throw Error(o.error||"Failed to update payment information")}catch(e){console.error("Error saving information:",e),setAlertMessage({type:"error",message:e.message||"An error occurred while saving your information. Please try again."})}finally{setLoading(!1)}};return(0,l.jsxs)("div",{className:"bg-white rounded-lg",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold",children:"Personal Information"}),r?(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)(v,{variant:"outlined",color:"primary",onClick:()=>s(!1),disabled:i,children:"Cancel"}),(0,l.jsx)(v,{variant:"contained",color:"primary",onClick:g,disabled:i,children:i?"Saving...":"Save Changes"})]}):(0,l.jsx)(v,{variant:"contained",color:"primary",onClick:()=>s(!0),children:"Edit Information"})]}),u&&(0,l.jsx)(_,{severity:"success",className:"mb-4",children:"Your personal information has been updated successfully."}),c&&(0,l.jsx)(_,{severity:"error",className:"mb-4",children:c}),(0,l.jsxs)("form",{onSubmit:g,children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsx)(j,{label:"First Name",name:"first_name",value:e.first_name,onChange:h,required:!0,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"Last Name",name:"last_name",value:e.last_name,onChange:h,required:!0,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"Middle Name",name:"middle_name",value:e.middle_name,onChange:h,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"Email",type:"email",name:"email",value:e.email,onChange:h,required:!0,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"Phone Number",type:"tel",name:"phone_number",value:e.phone_number,onChange:h,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"Date of Birth",type:"date",name:"dob",value:e.dob,onChange:h,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"Gender",name:"gender",value:e.gender,onChange:h,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"Marital Status",name:"marital_status",value:e.marital_status,onChange:h,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"Address",name:"address",value:e.address,onChange:h,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"City",name:"city",value:e.city,onChange:h,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"State/Province",name:"state",value:e.state,onChange:h,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"ZIP/Postal Code",name:"zip_code",value:e.zip_code,onChange:h,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"Country",name:"country",value:e.country,onChange:h,fullWidth:!0,disabled:!r})]}),(0,l.jsxs)("div",{className:"mt-8",children:[(0,l.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Payment Method"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsx)(j,{label:"Bank Name",name:"payment_method.bank_name",value:e.payment_method.bank_name,onChange:h,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"Account Number",name:"payment_method.account_number",value:e.payment_method.account_number,onChange:h,fullWidth:!0,disabled:!r,type:r?"text":"password"}),r&&(0,l.jsx)(j,{label:"Confirm Account Number",name:"payment_method.account_number_confirm",value:e.payment_method.account_number_confirm,onChange:h,fullWidth:!0,required:!0,error:e.payment_method.account_number!==e.payment_method.account_number_confirm,helperText:e.payment_method.account_number!==e.payment_method.account_number_confirm?"Account numbers don't match":"",type:"text"}),(0,l.jsx)(j,{label:"Routing Number",name:"payment_method.routing_number",value:e.payment_method.routing_number,onChange:h,fullWidth:!0,disabled:!r,type:r?"text":"password"}),"KE"===e.country&&(0,l.jsx)(j,{label:"M-Pesa Phone Number",name:"payment_method.mobile_wallet_id",value:e.payment_method.mobile_wallet_id,onChange:h,fullWidth:!0,disabled:!r,placeholder:"e.g., 07XXXXXXXX"})]})]}),(0,l.jsxs)("div",{className:"mt-8",children:[(0,l.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Emergency Contact"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,l.jsx)(j,{label:"Name",name:"emergency_contact.name",value:e.emergency_contact.name,onChange:h,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"Relationship",name:"emergency_contact.relationship",value:e.emergency_contact.relationship,onChange:h,fullWidth:!0,disabled:!r}),(0,l.jsx)(j,{label:"Phone Number",name:"emergency_contact.phone",value:e.emergency_contact.phone,onChange:h,fullWidth:!0,disabled:!r})]})]})]})]})},A=()=>{let e=()=>{let e=window.location.pathname+window.location.search;window.location.href="/login?expired=true&redirect=".concat(encodeURIComponent(e))};(0,i.useRouter)();let t=e=>p.oR.success(e),v=e=>p.oR.error(e),j=e=>p.oR.loading(e),N=e=>p.oR.error(e,{icon:"⚠️"}),A=(0,o.useRef)(!0),E=(0,o.useRef)(null),S=(0,o.useRef)(null);(0,o.useEffect)(()=>(A.current=!0,()=>{A.current=!1}),[]);let[P,M]=(0,o.useState)([]),[F,T]=(0,o.useState)(!0),[I,L]=(0,o.useState)(null),[D,U]=(0,o.useState)("personal"),[W,R]=(0,o.useState)("list"),[H,z]=(0,o.useState)("employee-management"),[B,O]=(0,o.useState)(""),[q,Y]=(0,o.useState)(null),[G,X]=(0,o.useState)(!1),[V,J]=(0,o.useState)(!1),[K,Z]=(0,o.useState)(!1),[$,Q]=(0,o.useState)(""),[ee,et]=(0,o.useState)(""),[er,ea]=(0,o.useState)(null),[en,es]=(0,o.useState)(!0),[el,eo]=(0,o.useState)(!1),[ei,ed]=(0,o.useState)(!1),[ec,em]=(0,o.useState)(null),[eu,ep]=(0,o.useState)(!1),[eh,eg]=(0,o.useState)(!1),ey=()=>{try{return(0,g.gd)("tenantId")||(0,g.gd)("businessid")||"default"}catch(e){return console.error("Error accessing AppCache for tenantId:",e),"default"}},[ex,eb]=(0,o.useState)(ey()),ef={first_name:"",last_name:"",email:"",phone:"",address:"",city:"",state:"",zip_code:"",country:"US",role:"employee",department:"",job_title:"",hire_date:new Date().toISOString().split("T")[0],date_joined:new Date().toISOString().split("T")[0],dob:new Date().toISOString().split("T")[0],salary:"",employment_status:"ACTIVE",employee_type:"FULL_TIME",security_number_type:"SSN",security_number:"",invite_to_onboard:!1,ID_verified:!1,areManager:!1,supervising:[]},[e_,ev]=(0,o.useState)(ef);Object.entries(c.Xr).map(e=>{let[t,r]=e;return{code:t,name:r.name}});let ej=e=>{switch(e){case"US":return"SSN";case"UK":case"GB":return"NIN";case"CA":return"SIN";case"AU":return"TFN";case"NZ":return"IRD";default:return"Tax ID"}},ew=e=>e&&Array.isArray(e)?(y.vF.debug("[EmployeeManagement] Normalizing ".concat(e.length," employees")),e.length>0&&y.vF.debug("[EmployeeManagement] Sample employee data:",e.slice(0,Math.min(3,e.length)).map(e=>({id:e.id,first_name:e.first_name,last_name:e.last_name,email:e.email}))),e.map(e=>{if(!e||"object"!=typeof e)return y.vF.warn("[EmployeeManagement] Invalid employee record:",e),{};let t=(0,a._)({id:e.id||"",first_name:"",last_name:"",email:"",phone_number:"",job_title:"",department:"",compensation_type:"SALARY",salary:0,wage_per_hour:0,hours_per_day:8,days_per_week:5,overtime_rate:1.5,active:!0,employment_type:"FULL_TIME",employment_status:"ACTIVE",date_joined:new Date().toISOString().split("T")[0],role:"employee"},e);if(t.first_name="string"==typeof t.first_name?t.first_name.trim().slice(0,100):String(t.first_name||"").trim().slice(0,100),t.middle_name="string"==typeof t.middle_name?t.middle_name.trim().slice(0,100):String(t.middle_name||"").trim().slice(0,100),t.last_name="string"==typeof t.last_name?t.last_name.trim().slice(0,100):String(t.last_name||"").trim().slice(0,100),t.email="string"==typeof t.email?t.email.trim().toLowerCase().slice(0,255):String(t.email||"").trim().toLowerCase().slice(0,255),t.phone_number="string"==typeof t.phone_number?t.phone_number.replace(/[^\d+\-() ]/g,"").trim().slice(0,20):String(t.phone_number||"").replace(/[^\d+\-() ]/g,"").trim().slice(0,20),t.job_title="string"==typeof t.job_title?t.job_title.trim().slice(0,100):String(t.job_title||"").trim().slice(0,100),t.department="string"==typeof t.department?t.department.trim().slice(0,100):String(t.department||"").trim().slice(0,100),!t.compensation_type){let e=parseFloat(t.salary||0);t.compensation_type=e>0?"SALARY":"WAGE"}if("WAGE"===t.compensation_type?(t.wage_per_hour=parseFloat(t.wage_per_hour||0),t.hours_per_day=parseFloat(t.hours_per_day||8),t.days_per_week=parseFloat(t.days_per_week||5),t.overtime_rate=parseFloat(t.overtime_rate||1.5)):t.salary=parseFloat(t.salary||0),t.active=!0===t.active||"true"===t.active||1===t.active||"1"===t.active,t.role){let e=String(t.role).toUpperCase();["ADMINISTRATOR"].includes(e)||["owner","OWNR"].includes(e)?t.role="owner":t.role="employee"}else t.role="employee";if(t.date_joined)try{let e=new Date(t.date_joined);isNaN(e.getTime())?(y.vF.warn("[EmployeeManagement] Invalid date_joined:",t.date_joined),t.date_joined=new Date().toISOString().split("T")[0]):t.date_joined=e.toISOString().split("T")[0]}catch(e){y.vF.warn("[EmployeeManagement] Error parsing date_joined:",e),t.date_joined=new Date().toISOString().split("T")[0]}else t.date_joined=new Date().toISOString().split("T")[0];if(t.employment_type){let e=String(t.employment_type).toUpperCase();["FT","FULL","FULL-TIME","FULL_TIME","FULLTIME"].includes(e)?t.employment_type="FULL_TIME":["PT","PART","PART-TIME","PART_TIME","PARTTIME"].includes(e)?t.employment_type="PART_TIME":t.employment_type="FULL_TIME"}else t.employment_type="FULL_TIME";return"3659"===t.id&&y.vF.debug("[EmployeeManagement] Found and processed employee 3659:",{id:t.id,name:"".concat(t.first_name," ").concat(t.last_name),email:t.email}),t})):(y.vF.warn("[EmployeeManagement] Invalid employees data received:",e),[]),eN=async e=>{var t,a,n,s,l,o,i;if(!e){y.vF.error("[EmployeeManagement] Cannot fetch employees: No tenant ID provided"),L("No tenant ID available. Please try refreshing the page."),T(!1);return}let c=null==(n=window)||null==(a=n.__APP_CACHE)||null==(t=a.auth)?void 0:t.token;if(!c){y.vF.warn("[EmployeeManagement] No auth token found in APP_CACHE before fetching employees");try{let{fetchAuthSession:e}=await Promise.all([r.e(31861),r.e(55158)]).then(r.bind(r,55158)),t=await e();if(null==t||null==(s=t.tokens)?void 0:s.idToken)c=t.tokens.idToken.toString(),y.vF.info("[EmployeeManagement] Successfully retrieved auth token directly from Amplify"),window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.auth=window.__APP_CACHE.auth||{},window.__APP_CACHE.auth.token=c;else{if(y.vF.error("[EmployeeManagement] No token available in Amplify session"),L("Authentication required. Please log in to view employees."),T(!1),!await (0,u.refreshUserSession)())return void y.vF.error("[EmployeeManagement] Session refresh failed - no token available");if(!(c=null==(i=window)||null==(o=i.__APP_CACHE)||null==(l=o.auth)?void 0:l.token))return void y.vF.error("[EmployeeManagement] Still no token after refresh")}}catch(e){y.vF.error("[EmployeeManagement] Error getting auth token from Amplify:",e),L("Authentication required. Please log in to view employees."),T(!1);return}}let m=c.substring(0,10)+"..."+c.substring(c.length-5);y.vF.debug("[EmployeeManagement] Using auth token for fetch: ".concat(m)),y.vF.info("[EmployeeManagement] Fetching employees with tenant ID: ".concat(e));try{if((0,d.resetCircuitBreakers)("/employees"),T(!0),L(null),S.current&&(clearTimeout(S.current),S.current=null),E.current){try{E.current.abort()}catch(e){}E.current=null}let t=new AbortController;E.current=t,S.current=setTimeout(async()=>{try{let e=await x.Rz.getAll({bypassCache:!0,_t:Date.now(),signal:t.signal,retry:2,timeout:1e4});if(!A.current)return;Array.isArray(e)?(y.vF.debug("[EmployeeManagement] Received ".concat(e.length," employees from API")),M(ew(e))):e&&Array.isArray(e.data)?(y.vF.debug("[EmployeeManagement] Received ".concat(e.data.length," employees from API (in data property)")),M(ew(e.data))):(y.vF.warn("[EmployeeManagement] Unexpected response format from employeeApi.getAll:",e),M([])),T(!1),eo(!1)}catch(t){var r,a,n;if(!A.current)return;if("AbortError"===t.name||(null==(r=t.message)?void 0:r.includes("aborted")))return void y.vF.info("[EmployeeManagement] Request aborted");if(y.vF.error("[EmployeeManagement] Error fetching employees:",t),(null==(a=t.response)?void 0:a.status)===403){y.vF.warn("[EmployeeManagement] Got 403 Forbidden, trying proxy route instead");try{let t=await fetch("/api/hr-proxy?tenantId=".concat(e),{method:"GET",headers:{Authorization:"Bearer ".concat(c),"Content-Type":"application/json"}}),r=await t.json();if(r.data&&Array.isArray(r.data)){y.vF.info("[EmployeeManagement] Successfully fetched employees through proxy route"),M(ew(r.data)),T(!1),eo(!1);return}y.vF.warn("[EmployeeManagement] Proxy route returned non-array data:",r)}catch(e){y.vF.error("[EmployeeManagement] Proxy route also failed:",e)}}if(T(!1),(null==(n=t.response)?void 0:n.status)===401||t.message&&(t.message.includes("401")||t.message.includes("Unauthorized")||t.message.includes("Authentication"))){y.vF.warn("[EmployeeManagement] Auth error detected in fetchEmployeesData"),await handleAuthError()||L("Your session has expired. Please log in again to view employees.");return}L("Failed to fetch employees. Please try again later."),t.message&&(t.message.includes("Circuit breaker")||t.message.includes("Network Error")||t.message.includes("timeout")||t.message.includes("aborted"))&&eo(!0)}finally{A.current&&(S.current=null,E.current=null)}},100)}catch(e){if(!A.current)return;y.vF.error("[EmployeeManagement] Error in fetchEmployeesData:",e),T(!1),L("Failed to fetch employees. Please try again later.")}},ek=async()=>{var e,t,r,a;try{(0,d.resetCircuitBreakers)("/employees"),(0,u.GC)();let a=ey();if(!(null==(r=window)||null==(t=r.__APP_CACHE)||null==(e=t.auth)?void 0:e.token)){if(y.vF.info("[EmployeeManagement] No token found, attempting to refresh session"),!await (0,u.refreshUserSession)()){y.vF.error("[EmployeeManagement] Session refresh failed - setting auth error"),L("Your session has expired. Please log in again to view employees."),es(!1),eo(!1),T(!1);return}y.vF.info("[EmployeeManagement] Session refreshed successfully")}if(window.__APP_CACHE&&window.__APP_CACHE.debug&&!0===window.__APP_CACHE.debug.useMockMode){y.vF.info("[EmployeeManagement] Using mock data mode from localStorage setting");try{T(!0);let e=await fetch("/api/hr/employees"),t=await e.json();if(Array.isArray(t)){M(ew(t)),T(!1),eo(!1);return}}catch(e){y.vF.error("[EmployeeManagement] Mock API error:",e)}}await eN(a)}catch(e){T(!1),y.vF.error("[EmployeeManagement] Error in fetchEmployees:",e),(null==e||null==(a=e.response)?void 0:a.status)===401||(null==e?void 0:e.message)&&((null==e?void 0:e.message.includes("401"))||(null==e?void 0:e.message.includes("Unauthorized"))||(null==e?void 0:e.message.includes("Authentication")))?(L("Authentication failed. Please log in again."),es(!1)):L("Failed to fetch employees. Please try again later.")}};(0,o.useEffect)(()=>((async()=>{try{y.vF.info("[EmployeeManagement] Testing backend connection before employee fetch...");try{let{verifyBackendConnection:e}=await Promise.resolve().then(r.bind(r,29729)),t=await e();y.vF.info("[EmployeeManagement] Backend connection test result:",t)}catch(e){y.vF.error("[EmployeeManagement] Backend connection test failed:",e)}(0,u.GC)();let e=async()=>{try{let{getCurrentUser:e}=await Promise.all([r.e(31861),r.e(55158)]).then(r.bind(r,55158));await e(),es(!0),ek()}catch(e){y.vF.error("[EmployeeManagement] Session check failed:",e),es(!1),L("Your session appears to be invalid. Please refresh your session or log in again.")}};await e()}catch(e){y.vF.error("[EmployeeManagement] Error loading employees:",e),v("Failed to load employees. Please refresh the page.")}})(),()=>{if(A.current=!1,S.current&&clearTimeout(S.current),E.current)try{E.current.abort()}catch(e){}}),[]),(0,o.useCallback)(()=>{let e=!(window.__APP_CACHE&&window.__APP_CACHE.debug&&!0===window.__APP_CACHE.debug.useMockMode);window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.debug=window.__APP_CACHE.debug||{},window.__APP_CACHE.debug.useMockMode=e,e?t("Switching to mock data mode"):j("Switching to real backend mode"),ek()},[]);let eC=async()=>{try{eo(!1),await ek(),t("Connection restored successfully!")}catch(e){y.vF.error("[EmployeeManagement] Error in handleConnectionRestored:",e),v("Failed to fetch data after connection restored.")}},eA=o.useMemo(()=>[{Header:"Name",accessor:e=>"".concat(e.first_name," ").concat(e.last_name),Cell:e=>{let{row:t}=e;return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm font-medium text-black",children:"".concat(t.original.first_name," ").concat(t.original.last_name)}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:t.original.job_title||"No title"})]})}},{Header:"Email",accessor:"email",Cell:e=>{let{value:t}=e;return(0,l.jsx)("div",{className:"text-sm text-black",children:t})}},{Header:"Department",accessor:"department",Cell:e=>{let{value:t}=e;return(0,l.jsx)("div",{className:"text-sm text-black",children:t||"N/A"})}},{Header:"Compensation",accessor:"compensation_type",Cell:e=>{let{row:t}=e,{compensation_type:r,salary:a,wage_per_hour:n}=t.original;return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm font-medium text-black",children:"SALARY"===r?"Salary":"Hourly Wage"}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:"SALARY"===r?"$".concat(parseFloat(a||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),"/year"):"$".concat(parseFloat(n||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),"/hour")})]})}},{Header:"Employment",accessor:"employment_type",Cell:e=>{let{value:t}=e;return(0,l.jsx)("div",{className:"text-sm text-black",children:"FT"===t?"Full-time":"Part-time"})}},{Header:"Status",accessor:"active",Cell:e=>{let{value:t}=e;return(0,l.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(t?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t?"Active":"Inactive"})}},{Header:"Actions",id:"actions",Cell:e=>{let{row:t}=e;return(0,l.jsxs)("div",{className:"text-right flex justify-end space-x-2",children:[(0,l.jsxs)("button",{onClick:()=>{eY(t.original)},className:"p-1 flex items-center bg-blue-50 text-blue-600 hover:bg-blue-100 rounded-md",title:"Edit",children:[(0,l.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),(0,l.jsx)("span",{className:"text-xs",children:"Edit"})]}),(0,l.jsxs)("button",{onClick:()=>{em(t.original),J(!0),X(!1),eg(!1)},className:"p-1 flex items-center bg-indigo-50 text-indigo-600 hover:bg-indigo-100 rounded-md",title:"Details",children:[(0,l.jsxs)("svg",{className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),(0,l.jsx)("span",{className:"text-xs",children:"Details"})]}),(0,l.jsxs)("button",{onClick:()=>eV(t.original.id),className:"p-1 flex items-center bg-red-50 text-red-600 hover:bg-red-100 rounded-md",title:"Delete",children:[(0,l.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),(0,l.jsx)("span",{className:"text-xs",children:"Delete"})]})]})}}],[]);o.useMemo(()=>P&&Array.isArray(P)?P:[],[P]);let eE=(0,o.useMemo)(()=>{if(!P||0===P.length)return[];if(!B.trim())return P;let e=B.toLowerCase().trim();return P.filter(t=>t.first_name&&t.first_name.toLowerCase().includes(e)||t.last_name&&t.last_name.toLowerCase().includes(e)||t.email&&t.email.toLowerCase().includes(e)||t.department&&t.department.toLowerCase().includes(e)||t.job_title&&t.job_title.toLowerCase().includes(e))},[P,B]),{getTableProps:eS,getTableBodyProps:eP,headerGroups:eM,page:eF,prepareRow:eT,canPreviousPage:eI,canNextPage:eL,pageOptions:eD,pageCount:eU,gotoPage:eW,nextPage:eR,previousPage:eH,setPageSize:ez,state:{pageIndex:eB,pageSize:eO}}=(0,h.useTable)({columns:eA,data:eE,initialState:{pageIndex:0,pageSize:10}},h.useSortBy,h.usePagination);(0,o.useCallback)(()=>{try{(0,d.resetCircuitBreakers)("/employees"),y.vF.info("[EmployeeManagement] Reset circuit breaker for /employees endpoint"),t("Connection reset successful. Trying again..."),setTimeout(()=>{eN(!0,0,!0)},500)}catch(e){y.vF.error("[EmployeeManagement] Error resetting circuit breaker:",e),v("Failed to reset connection. Please refresh the page.")}},[eN]);let eq=async r=>{r.preventDefault();try{if(X(!0),ea(null),ey(),!e_.first_name||!e_.last_name||!e_.email){ea("First name, last name, and email are required"),X(!1);return}e_.date_joined||(e_.date_joined=new Date().toISOString().split("T")[0]),await (0,u.refreshUserSession)();let r=await x.Rz.create(e_);r&&(r.id||r.success)?(M([...P,r]),ev(ef),R("list"),t("Employee created successfully!"),ek()):r&&r.message?(ea(r.message),(401===r.status||r.message.includes("Authentication"))&&(N("Session expired. Attempting to refresh..."),await (0,u.refreshUserSession)()?j("Session refreshed. Please try again."):(v("Failed to refresh session. Please log in again."),setTimeout(()=>e(),2e3)))):ea("Failed to create employee. Please try again.")}catch(t){if(y.vF.error("[EmployeeManagement] Error creating employee:",t),t.message&&t.message.includes("Authentication")){ea("Authentication failed. Refreshing your session...");try{await (0,u.refreshUserSession)()?ea("Session refreshed. Please try creating the employee again."):(ea("Failed to refresh session. Please log in again."),setTimeout(()=>e(),2e3))}catch(t){ea("Failed to refresh session. Please log in again."),setTimeout(()=>e(),2e3)}}else ea(t.message||"An unexpected error occurred while creating the employee")}finally{X(!1)}},eY=e=>{J(!1),em(null),ev(e),eg(!0),ed(!0),y.vF.debug("[EmployeeManagement] Edit employee initiated:",e.id)},eG=()=>{ei&&ed(!1),J(!1),em(null),y.vF.debug("[EmployeeManagement] Employee details closed")},eX=async e=>{e.preventDefault();try{if(Z(!0),ea(null),ey(),!e_.first_name||!e_.last_name||!e_.email){ea("First name, last name, and email are required"),Z(!1);return}let e=(0,a._)({},e_);if(e.dob&&"string"==typeof e.dob){let t=new Date(e.dob);isNaN(t.getTime())||(e.dob=t.toISOString().split("T")[0])}if(e.date_joined&&"string"==typeof e.date_joined){let t=new Date(e.date_joined);isNaN(t.getTime())||(e.date_joined=t.toISOString().split("T")[0])}if(e.probation_end_date&&"string"==typeof e.probation_end_date){let t=new Date(e.probation_end_date);isNaN(t.getTime())||(e.probation_end_date=t.toISOString().split("T")[0])}if(e.termination_date&&"string"==typeof e.termination_date){let t=new Date(e.termination_date);isNaN(t.getTime())||(e.termination_date=t.toISOString().split("T")[0])}if(e.last_work_date&&"string"==typeof e.last_work_date){let t=new Date(e.last_work_date);isNaN(t.getTime())||(e.last_work_date=t.toISOString().split("T")[0])}void 0!==e.salary&&null!==e.salary&&(e.salary=Number(e.salary)),void 0!==e.wage_per_hour&&null!==e.wage_per_hour&&(e.wage_per_hour=Number(e.wage_per_hour)),void 0!==e.hours_per_day&&null!==e.hours_per_day&&(e.hours_per_day=Number(e.hours_per_day)),void 0!==e.days_per_week&&null!==e.days_per_week&&(e.days_per_week=Number(e.days_per_week)),void 0!==e.overtime_rate&&null!==e.overtime_rate&&(e.overtime_rate=Number(e.overtime_rate)),e.active=!!e.active,e.onboarded=!!e.onboarded,e.probation=!!e.probation,e.health_insurance_enrollment=!!e.health_insurance_enrollment,e.pension_enrollment=!!e.pension_enrollment,e.ID_verified=!!e.ID_verified,e.areManager=!!e.areManager,y.vF.debug("[EmployeeManagement] Updating employee with formatted data:",JSON.stringify(e,null,2));let r=await x.Rz.update(e.id,e);r&&r.id?(M(P.map(t=>t.id===e.id?r:t)),ev(ef),ed(!1),t("Employee updated successfully!"),ek()):ea("Failed to update employee. Please try again.")}catch(t){y.vF.error("[EmployeeManagement] Error updating employee:",t);let e="An unexpected error occurred while updating the employee";if(t.response&&t.response.data){if("string"==typeof t.response.data)e=t.response.data;else if("object"==typeof t.response.data){let r=[];Object.entries(t.response.data).forEach(e=>{let[t,a]=e;Array.isArray(a)?r.push("".concat(t,": ").concat(a.join(", "))):r.push("".concat(t,": ").concat(a))}),r.length>0&&(e="Validation errors: ".concat(r.join("; ")))}}else t.message&&(e=t.message);ea(e)}finally{Z(!1)}},eV=async e=>{if(window.confirm("Are you sure you want to delete this employee?"))try{T(!0),ey(),await x.Rz.delete(e),M(P.filter(t=>t.id!==e)),t("Employee deleted successfully!")}catch(e){y.vF.error("[EmployeeManagement] Error deleting employee:",e),v(e.message||"An unexpected error occurred while deleting the employee")}finally{T(!1)}},eJ=e=>{let{name:t,value:r,type:s,checked:l}=e.target;"checkbox"===s?ev((0,n._)((0,a._)({},e_),{[t]:l})):"country"===t?ev((0,n._)((0,a._)({},e_),{[t]:r,security_number_type:ej(r)})):ev((0,n._)((0,a._)({},e_),{[t]:r}))};return(0,l.jsxs)("div",{className:"p-6 bg-white shadow-sm rounded-lg",children:[(0,l.jsx)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:(0,l.jsxs)("div",{children:[(0,l.jsx)(f,{variant:"h4",component:"h1",className:"mb-2",children:"Employee Portal"}),(0,l.jsx)(f,{variant:"body2",color:"textSecondary",children:"Manage employees and personal information"})]})}),(0,l.jsx)("div",{className:"border-b border-gray-200 mb-6",children:(0,l.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,l.jsx)("button",{onClick:()=>U("personal"),className:"".concat("personal"===D?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"),children:"Personal Information"}),(0,l.jsx)("button",{onClick:()=>{U("add-employee"),ev({first_name:"",last_name:"",email:"",phone:"",department:"",role:"",hire_date:new Date().toISOString().split("T")[0],employment_status:"PENDING",employee_type:"FULL_TIME",ID_verified:!1,areManager:!1,supervising:[]})},className:"".concat("add-employee"===D?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"),children:"Add Employee"}),(0,l.jsx)("button",{onClick:()=>U("list-employees"),className:"".concat("list-employees"===D?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"),children:"List Employees"})]})}),I&&(0,l.jsxs)(_,{severity:"error",className:"mb-4",children:[(0,l.jsx)("div",{className:"text-red-800",children:I}),!1]}),el&&(0,l.jsx)(b,{onConnectionRestored:eC}),"personal"===D?(0,l.jsx)(C,{}):"add-employee"===D?(0,l.jsx)(k,{onSubmit:eq,newEmployee:e_,handleInputChange:eJ,isLoading:G,setNewEmployee:ev,setShowAddForm:R,employees:P}):(0,l.jsxs)(l.Fragment,{children:[F?(0,l.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,l.jsx)(w,{size:"large",color:"primary"}),(0,l.jsx)("span",{className:"ml-3",children:"Loading employees..."})]}):F&&!P.length?(0,l.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"}),(0,l.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading employees..."})]})}):q||I?(0,l.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,l.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[(0,l.jsx)("h3",{className:"text-red-800 font-medium text-lg mb-2",children:"Error Loading Employees"}),(0,l.jsx)("p",{className:"text-red-700 mb-4",children:q||I}),(0,l.jsx)("button",{onClick:()=>eN(ex),className:"bg-red-100 text-red-800 px-4 py-2 rounded-md hover:bg-red-200 transition-colors",children:"Try Again"})]})}):P&&0!==P.length?0===eE.length?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 bg-white rounded-lg p-6",children:[(0,l.jsxs)("div",{className:"text-center mb-6",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-gray-300 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,l.jsx)("h3",{className:"text-xl font-medium text-black mb-2",children:"No Matching Employees"}),(0,l.jsxs)("p",{className:"text-gray-500 max-w-md",children:['No employees match your search criteria "',B,'". Try a different search term or clear the search.']})]}),(0,l.jsxs)("button",{className:"flex items-center px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 transition-colors",onClick:()=>O(""),children:[(0,l.jsx)("svg",{className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}),"Clear Search"]})]}):(0,l.jsx)("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:(0,l.jsxs)("table",(0,n._)((0,a._)({},eS()),{className:"min-w-full divide-y divide-gray-200",children:[(0,l.jsx)("thead",{className:"bg-gray-50",children:eM.map(e=>(0,l.jsx)("tr",(0,n._)((0,a._)({},e.getHeaderGroupProps()),{children:e.headers.map(e=>{let t=e.getHeaderProps(e.getSortByToggleProps()),{key:r}=t,o=(0,s._)(t,["key"]);return(0,l.jsxs)("th",(0,n._)((0,a._)({},o),{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:[e.render("Header"),(0,l.jsx)("span",{children:e.isSorted?e.isSortedDesc?" \uD83D\uDD3D":" \uD83D\uDD3C":""})]}),r)})})))}),(0,l.jsx)("tbody",(0,n._)((0,a._)({},eP()),{className:"bg-white divide-y divide-gray-200",children:eF.map((e,t)=>{eT(e);let r=e.getRowProps(),{key:o}=r,i=(0,s._)(r,["key"]);return(0,l.jsx)("tr",(0,n._)((0,a._)({},i),{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>{em(e.original),J(!0)},children:e.cells.map(e=>{let t=e.getCellProps(),{key:r}=t,o=(0,s._)(t,["key"]);return(0,l.jsx)("td",(0,n._)((0,a._)({},o),{className:"px-6 py-4 whitespace-nowrap",onClick:t=>{"actions"===e.column.id&&t.stopPropagation()},children:e.render("Cell")}),r)})}),o||e.id||t)})}))]}))}):(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 bg-white rounded-lg p-6",children:[(0,l.jsxs)("div",{className:"text-center mb-6",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-gray-300 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})}),(0,l.jsx)("h3",{className:"text-xl font-medium text-black mb-2",children:"No Employees Yet"}),(0,l.jsx)("p",{className:"text-gray-500 max-w-md",children:'You haven\'t added any employees to your organization yet. Get started by clicking the "Add Employee" button above.'})]}),(0,l.jsxs)("button",{className:"flex items-center px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 transition-colors",onClick:()=>{R("add"),X(!1),eg(!1),J(!1),em(null)},children:[(0,l.jsx)("svg",{className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"Add Employee"]})]}),ei&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[60] flex items-center justify-center",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-auto",style:{marginLeft:"120px"},children:[(0,l.jsxs)("div",{className:"sticky top-0 bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-4 flex justify-between items-center",children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-white",children:"Edit Employee"}),(0,l.jsx)("button",{onClick:()=>{ed(!1),eg(!1),J(!1),y.vF.debug("[EmployeeManagement] Edit form closed")},className:"text-white hover:text-blue-100","aria-label":"Close",children:(0,l.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,l.jsx)(k,{isEdit:!0,onSubmit:eX,newEmployee:e_,handleInputChange:eJ,isLoading:K,setNewEmployee:ev,setShowEditForm:ed,employees:P})]})}),(()=>{var e,t;return ec&&V?(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[55] flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:[(0,l.jsx)("div",{className:"sticky top-0 bg-white px-6 py-4 border-b border-gray-200 z-10",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("h3",{className:"text-lg font-medium",children:[ec.first_name," ",ec.last_name]}),(0,l.jsx)("button",{onClick:eG,className:"text-gray-400 hover:text-gray-500",children:(0,l.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,l.jsx)("div",{className:"px-6 py-4",children:(0,l.jsxs)("div",{className:"flex flex-wrap mb-6",children:[(0,l.jsx)("div",{className:"mb-4 w-full md:w-1/3 pr-4",children:(0,l.jsxs)("div",{className:"flex flex-col items-center p-4 bg-gray-50 rounded-lg",children:[(0,l.jsxs)("div",{className:"w-20 h-20 rounded-full bg-blue-600 flex items-center justify-center text-white text-xl font-bold mb-2",children:[null==(e=ec.first_name)?void 0:e[0],null==(t=ec.last_name)?void 0:t[0]]}),(0,l.jsxs)("h4",{className:"text-lg font-semibold",children:[ec.first_name," ",ec.middle_name?ec.middle_name[0]+". ":"",ec.last_name]}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:ec.job_title||"No Title"}),(0,l.jsxs)("div",{className:"mt-4 w-full flex flex-col space-y-2",children:[(0,l.jsxs)("button",{onClick:()=>{J(!1),eY(ec)},className:"flex items-center justify-center w-full px-3 py-2 border border-gray-300 text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,l.jsx)("svg",{className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Edit Employee"]}),(0,l.jsxs)("button",{onClick:()=>eV(ec.id),className:"flex items-center justify-center w-full px-3 py-2 border border-gray-300 text-sm leading-4 font-medium rounded-md text-red-700 bg-white hover:bg-red-50 hover:border-red-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[(0,l.jsx)("svg",{className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete Employee"]})]})]})}),(0,l.jsx)("div",{className:"mb-4 w-full md:w-2/3",children:(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Email"}),(0,l.jsx)("span",{className:"block mt-1",children:ec.email})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Phone"}),(0,l.jsx)("span",{className:"block mt-1",children:ec.phone_number||"Not provided"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Job Title"}),(0,l.jsx)("span",{className:"block mt-1",children:ec.job_title||"Not assigned"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Department"}),(0,l.jsx)("span",{className:"block mt-1",children:ec.department||"Not assigned"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Management"}),(0,l.jsx)("span",{className:"block mt-1",children:ec.areManager?(0,l.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Manager"]}):"Not a manager"})]}),ec.supervising&&ec.supervising.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Supervising"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:ec.supervising.map(e=>{let t=P.find(t=>t.id===e);return t?(0,l.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:[t.first_name," ",t.last_name]},e):null})})]}),P.some(e=>e.supervising&&e.supervising.includes(ec.id))&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Reports to"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:P.filter(e=>e.supervising&&e.supervising.includes(ec.id)).map(e=>(0,l.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800",children:[e.first_name," ",e.last_name]},e.id))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Role"}),(0,l.jsx)("span",{className:"block mt-1",children:"ADMIN"===ec.role||"ADMN"===ec.role?"Administrator":"owner"===ec.role||"OWNR"===ec.role?"owner":"employee"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Employment Type"}),(0,l.jsx)("span",{className:"block mt-1",children:"FT"===ec.employment_type?"Full-time":"Part-time"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Date Joined"}),(0,l.jsx)("span",{className:"block mt-1",children:ec.date_joined?(0,m.A)(new Date(ec.date_joined),"MMMM d, yyyy"):"Not provided"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Gender"}),(0,l.jsx)("span",{className:"block mt-1",children:ec.gender||"Not provided"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Marital Status"}),(0,l.jsx)("span",{className:"block mt-1",children:ec.marital_status||"Not provided"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Country"}),(0,l.jsx)("span",{className:"block mt-1",children:ec.country||"Not provided"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Street"}),(0,l.jsx)("span",{className:"block mt-1",children:ec.street||"Not provided"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"City"}),(0,l.jsx)("span",{className:"block mt-1",children:ec.city||"Not provided"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"block text-sm font-medium text-gray-500",children:"Postcode"}),(0,l.jsx)("span",{className:"block mt-1",children:ec.postcode||"Not provided"})]})]})})]})})]})}):null})()]})]})}}}]);