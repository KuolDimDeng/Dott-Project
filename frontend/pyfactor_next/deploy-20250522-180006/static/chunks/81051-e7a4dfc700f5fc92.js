"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[81051],{49852:(e,t,r)=>{r.d(t,{K:()=>c});var a=r(29729),o=r(42749);let c={async getTenantInfo(e){try{if(!e)return o.vF.warn("[apiService] No tenant ID provided to getTenantInfo"),null;return(await a.Ay.get("/api/tenants/".concat(e))).data}catch(t){if(t.response&&404===t.response.status)return o.vF.warn("[apiService] Tenant not found: ".concat(e)),null;return o.vF.warn("[apiService] Error fetching tenant info: ".concat(t.message,". Using mock data.")),{id:e,name:"Business ".concat(e.substring(0,8)),type:"business",status:"active",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}},async getUserTenants(){try{return(await a.Ay.get("/api/tenants")).data}catch(e){return o.vF.warn("[apiService] Error fetching user tenants: ".concat(e.message,". Using mock data.")),[{id:"11111111-1111-1111-1111-111111111111",name:"",type:"business",status:"active",isOwner:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}]}}}},81051:(e,t,r)=>{r.d(t,{o:()=>h});var a=r(55166),o=r(49852),c=r(42749);let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PRD",t=Math.floor(1e4+9e4*Math.random()),r=Date.now().toString().slice(-6);return"".concat(e,"-").concat(t,"-").concat(r)},i={productsCache:new Map,productStatsCache:null,categoriesCache:new Map,suppliersCache:new Map,locationsCache:new Map,lastCacheTime:0,cacheExpiry:3e5},s=()=>{i.productsCache.clear(),i.productStatsCache=null,i.lastCacheTime=0,c.vF.debug("Product cache cleared")},d=()=>({}),u=()=>{let e=[];for(let t=1;t<=20;t++)e.push({id:"mock-".concat(t),name:"Mock Product ".concat(t),description:"This is a mock product for testing purposes ".concat(t),price:(100*Math.random()).toFixed(2),product_code:"MOCK-".concat(1e3+t),stock_quantity:Math.floor(100*Math.random()),reorder_level:10,category_id:t%5+1,supplier_id:t%3+1,location_id:t%4+1,is_active:!0,tax_rate:8.5,cost_price:(50*Math.random()).toFixed(2),last_ordered_date:new Date(Date.now()-1e10*Math.random()).toISOString(),created_at:new Date(Date.now()-1e10*Math.random()).toISOString(),updated_at:new Date(Date.now()-1e9*Math.random()).toISOString(),image_url:t%3==0?"https://picsum.photos/id/".concat(t+100,"/200/200"):null});return e},l=async e=>{if(!e)throw c.vF.error("Product ID is required for deletion"),Error("Product ID is required for deletion");try{return c.vF.info("Deleting product ".concat(e)),await o.K.delete("/api/inventory/products/".concat(e,"/"),{invalidateCache:["/api/inventory/products/","/api/inventory/ultra/products/","/api/inventory/products/".concat(e,"/")],headers:d()}),s(),!0}catch(t){throw c.vF.error("Error deleting product ".concat(e,":"),t),t}},p=async e=>{if(!e||!Array.isArray(e)||0===e.length)throw c.vF.error("Valid array of product IDs is required for bulk deletion"),Error("Valid array of product IDs is required for bulk deletion");try{c.vF.info("Bulk deleting ".concat(e.length," products"));let t=await o.K.post("/api/inventory/products/bulk-delete/",{ids:e},{invalidateCache:["/api/inventory/products/","/api/inventory/ultra/products/"],headers:d()});return s(),t}catch(r){c.vF.error("Error bulk deleting products:",r);let t={success_count:0,failed_ids:[]};for(let r of e)try{await l(r),t.success_count++}catch(e){c.vF.error("Error deleting product ".concat(r,":"),e),t.failed_ids.push(r)}return t}},h={getProducts:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let{page:r=1,limit:a=20,search:n="",category_id:s="",supplier_id:l="",location_id:p="",sort_by:h="name",sort_order:g="asc",view_mode:v="standard",include_inactive:f=!1}=e,y=JSON.stringify({page:r,limit:a,search:n,category_id:s,supplier_id:l,location_id:p,sort_by:h,sort_order:g,view_mode:v,include_inactive:f});if(i.productsCache.has(y)&&Date.now()-i.lastCacheTime<i.cacheExpiry)return c.vF.debug("Returning products from cache for key:",y),i.productsCache.get(y);c.vF.debug("Fetching products with params:",{params:e,options:t});try{let t=new URLSearchParams;Object.entries(e).forEach(e=>{let[r,a]=e;null!=a&&""!==a&&t.append(r,a)});let r=await o.K.get("/api/inventory/products/?".concat(t.toString()),{headers:d()});return i.productsCache.set(y,r),i.lastCacheTime=Date.now(),r}catch(d){c.vF.error("Error fetching products from API:",d),c.vF.info("Returning mock products as fallback");let e=[...u()];if(n){let t=n.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)||e.product_code.toLowerCase().includes(t))}s&&(e=e.filter(e=>e.category_id===parseInt(s))),l&&(e=e.filter(e=>e.supplier_id===parseInt(l))),p&&(e=e.filter(e=>e.location_id===parseInt(p))),f||(e=e.filter(e=>e.is_active)),e.sort((e,t)=>{let r=e[h],a=t[h];return"asc"===g?r>a?1:-1:r<a?1:-1});let t=(r-1)*a,o={data:e.slice(t,t+a),pagination:{total:e.length,page:r,limit:a,total_pages:Math.ceil(e.length/a)}};return i.productsCache.set(y,o),i.lastCacheTime=Date.now(),o}}catch(e){throw c.vF.error("Error in getProducts:",e),e}},getProductStats:async()=>{try{if(i.productStatsCache&&Date.now()-i.lastCacheTime<i.cacheExpiry)return c.vF.debug("Returning product stats from cache"),i.productStatsCache;c.vF.debug("Fetching product statistics");try{let e=await o.K.get("/api/inventory/stats/",{headers:d()});return i.productStatsCache=e,i.lastCacheTime=Date.now(),e}catch(r){c.vF.error("Error fetching product stats from API:",r);let e=u(),t={total_products:e.length,low_stock_count:e.filter(e=>e.stock_quantity<e.reorder_level).length,total_value:e.reduce((e,t)=>e+parseFloat(t.price)*t.stock_quantity,0).toFixed(2),new_products_count:e.filter(e=>new Date(e.created_at)>new Date(Date.now()-6048e5)).length};return i.productStatsCache=t,i.lastCacheTime=Date.now(),t}}catch(e){throw c.vF.error("Error in getProductStats:",e),e}},getCategories:async()=>{try{if(i.categoriesCache.size>0&&Date.now()-i.lastCacheTime<i.cacheExpiry)return c.vF.debug("Returning categories from cache"),Array.from(i.categoriesCache.values());c.vF.debug("Fetching product categories");try{let e=await o.K.get("/api/inventory/categories/",{headers:d()});return e.forEach(e=>i.categoriesCache.set(e.id,e)),i.lastCacheTime=Date.now(),e}catch(t){c.vF.error("Error fetching categories from API:",t);let e=[{id:1,name:"Electronics",description:"Electronic devices and accessories"},{id:2,name:"Furniture",description:"Home and office furniture"},{id:3,name:"Clothing",description:"Apparel and fashion items"},{id:4,name:"Food",description:"Groceries and food items"},{id:5,name:"Other",description:"Other miscellaneous items"}];return e.forEach(e=>i.categoriesCache.set(e.id,e)),i.lastCacheTime=Date.now(),e}}catch(e){throw c.vF.error("Error in getCategories:",e),e}},createProduct:async e=>{try{console.log("DEBUG: unifiedInventoryService.createProduct - Starting product creation:",e),c.vF.info("Creating product:",e),e.product_code||(e.product_code=n(e.name),console.log("DEBUG: Generated product code:",e.product_code));let t=e,r=(0,a._)({},d());if(console.log("DEBUG: Using tenant headers:",r),e.image_file){let r=new FormData;Object.entries(e).forEach(e=>{let[t,a]=e;"image_file"===t?r.append("image",a):null!=a&&r.append(t,a)}),t=r,console.log("DEBUG: Using FormData for image upload")}else r["Content-Type"]="application/json",console.log("DEBUG: Using JSON content type");console.log("DEBUG: Making API request to create product to /api/inventory/products/");let i=await o.K.post("/api/inventory/products/",t,{invalidateCache:["/api/inventory/products/","/api/inventory/ultra/products/"],headers:r});return console.log("DEBUG: Product API response received:",i),s(),console.log("DEBUG: Product cache cleared"),c.vF.info("Product created successfully:",i),i}catch(e){throw console.error("DEBUG: Error creating product:",e),c.vF.error("Error creating product:",e),e}},updateProduct:async(e,t)=>{if(!e)throw c.vF.error("Product ID is required for update"),Error("Product ID is required for update");try{c.vF.info("Updating product ".concat(e,":"),t);let r=t,n=(0,a._)({},d());if(t.image_file){let e=new FormData;Object.entries(t).forEach(t=>{let[r,a]=t;"image_file"===r?e.append("image",a):null!=a&&e.append(r,a)}),r=e}else n["Content-Type"]="application/json";let i=await o.K.put("/api/inventory/products/".concat(e,"/"),r,{invalidateCache:["/api/inventory/products/","/api/inventory/ultra/products/","/api/inventory/products/".concat(e,"/")],headers:n});return s(),i}catch(t){throw c.vF.error("Error updating product ".concat(e,":"),t),t}},deleteProduct:l,bulkDeleteProducts:p,importProducts:async e=>{try{c.vF.info("Importing products from file:",e.name);let t=new FormData;t.append("file",e);let r=await o.K.post("/api/inventory/products/import/",t,{invalidateCache:["/api/inventory/products/","/api/inventory/ultra/products/"],headers:d()});return s(),r}catch(e){throw c.vF.error("Error importing products:",e),e}},exportProducts:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"csv",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{c.vF.info("Exporting products as ".concat(e),{filters:t});let r=new URLSearchParams;return r.append("format",e),Object.entries(t).forEach(e=>{let[t,a]=e;null!=a&&""!==a&&r.append(t,a)}),await o.K.get("/api/inventory/products/export/?".concat(r.toString()),{responseType:"blob",headers:d()})}catch(t){throw c.vF.error("Error exporting products as ".concat(e,":"),t),t}},clearProductCache:s,clearAllCaches:()=>{i.productsCache.clear(),i.productStatsCache=null,i.categoriesCache.clear(),i.suppliersCache.clear(),i.locationsCache.clear(),i.lastCacheTime=0,c.vF.debug("All inventory caches cleared")},getMockProducts:u}}}]);