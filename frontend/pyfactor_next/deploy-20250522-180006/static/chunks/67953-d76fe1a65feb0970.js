"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[67953],{18997:(e,t,r)=>{r.d(t,{Bm:()=>S,Bp:()=>H,CJ:()=>w,HE:()=>y,MG:()=>A,RA:()=>M,U4:()=>W,UF:()=>L,Y4:()=>x,ZF:()=>I,f7:()=>k,xf:()=>T});var n=r(55166),i=r(68387),o=r(57247),a=r(42749);let l=0,c=0,s=[],u="undefined"!=typeof navigator&&navigator.onLine,f="unknown",d=!0,m=0,g=[],p={CLOSED:"CLOSED",OPEN:"OPEN",HALF_OPEN:"HALF_OPEN"},h={state:p.CLOSED,failureCount:0,lastFailure:0,successCount:0,failureThreshold:3,resetTimeout:3e4,successThreshold:2},w=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p.CLOSED;return h.state=e,h.failureCount=0,h.successCount=0,h.lastFailure=0,a.vF.info("[CircuitBreaker] Cognito circuit has been manually reset to ".concat(e," state")),e},y=()=>{let e=Date.now();switch(h.state){case p.CLOSED:return!0;case p.OPEN:if(e-h.lastFailure>h.resetTimeout)return h.state=p.HALF_OPEN,h.successCount=0,a.vF.info("[CircuitBreaker] Cognito circuit transitioned from OPEN to HALF_OPEN"),!0;return!1;case p.HALF_OPEN:default:return!0}},A=()=>{h.state===p.HALF_OPEN&&(h.successCount++,h.successCount>=h.successThreshold&&(h.state=p.CLOSED,h.failureCount=0,h.successCount=0,a.vF.info("[CircuitBreaker] Cognito circuit transitioned from HALF_OPEN to CLOSED")))},b=0,v=0,E=!1,_=!0,C={maxRetries:3,baseDelay:1e3,maxDelay:5e3},F={primary:"/api/health",fallbacks:["/api/ping","/api/status","/health","/ping"]},T=e=>{m++;let t=Date.now();return g.push(t),g=g.filter(e=>t-e<6e4),m>=3&&(a.vF.warn("[NetworkMonitor] Multiple Cognito failures detected (".concat(m,"):"),e),D({type:"cognito-degradation",failures:m,source:"cognito",error:(null==e?void 0:e.message)||String(e)})),h.lastFailure=t,h.state===p.CLOSED?(h.failureCount++,h.failureCount>=h.failureThreshold&&(h.state=p.OPEN,a.vF.warn("[CircuitBreaker] Cognito circuit transitioned from CLOSED to OPEN"))):h.state===p.HALF_OPEN&&(h.state=p.OPEN,a.vF.warn("[CircuitBreaker] Cognito circuit transitioned from HALF_OPEN to OPEN")),{cognito:{failures:m,isReliable:m<3}}},k=()=>(_=!0,window.addEventListener("online",N),window.addEventListener("offline",R),navigator.onLine?setTimeout(()=>U(),100):(u=!1,f="offline"),a.vF.info("[NetworkMonitor] Monitoring initialized, current status:",u?"online":"offline"),()=>{if(_=!1,window.removeEventListener("online",N),window.removeEventListener("offline",R),void 0!==window.__NETWORK_ABORT_CONTROLLERS)try{(window.__NETWORK_ABORT_CONTROLLERS||[]).forEach(e=>{try{e.abort()}catch(e){}}),window.__NETWORK_ABORT_CONTROLLERS=[]}catch(e){}}),N=()=>{u=!0,a.vF.info("[NetworkMonitor] Connection restored"),setTimeout(()=>{_&&U()},500)},R=()=>{u=!1,f="offline",a.vF.info("[NetworkMonitor] Connection lost"),D({type:"offline",quality:"offline"})},P=e=>{if(!e)return e;try{window.__NETWORK_ABORT_CONTROLLERS=window.__NETWORK_ABORT_CONTROLLERS||[],!window.__NETWORK_ABORT_CONTROLLERS.some(t=>t===e)&&(window.__NETWORK_ABORT_CONTROLLERS.push(e),e.signal&&"function"==typeof e.signal.addEventListener&&e.signal.addEventListener("abort",()=>{try{let t=window.__NETWORK_ABORT_CONTROLLERS.indexOf(e);-1!==t&&window.__NETWORK_ABORT_CONTROLLERS.splice(t,1)}catch(e){a.vF.debug("[NetworkMonitor] Error cleaning up abort controller:",e.message)}}))}catch(e){a.vF.debug("[NetworkMonitor] Error registering abort controller:",e.message)}return e},I=()=>{let e=Date.now();return e-v<1e4?(a.vF.debug("[NetworkMonitor] Health check in cooldown (".concat(Math.round((e-v)/1e3),"s elapsed of ").concat(10,"s cooldown)")),!1):!(b>=2)||(a.vF.debug("[NetworkMonitor] Max concurrent health checks already running (".concat(b,"/").concat(2,")")),!1)},U=async()=>{if(!_||!u){f=u?"unknown":"offline";return}if(!I())return f;v=Date.now(),b++;let e=0,t=F.fallbacks.length+1;try{let r=new AbortController;P(r);let n=!1,i=setTimeout(()=>{n=!0;try{r&&"object"==typeof r&&r.signal&&"object"==typeof r.signal&&!r.signal.aborted&&"function"==typeof r.abort&&r.abort()}catch(e){a.vF.debug("[NetworkMonitor] Error while aborting controller:",e.message)}},2e3);try{if(!_){clearTimeout(i),b--;return}let n=Date.now(),o=0===e?F.primary:F.fallbacks[e-1]||F.primary;a.vF.debug("[NetworkMonitor] Checking network quality using endpoint: ".concat(o));let l=await fetch(o,{method:"HEAD",cache:"no-store",headers:{"Cache-Control":"no-cache"},signal:r.signal});if(clearTimeout(i),!_)return void b--;let c=Date.now()-n;if(404===l.status){if(++e<t)return a.vF.debug("[NetworkMonitor] Endpoint ".concat(o," returned 404, trying fallback #").concat(e)),clearTimeout(i),b--,U();a.vF.warn("[NetworkMonitor] All health endpoints returned 404, assuming network OK but services unavailable"),f="good"}else l.ok?(f=c<100?"excellent":c<300?"good":c<600?"fair":"poor",a.vF.info("[NetworkMonitor] Network quality: ".concat(f," (").concat(c,"ms)"))):(f="degraded",a.vF.warn("[NetworkMonitor] Health check failed with status:",l.status))}catch(e){if(clearTimeout(i),!_)return void b--;"AbortError"===e.name||n?f="poor":(f="degraded",a.vF.warn("[NetworkMonitor] Health check failed:",e.message||e))}}catch(e){a.vF.warn("[NetworkMonitor] Error in health check setup:",e),f="degraded"}finally{b--}if(_)return D({type:"quality-change",quality:f}),f},O=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(l++,!t){c++;let t={timestamp:Date.now(),endpoint:e,error:r?r.message||String(r):"Unknown error"};s.push(t),s.length>10&&s.shift(),(0,o.yt)(e,r);let n=c/l;n>.5&&l>=3&&(a.vF.error("[NetworkMonitor] High API failure rate detected: ".concat(Math.round(100*n),"%")),D({type:"api-degradation",failureRate:n,recentFailures:[...s]}),U())}return l>100&&(l=Math.floor(l/2),c=Math.floor(c/2)),{success:t,monitored:l,failed:c,failureRate:c/l}},D=e=>{let t=new CustomEvent("network-status",{detail:(0,i._)((0,n._)({},e),{timestamp:Date.now(),isOnline:u,quality:f,criticalEndpointsAvailable:d})});window.dispatchEvent(t)},S=()=>m>=3,M=()=>0===m?5e3:Math.min(5e3+Math.min(1e3*m,7e3),8e3),L=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Date.now(),o=!1,l=null;try{let r=new AbortController;P(r);let a=t.timeout||1e4,c=setTimeout(()=>{try{r&&!r.signal.aborted&&r.abort()}catch(e){}},a),s=await fetch(e,(0,i._)((0,n._)({},t),{signal:r.signal}));return clearTimeout(c),(o=s.ok)||((l=Error("HTTP error ".concat(s.status))).status=s.status),O(e,o,l),s}catch(t){if(o=!1,"AbortError"===(l=t).name){if(!_)return new Response("",{status:200});let t=Error("Request to ".concat(e," timed out"));throw t.name="TimeoutError",t.originalError=l,O(e,!1,t),t}throw O(e,!1,t),t}finally{let t=Date.now()-r;t>2e3&&a.vF.warn("[NetworkMonitor] Slow API call to ".concat(e,": ").concat(t,"ms"))}},H=async()=>{if(b>=2||!_)return a.vF.info("[NetworkMonitor] Skipping health check, already in progress or component unmounted"),d;if(window.location.pathname.includes("/auth/")||window.location.pathname.includes("/sign-in")||window.location.pathname.includes("/sign-up")||"/"===window.location.pathname||"/login"===window.location.pathname)return a.vF.info("[NetworkMonitor] Skipping emergency recovery on auth/public page"),!0;b++;try{let e,t=[{url:F.primary,fallbacks:F.fallbacks,critical:!0},{url:"/api/user/profile",fallbacks:["/api/user/me","/api/profile"],critical:!1},{url:"/api/auth/session",fallbacks:["/api/auth/status","/api/auth/check"],critical:!0}],r=new AbortController;P(r);try{if(e=setTimeout(()=>{try{r&&!r.signal.aborted&&r.abort()}catch(e){}},3e3),!_)return clearTimeout(e),b--,d;let n=await Promise.allSettled(t.map(async e=>{if(!_)return{endpoint:e.url,ok:!0,critical:e.critical};try{let t=await fetch(e.url,{method:"HEAD",cache:"no-store",headers:{"Cache-Control":"no-cache"},signal:r.signal});if(404===t.status&&e.fallbacks&&e.fallbacks.length>0){for(let n of(a.vF.debug("[NetworkMonitor] Endpoint ".concat(e.url," returned 404, trying fallbacks")),e.fallbacks)){if(!_)break;try{if(t=await fetch(n,{method:"HEAD",cache:"no-store",headers:{"Cache-Control":"no-cache"},signal:r.signal}),404!==t.status){a.vF.debug("[NetworkMonitor] Fallback endpoint ".concat(n," returned status ").concat(t.status));break}}catch(e){a.vF.debug("[NetworkMonitor] Fallback endpoint ".concat(n," error:"),e.message)}}if(404===t.status)return a.vF.debug("[NetworkMonitor] All fallbacks for ".concat(e.url," returned 404, assuming network OK")),{endpoint:e.url,status:200,ok:!0,critical:e.critical}}return{endpoint:e.url,status:t.status,ok:t.ok,critical:e.critical}}catch(t){if(!_)return{endpoint:e.url,ok:!0,critical:e.critical};return{endpoint:e.url,error:"AbortError"===t.name?"timeout":t.message,ok:!1,critical:e.critical}}}));if(e&&clearTimeout(e),!_)return b--,d;let i=n.filter((e,r)=>t[r].critical&&("rejected"===e.status||"fulfilled"===e.status&&!e.value.ok)).map((e,r)=>"fulfilled"===e.status?e.value:{endpoint:t[r].url,error:"Request failed",critical:t[r].critical});if(i.length>0){if(a.vF.error("[NetworkMonitor] Critical API endpoints unavailable:",i),d=!1,i.length===t.filter(e=>e.critical).length&&!E&&_)return a.vF.error("[NetworkMonitor] All critical endpoints unavailable, triggering emergency recovery"),E=!0,setTimeout(()=>{E=!1},1e4),(0,o.GJ)(),b--,!1}else d=!0}catch(t){e&&clearTimeout(e),a.vF.error("[NetworkMonitor] Error in API health check:",t),d=!0}}finally{b--}return d},x=e=>{let t=t=>{e(t.detail)};return window.addEventListener("network-status",t),()=>window.removeEventListener("network-status",t)},W=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(0,n._)({},C,t);return new Promise((t,n)=>{let i=0,o=()=>{let l=document.createElement("script");if(l.src=e,l.async=!0,i>0){let e="_cb=".concat(Date.now());l.src=l.src.includes("?")?"".concat(l.src,"&").concat(e):"".concat(l.src,"?").concat(e)}l.onload=()=>{a.vF.info("[NetworkMonitor] External script loaded successfully: ".concat(e)),t(l)},l.onerror=t=>{if(document.body.removeChild(l),i<r.maxRetries){i++;let t=Math.min(r.baseDelay*Math.pow(2,i-1),r.maxDelay);a.vF.warn("[NetworkMonitor] Script load failed, retrying (".concat(i,"/").concat(r.maxRetries,") after ").concat(t,"ms: ").concat(e)),setTimeout(o,t)}else a.vF.error("[NetworkMonitor] Failed to load script after ".concat(r.maxRetries," attempts: ").concat(e)),n(Error("Failed to load script: ".concat(e)))},document.body.appendChild(l)};o()})}},21898:(e,t,r)=>{r.d(t,{cw:()=>g,iD:()=>p,rE:()=>w});var n=r(55166),i=r(68387),o=r(42749),a=r(18997),l=r(57247);r(60584);let c={userAttributes:null,tokens:null,timestamp:0,session:null,memoizedResults:new Map,memoExpiry:6e4},s=e=>{if(e&&Object.keys(e).length>0){c.userAttributes=(0,n._)({},e),c.timestamp=Date.now();try{try{sessionStorage.setItem("amplify_cached_attributes",JSON.stringify({attributes:c.userAttributes,timestamp:c.timestamp}))}catch(e){}window.__APP_CACHE&&(window.__APP_CACHE.user=window.__APP_CACHE.user||{},window.__APP_CACHE.user.attributes=(0,n._)({},e),window.__APP_CACHE.user.timestamp=Date.now())}catch(e){o.vF.debug("[AmplifyResiliency] Error caching user attributes:",e)}return!0}return!1},u=e=>!!e&&(c.session=e,c.timestamp=Date.now(),!0);try{let e=sessionStorage.getItem("amplify_cached_attributes");if(e){let t=JSON.parse(e);t.attributes&&t.timestamp&&Date.now()-t.timestamp<36e5&&(c.userAttributes=t.attributes,c.timestamp=t.timestamp,o.vF.debug("[AmplifyResiliency] Loaded cached user attributes from sessionStorage (".concat((Date.now()-t.timestamp)/1e3,"s old)")))}if(window.__APP_CACHE&&window.__APP_CACHE.user&&window.__APP_CACHE.user.attributes){let e=window.__APP_CACHE.user.timestamp||0;(!c.userAttributes||e>c.timestamp)&&(c.userAttributes=(0,n._)({},window.__APP_CACHE.user.attributes),c.timestamp=e,o.vF.debug("[AmplifyResiliency] Loaded cached user attributes from APP_CACHE (".concat((Date.now()-e)/1e3,"s old)")))}}catch(e){o.vF.debug("[AmplifyResiliency] Error loading cached attributes:",e)}let f=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.memoExpiry,n=c.memoizedResults.get(e);return n&&Date.now()-n.timestamp<r?(o.vF.debug("[AmplifyResiliency] Using memoized result for ".concat(e," (").concat((Date.now()-n.timestamp)/1e3,"s old)")),Promise.resolve(n.result)):t().then(t=>(c.memoizedResults.set(e,{result:t,timestamp:Date.now()}),t))},d=["name","given_name","family_name","preferred_username","email","phone_number","address","birthdate","gender","locale","picture","website","zoneinfo","custom:tenant_ID","custom:tenant_Id","custom:tenant_id","custom:tenantID","custom:tenantId","custom:tenantid","custom:businessid","custom:businessId","custom:business_id","custom:business_ID","custom:onboarding","custom:setupdone","custom:setup_done","custom:plan","custom:subplan","custom:subscription_plan","custom:created_at","custom:updated_at","custom:last_login","custom:theme","custom:language","custom:timezone","custom:preferences"],m=e=>{let t={},r=!1,n=[];return Object.entries(e).forEach(e=>{let[i,o]=e;d.includes(i)?t[i]=o:(r=!0,n.push(i))}),r&&o.vF.warn("[Amplify] Dropped unauthorized attributes:",n),t},g=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!1!==t.useMemoized)try{return await f("fetchUserAttributes",async()=>await g(e,(0,i._)((0,n._)({},t),{useMemoized:!1})))}catch(e){o.vF.warn("[AmplifyResiliency] Memoization failed, falling back to normal operation")}if(!(0,a.HE)()){if(o.vF.warn("[AmplifyResiliency] Circuit breaker is OPEN, using cached attributes"),!1!==t.fallbackToCache&&c.userAttributes){let e=Date.now()-c.timestamp;return o.vF.info("[AmplifyResiliency] Using cached user attributes (".concat(e/1e3,"s old)")),c.userAttributes}let e=(0,l.If)();if(e)return o.vF.info("[AmplifyResiliency] Using emergency fallback user attributes with tenant ID:",e),{"custom:tenant_ID":e,"custom:tenantId":e};throw Error("Circuit breaker is open and no fallback data available")}let{maxRetries:r=2,timeoutOverride:u,fallbackToCache:d=!0}=t,m=u||(0,a.RA)(),p=0,h=null,w=new AbortController,y=setTimeout(()=>w.abort(),m);try{for(;p<=r;)try{o.vF.debug("[AmplifyResiliency] Attempting to fetch user attributes (attempt ".concat(p+1,"/").concat(r+1,")"));let t=Date.now(),n=await e();clearTimeout(y);let i=Date.now()-t;return o.vF.debug("[AmplifyResiliency] Successfully fetched user attributes in ".concat(i,"ms")),(0,a.MG)(),s(n),p>0&&(0,a.CJ)(),n}catch(t){if(p++,h=t,"TimeoutError"===t.name||"AbortError"===t.name)o.vF.warn("[AmplifyResiliency] Timeout fetching user attributes (attempt ".concat(p,"/").concat(r+1,")"));else if("NetworkError"===t.name)o.vF.warn("[AmplifyResiliency] Network error fetching user attributes (attempt ".concat(p,"/").concat(r+1,"):"),t);else if(o.vF.warn("[AmplifyResiliency] Error fetching user attributes (attempt ".concat(p,"/").concat(r+1,"):"),t),"NotAuthorizedException"===t.name||"UserNotFoundException"===t.name)break;if((0,a.xf)(t),p>r)break;let e=Math.min(2**p*500,3e3);await new Promise(t=>setTimeout(t,e))}if(d&&c.userAttributes){let e=Date.now()-c.timestamp;return o.vF.info("[AmplifyResiliency] Using cached user attributes (".concat(e/1e3,"s old)")),c.userAttributes}let t=(0,l.If)();if(t)return o.vF.info("[AmplifyResiliency] Using emergency fallback user attributes with tenant ID:",t),{"custom:tenant_ID":t,"custom:tenantId":t};throw h}finally{clearTimeout(y)}},p=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!1!==t.useMemoized)try{return await f("getCurrentUser",async()=>await p(e,(0,i._)((0,n._)({},t),{useMemoized:!1})))}catch(e){o.vF.warn("[AmplifyResiliency] Memoization failed, falling back to normal operation")}if(!(0,a.HE)())throw o.vF.warn("[AmplifyResiliency] Circuit breaker is OPEN, skipping getCurrentUser request"),Error("Circuit breaker is open, request blocked to prevent cascading failures");let{maxRetries:r=1,timeoutOverride:l,fallbackToCache:c=!0}=t,s=l||(0,a.RA)(),u=0,d=null;try{for(;u<=r;)try{o.vF.debug("[AmplifyResiliency] Attempting to get current user (attempt ".concat(u+1,"/").concat(r+1,")"));let t=new AbortController,n=setTimeout(()=>t.abort(),s),i=Date.now();try{let t=await e();clearTimeout(n);let r=Date.now()-i;return o.vF.debug("[AmplifyResiliency] Successfully got current user in ".concat(r,"ms")),(0,a.MG)(),t}catch(e){throw clearTimeout(n),e}}catch(t){if(u++,d=t,"TimeoutError"===t.name||"AbortError"===t.name)o.vF.warn("[AmplifyResiliency] Timeout getting current user (attempt ".concat(u,"/").concat(r+1,")"));else if("NetworkError"===t.name)o.vF.warn("[AmplifyResiliency] Network error getting current user (attempt ".concat(u,"/").concat(r+1,"):"),t);else if(o.vF.warn("[AmplifyResiliency] Error getting current user (attempt ".concat(u,"/").concat(r+1,"):"),t),"NotAuthorizedException"===t.name||"UserNotFoundException"===t.name)break;if((0,a.xf)(t),u>r)break;let e=Math.min(2**u*500,2e3);await new Promise(t=>setTimeout(t,e))}throw d}catch(e){throw o.vF.error("[AmplifyResiliency] All attempts to get current user failed:",e),e}},h=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!1!==t.useMemoized&&!t.forceRefresh)try{return await f("fetchAuthSession",async()=>await h(e,_object_spread_props(_object_spread({},t),{useMemoized:!1})))}catch(e){logger.warn("[AmplifyResiliency] Memoization failed, falling back to normal operation")}if(!shouldAttemptCognitoRequest()){if(logger.warn("[AmplifyResiliency] Circuit breaker is OPEN, using cached session if available"),c.session){let e=Date.now()-c.timestamp;return logger.info("[AmplifyResiliency] Using cached session (".concat(e/1e3,"s old)")),c.session}throw Error("Circuit breaker is open and no cached session available")}let{maxRetries:r=1,timeoutOverride:n,fallbackToCache:i=!0,forceRefresh:o=!1}=t,a=n||getCognitoTimeout(),l=0,s=null;try{for(;l<=r;)try{logger.debug("[AmplifyResiliency] Attempting to fetch auth session (attempt ".concat(l+1,"/").concat(r+1,")"));let t=new AbortController,n=setTimeout(()=>t.abort(),a),i=Date.now();try{let t=await e({forceRefresh:o});clearTimeout(n);let r=Date.now()-i;return logger.debug("[AmplifyResiliency] Successfully fetched auth session in ".concat(r,"ms")),u(t),trackCognitoSuccess(),t}catch(e){throw clearTimeout(n),e}}catch(t){if(l++,s=t,"TimeoutError"===t.name||"AbortError"===t.name)logger.warn("[AmplifyResiliency] Timeout fetching auth session (attempt ".concat(l,"/").concat(r+1,")"));else if("NetworkError"===t.name)logger.warn("[AmplifyResiliency] Network error fetching auth session (attempt ".concat(l,"/").concat(r+1,"):"),t);else if(logger.warn("[AmplifyResiliency] Error fetching auth session (attempt ".concat(l,"/").concat(r+1,"):"),t),"NotAuthorizedException"===t.name||"UserNotFoundException"===t.name)break;if(trackCognitoFailure(t),l>r)break;let e=Math.min(2**l*500,2e3);await new Promise(t=>setTimeout(t,e))}if(i&&c.session){let e=Date.now()-c.timestamp;return logger.info("[AmplifyResiliency] Using cached auth session (".concat(e/1e3,"s old)")),c.session}throw s}catch(e){throw logger.error("[AmplifyResiliency] All attempts to fetch auth session failed:",e),e}};async function w(e){let t=0,a=!1,l=null,c=performance.now(),s=m(e.userAttributes);if(0===Object.keys(s).length)return void o.vF.warn("[Amplify] No allowed attributes to update");let u=(0,i._)((0,n._)({},e),{userAttributes:s});for(;t<=3&&!a;)try{++t>1&&o.vF.info("[Amplify] Retrying updateUserAttributes, attempt:",t);let{updateUserAttributes:e}=await Promise.all([r.e(31861),r.e(55158)]).then(r.bind(r,55158));await e(u),a=!0;let n=performance.now()-c;t>1&&o.vF.info("[Amplify] updateUserAttributes succeeded after retries",{attempts:t,duration:n})}catch(e){if(l=e,o.vF.warn("[Amplify] updateUserAttributes error on attempt "+t,{error:e.message,code:e.code,name:e.name}),t<=3){let e=Math.min(1e3*Math.pow(2,t-1),1e4);await new Promise(t=>setTimeout(t,e))}}if(!a){let e=performance.now();throw o.vF.error("[Amplify] updateUserAttributes failed after all retries",{duration:e-c,retries:t,error:l.message,code:l.code}),l}}},27494:(e,t,r)=>{r.d(t,{$n:()=>o,KZ:()=>i,tg:()=>l});var n=r(42749);let i=()=>"req_"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),o=e=>{try{let t=e.split(".")[1];if(!t)throw Error("Invalid token format");let r=t.replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(n)}catch(e){return n.vF.error("[authUtils] Failed to parse JWT:",e),{}}},a=["/","/index","/home","/auth/signin","/auth/signup","/auth/forgot-password","/auth/reset-password","/auth/verify","/auth/verify-email","/about","/privacy","/terms","/auth/reset","/auth/reset/confirm","/auth/callback","/api/health","/api/public","/api/login","/api/signup","/login","/signup","/reset-password","/onboarding/business-info","/onboarding/subscription","/onboarding/payment","/onboarding/setup"],l=e=>{if("/"===e||""===e||"/index.html"===e)return n.vF.debug("[authUtils] Route ".concat(e," is public (root path)")),!0;if(e.startsWith("/onboarding/"))return n.vF.debug("[authUtils] Route ".concat(e," is treated as public for redirection purposes")),!0;let t=e.endsWith("/")?e.slice(0,-1):e;if(n.vF.debug("[authUtils] Checking if route is public: ".concat(e," (normalized: ").concat(t,")")),a.includes(t))return n.vF.debug("[authUtils] Route ".concat(e," is public (exact match)")),!0;let r=a.some(e=>t===e||t.startsWith(e+"/")&&"/"!==e);return n.vF.debug("[authUtils] Route ".concat(e," is ").concat(r?"public":"private"," (prefix match)")),r}},57247:(e,t,r)=>{r.d(t,{GJ:()=>m,If:()=>l,hs:()=>f,jJ:()=>g,yt:()=>u});var n=r(51174),i=r(42749);let o={TENANT_ID:"tenant_id",TENANT_RECOVERY_ATTEMPTS:"tenant_recovery_attempts",LAST_KNOWN_TENANT:"last_known_tenant_id",FALLBACK_ACTIVATED:"tenant_fallback_activated",EMERGENCY_RECOVERY_EXECUTED:"emergency_recovery_executed",EMERGENCY_RECOVERY_TIMESTAMP:"emergency_recovery_timestamp"},a=!1,l=()=>{try{var e,t;let r=localStorage.getItem(o.TENANT_ID);if(r&&(0,n.isValidUUID)(r))return i.vF.debug("[TenantFallback] Using tenant ID from localStorage:",r),r;let a=sessionStorage.getItem(o.TENANT_ID);if(a&&(0,n.isValidUUID)(a))return i.vF.debug("[TenantFallback] Using tenant ID from sessionStorage:",a),localStorage.setItem(o.TENANT_ID,a),a;try{let e=c();if(e&&(0,n.isValidUUID)(e))return i.vF.debug("[TenantFallback] Extracted tenant ID from URL path:",e),localStorage.setItem(o.TENANT_ID,e),e}catch(e){i.vF.error("[TenantFallback] Error extracting tenant ID from URL:",e)}if((null==(t=window.__APP_CACHE)||null==(e=t.tenant)?void 0:e.id)&&(0,n.isValidUUID)(window.__APP_CACHE.tenant.id))return i.vF.debug("[TenantFallback] Using tenant ID from AppCache:",window.__APP_CACHE.tenant.id),localStorage.setItem(o.TENANT_ID,window.__APP_CACHE.tenant.id),window.__APP_CACHE.tenant.id;let l=localStorage.getItem(o.LAST_KNOWN_TENANT);if(l&&(0,n.isValidUUID)(l))return i.vF.debug("[TenantFallback] Using last known tenant ID:",l),localStorage.setItem(o.TENANT_ID,l),l;return i.vF.warn("[TenantFallback] Could not find a valid tenant ID from any source"),null}catch(e){return i.vF.error("[TenantFallback] Error getting fallback tenant ID:",e),null}},c=()=>{try{for(let e of window.location.pathname.split("/").filter(Boolean))if((0,n.isValidUUID)(e))return e;return null}catch(e){return i.vF.error("[TenantFallback] Error extracting tenant ID from URL:",e),null}},s=()=>{try{if("true"===localStorage.getItem(o.FALLBACK_ACTIVATED))return!0;if(parseInt(localStorage.getItem(o.TENANT_RECOVERY_ATTEMPTS)||"0",10)>=2&&l())return localStorage.setItem(o.FALLBACK_ACTIVATED,"true"),!0;return!1}catch(e){return i.vF.error("[TenantFallback] Error checking if tenant recovery should activate:",e),!1}},u=(e,t)=>{try{let r=parseInt(localStorage.getItem(o.TENANT_RECOVERY_ATTEMPTS)||"0",10);return localStorage.setItem(o.TENANT_RECOVERY_ATTEMPTS,String(r+1)),i.vF.warn("[TenantFallback] API failure #".concat(r+1," at ").concat(e,":"),(null==t?void 0:t.message)||t),s()}catch(e){return i.vF.error("[TenantFallback] Error recording API failure:",e),!1}},f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let t=e||l();if(!t)return i.vF.error("[TenantFallback] Cannot generate recovery URL without a tenant ID"),"/";return"/".concat(t,"/dashboard?recovery=true")}catch(e){return i.vF.error("[TenantFallback] Error generating recovery dashboard URL:",e),"/"}},d=()=>{if(a)return!0;try{let e=parseInt(localStorage.getItem(o.EMERGENCY_RECOVERY_TIMESTAMP)||"0",10),t=Date.now();if(t-e<1e4)return i.vF.warn("[TenantFallback] Throttling emergency recovery - last recovery was ".concat(t-e,"ms ago")),!0;return!1}catch(e){return i.vF.error("[TenantFallback] Error checking recovery throttle:",e),!1}},m=()=>{if(window.location.pathname.includes("/auth/")||window.location.pathname.includes("/sign-in")||window.location.pathname.includes("/sign-up")||"/"===window.location.pathname||"/login"===window.location.pathname)return i.vF.debug("[TenantFallback] Skipping emergency recovery on auth/public page"),!1;if(d())return!1;a=!0;try{let e=l();if(localStorage.setItem(o.EMERGENCY_RECOVERY_TIMESTAMP,Date.now().toString()),localStorage.setItem(o.EMERGENCY_RECOVERY_EXECUTED,"true"),e){let t=f(e);return i.vF.info("[TenantFallback] Executing emergency recovery navigation to:",t),setTimeout(()=>{try{window.location.href=t}catch(e){i.vF.error("[TenantFallback] Navigation error during emergency recovery:",e),a=!1}},100),!0}if(window.location.pathname.includes("/dashboard"))return i.vF.error("[TenantFallback] Emergency recovery failed - no valid tenant ID found, redirecting to home"),setTimeout(()=>{try{window.location.href="/"}catch(e){i.vF.error("[TenantFallback] Navigation error during fallback to home:",e),a=!1}},100),!1;return i.vF.warn("[TenantFallback] No tenant ID available, but not disrupting current page"),a=!1,!1}catch(e){return i.vF.error("[TenantFallback] Critical error in emergency recovery:",e),a=!1,!1}},g=e=>{if(!e||!(0,n.isValidUUID)(e))if(!e)return i.vF.error("[TenantFallback] Cannot store null tenant ID"),!1;else{let t=(0,n.pm)(e);if(!t)return i.vF.error("[TenantFallback] Cannot store invalid tenant ID and validation failed"),!1;e=t}try{return localStorage.setItem(o.TENANT_ID,e),sessionStorage.setItem(o.TENANT_ID,e),localStorage.setItem(o.LAST_KNOWN_TENANT,e),window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.tenant=window.__APP_CACHE.tenant||{},window.__APP_CACHE.tenant.id=e,!0}catch(e){return i.vF.error("[TenantFallback] Error storing tenant ID reliably:",e),!1}}},60584:(e,t,r)=>{r.r(t),r.d(t,{Amplify:()=>n.E,Hub:()=>E,configureAmplify:()=>k,confirmResetPassword:()=>s.P,confirmSignUp:()=>l.z,confirmUserAttribute:()=>w.w,fetchAuthSession:()=>d.$,fetchAuthSessionWithConfig:()=>M,fetchUserAttributes:()=>f.T,fetchUserAttributesWithConfig:()=>S,getCurrentUser:()=>u.H,getCurrentUserWithConfig:()=>D,initAmplify:()=>I,isAmplifyConfigured:()=>N,resendSignUpCode:()=>m.h,resetPassword:()=>c.x,safeSignOut:()=>R,sendUserAttributeVerificationCode:()=>h.c,setUpTOTP:()=>y.x,signIn:()=>o.J,signInWithConfig:()=>U,signInWithRedirect:()=>p.$,signOut:()=>i.C,signOutWithConfig:()=>O,signUp:()=>a.H,updateUserAttributes:()=>g.u});var n=r(63900),i=r(82354),o=r(23639),a=r(95027),l=r(55481),c=r(27755),s=r(80079),u=r(81746),f=r(11024),d=r(24818),m=r(97220),g=r(52584),p=r(15102),h=r(35220),w=r(71194),y=r(35030),A=r(51148),b=r(42749),v=r(49509);let E=A.YZ,_="1o5v84mrgn4gt87khtr179uc5b",C="us-east-1_JPL8vGfb6",F="us-east-1";b.vF.debug("[AmplifyUnified] Configuration values:",{COGNITO_CLIENT_ID:_,COGNITO_USER_POOL_ID:C,AWS_REGION:F});let T=!1,k=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(T&&!e)return b.vF.debug("[AmplifyUnified] Amplify already configured, skipping"),!0;try{e&&(b.vF.info("[AmplifyUnified] Force reconfiguring Amplify"),window.__amplifyConfigured&&(window.__amplifyConfigured=!1))}catch(e){b.vF.error("[AmplifyUnified] Error during force reconfigure:",e)}try{b.vF.info("[AmplifyUnified] Configuring Amplify",{environment:"production",isDevelopment:!1});let e=C||v.env.NEXT_PUBLIC_USER_POOL_ID||"us-east-1_JPL8vGfb6",t=_||v.env.NEXT_PUBLIC_USER_POOL_CLIENT_ID||"1o5v84mrgn4gt87khtr179uc5b";if(!e||!t)return b.vF.error("[AmplifyUnified] Missing required configuration:",{hasUserPoolId:!!e,hasClientId:!!t}),T=!1,!1;let r={Auth:{Cognito:{userPoolId:e,userPoolClientId:t,identityPoolId:v.env.NEXT_PUBLIC_COGNITO_IDENTITY_POOL_ID,region:F||"us-east-1",loginWith:{email:!0,username:!0,phone:!1},httpOptions:{timeout:3e4,connectTimeout:1e4,rejectUnauthorized:!1,retryable:!0,maxRetries:3}}}};b.vF.debug("[AmplifyUnified] Amplify configuration:",{userPoolId:r.Auth.Cognito.userPoolId,userPoolClientId:r.Auth.Cognito.userPoolClientId,region:r.Auth.Cognito.region}),n.E.configure(r);let i=n.E.getConfig();if(!(i&&i.Auth&&i.Auth.Cognito&&i.Auth.Cognito.userPoolId))return b.vF.error("[AmplifyUnified] Configuration verification failed",{hasConfig:!!i,hasAuth:!!(i&&i.Auth),hasCognito:!!(i&&i.Auth&&i.Auth.Cognito)}),T=!1,!1;return E.listen("auth",e=>{if("signOut"===e.payload.event||"signIn_failure"===e.payload.event){var t,r;b.vF.debug("[AmplifyUnified] Auth event that might require reconfiguration:",{event:e.payload.event,data:e.payload.data});let i=n.E.getConfig();(null==i||null==(r=i.Auth)||null==(t=r.Cognito)?void 0:t.userPoolId)||(b.vF.warn("[AmplifyUnified] Configuration lost after auth event, reconfiguring..."),k())}}),T=!0,b.vF.info("[AmplifyUnified] Amplify configured successfully"),window.__amplifyConfigured=!0,!0}catch(e){return b.vF.error("[AmplifyUnified] Failed to configure Amplify:",{error:e.message,stack:e.stack}),T=!1,!1}};try{k()}catch(e){b.vF.error("[AmplifyUnified] Error during initial Amplify configuration:",e)}let N=()=>{var e,t;if(!T)return b.vF.info("[AmplifyUnified] Amplify configuration status check: Not configured"),!1;let r=n.E.getConfig(),i=!!(r&&(null==(t=r.Auth)||null==(e=t.Cognito)?void 0:e.userPoolId));return b.vF.debug("[AmplifyUnified] Amplify configuration status:",{isConfigured:T,hasAuth:i,config:{isConfigured:T,hasAuth:i}}),T&&i},R=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{global:!0};try{b.vF.info("[AmplifyUnified] Amplify configuration status before sign out:",{isConfigured:N()}),N()||(b.vF.warn("[AmplifyUnified] Attempting to reconfigure Amplify before signing out"),k());try{return await (0,i.C)(e),b.vF.info("[AmplifyUnified] Successfully signed out user"),!0}catch(e){if(b.vF.error("[AmplifyUnified] Error during Amplify signOut:",e),"AuthUserPoolException"===e.name||e.message&&e.message.includes("UserPool not configured")){b.vF.warn("[AmplifyUnified] Auth UserPool not configured, attempting recovery"),k();try{window.__APP_CACHE&&(window.__APP_CACHE.auth={},window.__APP_CACHE.user={},b.vF.info("[AmplifyUnified] Cleared app cache for auth data"))}catch(e){b.vF.error("[AmplifyUnified] Error clearing app cache:",e)}}return!0}}catch(e){return b.vF.error("[AmplifyUnified] Unexpected error in safeSignOut:",e),!0}},P=async function(e){for(var t,r,n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];try{if(e===o.J)try{if(await (0,u.H)()){b.vF.warn("[AmplifyUnified] User already authenticated, signing out first");try{await R({global:!0})}catch(e){b.vF.error("[AmplifyUnified] Error signing out before signIn:",e)}}}catch(e){(null==(t=e.message)?void 0:t.includes("not authenticated"))||b.vF.warn("[AmplifyUnified] Error checking current user before signIn:",e)}N()||(b.vF.warn("[AmplifyUnified] Amplify not configured before auth function call, configuring now"),k(!0));let n=0;for(;n<=3;)try{return await e(...i)}catch(i){if(n++,b.vF.error("[AmplifyUnified] Error in ".concat(e.name," (retry ").concat(n,"/").concat(3,"):"),{name:i.name,message:i.message,code:i.code,statusCode:null==i||null==(r=i.response)?void 0:r.status,retryable:i.retryable}),("AuthUserPoolException"===i.name||i.message&&i.message.includes("UserPool not configured"))&&(b.vF.warn("[AmplifyUnified] Auth UserPool not configured, attempting recovery (retry ".concat(n,"/").concat(3,")")),k(!0),n<=3)){await new Promise(e=>setTimeout(e,1e3*n));continue}if(("NetworkError"===i.name||i.message&&(i.message.includes("network")||i.message.includes("Network")||i.message.includes("SSL")||i.message.includes("certificate")||i.message.includes("CORS")||i.message.includes("timeout"))||"NETWORK_ERROR"===i.code||"NetworkingError"===i.code)&&(b.vF.warn("[AmplifyUnified] Network error, attempting retry with backoff (retry ".concat(n,"/").concat(3,")")),k(!0),n<=3)){let e=Math.min(2e3*Math.pow(2,n-1),1e4);b.vF.info("[AmplifyUnified] Waiting ".concat(e,"ms before retry")),await new Promise(t=>setTimeout(t,e));continue}if(n>3)throw i;let t=1e3*n;await new Promise(e=>setTimeout(e,t))}throw Error("[AmplifyUnified] Failed to execute ".concat(e.name," after ").concat(3," retries"))}catch(e){throw b.vF.error("[AmplifyUnified] Error in ensureConfigAndCall:",e),e}},I=()=>window.__amplifyConfigured?window.__amplifyConfigured:(b.vF.info("[AmplifyUnified] Initializing Amplify from hook"),k(),!0),U=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return P(o.J,...t)},O=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return P(i.C,...t)},D=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return P(u.H,...t)},S=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return P(f.T,...t)},M=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return P(d.$,...t)}}}]);