"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[82786],{82786:(e,t,s)=>{s.r(t),s.d(t,{default:()=>v});var r=s(95155),a=s(12115),o=s(56732),c=s(42749),n=s(20171),i=s(29670);let l="/api/customers",d="customer",m="".concat(d,"_list"),u=async e=>{try{let t=await i.Ay.getCacheValue(e);return null!=t}catch(t){return c.vF.warn("[CustomerService] Error checking cache for key ".concat(e,":"),t),!1}},h=e=>{if(!e)return[];try{if("string"==typeof e)return JSON.parse(e);return e}catch(t){return c.vF.error("[CustomerService] Error parsing JSON response:",t),Array.isArray(e)?[]:{}}},x={async getCustomers(){let{forceRefresh:e=!1,headers:t={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(!e&&await u(m))return c.vF.info("[CustomerService] Returning customers from cache"),await i.Ay.getCacheValue(m);c.vF.info("[CustomerService] Fetching customers from API");let s=await n.A.get(l,{headers:t,timeout:8e3,validateStatus:e=>e<500}),r=h(s.data),a=[];return Array.isArray(r)?a=r:r&&"object"==typeof r&&Array.isArray(r.customers)?a=r.customers:(c.vF.warn("[CustomerService] Unexpected data format:",r),a=[]),await i.Ay.setCacheValue(m,a,300),a}catch(e){return c.vF.error("[CustomerService] Error fetching customers:",e),e.response&&c.vF.error("[CustomerService] Error response:",{status:e.response.status,headers:e.response.headers,data:e.response.data}),[]}},async getCustomer(e){let{forceRefresh:t=!1,headers:s={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(!e)return c.vF.error("[CustomerService] Invalid customer ID provided"),null;let r="".concat(d,"_").concat(e);if(!t&&await u(r))return c.vF.info("[CustomerService] Returning customer ".concat(e," from cache")),await i.Ay.getCacheValue(r);c.vF.info("[CustomerService] Fetching customer ".concat(e," from API"));let a=await n.A.get("".concat(l,"/").concat(e),{headers:s,timeout:8e3,validateStatus:e=>e<500}),o=h(a.data);return await i.Ay.setCacheValue(r,o,300),o}catch(t){return c.vF.error("[CustomerService] Error fetching customer ".concat(e,":"),t),t.response&&c.vF.error("[CustomerService] Error response:",{status:t.response.status,headers:t.response.headers,data:t.response.data}),null}},async createCustomer(e){let{headers:t={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{c.vF.info("[CustomerService] Creating new customer");let s=await n.A.post(l,e,{headers:t});return await i.Ay.removeCacheValue(m),s.data}catch(e){throw c.vF.error("[CustomerService] Error creating customer:",e),e}},async updateCustomer(e,t){let{headers:s={}}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{c.vF.info("[CustomerService] Updating customer ".concat(e));let r=await n.A.put("".concat(l,"/").concat(e),t,{headers:s}),a="".concat(d,"_").concat(e);return await i.Ay.setCacheValue(a,r.data,300),await i.Ay.removeCacheValue(m),r.data}catch(t){throw c.vF.error("[CustomerService] Error updating customer ".concat(e,":"),t),t}},async deleteCustomer(e){let{headers:t={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{c.vF.info("[CustomerService] Deleting customer ".concat(e));let s=await n.A.delete("".concat(l,"/").concat(e),{headers:t}),r="".concat(d,"_").concat(e);return await i.Ay.removeCacheValue(r),await i.Ay.removeCacheValue(m),s.data}catch(t){throw c.vF.error("[CustomerService] Error deleting customer ".concat(e,":"),t),t}},async clearCache(){c.vF.info("[CustomerService] Clearing customer cache"),await i.Ay.clearCache()}};var p=s(47070),g=s(35695);let v=e=>{let{onCustomerSelect:t,onCreateCustomer:s}=e,[n,i]=(0,a.useState)([]),[l,d]=(0,a.useState)(!0),[m,u]=(0,a.useState)(null),[h,v]=(0,a.useState)(""),[f,w]=(0,a.useState)(null),[y,b]=(0,a.useState)(!1),{notifySuccess:j,notifyError:N,notifyInfo:C}=(0,o.d)(),{data:k}=(0,p.useSession)(),S=(0,g.useParams)(),A=null==S?void 0:S.tenantId,F=(0,g.useRouter)(),E=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{d(!0),c.vF.info("[CustomerList] Fetching customers".concat(e?" (force refresh)":""));let t={};(null==k?void 0:k.accessToken)&&(t.Authorization="Bearer ".concat(k.accessToken));let s=await x.getCustomers({forceRefresh:e,headers:t});c.vF.info("[CustomerList] Successfully fetched ".concat(s.length," customers")),i(s),u(null)}catch(e){var t,s;c.vF.error("[CustomerList] Error fetching customers:",e),c.vF.error("[CustomerList] Error details:",{message:e.message,responseData:null==(t=e.response)?void 0:t.data,responseStatus:null==(s=e.response)?void 0:s.status}),u("Error fetching customers"),N("Failed to fetch customers")}finally{d(!1)}},[k,N]);(0,a.useEffect)(()=>{E();let e=setInterval(()=>{E(!0)},3e5);return()=>{clearInterval(e)}},[E]);let L=e=>{c.vF.info("Selected customer:",e),A?window.location.href="/".concat(A,"/dashboard/customers/").concat(e.id):t(e.id),C("Viewing customer: ".concat(e.customer_name||e.customerName||"".concat(e.first_name," ").concat(e.last_name)))},_=(e,t)=>{t&&t.stopPropagation(),c.vF.info("[CustomerList] Editing customer ".concat(e.id)),F.push("/dashboard/customers/edit/".concat(e.id))},V=(e,t)=>{t.stopPropagation(),w(e),b(!0)},z=async()=>{try{d(!0),c.vF.info("[CustomerList] Deleting customer with ID: ".concat(f.id));let e={};(null==k?void 0:k.accessToken)&&(e.Authorization="Bearer ".concat(k.accessToken)),await x.deleteCustomer(f.id,{headers:e}),i(n.filter(e=>e.id!==f.id)),j("Customer deleted successfully")}catch(s){var e,t;c.vF.error("[CustomerList] Error deleting customer:",s),c.vF.error("[CustomerList] Error details:",{message:s.message,responseData:null==(e=s.response)?void 0:e.data,responseStatus:null==(t=s.response)?void 0:t.status}),N("Failed to delete customer")}finally{d(!1),b(!1),w(null)}},D=()=>{E(!0),C("Refreshing customer list...")},R=h?n.filter(e=>{let t="".concat(e.first_name||""," ").concat(e.last_name||"").toLowerCase(),s=(e.customer_name||e.customerName||"").toLowerCase(),r=(e.email||"").toLowerCase(),a=(e.phone||"").toLowerCase(),o=h.toLowerCase();return t.includes(o)||s.includes(o)||r.includes(o)||a.includes(o)}):n;return l&&0===n.length?(0,r.jsxs)("div",{className:"w-full",children:[(0,r.jsx)("div",{className:"h-2 bg-gray-200",children:(0,r.jsx)("div",{className:"h-2 bg-blue-600 animate-pulse"})}),(0,r.jsx)("div",{className:"flex justify-center items-center py-16",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})})]}):m&&0===n.length?(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded-md mb-4",children:(0,r.jsx)("p",{className:"text-red-700",children:m})}),(0,r.jsx)("button",{className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50",onClick:D,children:"Try Again"})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-md mb-6",children:(0,r.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,r.jsxs)("div",{className:"relative flex-grow",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})}),(0,r.jsx)("input",{type:"text",placeholder:"Search customers...",className:"pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",value:h,onChange:e=>v(e.target.value)})]}),(0,r.jsx)("button",{onClick:D,className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-md transition-colors",title:"Refresh",disabled:l,children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ".concat(l?"animate-spin":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),(0,r.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",onClick:s,children:"Add Customer"})]})}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Address"}),(0,r.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:R.length>0?R.map(e=>(0,r.jsxs)("tr",{onClick:()=>L(e),className:"hover:bg-gray-50 cursor-pointer transition-colors",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.customer_name||e.customerName||"".concat(e.first_name||""," ").concat(e.last_name||"")}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.email}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.phone}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.city&&e.state?"".concat(e.city,", ").concat(e.state):e.city||e.state||""}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,r.jsx)("button",{onClick:t=>_(e,t),className:"text-blue-600 hover:text-blue-900 mr-4",title:"Edit",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})}),(0,r.jsx)("button",{onClick:t=>V(e,t),className:"text-red-600 hover:text-red-900",title:"Delete",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})]},e.id)):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:"5",className:"px-6 py-4 text-center text-gray-500",children:h?"No customers match your search":"No customers found"})})})]})}),l&&n.length>0&&(0,r.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-60 flex justify-center items-center z-10",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"})})]}),y&&(0,r.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,r.jsxs)("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,r.jsx)("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),(0,r.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),(0,r.jsxs)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[(0,r.jsx)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:(0,r.jsxs)("div",{className:"sm:flex sm:items-start",children:[(0,r.jsx)("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:(0,r.jsx)("svg",{className:"h-6 w-6 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,r.jsxs)("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left",children:[(0,r.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Delete Customer"}),(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Are you sure you want to delete this customer? This action cannot be undone."}),f&&(0,r.jsxs)("div",{className:"mt-2 p-2 bg-gray-50 rounded-md",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,r.jsx)("span",{className:"font-medium",children:"Name:"})," ",f.customer_name||f.customerName||"".concat(f.first_name||""," ").concat(f.last_name||"")]}),f.email&&(0,r.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,r.jsx)("span",{className:"font-medium",children:"Email:"})," ",f.email]})]})]})]})]})}),(0,r.jsxs)("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[(0,r.jsx)("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:z,disabled:l,children:l?"Deleting...":"Delete"}),(0,r.jsx)("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:()=>b(!1),disabled:l,children:"Cancel"})]})]})]})})]})}}}]);