"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[38475,82346],{6218:(e,t,n)=>{n.d(t,{Y:()=>i});var r=n(10831);let i={convert(e,t={urlSafe:!1,skipPadding:!1}){let n="string"==typeof e?e:Array.from(e,e=>String.fromCodePoint(e)).join(""),i=(0,r.xA)()(n);return t.urlSafe&&(i=i.replace(/\+/g,"-").replace(/\//g,"_")),t.skipPadding&&(i=i.replace(/=/g,"")),i}}},11024:(e,t,n)=>{n.d(t,{T:()=>o});var r=n(87970),i=n(69496);let o=()=>(0,i.T)(r.H)},29985:(e,t,n)=>{n.d(t,{A:()=>h});var r=n(55166),i=n(68387),o=n(95155),a=n(12115),s=n(35695),u=n(6874),d=n.n(u),l=n(60584),c=n(42749),m=n(51174),g=n(25956),f=n(29670);n(47070),window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.auth=window.__APP_CACHE.auth||{},window.__APP_CACHE.user=window.__APP_CACHE.user||{},window.__APP_CACHE.tenant=window.__APP_CACHE.tenant||{},window.__APP_CACHE.tenants=window.__APP_CACHE.tenants||{},window.setCacheValue||(window.setCacheValue=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{if(!window.__APP_CACHE)return!1;let r=Date.now(),i=n.ttl||36e5;return window.__APP_CACHE[e]={value:t,timestamp:r,expiresAt:r+i,ttl:i},!0}catch(t){return console.error("[AppCache] Error setting cache value for key ".concat(e,":"),t),!1}}),window.getCacheValue||(window.getCacheValue=function(e){try{if(!window.__APP_CACHE)return null;let t=window.__APP_CACHE[e];if(!t)return null;if(t.expiresAt&&void 0!==t.value){if(Date.now()>t.expiresAt)return delete window.__APP_CACHE[e],null;return t.value}return t}catch(t){return console.error("[AppCache] Error getting cache value for key ".concat(e,":"),t),null}}),window.storeTenantInfo||(window.storeTenantInfo=function(e){try{if(!e||!e.tenantId)return console.error("[SignInForm] Cannot store null or invalid tenant info"),!1;return localStorage.setItem("tenant_id",e.tenantId),localStorage.setItem("tenantId",e.tenantId),e.metadata&&localStorage.setItem("tenant_metadata",JSON.stringify(e.metadata)),window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.tenant=window.__APP_CACHE.tenant||{},window.__APP_CACHE.tenant.id=e.tenantId,window.__APP_CACHE.tenantId=e.tenantId,e.metadata&&Object.entries(e.metadata).forEach(e=>{let[t,n]=e;window.__APP_CACHE.tenant[t]=n}),console.log("[SignInForm] Successfully stored tenant info:",e.tenantId),!0}catch(e){return console.error("[SignInForm] Error in storeTenantInfo:",e),!1}});let w=async()=>{try{if(window.__APP_CACHE&&window.__APP_CACHE.tenant&&window.__APP_CACHE.tenant.id)return c.vF.debug("[SignInForm] Found tenant ID in APP_CACHE:",window.__APP_CACHE.tenant.id),window.__APP_CACHE.tenant.id;try{let e=sessionStorage.getItem("tenant_id");if(e)return c.vF.debug("[SignInForm] Found tenant ID in sessionStorage:",e),e}catch(e){}{let e=window.location.pathname.match(/\/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})\/dashboard/i);if(e&&e[1])return c.vF.debug("[SignInForm] Found tenant ID in URL path:",e[1]),e[1]}try{let{getCurrentUser:e,fetchUserAttributes:t}=await Promise.resolve().then(n.bind(n,60584));if(await e()){let e=await t(),n=(null==e?void 0:e["custom:tenantId"])||(null==e?void 0:e["custom:tenant_id"])||(null==e?void 0:e["custom:tenant_ID"])||(null==e?void 0:e.tenantId);if(n)return c.vF.debug("[SignInForm] Found tenant ID in Cognito attributes:",n),n}}catch(e){c.vF.warn("[SignInForm] Error getting tenant ID from Cognito:",e)}try{let{fetchAuthSession:t}=await Promise.resolve().then(n.bind(n,60584)),r=await t();if(r&&r.tokens){var e;let t=(null==(e=r.tokens.idToken)?void 0:e.payload)||{},n=t["custom:tenantId"]||t["custom:tenant_id"]||t["custom:tenant_ID"]||t.tenantId;if(n)return c.vF.debug("[SignInForm] Found tenant ID in auth session claims:",n),n}}catch(e){c.vF.warn("[SignInForm] Error getting tenant ID from auth session:",e)}return c.vF.warn("[SignInForm] Could not find tenant ID from any source"),null}catch(e){return c.vF.warn("[SignInForm] Error getting tenant ID from sources:",e),null}},_=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{c.vF.debug("[SignInForm] Preparing for dashboard redirect",{tenantId:t,options:r}),(0,f.mm)("auth_had_session",!0,{ttl:864e5}),localStorage.setItem("auth_had_session","true");let i=new Date().toISOString();if((0,f.mm)("auth_last_time",i,{ttl:864e5}),localStorage.setItem("auth_last_time",i),c.vF.info("[SignInForm] Redirecting with tenant ID:",t),t){window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.tenant=window.__APP_CACHE.tenant||{},window.__APP_CACHE.tenant.id=t,window.__APP_CACHE.tenantId=t,localStorage.setItem("tenant_id",t),localStorage.setItem("tenantId",t);let i="",o="Other",a="US",s="",u="";try{let{fetchUserAttributes:e}=await Promise.resolve().then(n.bind(n,60584)),t=await e();s=t.sub||"",u=t.email||"",i=t["custom:businessname"]||(t.given_name?"".concat(t.given_name,"'s Business"):t.email?"".concat(t.email.split("@")[0],"'s Business"):""),o=t["custom:businesstype"]||"Other",a=t["custom:businesscountry"]||"US",(0,f.mm)("user_id",s,{ttl:864e5}),window.__APP_CACHE.user=window.__APP_CACHE.user||{},window.__APP_CACHE.user.id=s,window.__APP_CACHE.user.sub=s,window.__APP_CACHE.user.email=u}catch(e){c.vF.warn("[SignInForm] Error getting user attributes:",e)}let d="";try{let{getCurrentUser:e,getIdToken:t}=await n.e(31861).then(n.bind(n,31861)),r=await e();d=await t(r),window.__APP_CACHE.auth=window.__APP_CACHE.auth||{},window.__APP_CACHE.auth.idToken=d}catch(e){c.vF.warn("[SignInForm] Error getting ID token:",e)}try{c.vF.info("[SignInForm] Ensuring tenant record exists:",t);let e=await fetch("/api/tenant/ensure-db-record",{method:"POST",headers:{"Content-Type":"application/json","x-tenant-id":t,"x-user-id":s,Authorization:d?"Bearer ".concat(d):""},body:JSON.stringify({tenantId:t,userId:s,email:u,businessName:i,businessType:o,businessCountry:a})});if(e.ok){c.vF.info("[SignInForm] Tenant record creation successful");let t=await e.json();t&&t.rls&&t.rls.enabled&&c.vF.info("[SignInForm] RLS is enabled for this tenant")}else c.vF.warn("[SignInForm] Warning creating tenant record:",await e.text())}catch(e){c.vF.warn("[SignInForm] Error ensuring tenant record:",e)}try{c.vF.info("[SignInForm] Ensuring tenant database is initialized:",t);let e=await fetch("/api/tenant/initialize-tenant",{method:"POST",headers:{"Content-Type":"application/json","x-tenant-id":t,"x-user-id":s,Authorization:d?"Bearer ".concat(d):"","x-rls-version":"2"},body:JSON.stringify({tenantId:t,userId:s,skipRlsParams:!0,useQuotedParams:!0})});e.ok?c.vF.info("[SignInForm] Tenant database initialization successful"):(c.vF.warn("[SignInForm] Warning initializing tenant database:",await e.text()),500===e.status&&(c.vF.info("[SignInForm] Trying alternate RLS initialization method"),(await fetch("/api/tenant/initialize-tenant",{method:"POST",headers:{"Content-Type":"application/json","x-tenant-id":t,"x-user-id":s,Authorization:d?"Bearer ".concat(d):"","x-rls-alternate":"true"},body:JSON.stringify({tenantId:t,userId:s,alternateRlsMethod:!0})})).ok?c.vF.info("[SignInForm] Alternate tenant initialization successful"):c.vF.warn("[SignInForm] All tenant initialization methods failed, continuing anyway")))}catch(e){c.vF.warn("[SignInForm] Error initializing tenant database:",e)}try{"function"==typeof window.storeTenantInfo&&window.storeTenantInfo({tenantId:t,metadata:{businessName:i,businessType:o,businessCountry:a,userId:s,userEmail:u,createdAt:new Date().toISOString(),source:"signin"}}),localStorage.setItem("tenant_metadata",JSON.stringify({tenantId:t,businessName:i,businessType:o,businessCountry:a,userId:s,createdAt:new Date().toISOString(),source:"signin"}))}catch(e){c.vF.warn("[SignInForm] Error storing tenant metadata:",e)}let l=new URLSearchParams;l.append("fromAuth","true"),l.append("tenantName",encodeURIComponent(i||"")),l.append("tenantType",encodeURIComponent(o||"")),l.append("tenantUserId",encodeURIComponent(s||"")),Object.entries(r).forEach(e=>{let[t,n]=e;l.append(t,n.toString())});let m=l.toString(),g="/tenant/".concat(t,"/dashboard").concat(m?"?"+m:"");c.vF.info("[SignInForm] Redirecting to tenant dashboard:",g);try{sessionStorage.setItem("tenant_data",JSON.stringify({id:t,name:i,type:o,country:a,userId:s,timestamp:Date.now()}))}catch(e){c.vF.warn("[SignInForm] Could not store tenant data in sessionStorage:",e)}setTimeout(()=>{e.push(g)},500)}else{let t=new URLSearchParams;t.append("fromAuth","true"),Object.entries(r).forEach(e=>{let[n,r]=e;t.append(n,r.toString())});let n=t.toString(),i="/dashboard".concat(n?"?"+n:"");c.vF.info("[SignInForm] Redirecting to dashboard (no tenant):",i),setTimeout(()=>{e.push(i)},500)}}catch(t){c.vF.error("[SignInForm] Error during dashboard redirect:",t),e.push("/dashboard?fromAuth=true")}};function h(){let e=(0,s.useRouter)(),[t,u]=(0,a.useState)({username:"",password:"",rememberMe:!1}),[h,A]=(0,a.useState)({}),[p,C]=(0,a.useState)(!1),[P,b]=(0,a.useState)(null),[y,I]=(0,a.useState)(!1),[v,E]=(0,a.useState)("");(0,a.useEffect)(()=>{if("expired"===new URLSearchParams(window.location.search).get("session")){!0===(0,f.gd)("auth_had_session")&&A({general:"Your session has expired. Please sign in again to continue."});let e=window.location.pathname;window.history.replaceState({},document.title,e)}},[]);let S=e=>{let{name:t,value:n,type:o,checked:a}=e.target,s="checkbox"===o?a:n;u(e=>(0,i._)((0,r._)({},e),{[t]:s})),h[t]&&A(e=>{let n=(0,r._)({},e);return delete n[t],n})},F=()=>{let e={};return t.username.trim()||(e.username="Email is required"),t.password||(e.password="Password is required"),A(e),0===Object.keys(e).length},H=async r=>{if(r.preventDefault(),F()){A({}),b(null),C(!0);try{await (0,g.nH)()}catch(e){c.vF.warn("[SignInForm] Error preparing for sign-in:",e)}try{var i,o,a;c.vF.debug("[SignInForm] Starting sign-in process",{username:t.username,hasPassword:!!t.password,rememberMe:t.rememberMe}),window.reconfigureAmplify&&(c.vF.debug("[SignInForm] Ensuring Amplify is configured before authentication"),window.reconfigureAmplify());let r=await (0,l.signInWithConfig)({username:t.username,password:t.password,options:{authFlowType:"USER_SRP_AUTH"}});c.vF.debug("[SignInForm] Sign-in result",{isSignedIn:r.isSignedIn,nextStep:null==(i=r.nextStep)?void 0:i.signInStep}),(0,f.mm)("auth_had_session",!0),window.__APP_CACHE&&(window.__APP_CACHE.auth.had_session=!0,window.__APP_CACHE.auth.last_login=new Date().toISOString());try{await (0,g.F6)()}catch(e){c.vF.warn("[SignInForm] Failed to ensure created_at attribute, but continuing:",e)}if(r.isSignedIn)if(b("Sign in successful! Redirecting..."),r.nextStep){let{signInStep:i}=r.nextStep;if("CONFIRM_SIGN_UP"===i){c.vF.debug("[SignInForm] User needs to confirm signup"),b("Please verify your email before signing in. Redirecting..."),(0,f.mm)("auth_email",t.username),(0,f.mm)("auth_needs_verification",!0),window.__APP_CACHE&&window.__APP_CACHE.auth&&(window.__APP_CACHE.auth.email=t.username,window.__APP_CACHE.auth.needs_verification=!0),setTimeout(()=>{e.push("/auth/verify-email?email=".concat(encodeURIComponent(t.username)))},1500);return}if("DONE"===i){c.vF.debug("[SignInForm] Authentication successful, checking onboarding status");try{let{fetchUserAttributes:r,updateUserAttributes:i}=await Promise.resolve().then(n.bind(n,60584)),s=await r();(0,f.mm)("user_attributes",s,{ttl:36e5}),window.__APP_CACHE=window.__APP_CACHE||{},window.__APP_CACHE.user=window.__APP_CACHE.user||{},window.__APP_CACHE.user.attributes=s,window.__APP_CACHE.user.email=s.email||t.username;try{let{fetchAuthSession:e}=await Promise.resolve().then(n.bind(n,60584)),t=await e();t&&t.tokens&&(sessionStorage.setItem("idToken",t.tokens.idToken.toString()),sessionStorage.setItem("accessToken",t.tokens.accessToken.toString()),sessionStorage.setItem("tokenTimestamp",Date.now().toString()),sessionStorage.setItem("hasSession","true"),window.__APP_CACHE.auth=window.__APP_CACHE.auth||{},window.__APP_CACHE.auth.idToken=t.tokens.idToken.toString(),window.__APP_CACHE.auth.token=t.tokens.idToken.toString(),window.__APP_CACHE.auth.accessToken=t.tokens.accessToken.toString(),window.__APP_CACHE.auth.hasSession=!0,window.__APP_CACHE.auth.provider="cognito",c.vF.debug("[SignInForm] Successfully stored tokens in sessionStorage and APP_CACHE"))}catch(e){c.vF.warn("[SignInForm] Error storing tokens in sessionStorage:",e)}c.vF.info("[SignInForm] Raw onboarding status:",{rawOnboarding:s["custom:onboarding"],rawSetupDone:s["custom:setupdone"]});let u=(s["custom:onboarding"]||"").toLowerCase(),d="true"===(s["custom:setupdone"]||"").toLowerCase();if(c.vF.debug("[SignInForm] User onboarding status:",{onboardingStatus:u,setupDone:d}),s&&s["custom:onboarding"]){let e=(0,m.Pc)(s["custom:onboarding"]);if(e!==s["custom:onboarding"])try{await i({"custom:onboarding":e}),s["custom:onboarding"]=e}catch(t){c.vF.warn("[SignInForm] Error updating onboarding status case:",t),s["custom:onboarding"]=e}}if((0,f.mm)("onboarding_status",u,{ttl:36e5}),(0,f.mm)("setup_done",d,{ttl:36e5}),window.__APP_CACHE&&window.__APP_CACHE.user&&(window.__APP_CACHE.user.onboarding_status=u,window.__APP_CACHE.user.setup_done=d),"complete"===u||d){c.vF.debug("[SignInForm] Onboarding complete, redirecting to dashboard");let t=s["custom:tenant_ID"];if(t){try{window.__APP_CACHE&&(window.__APP_CACHE.tenant=window.__APP_CACHE.tenant||{},window.__APP_CACHE.tenant.id=t,window.__APP_CACHE.tenantId=t),await (0,m.$_)(t),(0,f.mm)("tenantId",t,{ttl:864e5}),c.vF.debug("[SignInForm] Successfully stored tenant ID in all locations:",t)}catch(e){c.vF.error("[SignInForm] Error storing tenant ID, but continuing:",e)}await _(e,t)}else{let t=await w();await _(e,t)}}else if(u)switch(u){case"business_info":case"business-info":e.push("/onboarding/subscription");break;case"subscription":let l=null==(o=s["custom:subplan"])?void 0:o.toLowerCase();c.vF.info("[SignInForm] User attributes for redirection decision:",{subplan:l,plan:s["custom:plan"],subPlan:s["custom:subplan"],businessId:s["custom:business_id"]||s["custom:businessid"],tenantId:s["custom:tenant_ID"]}),c.vF.info("[SignInForm] Redirecting user with subscription onboarding status to subscription page"),e.push("/onboarding/subscription");break;case"payment":let g=null==(a=s["custom:subplan"])?void 0:a.toLowerCase();if("free"===g||"basic"===g){c.vF.warn("[SignInForm] Free/Basic plan redirected to dashboard instead of payment");let t=s["custom:tenant_ID"];if(t){try{window.__APP_CACHE&&(window.__APP_CACHE.tenant=window.__APP_CACHE.tenant||{},window.__APP_CACHE.tenant.id=t,window.__APP_CACHE.tenantId=t),await (0,m.$_)(t),(0,f.mm)("tenantId",t,{ttl:864e5}),c.vF.debug("[SignInForm] Successfully stored tenant ID in all locations:",t)}catch(e){c.vF.error("[SignInForm] Error storing tenant ID, but continuing:",e)}await _(e,t)}else{let t=await w();await _(e,t)}}else e.push("/onboarding/setup");break;case"setup":e.push("/onboarding/setup");break;default:c.vF.warn("[SignInForm] Unknown onboarding step:",u),e.push("/onboarding")}else c.vF.debug("[SignInForm] No onboarding status, redirecting to onboarding"),e.push("/onboarding")}catch(n){c.vF.error("[SignInForm] Error fetching user attributes:",n);let t=await w();await _(e,t,{error:"attribute_fetch"})}}else{c.vF.warn("[SignInForm] Unexpected auth next step:",r.nextStep);let t=await w();await _(e,t,{warning:"unexpected_step"})}}else{c.vF.debug("[SignInForm] No specific next step, redirecting to dashboard");let t=await w();await _(e,t)}else c.vF.error("[SignInForm] Authentication succeeded but isSignedIn is false"),A({general:"Error during authentication. Please try again."})}catch(e){C(!1),e.message&&(e.message.includes("disabled")||"UserDisabledException"===e.code)?(E(t.username),I(!0)):"UserNotFoundException"===e.code?A({username:"No account found with this email"}):"NotAuthorizedException"===e.code?A({password:"Incorrect password"}):A({general:e.message||"Authentication failed. Please try again."})}}};return(0,a.useEffect)(()=>{},[]),(0,o.jsxs)("div",{className:"max-w-md w-full mx-auto",children:[(0,o.jsxs)("form",{onSubmit:H,className:"space-y-4",children:[(0,o.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center text-gray-800",children:"Sign In"}),h.general&&(0,o.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded",children:"string"==typeof h.general?(0,o.jsxs)(o.Fragment,{children:[h.general,h.general.includes("verification")&&(0,o.jsx)("div",{className:"mt-2",children:(0,o.jsx)(d(),{href:"/auth/verify-email?email=".concat(encodeURIComponent(t.username)),className:"text-blue-600 underline",children:"Go to verification page"})})]}):h.general}),P&&(0,o.jsx)("div",{className:"mb-4 p-3 bg-green-100 border border-green-300 text-green-700 rounded",children:P}),(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)("label",{htmlFor:"username",className:"block text-gray-700 font-medium mb-1",children:"Email"}),(0,o.jsx)("input",{type:"email",id:"username",name:"username",value:t.username,onChange:S,className:"w-full px-3 py-2 border ".concat(h.username?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"," rounded focus:outline-none"),required:!0,autoComplete:"email"}),h.username&&(0,o.jsx)("p",{className:"mt-2 text-sm text-red-600 animate-fadeIn",role:"alert",children:h.username})]}),(0,o.jsxs)("div",{className:"mb-6",children:[(0,o.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,o.jsx)("label",{htmlFor:"password",className:"block text-gray-700 font-medium",children:"Password"}),(0,o.jsx)(d(),{href:"/auth/forgot-password",className:"text-sm text-blue-600 hover:underline",children:"Forgot password?"})]}),(0,o.jsx)("input",{type:"password",id:"password",name:"password",value:t.password,onChange:S,className:"w-full px-3 py-2 border ".concat(h.password?"border-red-300 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"," rounded focus:outline-none"),required:!0,autoComplete:"current-password"}),h.password&&(0,o.jsx)("p",{className:"mt-2 text-sm text-red-600 animate-fadeIn",role:"alert",children:h.password})]}),(0,o.jsx)("div",{className:"flex items-center justify-between",children:(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsx)("input",{id:"rememberMe",name:"rememberMe",type:"checkbox",checked:t.rememberMe,onChange:S,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded transition duration-150 ease-in-out"}),(0,o.jsx)("label",{htmlFor:"rememberMe",className:"ml-2 block text-sm text-gray-700",children:"Remember me"})]})}),(0,o.jsx)("button",{type:"submit",className:"w-full py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 ".concat(p?"opacity-70 cursor-not-allowed":""),disabled:p,children:p?"Signing In...":"Sign In"})]}),(0,o.jsx)("div",{className:"text-center mt-4",children:(0,o.jsxs)("p",{className:"text-sm text-gray-600",children:["Account deactivated?"," ",(0,o.jsx)("button",{type:"button",onClick:()=>{t.username?(E(t.username),I(!0)):alert("Please enter your email address first")},className:"font-medium text-blue-600 hover:text-blue-500",children:"Reactivate it here"})]})})]})}},35695:(e,t,n)=>{var r=n(18999);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},42749:(e,t,n)=>{n.d(t,{vF:()=>a});let r={debug:0,info:1,warn:2,error:3},i="info",o=()=>!1,a={setLevel(e){void 0!==r[e]&&(i=e)},getLevel:()=>i,debug:(e,t)=>{},info:(e,t)=>{r[i]<=r.info&&(o()?void 0!==t?console.info("[SERVER INFO] ".concat(e),t):console.info("[SERVER INFO] ".concat(e)):void 0!==t?console.info(e,t):console.info(e))},warn:(e,t)=>{r[i]<=r.warn&&(o()?void 0!==t?console.warn("[SERVER WARN] ".concat(e),t):console.warn("[SERVER WARN] ".concat(e)):void 0!==t?console.warn(e,t):console.warn(e))},error:(e,t)=>{r[i]<=r.error&&(o()?void 0!==t?console.error("[SERVER ERROR] ".concat(e),t):console.error("[SERVER ERROR] ".concat(e)):void 0!==t?console.error(e,t):console.error(e))}}},50581:(e,t,n)=>{n.d(t,{N:()=>u});var r=n(90808),i=n(55413),o=n(2242),a=n(41811),s=n(83854);let u=e=>(0,r.A)(i.e,(0,o._)("GetUser"),(0,a.T)(),{...s.C,...e})},51174:(e,t,n)=>{n.d(t,{$_:()=>d,BI:()=>A,FB:()=>p,Nf:()=>w,Pc:()=>c,fy:()=>C,getTenantId:()=>s,getTenantIdFromCognito:()=>f,h_:()=>g,isValidUUID:()=>u,jW:()=>h,oA:()=>l,pm:()=>_,updateTenantIdInCognito:()=>m});var r=n(81746),i=n(24818),o=n(62052);let a="tenantId",s=async()=>{try{var e,t,n,s,u,d;let l=await o.l.getItem(a);if(l)return l;let c=await (0,r.H)(),m=await (0,i.$)(),g=(null==c||null==(e=c.attributes)?void 0:e["custom:tenant_ID"])||(null==c||null==(t=c.attributes)?void 0:t["custom:tenantId"])||(null==m||null==(s=m.accessToken)||null==(n=s.payload)?void 0:n["custom:tenant_ID"])||(null==m||null==(d=m.accessToken)||null==(u=d.payload)?void 0:u["custom:tenantId"]);if(!g)throw Error("Tenant ID not found in user attributes or session");return await o.l.setItem(a,g),g}catch(e){throw console.error("Error getting tenant ID:",e),e}},u=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),d=async e=>{try{await o.l.setItem(a,e)}catch(e){throw console.error("Error storing tenant ID:",e),e}},l=async e=>{let{tenantId:t,metadata:n={}}=e;try{if(!t)return void console.error("Cannot store tenant info: No tenant ID provided");await o.l.setItem(a,t),window.__APP_CACHE||(window.__APP_CACHE={}),window.__APP_CACHE.tenant||(window.__APP_CACHE.tenant={}),window.__APP_CACHE.tenant.id=t,window.__APP_CACHE.tenant.metadata=n,window.__APP_CACHE.tenant.timestamp=Date.now();try{sessionStorage.setItem("tenant_id",t),sessionStorage.setItem("tenant_info",JSON.stringify({id:t,metadata:n,timestamp:Date.now()}))}catch(e){console.debug("Could not store tenant info in sessionStorage:",e)}console.debug("[TenantUtils] Stored tenant info for ID: ".concat(t))}catch(e){console.error("Error storing tenant info:",e)}},c=e=>e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e,m=async e=>{try{let{updateUserAttributes:t}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158));await t({userAttributes:{"custom:tenant_ID":e}}),await d(e),console.debug("[TenantUtils] Updated tenant ID in Cognito: ".concat(e))}catch(t){console.error("Error updating tenant ID in Cognito:",t),await d(e)}},g=async e=>{try{await o.l.setItem("auth_tokens",e)}catch(e){throw console.error("Error setting tokens:",e),e}},f=async()=>{try{var e,t,n,s,u,d;let l=await o.l.getItem(a);if(l)return l;let c=await (0,r.H)(),m=await (0,i.$)(),g=(null==c||null==(e=c.attributes)?void 0:e["custom:tenant_ID"])||(null==c||null==(t=c.attributes)?void 0:t["custom:tenantId"])||(null==m||null==(s=m.accessToken)||null==(n=s.payload)?void 0:n["custom:tenant_ID"])||(null==m||null==(d=m.accessToken)||null==(u=d.payload)?void 0:u["custom:tenantId"]);if(!g)return null;return await o.l.setItem(a,g),g}catch(e){return console.error("Error getting tenant ID from Cognito:",e),null}},w=async e=>{try{if(!u(e))return!1;return(await fetch("/api/tenants/".concat(e,"/validate"))).ok}catch(e){return console.error("Error validating tenant ID:",e),!1}},_=e=>{let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return"00000000-0000-4000-a000-".concat(Math.abs(t).toString(16).padStart(12,"0"))},h=async()=>{try{let e=await s();if(!u(e))return console.error("Invalid tenant ID format:",e),null;return e}catch(e){return console.error("Error getting secure tenant ID:",e),null}},A=e=>u(e),p=e=>e?"tenant_".concat(e.replace(/-/g,"_")):"public",C=async()=>{try{let e=await s(),t={"Content-Type":"application/json","x-tenant-id":e};try{let{getCurrentUser:e}=await Promise.all([n.e(58430),n.e(84620),n.e(23639),n.e(38501),n.e(31861),n.e(94901)]).then(n.bind(n,55158)),r=await e();r&&r.userId&&(t["x-user-id"]=r.userId)}catch(e){}return t}catch(e){return console.error("Error getting tenant headers:",e),{"Content-Type":"application/json"}}}},52584:(e,t,n)=>{n.d(t,{u:()=>A});var r=n(87970),i=n(24818),o=n(45103),a=n(27593),s=n(84295),u=n(88726),d=n(85565),l=n(59262),c=n(90808),m=n(55413),g=n(2242),f=n(41811),w=n(83854);let _=e=>(0,c.A)(m.e,(0,g._)("UpdateUserAttributes"),(0,f.T)(),{...w.C,...e});var h=n(32712);let A=async e=>{let{userAttributes:t,options:n}=e,c=r.H.getConfig().Auth?.Cognito,m=n?.clientMetadata;(0,o.$y)(c);let{userPoolEndpoint:g,userPoolId:f}=c,{tokens:w}=await (0,i.$)({forceRefresh:!1});(0,s.H0)(w);let A=_({endpointResolver:(0,h.o)({endpointOverride:g})}),{CodeDeliveryDetailsList:p}=await A({region:(0,u.J)(f),userAgentValue:(0,l.A)(a.BM.UpdateUserAttributes)},{AccessToken:w.accessToken.toString(),ClientMetadata:m,UserAttributes:(0,d.Q)(t)});return{...function(e){let t={};return Object.keys(e)?.forEach(e=>{t[e]={isUpdated:!0,nextStep:{updateAttributeStep:"DONE"}}}),t}(t),...function(e){let t={};return e?.forEach(e=>{let{AttributeName:n,DeliveryMedium:r,Destination:i}=e;n&&(t[n]={isUpdated:!1,nextStep:{updateAttributeStep:"CONFIRM_ATTRIBUTE_WITH_CODE",codeDeliveryDetails:{attributeName:n,deliveryMedium:r,destination:i}}})}),t}(p)}}},59262:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(32307),i=n(27593);let o=(e,t)=>(0,r.fE)({category:i.b7.Auth,action:e,...t})},60584:(e,t,n)=>{n.r(t),n.d(t,{Amplify:()=>r.E,Hub:()=>b,configureAmplify:()=>S,confirmResetPassword:()=>d.P,confirmSignUp:()=>s.z,confirmUserAttribute:()=>h.w,fetchAuthSession:()=>m.$,fetchAuthSessionWithConfig:()=>D,fetchUserAttributes:()=>c.T,fetchUserAttributesWithConfig:()=>R,getCurrentUser:()=>l.H,getCurrentUserWithConfig:()=>N,initAmplify:()=>U,isAmplifyConfigured:()=>F,resendSignUpCode:()=>g.h,resetPassword:()=>u.x,safeSignOut:()=>H,sendUserAttributeVerificationCode:()=>_.c,setUpTOTP:()=>A.x,signIn:()=>o.J,signInWithConfig:()=>k,signInWithRedirect:()=>w.$,signOut:()=>i.C,signOutWithConfig:()=>T,signUp:()=>a.H,updateUserAttributes:()=>f.u});var r=n(63900),i=n(82354),o=n(23639),a=n(95027),s=n(55481),u=n(27755),d=n(80079),l=n(81746),c=n(11024),m=n(24818),g=n(97220),f=n(52584),w=n(15102),_=n(35220),h=n(71194),A=n(35030),p=n(51148),C=n(42749),P=n(49509);let b=p.YZ,y="1o5v84mrgn4gt87khtr179uc5b",I="us-east-1_JPL8vGfb6",v="us-east-1";C.vF.debug("[AmplifyUnified] Configuration values:",{COGNITO_CLIENT_ID:y,COGNITO_USER_POOL_ID:I,AWS_REGION:v});let E=!1,S=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(E&&!e)return C.vF.debug("[AmplifyUnified] Amplify already configured, skipping"),!0;try{e&&(C.vF.info("[AmplifyUnified] Force reconfiguring Amplify"),window.__amplifyConfigured&&(window.__amplifyConfigured=!1))}catch(e){C.vF.error("[AmplifyUnified] Error during force reconfigure:",e)}try{C.vF.info("[AmplifyUnified] Configuring Amplify",{environment:"production",isDevelopment:!1});let e=I||P.env.NEXT_PUBLIC_USER_POOL_ID||"us-east-1_JPL8vGfb6",t=y||P.env.NEXT_PUBLIC_USER_POOL_CLIENT_ID||"1o5v84mrgn4gt87khtr179uc5b";if(!e||!t)return C.vF.error("[AmplifyUnified] Missing required configuration:",{hasUserPoolId:!!e,hasClientId:!!t}),E=!1,!1;let n={Auth:{Cognito:{userPoolId:e,userPoolClientId:t,identityPoolId:P.env.NEXT_PUBLIC_COGNITO_IDENTITY_POOL_ID,region:v||"us-east-1",loginWith:{email:!0,username:!0,phone:!1},httpOptions:{timeout:3e4,connectTimeout:1e4,rejectUnauthorized:!1,retryable:!0,maxRetries:3}}}};C.vF.debug("[AmplifyUnified] Amplify configuration:",{userPoolId:n.Auth.Cognito.userPoolId,userPoolClientId:n.Auth.Cognito.userPoolClientId,region:n.Auth.Cognito.region}),r.E.configure(n);let i=r.E.getConfig();if(!(i&&i.Auth&&i.Auth.Cognito&&i.Auth.Cognito.userPoolId))return C.vF.error("[AmplifyUnified] Configuration verification failed",{hasConfig:!!i,hasAuth:!!(i&&i.Auth),hasCognito:!!(i&&i.Auth&&i.Auth.Cognito)}),E=!1,!1;return b.listen("auth",e=>{if("signOut"===e.payload.event||"signIn_failure"===e.payload.event){var t,n;C.vF.debug("[AmplifyUnified] Auth event that might require reconfiguration:",{event:e.payload.event,data:e.payload.data});let i=r.E.getConfig();(null==i||null==(n=i.Auth)||null==(t=n.Cognito)?void 0:t.userPoolId)||(C.vF.warn("[AmplifyUnified] Configuration lost after auth event, reconfiguring..."),S())}}),E=!0,C.vF.info("[AmplifyUnified] Amplify configured successfully"),window.__amplifyConfigured=!0,!0}catch(e){return C.vF.error("[AmplifyUnified] Failed to configure Amplify:",{error:e.message,stack:e.stack}),E=!1,!1}};try{S()}catch(e){C.vF.error("[AmplifyUnified] Error during initial Amplify configuration:",e)}let F=()=>{var e,t;if(!E)return C.vF.info("[AmplifyUnified] Amplify configuration status check: Not configured"),!1;let n=r.E.getConfig(),i=!!(n&&(null==(t=n.Auth)||null==(e=t.Cognito)?void 0:e.userPoolId));return C.vF.debug("[AmplifyUnified] Amplify configuration status:",{isConfigured:E,hasAuth:i,config:{isConfigured:E,hasAuth:i}}),E&&i},H=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{global:!0};try{C.vF.info("[AmplifyUnified] Amplify configuration status before sign out:",{isConfigured:F()}),F()||(C.vF.warn("[AmplifyUnified] Attempting to reconfigure Amplify before signing out"),S());try{return await (0,i.C)(e),C.vF.info("[AmplifyUnified] Successfully signed out user"),!0}catch(e){if(C.vF.error("[AmplifyUnified] Error during Amplify signOut:",e),"AuthUserPoolException"===e.name||e.message&&e.message.includes("UserPool not configured")){C.vF.warn("[AmplifyUnified] Auth UserPool not configured, attempting recovery"),S();try{window.__APP_CACHE&&(window.__APP_CACHE.auth={},window.__APP_CACHE.user={},C.vF.info("[AmplifyUnified] Cleared app cache for auth data"))}catch(e){C.vF.error("[AmplifyUnified] Error clearing app cache:",e)}}return!0}}catch(e){return C.vF.error("[AmplifyUnified] Unexpected error in safeSignOut:",e),!0}},x=async function(e){for(var t,n,r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];try{if(e===o.J)try{if(await (0,l.H)()){C.vF.warn("[AmplifyUnified] User already authenticated, signing out first");try{await H({global:!0})}catch(e){C.vF.error("[AmplifyUnified] Error signing out before signIn:",e)}}}catch(e){(null==(t=e.message)?void 0:t.includes("not authenticated"))||C.vF.warn("[AmplifyUnified] Error checking current user before signIn:",e)}F()||(C.vF.warn("[AmplifyUnified] Amplify not configured before auth function call, configuring now"),S(!0));let r=0;for(;r<=3;)try{return await e(...i)}catch(i){if(r++,C.vF.error("[AmplifyUnified] Error in ".concat(e.name," (retry ").concat(r,"/").concat(3,"):"),{name:i.name,message:i.message,code:i.code,statusCode:null==i||null==(n=i.response)?void 0:n.status,retryable:i.retryable}),("AuthUserPoolException"===i.name||i.message&&i.message.includes("UserPool not configured"))&&(C.vF.warn("[AmplifyUnified] Auth UserPool not configured, attempting recovery (retry ".concat(r,"/").concat(3,")")),S(!0),r<=3)){await new Promise(e=>setTimeout(e,1e3*r));continue}if(("NetworkError"===i.name||i.message&&(i.message.includes("network")||i.message.includes("Network")||i.message.includes("SSL")||i.message.includes("certificate")||i.message.includes("CORS")||i.message.includes("timeout"))||"NETWORK_ERROR"===i.code||"NetworkingError"===i.code)&&(C.vF.warn("[AmplifyUnified] Network error, attempting retry with backoff (retry ".concat(r,"/").concat(3,")")),S(!0),r<=3)){let e=Math.min(2e3*Math.pow(2,r-1),1e4);C.vF.info("[AmplifyUnified] Waiting ".concat(e,"ms before retry")),await new Promise(t=>setTimeout(t,e));continue}if(r>3)throw i;let t=1e3*r;await new Promise(e=>setTimeout(e,t))}throw Error("[AmplifyUnified] Failed to execute ".concat(e.name," after ").concat(3," retries"))}catch(e){throw C.vF.error("[AmplifyUnified] Error in ensureConfigAndCall:",e),e}},U=()=>window.__amplifyConfigured?window.__amplifyConfigured:(C.vF.info("[AmplifyUnified] Initializing Amplify from hook"),S(),!0),k=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return x(o.J,...t)},T=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return x(i.C,...t)},N=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return x(l.H,...t)},R=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return x(c.T,...t)},D=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return x(m.$,...t)}},69496:(e,t,n)=>{n.d(t,{T:()=>m});var r=n(45103),i=n(57762),o=n(27593),a=n(88726),s=n(84295),u=n(85565),d=n(59262),l=n(50581),c=n(32712);let m=async e=>{let t=e.getConfig().Auth?.Cognito;(0,r.$y)(t);let{userPoolEndpoint:n,userPoolId:m}=t,{tokens:g}=await (0,i.$)(e,{forceRefresh:!1});(0,s.H0)(g);let f=(0,l.N)({endpointResolver:(0,c.o)({endpointOverride:n})}),{UserAttributes:w}=await f({region:(0,a.J)(m),userAgentValue:(0,d.A)(o.BM.FetchUserAttributes)},{AccessToken:g.accessToken.toString()});return(0,u.J)(w)}},85565:(e,t,n)=>{function r(e){return Object.entries(e).map(([e,t])=>({Name:e,Value:t}))}function i(e){let t={};return e?.forEach(e=>{e.Name&&(t[e.Name]=e.Value)}),t}n.d(t,{J:()=>i,Q:()=>r})}}]);