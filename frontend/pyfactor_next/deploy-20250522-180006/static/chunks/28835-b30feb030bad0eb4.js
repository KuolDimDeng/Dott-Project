"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[28835],{28835:(e,r,t)=>{t.r(r),t.d(r,{confirmUserBypass:()=>f,confirmUserDirectly:()=>l,getRefreshedAccessToken:()=>c,isTokenExpired:()=>s,manualConfirmUser:()=>g,signInWithSocialProvider:()=>a});var n=t(39786),i=t(42749),o=t(60584);let s=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e)return!0;try{let t=(0,n.s)(e);if(!t.exp)return!1;let i=Math.floor(Date.now()/1e3);return t.exp<=i-r}catch(e){return i.vF.error("[Auth] Error checking token expiration:",e),!0}},a=async e=>{try{i.vF.debug("[Auth] Initiating sign in with ".concat(e)),await (0,o.signInWithRedirect)({provider:e})}catch(r){throw i.vF.error("[Auth] ".concat(e," sign in failed:"),r),r}},c=async()=>{try{var e;i.vF.debug("[Auth] Attempting to refresh access token");let{fetchAuthSession:r}=await Promise.resolve().then(t.bind(t,60584)),n=await r();if(null==n||null==(e=n.tokens)?void 0:e.accessToken)return n.tokens.accessToken.toString();return null}catch(e){return i.vF.error("[Auth] Failed to refresh access token:",e),null}},u=()=>window.location.origin;async function l(e){if(!e)return console.error("No email provided for confirmation"),{success:!1,error:"No email provided"};console.log("Attempting to directly confirm user: ".concat(e));try{let r,t=u(),n="".concat(t,"/api/admin/confirm-user");console.log("Making request to: ".concat(n," with email: ").concat(e));let i=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(console.log("Response status: ".concat(i.status," ").concat(i.statusText)),!i.ok){let e,r=null;try{let t=await i.text();console.log("Raw response text:",t);try{t&&t.trim()?(r=JSON.parse(t),console.log("Parsed error response:",r)):(console.log("Empty response text received"),r={error:"Empty response from server"})}catch(e){console.error("Error parsing JSON response:",e),r={error:t||"".concat(i.status," ").concat(i.statusText)}}e=(null==r?void 0:r.error)||"".concat(i.status," ").concat(i.statusText),console.error("API error response:",r||{status:i.status,statusText:i.statusText})}catch(r){console.error("Error handling API response:",r),e="".concat(i.status," ").concat(i.statusText)}return console.error("Failed to confirm user:",e),{success:!1,status:i.status,statusText:i.statusText,error:"Failed to confirm user: ".concat(e)}}try{let e=await i.text();console.log("Success response text:",e),r=e?JSON.parse(e):{success:!0}}catch(e){console.warn("Error parsing success response:",e),r={success:!0,message:"User confirmed (no details available)"}}return console.log("User confirmed successfully:",r),{success:!0,data:r}}catch(e){return console.error("Network error confirming user:",e),{success:!1,error:e.message||"Unknown error",networkError:!0}}}let f=async e=>{if(!e)return console.error("Email is required to confirm a user"),{success:!1,error:"Email is required"};try{let r=u(),t=await fetch("".concat(r,"/api/admin/confirm-user"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(t.ok){let e=await t.json();return console.log("User confirmed successfully:",e),{success:!0,result:e}}{let e;try{e=await t.json()}catch(r){e={error:"Unknown error"}}return console.error("Failed to confirm user:",e),{success:!1,error:e.error||"Failed to confirm user"}}}catch(e){return console.error("Error confirming user:",e),{success:!1,error:e.message||"Unknown error"}}},g=async e=>{console.log("Manually confirming user:",e);try{let r=await l(e);if(r.success)return console.log("✅ User confirmed successfully:",r.data),{success:!0,message:"User confirmed successfully"};return console.error("❌ Failed to confirm user:",r.error),{success:!1,error:r.error}}catch(e){return console.error("❌ Error during manual confirmation:",e),{success:!1,error:e.message||"Unknown error"}}}},60584:(e,r,t)=>{t.r(r),t.d(r,{Amplify:()=>n.E,Hub:()=>C,configureAmplify:()=>k,confirmResetPassword:()=>u.P,confirmSignUp:()=>a.z,confirmUserAttribute:()=>h.w,fetchAuthSession:()=>g.$,fetchAuthSessionWithConfig:()=>W,fetchUserAttributes:()=>f.T,fetchUserAttributesWithConfig:()=>R,getCurrentUser:()=>l.H,getCurrentUserWithConfig:()=>S,initAmplify:()=>O,isAmplifyConfigured:()=>b,resendSignUpCode:()=>d.h,resetPassword:()=>c.x,safeSignOut:()=>I,sendUserAttributeVerificationCode:()=>p.c,setUpTOTP:()=>A.x,signIn:()=>o.J,signInWithConfig:()=>x,signInWithRedirect:()=>y.$,signOut:()=>i.C,signOutWithConfig:()=>N,signUp:()=>s.H,updateUserAttributes:()=>m.u});var n=t(63900),i=t(82354),o=t(23639),s=t(95027),a=t(55481),c=t(27755),u=t(80079),l=t(81746),f=t(11024),g=t(24818),d=t(97220),m=t(52584),y=t(15102),p=t(35220),h=t(71194),A=t(35030),v=t(51148),w=t(42749),U=t(49509);let C=v.YZ,F="1o5v84mrgn4gt87khtr179uc5b",P="us-east-1_JPL8vGfb6",E="us-east-1";w.vF.debug("[AmplifyUnified] Configuration values:",{COGNITO_CLIENT_ID:F,COGNITO_USER_POOL_ID:P,AWS_REGION:E});let _=!1,k=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(_&&!e)return w.vF.debug("[AmplifyUnified] Amplify already configured, skipping"),!0;try{e&&(w.vF.info("[AmplifyUnified] Force reconfiguring Amplify"),window.__amplifyConfigured&&(window.__amplifyConfigured=!1))}catch(e){w.vF.error("[AmplifyUnified] Error during force reconfigure:",e)}try{w.vF.info("[AmplifyUnified] Configuring Amplify",{environment:"production",isDevelopment:!1});let e=P||U.env.NEXT_PUBLIC_USER_POOL_ID||"us-east-1_JPL8vGfb6",r=F||U.env.NEXT_PUBLIC_USER_POOL_CLIENT_ID||"1o5v84mrgn4gt87khtr179uc5b";if(!e||!r)return w.vF.error("[AmplifyUnified] Missing required configuration:",{hasUserPoolId:!!e,hasClientId:!!r}),_=!1,!1;let t={Auth:{Cognito:{userPoolId:e,userPoolClientId:r,identityPoolId:U.env.NEXT_PUBLIC_COGNITO_IDENTITY_POOL_ID,region:E||"us-east-1",loginWith:{email:!0,username:!0,phone:!1},httpOptions:{timeout:3e4,connectTimeout:1e4,rejectUnauthorized:!1,retryable:!0,maxRetries:3}}}};w.vF.debug("[AmplifyUnified] Amplify configuration:",{userPoolId:t.Auth.Cognito.userPoolId,userPoolClientId:t.Auth.Cognito.userPoolClientId,region:t.Auth.Cognito.region}),n.E.configure(t);let i=n.E.getConfig();if(!(i&&i.Auth&&i.Auth.Cognito&&i.Auth.Cognito.userPoolId))return w.vF.error("[AmplifyUnified] Configuration verification failed",{hasConfig:!!i,hasAuth:!!(i&&i.Auth),hasCognito:!!(i&&i.Auth&&i.Auth.Cognito)}),_=!1,!1;return C.listen("auth",e=>{if("signOut"===e.payload.event||"signIn_failure"===e.payload.event){var r,t;w.vF.debug("[AmplifyUnified] Auth event that might require reconfiguration:",{event:e.payload.event,data:e.payload.data});let i=n.E.getConfig();(null==i||null==(t=i.Auth)||null==(r=t.Cognito)?void 0:r.userPoolId)||(w.vF.warn("[AmplifyUnified] Configuration lost after auth event, reconfiguring..."),k())}}),_=!0,w.vF.info("[AmplifyUnified] Amplify configured successfully"),window.__amplifyConfigured=!0,!0}catch(e){return w.vF.error("[AmplifyUnified] Failed to configure Amplify:",{error:e.message,stack:e.stack}),_=!1,!1}};try{k()}catch(e){w.vF.error("[AmplifyUnified] Error during initial Amplify configuration:",e)}let b=()=>{var e,r;if(!_)return w.vF.info("[AmplifyUnified] Amplify configuration status check: Not configured"),!1;let t=n.E.getConfig(),i=!!(t&&(null==(r=t.Auth)||null==(e=r.Cognito)?void 0:e.userPoolId));return w.vF.debug("[AmplifyUnified] Amplify configuration status:",{isConfigured:_,hasAuth:i,config:{isConfigured:_,hasAuth:i}}),_&&i},I=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{global:!0};try{w.vF.info("[AmplifyUnified] Amplify configuration status before sign out:",{isConfigured:b()}),b()||(w.vF.warn("[AmplifyUnified] Attempting to reconfigure Amplify before signing out"),k());try{return await (0,i.C)(e),w.vF.info("[AmplifyUnified] Successfully signed out user"),!0}catch(e){if(w.vF.error("[AmplifyUnified] Error during Amplify signOut:",e),"AuthUserPoolException"===e.name||e.message&&e.message.includes("UserPool not configured")){w.vF.warn("[AmplifyUnified] Auth UserPool not configured, attempting recovery"),k();try{window.__APP_CACHE&&(window.__APP_CACHE.auth={},window.__APP_CACHE.user={},w.vF.info("[AmplifyUnified] Cleared app cache for auth data"))}catch(e){w.vF.error("[AmplifyUnified] Error clearing app cache:",e)}}return!0}}catch(e){return w.vF.error("[AmplifyUnified] Unexpected error in safeSignOut:",e),!0}},T=async function(e){for(var r,t,n=arguments.length,i=Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];try{if(e===o.J)try{if(await (0,l.H)()){w.vF.warn("[AmplifyUnified] User already authenticated, signing out first");try{await I({global:!0})}catch(e){w.vF.error("[AmplifyUnified] Error signing out before signIn:",e)}}}catch(e){(null==(r=e.message)?void 0:r.includes("not authenticated"))||w.vF.warn("[AmplifyUnified] Error checking current user before signIn:",e)}b()||(w.vF.warn("[AmplifyUnified] Amplify not configured before auth function call, configuring now"),k(!0));let n=0;for(;n<=3;)try{return await e(...i)}catch(i){if(n++,w.vF.error("[AmplifyUnified] Error in ".concat(e.name," (retry ").concat(n,"/").concat(3,"):"),{name:i.name,message:i.message,code:i.code,statusCode:null==i||null==(t=i.response)?void 0:t.status,retryable:i.retryable}),("AuthUserPoolException"===i.name||i.message&&i.message.includes("UserPool not configured"))&&(w.vF.warn("[AmplifyUnified] Auth UserPool not configured, attempting recovery (retry ".concat(n,"/").concat(3,")")),k(!0),n<=3)){await new Promise(e=>setTimeout(e,1e3*n));continue}if(("NetworkError"===i.name||i.message&&(i.message.includes("network")||i.message.includes("Network")||i.message.includes("SSL")||i.message.includes("certificate")||i.message.includes("CORS")||i.message.includes("timeout"))||"NETWORK_ERROR"===i.code||"NetworkingError"===i.code)&&(w.vF.warn("[AmplifyUnified] Network error, attempting retry with backoff (retry ".concat(n,"/").concat(3,")")),k(!0),n<=3)){let e=Math.min(2e3*Math.pow(2,n-1),1e4);w.vF.info("[AmplifyUnified] Waiting ".concat(e,"ms before retry")),await new Promise(r=>setTimeout(r,e));continue}if(n>3)throw i;let r=1e3*n;await new Promise(e=>setTimeout(e,r))}throw Error("[AmplifyUnified] Failed to execute ".concat(e.name," after ").concat(3," retries"))}catch(e){throw w.vF.error("[AmplifyUnified] Error in ensureConfigAndCall:",e),e}},O=()=>window.__amplifyConfigured?window.__amplifyConfigured:(w.vF.info("[AmplifyUnified] Initializing Amplify from hook"),k(),!0),x=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return T(o.J,...r)},N=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return T(i.C,...r)},S=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return T(l.H,...r)},R=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return T(f.T,...r)},W=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return T(g.$,...r)}}}]);