# HTTPS Configuration for Next.js Application

This document outlines the HTTPS configuration for the Next.js application to ensure secure connections in both development and production environments.

## Overview

The application uses HTTPS with SSL certificates generated by `mkcert` for local development. This ensures secure communication between the frontend and backend, which is essential for production readiness and security.

## SSL Certificates

SSL certificates are stored in the `certificates` directory at the project root. The following files are required:

- `localhost+1.pem` - The SSL certificate
- `localhost+1-key.pem` - The SSL private key

To generate these certificates, use the `mkcert` tool:

```bash
# Install mkcert
brew install mkcert

# Install the local CA in the system trust store
mkcert -install

# Generate certificates for localhost and 127.0.0.1
mkcert localhost 127.0.0.1
```

Move the generated certificates to the `certificates` directory at the project root.

## Starting the Application with HTTPS

Use the provided `start-https-servers.sh` script in the project root to start both the frontend and backend with HTTPS:

```bash
# Make the script executable
chmod +x start-https-servers.sh

# Run the script
./start-https-servers.sh
```

Alternatively, you can start each component individually:

1. Start the backend:
   ```bash
   cd backend/pyfactor
   python run_https_server_fixed.py
   ```

2. Start the frontend:
   ```bash
   cd frontend/pyfactor_next
   ./start-https.sh
   ```

## HTTPS Implementation Details

### Backend (Python)

The backend uses a custom HTTPS server implemented in `run_https_server_fixed.py`. This server:

- Uses the SSL certificates from the `certificates` directory
- Runs on `https://127.0.0.1:8000`
- Handles all API requests securely

### Frontend (Next.js)

The frontend uses a custom HTTPS server implemented in `server/https-server.js`. This server:

- Uses the SSL certificates from the `certificates` directory
- Runs on `https://localhost:3000`
- Proxies API requests to the backend at `https://127.0.0.1:8000`
- Handles all Next.js routes securely

## Common Issues and Troubleshooting

### SSL_ERROR_RX_RECORD_TOO_LONG

This error occurs when a server is configured to use HTTPS but is actually serving HTTP content. To fix:

1. Ensure you're using the custom HTTPS server implementation (`https-server.js`)
2. Verify that the SSL certificates are correctly configured
3. Make sure the `start-https.sh` script is being used to start the Next.js server

### Certificate Not Trusted

If the browser shows a certificate warning:

1. Ensure `mkcert -install` has been run to add the local CA to your system's trust store
2. Verify that the correct certificate files are being used
3. Restart your browser after making changes

## Production Considerations

For production deployment:

1. Use proper SSL certificates from a trusted Certificate Authority
2. Configure environment variables appropriately for production
3. Ensure proper HTTP-to-HTTPS redirection
4. Implement proper security headers 