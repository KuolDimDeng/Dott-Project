files:
  "/etc/nginx/conf.d/optimize.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      # Optimize for single instance
      worker_processes auto;
      worker_connections 1024;
      
      # Optimize for t3.small
      client_max_body_size 10M;
      client_body_buffer_size 128k;
      
      # Gzip compression
      gzip on;
      gzip_vary on;
      gzip_min_length 1000;
      gzip_proxied any;
      gzip_comp_level 6;
      gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json;
      
      # Cache static files
      location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
      }

# Commenting out nginx reload to fix deployment issues
# container_commands:
#   01_reload_nginx:
#     command: "service nginx reload"
#     ignoreErrors: true 