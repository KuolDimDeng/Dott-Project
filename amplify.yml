version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Installing dependencies..."
        - npm install -g pnpm@8.10.0 || npm install -g yarn
        - echo "DEBUG: Current directory is $(pwd)"
        - echo "DEBUG: Listing root directory contents:" && ls -la
        - echo "DEBUG: Checking if frontend directory exists:" && ls -la frontend/ || echo "frontend directory not found"
        - cd frontend/pyfactor_next && pnpm install --no-frozen-lockfile
    build:
      commands:
        - echo "Building Next.js application..."
        - echo "DEBUG: Build phase - Current directory is $(pwd)"
        - echo "DEBUG: Build phase - Listing root directory contents:" && ls -la
        - echo "DEBUG: Build phase - Checking if frontend directory exists:" && ls -la frontend/ || echo "frontend directory not found"
        - echo "DEBUG: Build phase - Checking if frontend/pyfactor_next exists:" && ls -la frontend/pyfactor_next/ || echo "frontend/pyfactor_next directory not found"
        - cd frontend/pyfactor_next && export NODE_ENV=production && export NEXT_PUBLIC_API_URL=https://api.dottapps.com && export BACKEND_API_URL=https://api.dottapps.com && export USE_DATABASE=true && export MOCK_DATA_DISABLED=true && export PROD_MODE=true && export NODE_OPTIONS="--max-old-space-size=4096" && pnpm run build
  artifacts:
    baseDirectory: frontend/pyfactor_next/.next
    files:
      - '**/*'
  cache:
    paths:
      - frontend/pyfactor_next/node_modules/**/*
      - frontend/pyfactor_next/.next/cache/**/* 